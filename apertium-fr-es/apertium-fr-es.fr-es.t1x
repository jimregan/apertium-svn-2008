<?xml version="1.0" encoding="ISO-8859-1"?> <!-- -*- nxml -*- -->
<transfer default="chunk">
  <section-def-cats>
    <def-cat n="nom">
      <cat-item tags="n.*"/><!--Falten els altres np (antroponims) que tenen gen i nbr, revisar regles.-->
      <cat-item tags="np.loc.*"/>
    </def-cat>

     <def-cat n="ant">
      <cat-item tags="np.ant.*"/>
    </def-cat>

    <def-cat n="adj">
      <cat-item tags="adj.*"/>
      <cat-item tags="adj.pos.*"/>
    </def-cat>
    <def-cat n="det"><!--Determinants i predeterminants, van anteposats en catal�-->
      <cat-item tags="det.dem.*"/>
      <cat-item tags="det.ind.*"/>
      <cat-item tags="det.def.*"/>
      <cat-item tags="det.pos.*"/>
      <cat-item tags="det.qnt.*"/>
      <cat-item tags="det.itg.*"/>
      <cat-item tags="det.ord.*"/>
      <cat-item tags="predet.*"/>
      <!-- <cat-item tags="num.*"/> -->
    </def-cat>

    <def-cat n="num">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
    </def-cat>

    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>

    <def-cat n="prpers">
      <cat-item lemma="prpers" tags="prn.*"/>
    </def-cat>

    <def-cat n="tn_itg_pos"><!--Aqu�no hi entren els pronoms personals, caldr�fer-ne un xunc a part. -->
      <cat-item tags="prn.tn.m.*"/>
      <cat-item tags="prn.tn.f.*"/>
      <cat-item tags="prn.tn.mf.*"/>
      <cat-item tags="prn.itg.*"/>
      <cat-item tags="prn.pos.*"/>
    </def-cat>
    
    <def-cat n="enc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>

    <def-cat n="pro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>

    <def-cat n="verbnm_inf_ger"><!--verb no modal, infinitiu i gerundi -->
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vblex.pron.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbser.pron.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbhaver.pron.inf"/>
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vblex.pron.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbser.pron.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbhaver.pron.ger"/>
    </def-cat>

    <def-cat n="verbnm_imp"><!--verb no modal, imperatiu -->
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vblex.pron.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbser.pron.imp.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbhaver.pron.imp.*"/>
    </def-cat>

    <def-cat n="verbm"><!--verb modal -->
      <cat-item tags="vbmod.*"/>
    </def-cat>

    <def-cat n="verbm_inf_ger"><!--verb modal, infinitiu o gerundi -->
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>

    <def-cat n="haver">
      <cat-item tags="vbhaver.*"/>
    </def-cat>

    <def-cat n="caldre">
      <cat-item lemma="caldre" tags="vbmod.*"/>
    </def-cat>

    <def-cat n="verbcj">
      <cat-item tags="vblex.cni.*"/>
      <cat-item tags="vblex.fti.*"/>
      <cat-item tags="vblex.ifi.*"/>
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vblex.pii.*"/>
      <cat-item tags="vblex.pis.*"/>
      <cat-item tags="vblex.pri.*"/>
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vbser.cni.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbhaver.cni.*"/>
      <cat-item tags="vbhaver.fti.*"/>
      <cat-item tags="vbhaver.ifi.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbhaver.pii.*"/>
      <cat-item tags="vbhaver.pis.*"/>
      <cat-item tags="vbhaver.pri.*"/>
      <cat-item tags="vbhaver.prs.*"/>
      <cat-item tags="vbmod.cni.*"/>
      <cat-item tags="vbmod.fti.*"/>
      <cat-item tags="vbmod.ifi.*"/>
      <cat-item tags="vbmod.imp.*"/>
      <cat-item tags="vbmod.pii.*"/>
      <cat-item tags="vbmod.pis.*"/>
      <cat-item tags="vbmod.pri.*"/>
      <cat-item tags="vbmod.prs.*"/>
      <cat-item tags="vblex.pron.cni.*"/>
      <cat-item tags="vblex.pron.fti.*"/>
      <cat-item tags="vblex.pron.ifi.*"/>
      <cat-item tags="vblex.pron.imp.*"/>
      <cat-item tags="vblex.pron.pii.*"/>
      <cat-item tags="vblex.pron.pis.*"/>
      <cat-item tags="vblex.pron.pri.*"/>
      <cat-item tags="vblex.pron.prs.*"/>
    </def-cat>

    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vblex.pron.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/><!--ATENCI� CANVI -->
    </def-cat>

    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vblex.pron.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>

    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vblex.pron.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>


    <def-cat n="anar">
      <cat-item lemma="anar" tags="vblex.pri.*"/>
    </def-cat>

    <def-cat n="adv_preadv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>

    <def-cat n="adv">
      <cat-item tags="adv"/>
    </def-cat>

    <def-cat n="advitg">
      <cat-item tags="adv.itg"/>
    </def-cat>

    <def-cat n="no">
      <cat-item lemma="no" tags="adv"/>
    </def-cat>

    <def-cat n="cnjcoo">
      <cat-item lemma="i" tags="cnjcoo"/>
      <cat-item lemma="o" tags="cnjcoo"/>
      <cat-item lemma="per� tags="cnjcoo"/>
    </def-cat>

     <def-cat n="cnj">
      <cat-item tags="cnjcoo"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="cnjadv"/>
    </def-cat>

    <def-cat n="per">
      <cat-item lemma="per" tags="pr"/>
    </def-cat>

    <def-cat n="de">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>

    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>

  </section-def-cats>
  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="n.unc"/>
      <attr-item tags="np.loc"/>
      <attr-item tags="np.ant"/>
    </def-attr>

    <def-attr n="a_np_acr">
      <attr-item tags="np"/>
      <attr-item tags="acr"/>
    </def-attr>

    <def-attr n="a_adj">          
      <attr-item tags="adj"/>
      <attr-item tags="adj.sint"/>
      <attr-item tags="adj.sint.comp"/>
      <attr-item tags="adj.sint.sup"/>
      <attr-item tags="adj.pos"/>
    </def-attr>  


    <def-attr n="a_det">
      <attr-item tags="det.dem"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.def"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="det.qnt"/>
      <attr-item tags="det.itg"/>
      <attr-item tags="det.ord"/>
      <attr-item tags="predet"/>
      <attr-item tags="num"/>
    </def-attr>

    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>

    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="vaux"/>
    </def-attr>

    <def-attr n="pron">
      <attr-item tags="pron"/>
    </def-attr>

    <def-attr n="sep">
      <attr-item tags="sep"/>
    </def-attr>

    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
      <attr-item tags="adv.itg"/>
    </def-attr>

    <def-attr n="a_pp">
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
      <attr-item tags="vbmod.pp"/>
      <attr-item tags="vblex.sep.pp"/>
      <attr-item tags="vbser.sep.pp"/>
      <attr-item tags="vbmod.sep.pp"/>
      <attr-item tags="vaux.pp"/>
      <attr-item tags="vbhaver.pp"/>
    </def-attr>

    <def-attr n="a_prn">
      <attr-item tags="prn"/>
    </def-attr>

    <def-attr n="tipus_prn">
      <attr-item tags="subj"/>
      <attr-item tags="obj"/>
      <attr-item tags="tn"/>
      <attr-item tags="itg"/>
      <attr-item tags="pos"/>
    </def-attr>
    <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>

    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="temps">
      <attr-item tags="cni"/>
      <attr-item tags="fti"/>  
      <attr-item tags="ifi"/>
      <attr-item tags="imp"/>
      <attr-item tags="pii"/>
      <attr-item tags="pis"/>
      <attr-item tags="pri"/>
      <attr-item tags="prs"/>
      <attr-item tags="pp"/><!-- ? -->
      <attr-item tags="ger"/><!-- ? -->
      <attr-item tags="inf"/><!-- ? -->
    </def-attr>



    <def-attr n="neg">
      <attr-item tags="NEG"/>
    </def-attr>  

  </section-def-attrs>
  <section-def-vars>
    <def-var n="nombre"/>
    <def-var n="genere"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
    <def-var n="caseFirstWord"/> 
    <def-var n="lema"/>
    <def-var n="EOS"/>
    <def-var n="paraula1"/>
    <def-var n="SVnegatiu"/>
    <def-var n="auxiliar"/>
  </section-def-vars>

  <section-def-lists>

    <def-list n="det_canviant">
      <list-item v="un"/>
      <list-item v="un altre"/>
      <list-item v="poc"/>
      <list-item v="quant"/>
      <list-item v="menys"/>
      <list-item v="gaire"/>
      <list-item v="tant"/>
      <list-item v="massa"/>
    </def-list>
  </section-def-lists>


  <section-def-macros>
    

    <def-macro n="f_bcond" npar="1"><!--Per mirar si el blanc cont�o no format. Cal posar aquesta funci�en les regles en qu�desaparegui alguna paraula, per tal de decidir si el blanc de la paraula eliminada s'ha d'eliminar o conservar. Si cont�format cal conservar-la, si no en cont�cal eliminar-la perqu�no apareguin dos espais seguits. -->
      <choose>
	<when>
	  <test>
	    <not>
	      <equal>
		<b pos="1"/>
		<lit v=" "/>
	      </equal>
	    </not>
	  </test>
	  <out>
	    <b pos="1"/>
	  </out>
	</when>     	    
      </choose>
    </def-macro>


    <def-macro n="nombre_nom" npar="1">
      <let>
	<var n="nombre"/>
	<lit v=""/>
      </let>
      <choose>
	<when>
	  <test>
	    <and>
	      <equal>
		<clip pos="1" side="sl" part="nbr"/>
		<lit-tag v="sg"/>
	      </equal>
	      <equal>
		<clip pos="1" side="tl" part="nbr"/>
		<lit-tag v="pl"/>
	      </equal>
	    </and>
	  </test>
	  <let>
	    <var n="nombre"/>
	    <lit-tag v="pl_slsg"/>
	  </let>
	</when>
	<when>
	  <test>
	    <and>
	      <equal>
		<clip pos="1" side="sl" part="nbr"/>
		<lit-tag v="pl"/>
	      </equal>
	      <equal>
		<clip pos="1" side="tl" part="nbr"/>
		<lit-tag v="sg"/>
	      </equal>
	    </and>
	  </test>
	  <let>
	    <var n="nombre"/>
	    <lit-tag v="sg_slpl"/>
	  </let>
	</when>
	<otherwise>
	  <let>
	    <var n="nombre"/>
	    <clip pos="1" side="tl" part="nbr"/>
	  </let>
	</otherwise>
      </choose> 
    </def-macro>

    <def-macro n="firstWord" npar="1">
      <choose>
	<when>
	  <test>
	    <equal>
	      <clip pos="1" side="sl" part="a_np_acr"/>
	      <lit v=""/>
	    </equal>
	  </test>
	  <choose>
	    <when>
	      <test>
		<equal> 
		  <var n="EOS"/>
		  <lit v="true"/>
		</equal> 
	      </test>
	      <modify-case>
		<clip pos="1" side="tl" part="lem"/>
		<lit v="aa"/>
	      </modify-case>
	      <let>
		<var n="caseFirstWord"/>
		<lit v="Aa"/>
	      </let>
	    </when>
	  </choose>
	</when>
	<otherwise>
	  <let>
	    <var n="caseFirstWord"/>
	    <lit v="aa"/>
	  </let>
	</otherwise>
      </choose>
      <let>
	<var n="EOS"/>
	<lit v="false"/>
      </let>
    </def-macro>

</section-def-macros> 

  <section-rules>
 <rule comment="REGLA: NOM (per a collocar la cua en les multiparaules amb g">
      <pattern>
	<pattern-item n="nom"/>
      </pattern>
      <action>
	<call-macro n="firstWord">
	  <with-param pos="1"/>
	</call-macro>
	<call-macro n="nombre_nom">
	  <with-param pos="1"/>
	</call-macro>
	<out>
	  <chunk name="nom" case="caseFirstWord">
	    <tags>
	      <tag><lit-tag v="SN"/></tag>
	      <tag><clip pos="1" side="sl" part="gen"/></tag>
	      <tag><var n="nombre"/></tag>
	    </tags>
	    <lu>   
	      <clip pos="1" side="tl" part="lemh"/> 
	      <clip pos="1" side="tl" part="a_nom"/>
	      <clip pos="1" side="tl" part="nbr"/>
	      <clip pos="1" side="tl" part="lemq"/>
	    </lu>
	  </chunk>
	</out>
	<let>
	  <var n="caseFirstWord"/>
	  <lit v="aa"/>
	</let>
      </action>
    </rule>



    <rule comment="PRN personal">
      <pattern>
	<pattern-item n="prpers"/>
      </pattern>
      <action>
	<call-macro n="firstWord">
	  <with-param pos="1"/>
	</call-macro>
	<out>
	  <chunk name="prpers" case="caseFirstWord">
	    <tags>
	      <tag><lit-tag v="SN"/></tag>
	      <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
	      <tag><clip pos="1" side="tl" part="pers"/></tag>
	      <tag><clip pos="1" side="tl" part="gen"/></tag>
	      <tag><clip pos="1" side="tl" part="nbr"/></tag>
	    </tags>
	    <lu>   
	      <clip pos="1" side="tl" part="lem"/>  
	      <clip pos="1" side="tl" part="a_prn"/>  
	      <clip pos="1" side="tl" part="tipus_prn" link-to="2"/> 
	      <clip pos="1" side="tl" part="pers"/>
	      <clip pos="1" side="tl" part="gen"/>
	      <clip pos="1" side="tl" part="nbr"/>
	    </lu> 
	  </chunk>
	</out>  
	<let>
	  <var n="caseFirstWord"/>
	  <lit v="aa"/>
	</let>
      </action>
    </rule>
    

 <rule comment="CNJ">
      <pattern>
	<pattern-item n="cnj"/>
      </pattern>
      <action>
	<call-macro n="firstWord">
	  <with-param pos="1"/>
	</call-macro>	
	<out>
	  <chunk name="cnj" case="caseFirstWord">
	    <tags>
	      <tag><clip pos="1" side="tl" part="tags"/></tag>		
	    </tags>
	    <lu>
	      <clip pos="1" side="tl" part="whole"/>
	    </lu>
	  </chunk>
	</out>
	<let>
	  <var n="caseFirstWord"/>
	  <lit v="aa"/>
	</let>
      </action>
    </rule>

 <rule comment="de">
      <pattern>
	<pattern-item n="de"/>
      </pattern>
      <action>
	<call-macro n="firstWord">
	  <with-param pos="1"/>
	</call-macro>
	<out>
	  <chunk name="de" case="caseFirstWord">
	    <tags>
	      <tag><lit-tag v="PREP"/></tag>
	    </tags>
	    <lu>
	      <clip pos="1" side="tl" part="whole"/>
	    </lu>
	  </chunk>
	</out>
	<let>
	  <var n="caseFirstWord"/>
	  <lit v="aa"/>
	</let>
      </action>
    </rule>


    <rule comment="PREP">
      <pattern>
	<pattern-item n="prep"/>
      </pattern>
      <action>
	<call-macro n="firstWord">
	  <with-param pos="1"/>
	</call-macro>
	<out>
	  <chunk name="pr" case="caseFirstWord">
	    <tags>
	      <tag><lit-tag v="PREP"/></tag>
	    </tags>
	    <lu>
	      <clip pos="1" side="tl" part="whole"/>
	    </lu>
	  </chunk>
	</out>
	<let>
	  <var n="caseFirstWord"/>
	  <lit v="aa"/>
	</let>
      </action>
    </rule>

    <rule> <!-- REGLA: reset variables-->
      <pattern>
	<pattern-item n="sent"/>
      </pattern>
      <action>
	<let>
	  <var n="nombre"/>
	  <lit-tag v="sg"/>
	</let>
	<let>
	  <var n="genere"/>
	  <lit-tag v="m"/>
	</let>
	<choose>
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" side="sl" part="lem"/>
		    <lit v=";"/>
		  </equal>
		  <equal>
		    <clip pos="1" side="sl" part="lem"/>
		    <lit v=":"/>
		  </equal>
		</or>
	      </not>
	    </test>	      
	    <let>
	      <var n="EOS"/>
	      <lit v="true"/>
	    </let>
	  </when>
	</choose>
	<out>
	  <chunk name="punt">
	    <tags>
	      <tag><lit-tag v="sent"/></tag>
	    </tags>
	    <lu>
	      <clip pos="1" side="tl" part="whole"/>
	    </lu>
	  </chunk>
	</out>
      </action>
    </rule>
    

  </section-rules>
</transfer>

