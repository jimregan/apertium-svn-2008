\documentclass [12pt,a4paper]{book}
%\ifx\pdfoutput\undefined
%\usepackage[dvips]{graphicx}
%\else
%\usepackage[pdftex]{graphicx}
%\usepackage{type1cm}
%\fi
\usepackage[dvips]{graphicx}
\usepackage{rotating}
\usepackage{palatino,helvet}
\usepackage[spanish]{babel}
\usepackage[latin1]{inputenc}
\usepackage{sectsty}
\usepackage{alltt}
\usepackage[small,bf]{caption}
\usepackage{url}
\usepackage{rotating}
\usepackage{longtable}
% \usepackage{tocvsec2}

% \allsectionsfont{\sffamily}
% 


\setcounter{secnumdepth}{3}
%\setcounter{tocdepth}{3} %%(perquè l'índex arribi fins al tercer nivell, més específic)

% Salto de línea tras título de secciones \paragraph
\makeatletter % necesario para que reconozca a '@' como carácter normal
\renewcommand{\paragraph}{\@startsection{paragraph}{4}{\z@}{-3.25ex \@plus
-1ex \@minus -.2ex}{1.5ex \@plus .2ex}{\normalfont\normalsize\bfseries}}
\makeatother % necesario para que restablezca '@' como carácter especial



  \newcommand{\nota}[1]{  \begin{small}
   \begin{quote} 
   \begin{sf}
   [Nota: #1]
   \end{sf}
   \end{quote}
   \end{small}
  }


 \newcommand{\notavisible}[1]{  \begin{small}
  \begin{quote} 
  \begin{sf}
  [#1]
  \end{sf}
  \end{quote}
  \end{small}
 }

 %\newcommand{\nota}[1]{}


%% Proyecto ``Traducción
%%  automática de código
%%  abierto para las lenguas del Estado español'' (FIT-340101-2004-3) \\[.5ex]
\frontmatter 

\title{\sffamily\bfseries Documentación del sistema de código abierto \emph{Opentrad Apertium} de
  traducción automática de transferencia sintáctica
  superficial}
%%\date{28 de junio de 2005}



 \author{\textbf{AUTORES}:\\Mikel L. Forcada\\Boyan
   Ivanov Bonev\\Sergio Ortiz Rojas\\ Juan Antonio Pérez Ortiz \\
Gema Ramírez Sánchez\\Felipe Sánchez Martínez\\\\\textbf{COORDINADORA}:\\Mireia Ginestí Rosell\\[0.8cm]\\Departament
de Llenguatges i Sistemes Informàtics\\Universitat d'Alacant}
%% \textit{Eleka Ingeniaritza Linguistikoa} \\
%% \textit{Zelai Haundi Kalea, 3} \\
%% \textit{Osinalde Industrialdea} \\
%% \textit{20170 Usurbil}}



\begin{document}
\pagestyle{headings}
%\maxtocdepth{subsubsection}
%\maxtocdepth{paragraph}

%\settocdepth{subsubsection}

\maketitle


\newpage \thispagestyle{empty} 

\bigskip
\begin{quote}
  Copyright \copyright 2006 Grup Transducens, Universitat d'Alacant.
  Se otorga permiso para copiar, distribuir y/o modificar este
  documento bajo los términos de la Licencia de Documentación Libre de
  GNU, Versión 1.2 o cualquier otra versión posterior publicada por la
  Free Software Foundation; sin Secciones Invariantes ni Textos de
  Cubierta Delantera ni Textos de Cubierta Trasera. Una copia de la
  licencia se puede consultar en
  \url{http://www.gnu.org/copyleft/fdl.html}.  En
  \url{http://gugs.sindominio.net/licencias/gfdl-1.2-es.html} puede
  leerse la traducción no oficial de la licencia al español, en
  \url{http://www.softcatala.org/llicencies/fdl-ca.html} la traducción
  no oficial al catalán y en
  \url{http://members.tripod.com.br/RamonFlores/GNU/gpl.html} la
  traducción no oficial al gallego.

\end{quote}
\bigskip
    

\tableofcontents

\newpage

\mainmatter
\chapter*{Introducción}\addcontentsline{toc}{chapter}{Introducción}


La presente documentación describe el sistema \emph{Opentrad
  Apertium}\footnote{En adelante, nos referiremos a él simplemente
  como \emph{Apertium}}, uno de los sistemas de traducción automática
de código abierto creados en el marco del proyecto "Traducción
automática de código abierto para las lenguas del estado
español"\nota{Posem un resum de les dades del projecte en un apèndix
  (codi, durada, finançament, participants, etc.) i hi fem referència
  ací? - Mikel}. Se trata de un sistema de traducción automática de
transferencia sintáctica superficial y está pensado inicialmente para
la traducción entre pares de lenguas relacionadas, aunque algunos de
sus componentes se han utilizado también en la arquitectura de
transferencia sintáctica profunda (\emph{Opentrad Matxin}) que se ha desarrollado en el mismo
proyecto para el par es\-pa\-ñol--eus\-ke\-ra. \emph{Apertium} traduce
actualmente entre los pares es\-pa\-ñol--ga\-lle\-go y
es\-pa\-ñol--ca\-ta\-lán\footnote{Con la denominación \emph{catalán}
  nos referimos también a la variante dialectal valenciana de este
  idioma.}, y puede utilizarse para la construcción de traductores
entre otros pares de lenguas relacionadas como danés--sueco,
checo--eslovaco, etc.


Los demás sistemas de traducción automática disponibles hasta el
momento para los pares \texttt{es}--\texttt{ca} y
\texttt{es}--\texttt{gl} son mayoritariamente comerciales o utilizan tecnología de
propiedad, con lo que es muy difícil adaptarlos a nuevos usos; además, 
utilizan diferentes tecnologías para los distintos pares de lenguas,
lo que hace muy difícil integrarlos en un único sistema de gestión
de contenidos multilingües.

Una de las principales novedades de la arquitectura que presentamos es
que se ha liberado bajo una licencia de código abierto (licencia GNU
GPL para los programas y Creative Commons para los datos) y es de
distribución gratuita. Esto significa que cualquier persona que tenga
los conocimientos lingüísticos e informáticos necesarios podrá adaptar
o ampliar el producto para crear un nuevo sistema de traducción
automática, incluso para nuevos pares de lenguas relacionadas.
Esperamos, por ello, que la introducción de esta arquitectura de
traducción automática de código abierto solucione algunos de los
problemas mencionados (existencia de diferentes tecnologías para
diferentes pares, dificultad de adaptación de las arquitecturas de
código cerrado a nuevos usos, etc.) y favorezca el intercambio de
datos lingüísticos ya existentes utilizando los formatos basados en
XML que se definen en esta documentación. Al mismo tiempo, creemos que
ayudará a cambiar el modelo de negocio actual en este campo, basado en
licencias, por un modelo basado en la prestación de servicios.

Cabe mencionar que es la primera vez que el Gobierno español ha subvencionado un proyecto de 
código abierto de esta envergadura, aunque la adopción de software de código abierto por las administraciones
españolas no es algo nuevo.


En los capítulos de la presente documentación se explican detalladamente las características del sistema Apertium, con
la información organizada de la siguiente manera:


\begin{itemize}
\item Capítulo \ref{ss:descrarq}: \textbf{descripción general del sistema} de traducción automática de
  transferencia superficial y de los módulos de los que se compone.

\item Capítulo \ref{se:flujodatos}: descripción del \textbf{formato del
  flujo de los datos} que circulan de un módulo a otro.

\item Capítulo \ref{se:especificmodulos}: \textbf{especificación de los 
     módulos} del sistema. Para cada módulo se describe: el
  \textit{funcionamiento del módulo}, el \textit{formato de los datos}
  sobre los que trabaja el módulo, y los \textit{compiladores}
  correspondientes.  Este capítulo se divide en las siguientes
  secciones:
  \begin{itemize}
  \item [-]sección \ref{ss:modproclex}: \emph{Módulos de procesamiento
      léxico}, en la que se describe el funcionamiento del analizador
    morfológico, del módulo de transferencia léxica, del generador
    morfológico y del postgenerador (apartado \ref{ss:funcproclex}),
    el formato de los diccionarios con los que trabajan estos módulos
    (apartado \ref{ss:diccionarios}) y los compiladores de los mismos
    (apartado \ref{se:compiladoresdic})
  \item [-]sección \ref{ss:tagger}: \emph{Desambiguador léxico
      categorial}, en la que se describe el funcionamiento del desambiguador
    (apartado \ref{functagger}), el formato de los datos lingüísticos con los
    que trabaja (apartado \ref{datostagger}. 
% MLF 20060328 elimina
% y el compilador
% correspondiente (apartado \ref{ss:gentagger})
     
  \item [-]sección \ref{se:pretransfer}: \emph{Módulo de preproceso
      del transfer}, en la que se describe el módulo que se ejecuta
    antes del módulo de transferecia estructural para realizar ciertas
    operaciones en las unidades multipalabra
  \item [-]sección \ref{ss:transfer}: \emph{Módulo de transferencia
      estructural}, en la que se describe el funcionamiento del módulo
    (apartado \ref{functransfer}), el formato de las reglas de
    transferencia estructural (apartado \ref{formatotransfer}).
% MLF 20060328 
% y el
%    compilador correspondiente (apartado \ref{gentransfer})
  \item [-]sección \ref{se:desformat}: \emph{Desformateador y
      reformateador}, en la que se describe el funcionamiento de estos
    módulos (apartado \ref{ss:formato}), las reglas de especificación
    de formato (apartado \ref{ss:reglasformato}) y el proceso de
    generación de los módulos (apartado \ref{se:gendeformat})
 
  \end{itemize}



\item Capítulo \ref{se:instalacion}: describe cómo
  \textbf{instalar el sistema} y cuáles son los requisitos para ello, así como la manera
de \textbf{utilizar el traductor}.

\item Capítulo \ref{se:datosling}: describe cómo se pueden \textbf{modificar los datos
    lingüísticos} del traductor, es decir, los
  diccionarios, los datos de desambiguación léxica categorial y las
  reglas de transferencia estructural que se han creado para el
  español, el catalán, el gallego. Además, aquí se describen brevemente las características
de los datos existentes para los tres pares de lenguas del proyecto.


\nota{Es diuen a tot arreu els noms de programa i en quin paquet estan?}


\end{itemize}


Los ficheros a los que hace referencia este informe se pueden
consultar y descargar desde la página web del proyecto en Sourceforge:
\url{http://apertium.sourceforge.net/}.  En esta página se pueden
descargar los paquetes para la instalación, así como consultar los
archivos individualmente, en el repositorio de CVS
(\url{http://cvs.sourceforge.net/viewcvs.py/apertium/}). Los sistemas de traducción automática también se pueden probar a través de internet en \url{http://xixona.dlsi.ua.es/prototype/}.

%El presente documento tiene algunas secciones que están incompletas o
%no han sido escritas todavía. 


\paragraph*{Agradecimientos:} El presente trabajo se ha beneficiado de las aportaciones de muchas personas e instituciones:
\begin{itemize}
\item El Ministerio de Industria, Comercio y Turismo ha financiado
  este trabajo a través del proyecto ``Traducción automática de código
  abierto para las lenguas del Estado español'' del programa PROFIT,
  claves FIT-340101-2004-3  y su ampliación FIT-340001-2005-2.
\item Trabajadores y becarios de otros proyectos de traducción
  automática de la Universidad de Alicante: Míriam Antunes Scalco,
  Carme Armentano i Oller, Raül Canals i Marote, Alicia Garrido
  Alenda, Patrícia Gilabert i Zarco, Maribel Guardiola i Savall,
  Javier Herrero Vicente, Amaia Iturraspe Bellver, Sandra Montserrat i
  Buendia, Hermínia Pastor Pina, Antonio Pertusa Ibáñez, Francisco
  Javier Ramos Salas, Marcial Samper Asensio y Miguel Sánchez Molina.
\item Las empresas e instituciones que han financiado estos otros
  proyectos de traducción automática: el Ministerio de Ciencia y
  Tecnología, la Caja de Ahorros del Mediterráneo, la Universitat
  d'Alacant y Portal Universia,
  S.A.
\item Iñaki Alegria, del grup Ixa de la Euskal Herriko Unibertsitatea,
  por su lectura atenta de versiones anteriores de este documento.
\end{itemize}

\vspace{12cm}



ADVERTENCIA: Algunas partes de esta documentación están provisionalmente
en catalán, a la espera de su traducción al español.


\chapter[El ingenio de traducción]{El ingenio de traducción de transferencia sintáctica superficial}
\label{ss:descrarq}


Este capítulo describe brevemente la estructura del ingenio de traducción
automática de transferencia superficial, basado en el de los sistemas
español--catalán \textsf{interNOSTRUM}
\cite{canals01b,garridoalenda01p,garrido99j} y español--portugués
\textsf{Traductor Universia} \cite{garrido03p, gilabert03j}, ambos desarrollados por
el grupo Transducens de la Universitat d'Alacant.  Se trata de un sistema
clásico de traducci\'on autom\'atica indirecta que utiliza una estrategia de
transferencia sintáctica parcial similar a la de algunos sistemas comerciales
de TA para ordenadores personales. 


El diseño del sistema permite obtener sistemas de TA \emph{rápidos} (que traducen
decenas de miles de palabras por segundo en ordenadores de sobremesa comunes)
y cuyos resultados son, a pesar de los errores, razonablemente inteligibles y
fáciles de corregir. En el caso de lenguas emparentadas como las que nos
ocupan (español, gallego, catalán), una traducción mecánica palabra por
palabra (con un equivalente fijo) presentaría errores que, en su mayoría, se
pueden resolver con un análisis bastante somero (un análisis morfológico
seguido de un análisis sintáctico superficial, local y parcial) y con un
tratamiento adecuado de las ambigüedades léxicas (principalmente de la
homografía). El diseño adoptado sigue estas directrices con resultados muy
interesantes. La arquitectura de Apertium utiliza transductores de estados finitos para el procesamiento léxico,
modelos ocultos de Markov para la desambiguación léxica y procesamiento de patrones basado en estados
finitos para la transferencia estructural.


El ingenio de traducción consiste en una \emph{cadena de montaje} de
ocho módulos, que puede verse representada en la figura
\ref{fg:modules}.  Para facilitar el diagnóstico y la comprobación
independiente, los módulos se comunican entre sí en formato de texto.
De esta manera, siempre que se quiera se puede comprobar cuál es la entrada y
la salida de los mismos y, cuando se produce algún error en la
traducción, examinar por separado la salida de cada uno de ellos para
detectar dónde se localiza el error. Asimismo, la comunicación vía
texto permite que los módulos se usen de manera aislada,
independientemente del resto del sistema de traducción automática,
para otras tareas de procesamiento del lenguaje natural, y
posibilita la construcción de prototipos con módulos modificados o
añadidos.

Se ha elegido que el formato de los ficheros de datos lingüísticos sea
XML\footnote{\url{http://www.w3.org/XML/}} por su interoperabilidad,
por su independencia del juego de caracteres y por la existencia de
numerosos útiles y librerías que facilitan el análisis de los datos
codificados en este formato. Como bien se afirma en \cite{ide00}, XML
es el estándar emergente para la representación y el intercambio de
datos en Internet. Las tecnologías en torno a XML incluyen mecanismos
muy potentes para el acceso y la manipulación de documentos XML que
probablemente tendrán un impacto significativo en el desarrollo de
herramientas para el procesamiento del lenguaje de natural y de corpus
anotados.


Los módulos de los que se compone Apertium son los siguientes:

\begin{figure*}
{\footnotesize
\setlength{\tabcolsep}{0.5mm}
\begin{center}
\begin{tabular}{cccccccc}
\\
\parbox{0.7cm}{texto LO} \\
$\downarrow$ \\
\framebox{\parbox{1.4cm}{desfor\-mateador}} $\rightarrow$ &
\framebox{\parbox{0.8cm}{anal. morf.}}  $\rightarrow$ &
\framebox{\parbox{1.2cm}{desamb. categ.}} $\rightarrow$ & \framebox{\parbox{1.1cm}{transf.\ estruc.}} $\rightarrow$ &
\framebox{\parbox{0.8cm}{gen. morf.}} 
$\rightarrow$ & \framebox{\parbox{1.0cm}{post\-genera\-dor}}
$\rightarrow$ & \framebox{\parbox{1.2cm}{reforma\-teador}} \\
& & & $\updownarrow$ & & &  $\downarrow$ \\
& & & \framebox{\parbox{1.0cm}{transf.\ léxica}} & & & \parbox{0.7cm}{texto LM}\\\\
\end{tabular}
\end{center}
}
\caption{Los ocho m\'odulos que forman la cadena de montaje del sistema de
  traducción automática por transferencia sintáctica superficial.}
\label{fg:modules}
\label{pg:modules}
\end{figure*}



\begin{itemize}
\item El \emph{desformateador}, que separa el texto a traducir de la
  información de formato (RTF, HTML, etc.); su especificación se describe en el apartado
  \ref{ss:formato}. La información de formato es encapsulada de manera que los módulos restantes la tratan
como blancos entre palabras. Por ejemplo, ante el texto HTML en español:
\begin{alltt}
  es <em>una señal</em>
\end{alltt}
el desformatador encapsula las etiquetas HTML entre corchetes y proporciona como salida:
\begin{alltt}
  es [<em>]una señal[</em>]
\end{alltt}
Las secuencias de caracteres entre corchetes son tratadas por el resto de módulos como simples espacios en blanco
entre palabras.
\item \label{pg:FSFL} El \emph{analizador morfológico}, que segmenta
  el texto en \emph{formas superficiales} (FS) (las unidades léxicas tal como
  se presentan en los textos) y entrega para cada FS una o más \emph{formas
  léxicas} (FL) consistentes en un \emph{lema} (la forma base
  comúnmente usada para las entradas de los diccionarios clásicos), la
  \emph{categoría léxica} (nombre, verbo, preposición, etc.) y la
  información de flexión morfológica (número, género, persona, tiempo,
  etc.). La división de un texto en FS presenta aspectos complejos
  debido a la existencia, por un lado, de contracciones (\emph{del},
  \emph{teniéndolo}, \emph{vámonos}) y, por otro, de unidades léxicas
  de más de una palabra (\emph{a pesar de}, \emph{echó de menos}). El
  analizador morfológico permite analizar estas FS complejas y
  tratarlas adecuadamente para que sean procesadas por los módulos
  posteriores. En el caso de las contracciones, el sistema lee una
  única forma superficial y da como salida una secuencia de dos o más
  formas léxicas (por ejemplo, la contracción \emph{del} sería
  analizada como dos formas léxicas, una para la preposición \emph{de}
  y otra para el artículo \emph{el}). Las unidades léxicas de más de
  una palabra (multipalabras) son tratadas como formas léxicas individuales y, según
  su naturaleza, reciben un tratamiento específico.\footnote{Para más
    detalles sobre la el tratamiento de las unidades léxicas de más de
    una palabra, véase la página~\pageref{ss:multipalabras}.}

Al recibir como entrada el texto de ejemplo proveniente del módulo anterior, el 
analizador morfológico proporcionaría como salida:
\begin{alltt}
^es/ser<vbser><pri><p3><sg>\$[ <em>]
^una/un<det><ind><f><sg>/unir<vblex><prs><1><sg>/unir
<vblex><prs><3><sg>\$
^señal/señal<n><f><sg>\$[</em>]
\end{alltt}

donde cada forma superficial es analizada como una o más formas
léxicas.  Así, \emph{es} es analizada como una FS con lema \emph{ser},
mientras que \emph{una} recibe tres análisis: lema \emph{un},
determinante indefinido femenino singular; lema \emph{unir}, verbo en
presente de subjuntivo, 1ª persona del singular, y lema \emph{unir},
verbo en presente de subjuntivo, 3ª persona del singular.

Este módulo se genera a partir de un diccionario morfológico para la
lengua origen (LO), cuyo formato se especifica en el apartado
\ref{ss:diccionarios}.
\item El \emph{desambiguador léxico categorial}, elige, usando un
  modelo estadístico (modelo oculto de Markov), uno de los análisis de
  una palabra ambigua de acuerdo con su contexto; en el ejemplo
  utilizado, la palabra ambigua sería la forma superficial \emph{una},
  que puede analizarse de tres maneras diferentes. Las formas
  superficiales ambiguas por tener más de un lema, más de una
  categoría o representar más de una flexión son muy comunes (en las
  lenguas románicas, en torno a una de cada tres palabras) y son una
  fuente muy importante de errores de traducción en caso de elegir el
  equivalente incorrecto. El modelo estadístico se entrena sobre
  corpus suficientemente representativos de textos en LO.
 
  El resultado de procesar mediante el desambiguador el texto de
  ejemplo proporcionado por el analizador morfológico sería:

\begin{alltt}
^ser<vbser><pri><p3><sg>\$[ <em>]^un<det><ind><f><sg>\$ 
^señal<n><f><sg>\$[</em>]
\end{alltt}

en que se ha elegido la forma léxica correcta (el determinante) para la palabra \emph{una}.


  La
  especificación del desambiguador léxico categorial se describe en la
  sección \ref{ss:tagger}.


\item El \emph{módulo de transferencia léxica}, que gestiona un
  diccionario bilingüe y es invocado por el módulo de transferencia
  estructural, lee cada FL en LO y entrega la FL correspondiente en
  lengua meta (LM). El diccionario contiene un único equivalente para
cada forma léxica de la LO; esto significa que no se realiza ningún tipo de tratamiento de 
la polisemia. Las multipalabras son traducidas como una unidad.
En el ejemplo utilizado, cada una de las formas léxicas se traduciría al catalán de la siguiente manera:

\begin{alltt}
ser<vbser> \(\longrightarrow\) ser<vbser>
un<det> \(\longrightarrow\) un<det>
señal<n><f> \(\longrightarrow\) senyal<n><m>
\end{alltt}

Este módulo se genera a partir de un diccionario
  bilingüe, descrito en el apartado \ref{ss:diccionarios}).

\item El \emph{módulo de transferencia estructural}, que detecta y
  trata patrones de palabras (sintagmas) que exigen un tratamiento
  especial por causa de las divergencias gramaticales entre las
  lenguas (cambios de género y número, reordenamientos, cambios
  preposicionales, etc.). Este módulo se genera a partir de un archivo
  de reglas que describen la acción que debe realizarse para cada patrón.
Ante la frase de ejemplo, el patrón formado por \verb!^!\texttt{un<det><ind><f><sg>}\verb!$!
\verb!^!\texttt{señal<n><f><sg>}\verb!$! sería detectado por una regla determinante--nombre, que en este
caso modificaría el género del determinante para que concuerde con el nombre; el resultado sería:

\begin{alltt}
^ser<vbser><pri><p3><sg>\$[ <em>]^un<det><ind><m><sg>\$
^senyal<n><m><sg>\$[</em>]
\end{alltt}

 La especificación del formato del archivo de reglas de transferencia estructura, que se inspira en
  la descrita en \cite{garridoalenda01p}, se encuentra en la sección 
  \ref{ss:transfer}. 
\item El \emph{generador morfológico}, que genera a partir de la forma léxica en
  lengua meta una forma superficial flexionada adecuadamente. El resultado para la frase
de ejemplo sería:
\begin{alltt}
és[ <em>]un senyal[</em>]
\end{alltt}

Este módulo se genera a partir de un diccionario
  morfológico, cuyas características están descritas en el apartado \ref{ss:diccionarios}.
\item El \emph{postgenerador}, que realiza algunas operaciones
  ortográficas en LM tales como contracciones y apostrofaciones, y que
  es generado a partir de un archivo de reglas de transformación con
  un formato similar al de los diccionarios anteriores. Su formato se
  especifica en la sección \ref{ss:diccionarios}. En la frase de ejemplo utilizada no hay
que realizar ninguna contracción ni apostrofación.
\item El \emph{reformateador}, que reintegra la
  informaci\'on de formato original al texto traducido; el resultado para la frase de ejemplo sería
la correcta conversión del texto a formato HTML:
\begin{alltt}
és <em>un senyal</em>
\end{alltt}


La especificación del reformateador se
  describe en la sección \ref{ss:formato}. 
\end{itemize}

Los cuatro módulos de procesamiento léxico (el analizador morfológico,
el módulo de transferencia léxica, el generador morfológico y el
postgenerador) utilizan un único compilador, basado en un tipo de
\emph{transductores de estados finitos} \cite{garrido99j},
concretamente en transductores de letras \cite{roche97,ortiz05j} cuyas
características se explican en \ref{se:compiladoresdic}.



\chapter[Especificación del formato de flujo]{Especificación del formato del flujo de datos entre módulos}
\label{se:flujodatos}
\nota{Material duplicat en "formatadors i reformatadors": declarar-ho, treure-ho? - Gema}

\section{Introducción}

Para enteder y hacer más efectivo el procesamiento de documentos es
necesario especificar el formato de la información que circula como
texto entre los módulos del traductor. El diseño propuesto (véase
sección \ref{ss:descrarq}) impone la necesidad de utilizar tres tipos
de flujo de datos distintos como se expresa en la figura
\ref{fig:fdatos}.

El formato de flujo está basado en texto para facilitar, entre otras
cosas, la tarea de diagnóstico sobre posibles errores del sistema ya
que resulta sencillo manipular el flujo para reproducir aquellos
fenómenos que se desee probar y modificarlos para comprobar el
resultado. Otra ventaja destacable es la posibilidad de comprobar de
manera independiente la salida de cada módulo del traductor y, junto a
esto, la rapidez en la construcción de prototipos para comprobar su
funcionamiento global, la validez de los datos lingüísticos, etc.



\begin{figure}[h]
\begin{center}
\includegraphics[width=14cm]{fdatos} 
\end{center}
\caption{Los diversos tipos de flujo de datos en el sistema de traducción automática. Véase el
  texto para la definición de los diferentes tipos de flujo.}
\label{fig:fdatos}
\end{figure}

Estos flujos de datos son:

\begin{itemize}
\item \textit{Flujo de datos con formato:} Es el texto en su formato original,
  sin ningún otro tipo de marca: XML, texto ANSI, RTF, HTML, etc. Por ser el
  formato original de los documentos, de este flujo de datos no hay nada que
  especificar salvo el tipo de formato de que se trata. 
\item \textit{Flujo de datos sin formato:} Consiste en el texto con
  \textit{superblancos}, marcas que encapsulan el formato (véase el
  apartado \ref{ss:formato}) y que son tratadas como si de blancos se
  tratase (con algunas salvedades) por los módulos lingüísticos del
  sistema.  Este formato es el que genera el desformateador, y el que
  utiliza el reformateador para generar el documento traducido final.
\item \textit{Flujo de datos segmentado:} Además de superblancos, este
  formato tiene delimitadas mediante marcas las unidades léxicas que
  se debe traducir. Estas marcas son establecidas por el analizador
  morfológico, y son eliminadas por el generador, que entrega las
  formas superficiales finales.
\end{itemize}

% El objetivo es que los módulos sean capaces de tratar dos tipos de
% flujos de datos: uno que consiste en texto llano con marcas de carácter con
% significado especial ---orientado al procesamiento en servidores de
% internet que traduzcan grandes volumenes de texto--- y otro en un
% formato XML diseñado para mejorar la interoperabilidad entre módulos
% con vistas a que puedan ser usados para otros fines o para el
% diagnóstico de errores. A continuación describiremos las
% características de ambos tipos de flujo.

A continuación describiremos las caracaterísticas del flujo de datos
empleado entre módulos del traductor. A grandes rasgos, se trata de un
formato en texto llano con marcas de carácter que poseen un
significado especial. Dicho formato está orientado al procesamiento en
servidores que traduzcan grandes volúmenes de texto. 

Algunos de los formatos que puede tratar el traductor pueden contener bloques
extensos de información en formato binario ---como por ejemplo RTF, que puede
incluir imágenes de mapa de bits---.  Para facilitar un procesamiento eficiente
de este tipo de documentos se especifica en el apartado \ref{ss:formato} una
forma de extraer esta información para restituirla tras la traducción. 

\section{Flujo de datos sin formato}

El flujo de datos sin formato es producido como salida por el desformateador y
por el generador\nota{no del tot: postgenerador}, y es usado como entrada por el analizador morfológico, por
el postgenerador y por el reformateador.

% En las dos secciones que se presentan en este apartado
En el subapartado de esta sección se especifica la forma de delimitar
\textit{superblancos} y \textit{superblancos extensos}. Para los
ejemplos, tomaremos como referencia el documento HTML de la
figura~\ref{fg:docorig}.

\begin{figure}[htbp]
\begin{small}
\begin{alltt}
<\textbf{html}>
  <\textbf{head}>
    <\textbf{title}>Título</\textbf{title}>
  </\textbf{head}>
  <\textbf{body}>
    <\textbf{p}>Frase
       dividida</\textbf{p}>
  </\textbf{body}>
</\textbf{html}>
\end{alltt}
\end{small}
\caption{Ejemplo de documento HTML}
\label{fg:docorig}
\end{figure}

Los elementos estructurales que debe incluir este flujo de datos son
los siguientes:

\begin{itemize}
\item \textit{Superblancos}.  Se trata de bloques que incluyen segmentos de
  información de formato incluida en los documentos, cuando estos son cortos.
\item \textit{Superblancos extensos}.  Son marcas que se usan para
  especificar aquellos documentos externos que incluyan segmentos de información de
  formato del documento que se está procesando, cuando estos son largos.
\item \textit{Texto}. El texto de los documentos susceptible de ser traducido. 
\item \textit{Finales de frase artificiales}. \label{finfrase} Cuando
  el formato de los documento induzca una separación de frases que no
  esté marcada por ningún signo de puntuación (por ejemplo, los
  títulos que no acaban en punto o el contenido de las celdillas de
  una tabla), el formato debe instrumentar un mecanismo (invisible
  para el usuario) que permita marcar estos finales de frase.
\item \textit{Protección de caracteres especiales (para el caso del flujo no
    XML)}.  Los caracteres que se deben proteger para que no entren en conflicto
  con los usados en el propio formato del flujo de datos.
\end{itemize}

% \subsection{Formato XML}

% En este tipo de flujo se usa el elemento \texttt{<\textbf{b}>} para definir los
% superblancos y los superblancos extensos.  Para el caso de los
% \textbf{superblancos} la sintaxis es la siguiente:

% \begin{small}
% \begin{alltt}
%   <\textbf{b}>\textit{contenido del bloque de formato}</\textbf{b}>
% \end{alltt}
% \end{small}

% Hay que resaltar que para los formatos basados en SGML, es necesario
% incluir el formato en bloques \texttt{<![CDATA[\ldots]]>} dentro de
% las marcas indicadas. \nota{millor dir com són: prendre text de EAMT
%   '05 - Gema}  Por su parte, los \textit{superblancos extensos} se deben
% expresar, a modo de atributos, de la siguiente manera:

% \begin{small}
% \begin{alltt}
%   <\textbf{b} \textsl{filename}="\textit{nombre de fichero}"/>
% \end{alltt}
% \end{small}

% El \emph{texto} estará incluido entre los elementos \textbf{b} que se
% acaban de explicar sin ninguna marca de estructura particular.  

% Los \emph{finales de frase artificiales} se expresan mediante un punto y un
% superblanco vacío inmediatamente a continuación.

% \begin{small}
% \begin{alltt}
%   .<\textbf{b}/>
% \end{alltt}
% \end{small}

% Resumiendo, el flujo de datos de un documento en cualquier formato de los que
% trata el traductor se reduce a otro documento XML que debe cumplir la
% siguiente DTD:

% \begin{small}
% \begin{alltt}
%   <!\textsl{ELEMENT} \textbf{document} (b|\textsl{#PCDATA})*>
%   <!\textsl{ELEMENT} \textbf{b} (\textsl{#PCDATA}?)>
%   <!\textsl{ATTLIST} b filename \textsl{CDATA} \textsl{#IMPLIED}>
% \end{alltt}
% \end{small}

% El resultado de encapsular el formato del fichero de la
% figura~\ref{fg:docorig} en el flujo con formato XML se ve en la
% figura~\ref{fg:docorigXML}.  Si hubiese algún superblanco que por su longitud
% se convirtiese en un superblanco extenso, la forma de especificarlo sería como sigue:
% \begin{small}
% \begin{alltt}
%   <\textbf{b} \textsl{filename}="/tmp/ficherotemporal"/>
% \end{alltt}
% \end{small}donde \texttt{"/tmp/ficherotemporal"} es un fichero que
% contiene el superblanco extenso para que pueda ser recuperado por el reformateador.

% \begin{figure}
% \begin{small}
% \begin{alltt}
% <?\textbf{xml} \textsl{version}="1.0" \textsl{encoding}="iso-8859-15"?>
% <\textbf{document}>
% <\textbf{b}><![CDATA[<html>
%   <head>
%     <title>]]></\textbf{b}>Título.<\textbf{b}/><\textbf{b}><![CDATA[</title>
%   </head>
%   <body>
%     <p>]]></\textbf{b}>Frase<\textbf{b}><![CDATA[
%        ]]></\textbf{b}>dividida.<\textbf{b}/><\textbf{b}><![CDATA[
%   </body>
% </html>]]></\textbf{b}>
% </\textbf{document}>
% \end{alltt}
% \end{small}
% \caption{El documento de la figura \protect\ref{fg:docorig} con el
%   formato encapsulado usando marcas en XML y segmentos \texttt{<![CDATA[\ldots]]>}}
% \label{fg:docorigXML}
% \end{figure}

%\subsection{Formato no XML}
\subsection{Formato de flujo}
\label{se:noxml1}
Este formato se basa en el formato utilizado en los sistemas de
traducción \textsf{interNOSTRUM}
\cite{canals01b,garridoalenda01p,garrido99j} y \textsf{Traductor
  Universia} \cite{garrido03p, gilabert03j}.

En este tipo de flujo se usan los carácteres \texttt{[} y \texttt{]}
para marcar los \emph{superblancos} tal y como se muestra a
continuación:

\begin{small}
\begin{alltt}
[\textit{contenido del superblanco}]
\end{alltt}
\end{small}

Si se trata de \emph{superblancos extensos}, el nombre del fichero se
especifica utilizando el carácter de arroba \texttt{@}:

\begin{small}
\begin{alltt}
[@\textit{nombre de fichero}]
\end{alltt}
\end{small}

El \emph{texto} se encuentra fuera de las marcas de superblanco.

Los \emph{finales de frase artificiales}% , como en el caso del flujo XML,
se expresan mediante un punto y un superblanco vacío inmediatamente a
continuación.

\begin{small}
\begin{alltt}
.[]
\end{alltt}
\end{small}

Los \textbf{caracteres protegidos} se muestran en la siguiente tabla:

\begin{center}
\begin{tabular}{|l|c|c|l|}
\hline
Nombre & Carácter & Forma proteg.& Significado \\
\hline
Arroba & \texttt{@} & \verb!\@! & Superblanco externo\\
Barra & \texttt{/} & \verb!\/! & Divisor de acepciones\\
Barra invertida & \verb!\! & \verb!\\! & Carácter de protección \\
Circunflejo & \verb!^! & \verb!\^! & Inicio de FL\\
Corchete de apertura & \texttt{[} & \verb!\[! & Inicio de blanco\\
Corchete de cierre & \texttt{]} & \verb!\]! & Fin de blanco \\
Dólar & \verb!$! & \verb!\$! & Fin de FL\\
Mayor que & \texttt{>} & \verb!\>! & Inicio de símbolo gram.\\
Menor que & \texttt{<} & \verb!\<! & Fin de símbolo gram. \\
\hline
\end{tabular}
\end{center}


En la figura~\ref{fg:docorigtext} muestra cómo quedaría encapsulado el
documento de la figura~\ref{fg:docorig}.

\begin{figure}[here]
\begin{small}
\begin{alltt}
[<html>
  <head>
    <title>]Título.[][</title>
  </head>
  <body>
    <p>]Frase[
       ]dividida.[][</p>
  </body>
<html>]
\end{alltt}
\end{small}
\caption{El documento de la figura \protect\ref{fg:docorig} con el formato encapsulado usando corchetes}
\label{fg:docorigtext}
\end{figure}


\section{Flujo de datos segmentado}

El flujo de datos segmentado es el que circula entre los módulos que manejan
información lingüística dentro del traductor.  En este flujo las palabras se
encuentran delimitadas y etiquetadas.  Hay dos tipos de flujo segmentado:

\begin{itemize}
\item \textit{Flujo segmentado ambiguo}. Su  característica principal es que las palabras tienen forma superficial y potencialmente
  varias formas léxicas (multiformas léxicas).  Este flujo es el
  formato en el que el analizador morfológico proporciona los datos de
  entrada al desambiguador léxico categorial (consulte el esquema
  \ref{eq:formaanalizada} de la página~\pageref{formaanalizada} para
  obtener una descripción detallada del flujo segmentado ambiguo).
 
\item \textit{Flujo segmentado no ambiguo}.  Sólo tiene una forma
  léxica para cada palabra y no incluye la forma superficial.  En este
  formato transitan los datos desde el desambiguador al módulo de
  transferencia y desde éste al generador (consulte el esquema
  \ref{eq:formaanalizada2} de la página~\pageref{formaanalizada2} para
  ver el formato del flujo segmentado no ambiguo).
\end{itemize}

Por otro lado, además de la información que ya marca el flujo de datos sin
formato, el nuevo flujo deberá permitir marcar la siguiente
información:

\begin{itemize}
\item \textit{Unidades léxicas}.  Una unidad léxica consta de la forma
  superficial (para el caso del flujo segmentado ambiguo) más una o más
  formas léxicas (que corresponden a los posibles análisis de la FS)
  con sus símbolos gramaticales.
\item \textit{Formas superficiales (flujo segmentado ambiguo)}.  Se
  trata de la palabra tal y como se encuentra en el texto original. 
\item \textit{Formas léxicas}.  El lema de la palabra con los símbolos
  gramaticales correspondientes. 
\item \textit{Símbolos gramaticales}.  Marcan los atributos
  gramaticales de la forma superficial correspondiente. 
\end{itemize}

% \subsection{Formato XML}

% Las \textit{palabras} se etiquetan de la forma que se muestra a
% continuación:

% \begin{small}
% \begin{alltt}
%   <\textbf{w}>\textit{información de la palabra}</\textbf{w}>
% \end{alltt}
% \end{small}

% Para el caso del \textit{flujo de datos segmentado ambiguo}, la
% \textit{forma superficial} se indica en el interior de un elemento
% \texttt{<\textbf{w}>} mediante el contenido de un único elemento
% \texttt{<\textbf{sf}>}.  A continuación, se sitúan la forma o
% \textit{formas léxicas} que sean necesarias:

% \begin{small}
% \begin{alltt}
%   <\textbf{w}>
%     <\textbf{sf}>\textit{forma superficial}</\textbf{sf}>
%     <\textbf{lf}>\textit{forma léxica 1}</\textbf{lf}>
%     <\textbf{lf}>\textit{forma léxica 2 (opcional)}</\textbf{lf}>
%     ... 
%   </\textbf{w}>
% \end{alltt}
% \end{small}

% Para el caso del flujo no ambiguo, sólo se especifica una única forma léxica.


% \begin{small}
% \begin{alltt}
%   <\textbf{w}>
%     <\textbf{lf}>\textit{forma léxica}</\textbf{lf}>    
%   </\textbf{w}>
% \end{alltt}
% \end{small}

% %% \pagebreak

% La DTD de este flujo de datos para textos \textit{sin desambiguar} es la
% que se muestra en la figura~\ref{fg:ambdtd} a continuación.

% \begin{figure}[here]
% \begin{small}
% \begin{alltt}
%   <!\textsl{ELEMENT} \textbf{document} (b|w|\textsl{#PCDATA})*>
%   <!-- atención, el #PCDATA anterior sigue siendo necesario para los 
%        carácteres no etiquetados y que no forman parte del formato -->
%   <!\textsl{ELEMENT} \textbf{b} (\textsl{#PCDATA}?)>
%   <!\textsl{ATTLIST} b filename \textsl{CDATA} \textsl{#IMPLIED}>
%   <!\textsl{ELEMENT} \textbf{w} (sf,lf+)>
%   <!\textsl{ELEMENT} \textbf{sf} (\textsl{#PCDATA})>
%   <!\textsl{ELEMENT} \textbf{lf} (\textsl{#PCDATA}|s)+>
%   <!\textsl{ELEMENT} \textbf{s} \textsl{EMPTY}>
%   <!\textsl{ATTLIST} s n \textsl{IDREF #REQUIRED}>
% \end{alltt}
% \end{small}
% \caption{DTD para textos no desambiguados con formato XML}
% \label{fg:ambdtd}
% \end{figure}


% Para los ya \textit{ desambiguados}, los textos deben cumplir la DTD de la figura~\ref{fg:desambdtd}.


% \begin{figure}[here]
% \begin{small}
% \begin{alltt}
%   <!\textsl{ELEMENT} \textbf{document} (b|w|\textsl{#PCDATA})*>
%   <!-- atención, el #PCDATA anterior sigue siendo necesario para los 
%        carácteres no etiquetados y que no forman parte del formato -->
%   <!\textsl{ELEMENT} \textbf{b} (\textsl{#PCDATA}?)>
%   <!\textsl{ATTLIST} b filename \textsl{CDATA} \textsl{#IMPLIED}>
%   <!\textsl{ELEMENT} \textbf{w} (lf)>
%   <!\textsl{ELEMENT} \textbf{lf} (\textsl{#PCDATA}|s)+>
%   <!\textsl{ELEMENT} \textbf{s} \textsl{EMPTY}>
%   <!\textsl{ATTLIST} s n \textsl{IDREF #REQUIRED}>
% \end{alltt}
% \end{small}
% \caption{DTD para textos desambiguados con formato XML}
% \label{fg:desambdtd}
% \end{figure}

% La figura~\ref{fg:docorigXML2} muestra un ejemplo de segmentación del flujo
% que incluye la forma de encapsular el formato y la información léxica.  Este
% ejemplo es para el caso de flujo segmentado ambiguo y corresponde al texto
% HTML original de la figura~\ref{fg:docorig}. 

% \begin{figure}[htbp]
% \begin{small}
% \begin{alltt}
% <?\textbf{xml} \textsl{version}="1.0" \textsl{encoding}="iso-8859-15"?>
% <document>
% <\textbf{b}><![CDATA[<html>
%   <head>
%     <title>]]></\textbf{b}>
% <\textbf{w}>
%   <\textbf{sf}>Título<\textbf{sf}>
%   <\textbf{lf}>Título<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{lf}>
% </\textbf{w}>
% <\textbf{w}>
%   <\textbf{sf}>.</\textbf{sf}>
%   <\textbf{lf}>.<s n="sent"/></\textbf{lf}>
% </\textbf{w}><\textbf{b}/>
% <\textbf{b}><![CDATA[</title>
%   </head>
%   <body>
%     <p>]]></\textbf{b}>
% <\textbf{w}>
%   <\textbf{sf}>Frase</\textbf{sf}>
%   <\textbf{lf}>Frase<s n="n"/><s n="f"/><s n="sg"/></\textbf{lf}>
% </\textbf{w}>
% <\textbf{b}><![CDATA[
%        ]]></\textbf{b}>
% <\textbf{w}>
%   <\textbf{sf}>dividida</\textbf{sf}>
%   <\textbf{lf}>dividir<s n="vblex"/><s n="pp"/><s n="f"/><s n="sg"/></\textbf{lf}>
% </\textbf{w}>
% <\textbf{w}>
%   <\textbf{sf}>.</\textbf{sf}>
%   <\textbf{lf}>.<s n="sent"/></\textbf{lf}>
% </\textbf{w}><\textbf{b}/>
% <\textbf{b}><![CDATA[
%   </body>
% <html>]]></\textbf{b}>
% </document>
% \end{alltt}
% \end{small}
% \caption{Ejemplo de flujo segmentado con el formato encapsulado en XML,
%   correspondiente al documento HTML de la figura~\ref{fg:docorig}.} 
% \label{fg:docorigXML2}
% \end{figure}
%\subsection{Formato no XML}
%\subsubsection{Formato de flujo}
\label{se:noxml2}
Para delimitar \textit{palabras} se usan los caracteres de comienzo de
palabra '\verb!^!' y de fin de palabra '\verb!$!' como se muestra a continuación:

\begin{small}
\begin{alltt}
  \verb!^!\textit{palabra}\verb!$!
\end{alltt}
\end{small}

Para delimitar la \textit{forma superficial} y las sucesivas
\textit{formas léxicas} se usa el carácter de separación \texttt{/}.
Este separador sólo tiene sentido en el flujo segmentado ambiguo ya
que el no ambiguo sólo tiene la forma léxica.  Su forma es la
siguiente:

\begin{small}
\begin{alltt}
  \verb!^!\textit{forma superficial}/\textit{forma léxica 1}/...\verb!$!
\end{alltt}
\end{small}

Las formas léxicas pueden incluir símbolos (generalmente situados al
final), tal y como se muestra en el ejemplo de la figura
\ref{fg:docorigtext2}.


\begin{figure}
\begin{small}
\begin{alltt}
[<html>
  <head>
    <title>]^Título/Título<n><m><sg>\$^./.<sent>\$[][</title>
  </head>
  <body>
    <p>]^Frase/Frase<n><f><sg>\$[
       ]^dividida/dividir<vblex><pp><f><sg>\$^./.<sent>\$[][</p>
  </body>
<html>]
\end{alltt}
\end{small}
\caption{Ejemplo de flujo segmentado con el formato encapsulado en formato no
  XML,  correspondiente al documento HTML de la figura~\ref{fg:docorig}.} 
\label{fg:docorigtext2}
\end{figure}





\chapter{Especificación de los módulos}
\label{se:especificmodulos}



\section{Módulos de procesamiento léxico}
\label{ss:modproclex}

\subsection{Descripción del funcionamiento}
\label{ss:funcproclex}

Una de las aproximaciones más eficientes al procesamiento léxico usa
transductores de estados finitos (TEF) \cite{mohri97a,roche97b}. Los
TEF son una clase de autómatas de estados finitos que se describen en
el apartado siguiente. Los TEF pueden ser usados como analizadores
morfológicos de una sola pasada y se pueden implementar de manera muy
eficiente. En este proyecto se usa una clase de TEF denominados
transductores de letras \cite{roche97b,garrido02a,garrido99j}; de
hecho, cualquier transductor de estados finitos se puede convertir
siempre en un transductor de letras. Garrido y colaboradores
\cite{garrido99j,garrido02a} dan una una definición formal de los
transductores de letras usados en este trabajo; informalmente, un
transductor de letras es una máquina idealizada que se compone de:
\begin{enumerate}

\item Un conjunto (finito) de estados, es decir, de situaciones en las
que se puede encontrar el transductor según va leyendo, de izquierda a
derecha, las letras o símbolos de la entrada. Entre los
estados del conjunto se distinguen: 

\begin{enumerate}
\item  Un único estado inicial: el
estado en el que se encuentra el transductor antes de procesar la
primera letra o el primer símbolo de la entrada.
\item Uno o más estados de aceptación, a los que sólo se llega después
  de haber leído completamente una entrada válida y, por tanto, sirven
  para detectar las palabras válidas.
\end{enumerate}
\item Un conjunto (también finito) de transiciones de estado, cada una
  de las cuales se compone de:
\begin{enumerate}
\item el estado de partida 
\item el estado
  de llegada 
\item la letra o el símbolo de entrada
\item la letra o el
  símbolo de salida 
\end{enumerate}
Para permitir que la salida y la entrada tengan longitud diferente en
cualquier momento, se permite que el símbolo de entrada esté ausente,
que el símbolo de salida esté ausente o que ambos estén ausentes. Esta
circunstancia se indica normalmente usando un símbolo especial (el
símbolo vacío).
\end{enumerate}

El transductor construye, cada vez que lee un símbolo de la entrada,
una lista de estados \emph{vivos} o \emph{activos}, cada uno de los
cuales tiene una salida asociada (una secuencia de símbolos). El
funcionamiento del transductor de letras es distinto para cada tipo de
operación de procesamiento léxico. Por ejemplo, en el análisis
morfológico se intenta leer la entrada más larga que reconoce el
diccionario (modo ``de izquierda a derecha, segmento concordante más
largo'').
\begin{enumerate}
\item Iniciación: se hace que el conjunto de estados vivos contenga un único estado vivo: el estado inicial, con la palabra vacía ("") como salida asociada al estado.
\item Si desde alguno de los estados del conjunto de estados vivos
  actual se llega a otros estados mediante transiciones que no tienen
  símbolo de entrada, se añaden estos estados al conjunto de estados
  vivos, y se les asocia la salida obtenida alargando las salidas
  asociadas con el símbolo de salida que se haya encontrado en las
  correspondientes transiciones. Esta operación de ampliación del
  conjunto de estados vivos se efectúa hasta que no sea posible añadir
  más.  
\item Se lee un símbolo de la palabra de entrada.  
\item Se crea un
  nuevo conjunto de estados vivos con aquellos a los que se llega
  mediante transiciones que tienen ese símbolo como entrada, y se
  asocia a estos estados las salidas alargadas con los
  correspondientes símbolos de salida encontrados en las transiciones.
\item Si el conjunto actual tiene algún estado vivo se va al paso 2.
\item Se recorren hacia atrás los conjuntos de estados vivos hasta que encontramos algún conjunto en el que aparecen estados de aceptación. Los análisis morfológicos serán las salidas asociadas a dichos estados, y la posición de lectura se fija a la posición inmediatamente posterior a la de ese conjunto (para que pueda volver a ser procesada por el transductor en la siguiente pasada).
\end{enumerate}
No todos los estados de aceptación son de la misma clase, y esto añade
algunas condiciones más al proceso de aceptación, para permitir el
tratamiento de palabras desconocidas o de palabras que van unidas a
otras, como se explicará más adelante.

Como puede verse, el transductor lee la palabra de entrada sólo una
vez como caso promedio, de izquierda a derecha y símbolo a símbolo, y
mantiene una lista tentativa de posibles salidas parciales que va
actualizando y podando según lee la entrada. Cuando los transductores
de letras se usan como analizadores morfológicos o como lematizadores,
leen una forma superficial y escriben la(s) forma(s) léxica(s)
correspondiente(s). En este caso, los símbolos de entrada son las
letras de la forma superficial y los de salida las letras necesarias
para formar los lemas y los símbolos especiales que representan el
análisis morfológico, como, por ejemplo, \texttt{<n>}, \texttt{<f>},
\texttt{<2p>}, etc.

El funcionamiento de los transductores en otras tareas de
procesamiento léxico es similar.

\nota{La noció de LRLM (left-to-right, longest-match) (o ODSCML, "izquierda a
derecha, recortando el segmento concordante más largo") ha de quedar clara en el funcionamient del
morfològic i del trànsfer estructural. Afegir coses de l'article de EAMT 2005.}

\subsubsection{Tratamiento de mayúsculas y minúsculas en los diccionarios}
\label{mayusc}

Una misma palabra a la entrada de un módulo de procesamiento léxico
puede presentar aspectos diferentes respecto al formato de mayúsculas
y minúsculas.  Los casos más frecuentes son los siguientes:

\begin{itemize}
\item Toda la palabra está en minúsculas.
\item Toda la palabra está en mayúsculas.
\item La primera letra de la palabra está en mayúsculas y el resto en
  minúsculas (caso más típico de los nombres propios).
\end{itemize}

Las transducciones en el diccionario también se pueden encontrar en
los tres estados.  La forma en la que un término se encuentre en el
diccionario se usa para tratar de descartar acepciones de la palabra
de la siguiente manera:

\begin{itemize}
\item Si la letra de la entrada es mayúscula y en el estado actual de
  análisis tenemos transiciones concordantes en minúsculas, estas
  transducciones se realizan.
\item Si la letra de la entrada es minúscula y en el estado actual no
  tenemos transiciones concordantes en minúsuculas, no se realizan.
\end{itemize}

Esta política nos facilita que no figuren acepciones de nombres
propios para una forma superficial que no empieza por mayúscula.

La condición de mayúscula o minúscula de una letra en una palabra será
respetada a la salida del traductor a menos que se decida cambiar
dicha condición. Esta opción está disponible en el módulo de
transferencia estructural para casos como el de traducción de una
palabra en origen por dos palabras en la lengua meta: \texttt{Canté}
--> \texttt{Vaig cantar}.


\subsection{Formato de los datos: los diccionarios}
\label{ss:diccionarios}
\subsubsection{Criterios generales para el diseño de los diccionarios}

La experiencia del grupo Transducens de la Universitat d'Alacant en la
construcción de sistemas de traducción automática ya operativos y públicamente
accesibles entre lenguas románicas (\texttt{es}, \texttt{ca} y \texttt{pt})
ha inspirado los aspectos fundamentales del diseño completo del sistema de traducción automática de
transferencia sintáctica superficial que se describe en este
documento y de su aplicación a las lenguas románicas de España (\texttt{es}, \texttt{ca} y
\texttt{gl}). En cierto sentido, se podría decir que en el presente proyecto
sólo se ha tenido que adaptar (reescribir en un formato estandarizado e
interoperable) las especificaciones y los programas ya usados en proyectos ya
operativos. 

En particular, el diseño de los diccionarios se ha seguido realizando
a partir de una arquitectura que pretende independizar al máximo la
lengua origen de la lengua meta, incluso sabiendo que se trata de
diccionarios orientados a la traducción y que no conviene
elaborarlos completamente por separado.  El formato utilizado 
sirve para especificar tanto los diccionarios morfológicos (monolingües)
como los diccionarios bilingües.

El formato de los diccionarios, al igual que el de los demás datos
lingüísticos (fichero de definición del desambiguador y reglas de
transferencia estructural) es
XML\footnote{\url{http://www.w3.org/XML/}}, un estándar internacional
utilizado en numerosos proyectos de tratamiento del lenguaje natural
que, gracias a la existencia de numerosos útiles y librerías, se está
conviertiendo en una herramienta muy potente para la representación y
el intercambio de datos lingüísticos (véase el artículo \cite{ide00}).



Los diccionarios están diseñados de manera que puedan compilarse para
elaborar \textit{transductores de letras} con ellos, por cuestiones de
eficiencia. Para más información sobre transductores de letras
como caso particular de transductores de estados finitos véase el
artículo \cite{garrido02a}.

Los transductores de letras que se elaboran a partir de los
diccionarios (morfológicos, bilingües y de postgeneración) procesan
cadenas de caracteres de entrada para ofrecer cadenas de salida. De este
modo, los diccionarios están formados por entradas consistentes en
parejas de cadenas que constituyen las entradas y las salidas de los
transductores.


La herramienta más potente de estos diccionarios es la definición y el
uso de \emph{paradigmas}. Como en las lenguas romances muchos lemas
comparten una misma flexión (existen regularidades en la flexión),
resulta útil y directo agrupar estas regularidades en paradigmas de
flexión para evitar tener que escribir todas las formas de cada
palabra. Los paradigmas permiten representar las entradas del
diccionario de manera compacta y optimizar la velocidad de
construcción del diccionario. Una vez establecidos los paradigmas más frecuentes en un
diccionario, un lingüista no tiene que preocuparse en la mayoría de
ocasiones por toda la flexión de un nuevo término, puesto que
introducir una palabra que se flexiona se reduce generalmente a
indicar el lema e identificar la flexión entre los paradigmas
previamente definidos.  Además, el uso de paradigmas reduce los
requisitos de memoria, favorece la construcción de transductores de
letras eficientes y aumenta la velocidad de compilación \cite{ortiz05j}. En los
diccionarios bilingües no se han utilizado paradigmas (aunque se
podrían utilizar), puesto que la mayor parte de la información de
flexión se procesa de manera implícita, como se explica en la 
página~\pageref{ss:bil}.

%%La
%%diferencia fundamental entre el diseño de los diccionarios bilingües y los morfológicos es que
%%en el bilingüe se especifican algunas operaciones de manera implícita, como
%%se verá en el apartado~\ref{ss:bil}. 
%% Por
%% ejemplo, todas las etiquetas que sean omitidas en el diccionario bilingüe se
%% copian literalmente en la traducción tras las etiquetas que sí están
%% expresadas de manera explícita. 




%% La utilización de paradigmas tiene como desventaja la generación de un
%% diccionario en el que normalmente no tenemos toda la información
%% acerca de cada entrada (forma superficial y lema) de un solo golpe de vista.  Este inconveniente se
%% solucionará mediante mecanismos de documentación sistemáticos ---en particular,
%% añadiendo explícitamente un atributo con el lema de cada entrada--- que favorezcan la claridad
%% del diccionario.  Este particular es muy importante porque permitirá a los
%% lingüistas solucionar problemas rápidamente. 



\subsubsection{Tipos de diccionarios}
 
En el sistema tenemos tres tipos de diccionarios: diccionarios
morfológicos (monolingües) de cada uno de los idiomas implicados
(español, catalán y gallego); diccionarios bilingües para los
distintos pares de traducción (español--catalán y español--gallego), y
diccionarios de postgeneración para cada uno de los idiomas (que más que
un diccionario con lemas e información morfológica son un pequeño
diccionario de las transformaciones ortográficas que pueden sufrir
las palabras al entrar en contacto entre sí).
La estructura de los tres tipos de diccionarios está especificada
mediante la misma DTD (\emph{definición de tipo de documento}), que puede consultarse
en el apéndice \ref{ss:dtd_dics}.


Los \textbf{diccionarios morfológicos} se usan tanto para construir
analizadores morfológicos ---el módulo del sistema de traducción que
se usa para obtener todas las formas léxicas posibles para una forma
superficial dada en la lengua origen--- como generadores morfológicos
---el módulo que se ocupa de generar la forma superficial en la lengua
meta a partir de la forma léxica de cada palabra---.  Estos dos
módulos se obtienen a partir de un mismo diccionario morfológico,
según el sentido en que el sistema lo lea: leído de izquierda a
derecha se obtiene el analizador, y de derecha a izquierda, el
generador.

La estructura de bloques típica de estos diccionarios consta de:

\begin{itemize}
\item \textit{Una definición del alfabeto}.  Esta definición se usa
  exclusivamente para la construcción del analizador morfológico; en
  concreto, para que éste pueda recortar las palabras desconocidas y
  las de las secciones condicionales (ver la explicación del elemento
  \texttt{<section>} en la página \pageref{ss:section}) de forma
  adecuada; el generador morfológico no necesita esta definición.
%% \item \textit{Una definición de la marca de activación del postgenerador}. 
%%   Para su uso en algunas de las entradas de sólo generación. 
\item \textit{Una definición de los símbolos}.  Consiste en una
  declaración de los símbolos gramaticales que se usarán en las
  entradas del diccionario (véase en el Apéndice
  \ref{se:simbolosmorf} una lista con los símbolos gramaticales
  utilizados en este proyecto).
\item \textit{Una definición de paradigmas}.  Para poder referirse a ellos en
  las secciones del diccionario o en otros paradigmas.
\item \textit{Una o más secciones de diccionario de recorte
    condicional}, de tipo \texttt{standard}. Para incluir la mayoría de las palabras
  del diccionario. 
\item \textit{Una o más secciones de diccionario de recorte
    incondicional}.  Para incluir ciertas palabras que siguen algún
  patrón regular o se recortan independientemente del texto que les
  sigue (ver discusión del elemento \texttt{<section>} en la página
  \pageref{ss:section}). En los diccionarios morfológicos de catalán,
  las palabras que requieren un recorte incondicional se reparten en
  dos secciones: una para las formas que necesitan que se coloque un
  blanco a continuación (por razones de procesamiento de las formas
  léxicas), como \emph{l'} o \emph{d'}, y otra para signos de
  puntuación, números y otros signos.

\end{itemize}

Los \textbf{diccionarios bilingües} son los que representan en el
sistema el proceso de la transferencia léxica, esto es, la asignación
de la forma léxica de la LM que corresponde a cada forma léxica de la
LO. De cada diccionario bilingüe se obtienen dos \emph{productos}
según el sentido en el que el sistema los lea: leídos de izquierda a
derecha se obtiene el módulo de transferencia léxica en uno de los
sentidos de traducción, y leídos de derecha a izquierda, en el otro
sentido. Para los diccionarios bilingües de este proyecto se ha
convenido que el español se situará siempre en la parte izquierda de
las entradas, y las demás lenguas (catalán y gallego), en la parte
derecha. Así, por ejemplo, el diccionario bilingüe español--gallego se
leerá de izquierda a derecha para la traducción
\texttt{es}--\texttt{gl} y de derecha a izquierda para la traducción
\texttt{gl}--\texttt{es}.  En aplicaciones como las de este proyecto,
estos diccionarios no tienen paradigmas: se construyen mediante
entradas genéricas en las que casi nunca se especifica más que su lema
y categoría gramatical y no hay información de flexión.

El esquema de bloques usado en este proyecto para los diccionarios bilingües
es el siguiente:

\begin{itemize}
\item \textit{Una definición de los símbolos}.  Consiste en una declaración de
  los símbolos gramaticales que se usarán en las entradas del diccionario. 
\item \textit{Una sección única de diccionario}.  Para
  incluir las correspondencias bilingües del diccionario. 
\end{itemize}

A partir de 2007, los diccionarios bilingües permiten la 
especificación de más de una traducción en lengua meta para
que un módulo de selección léxica (veáse el apartado \ref{se:seleccio_lex})
pueda elegir el equivalente más adecuado según el contexto. Para tal fin se ha 
añadido un atributo a los diccionarios bilingües, que se describe en la sección 
\ref{dic_lextor}.


Los \textbf{diccionarios de postgeneración} se usan para llevar a cabo
las operaciones de transformación ortográfica, contracción,
apostrofación, etc. que sean necesarias una vez generadas las formas
superficiales de la lengua meta debido al contacto entre palabras.
Como este tipo de operaciones se pueden expresar como traducciones de
cadenas de caracteres se ha optado por usar el mismo tipo de
diccionarios. Implícitamente, se entiende que las partes del texto
cuyo procesamiento no se especifica se copian tal como llegan. En
estos diccionarios es útil la definición de paradigmas para expresar
cambios sistemáticos en los fenómenos de contacto entre palabras. A
diferencia de los demás tipos de diccionarios, estos no tienen
símbolos gramaticales, ya que procesan formas superficiales.

El esquema de bloques de los diccionarios de postgeneración es el siguiente:
\begin{itemize}
%% \item \textit{Una definición de la marca de activación del postgenerador}. 
%%   Para identificar la marca del diccionario con la marca en el flujo de datos. 
\item \textit{Una sección de definición de paradigmas}. Para componer las
  entradas. 
\item \textit{Una sección de diccionario}.  Para incluir los patrones para
  realizar la postgeneración. 
\end{itemize}


En la siguiente tabla se presentan de forma
resumida los sentidos de lectura de los diccionarios y su utilidad
para las lenguas románicas del presente proyecto:

\begin{center}
 \begin{tabular}{|l|l|l|}
 \hline
 Diccionario & Sentido de lectura    & Función \\
 \hline
Morfológico  & izquierda--derecha    & análisis de \texttt{es}, \texttt{ca} y \texttt{gl}\\
             & derecha--izquierda   & generación de \texttt{es}, \texttt{ca} y \texttt{gl}\\\hline
Bilingüe     & izquierda--derecha    & traducción \texttt{es-ca} y \texttt{es-gl} \\
             & derecha--izquierda   & traducción \texttt{ca-es} y \texttt{gl-es} \\\hline
Postgeneración & izquierda--derecha   & postgeneración para \texttt{ca}, \texttt{es}  y \texttt{gl}\\\hline

\end{tabular}
\end{center}



\subsubsection{Descripción del formato de los diccionarios}
\label{formatodics}
En esta sección se presentan los principales elementos del formato en
el que se construyen los diccionarios. La definición formal (una DTD)
se da en el apéndice~\ref{ss:dtd_dics}.  En la sección
\ref{dic_lextor} se describen las características de un
diccionario bilingüe que funcione en un sistema Apertium que disponga
de módulo de selección léxica.  Finalmente, en las páginas
\pageref{ss:morfgen} a %\pageref{ss:bil} y 
\pageref{ss:postgen} se
describen las características particulares de las entradas de los tres
tipos de diccionarios (morfológicos, bilingües y de postgeneración
respectivamente).



\paragraph{Elemento diccionario \texttt{<dictionary>}}
 
Es el elemento raíz, que incluye todo el diccionario.  Incluye una
definición de caracteres alfabéticos, una definición de símbolos (que
son las etiquetas morfológicas de las palabras), una definición de
paradigmas de flexión y una o varias secciones de diccionario, en las
que se encuentran las entradas correspondientes a las formas léxicas
(formadas por pares de forma superficial--forma léxica). En la figura
\ref{fig:dictionary} se muestra la estructura básica de bloques de un
diccionario genérico.

\begin{figure}
\begin{small}
\begin{alltt}
<?\textbf{xml} \textsl{version}="1.0" \textsl{encoding}="iso-8859-15"?>
<\textbf{dictionary}>
  <\textbf{alphabet}>abcdefghijk ... ABCDEFGH ... çñáéíóú</\textbf{alphabet}>
  <\textbf{sdefs}>
    <!-- ... -->
  </\textbf{sdefs}>
  <\textbf{pardefs}>
    <!-- ... -->
  </\textbf{pardefs}>
  <\textbf{section} ...>
    <!-- ... -->
  </\textbf{section}>
  <!-- ... -->
</\textbf{dictionary}>
\end{alltt}
\end{small}
\caption{Uso de los elementos \texttt{<\textbf{dictionary}>} y \texttt{<\textbf{alphabet}>}}
\label{fig:dictionary}
\end{figure}


\paragraph{Elemento alfabeto \texttt{<alphabet>}}

Permite especificar una definición de caracteres alfabéticos.  El
objeto de esta especificación es que los módulos que procesan la
entrada mediante transductores de letras puedan recortarla en palabras
individuales.\nota{Parlar dels mots desconeguts. Cita
  \ref{ss:section} - Mikel?}

En la actual especificación, sólo tiene sentido la definición de este
elemento en los diccionarios morfológicos, por ser necesario para el
análisis. La figura \ref{fig:dictionary} muestra un ejemplo de uso de
este elemento.


\paragraph{Elemento sección de definición de símbolos \texttt{<sdefs>}}
Agrupa todas las definiciones de símbolos de un diccionario (\texttt{<\textbf{sdef}>}).  Un ejemplo se
muestra en la figura \ref{fig:sdefs}. 

\paragraph{Elemento definición de símbolos \texttt{<sdef>}}

Se trata de un elemento vacío (no delimita ningún contenido): sirve
para especificar los nombres de los símbolos gramaticales que se usan
en este diccionario mediante los valores del atributo
\texttt{\textsl{n}}.  Estos símbolos son los que se utilizarán para
etiquetar morfológicamente las formas léxicas. En la figura
\ref{fig:sdefs} se ilustra un ejemplo del ámbito en el que se usa este
elemento. En el Apéndice \ref{se:simbolosmorf} puede verse una lista
de todos los simbolos gramaticales utilizados en los diccionarios de este proyecto.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{sdefs}>
  <\textbf{sdef} \textsl{n}="n"/>
  <\textbf{sdef} \textsl{n}="det"/>
  <\textbf{sdef} \textsl{n}="sg"/>
  <\textbf{sdef} \textsl{n}="pl"/>
  <!-- ... -->
</\textbf{sdefs}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{sdefs}>}}
\label{fig:sdefs}
\end{figure}

\paragraph{Elemento de sección del diccionario \texttt{<section>}}
\label{ss:section}

Define en su interior las palabras que serán reconocidas por el diccionario. 
La razón de dividir el diccionario en secciones es porque ciertos grupos de formas ---como
por ejemplo, las que proceden de la identificación de ciertos patrones
regulares, o las que pudieran depender de un dialecto específico--- necesitan en
ocasiones un procesamiento diferente. 

Uno de los procesamientos específicos que se resuelven mediante la
definición de secciones en el diccionario es el problema del
procedimiento de \textit{recorte} (división de palabras) en el
análisis morfológico.  La mayor parte de formas se recortan mediante
un criterio condicional, atendiendo a si viene un carácter no
alfabético ---es decir, no definido en \texttt{<\textbf{alphabet}>}---
después del carácter que está siendo procesado. Pero hay otras formas,
como las catalanas \emph{l'} o \emph{d'}, que requieren un modo de
recorte incondicional, sin esperar a leer lo que viene después ---ya
que si viene un carácter alfabético después, forma parte de la
\textit{siguiente} palabra---. Estas formas que requieren de un
recorte incondicional se incluyen en una sección específica del
diccionario. Otros tipos de procesamiento también pueden resolverse
mediante estas divisiones.



Se usa el valor del atributo \texttt{\textsl{type}} para expresar el tipo de
reconocimiento de las cadenas que se usa en cada sección del diccionario: los
valores del atributo son \texttt{standard} para casi todos los propósitos del
diccionario (condicional), \texttt{postblank} para las formas que requieren 
un recorte incondicional y la colocación de un blanco, e \texttt{inconditional} para 
las demás formas de recorte incondicional. 

El atributo \texttt{\textsl{id}} se usa para otorgar un identificador (un
nombre) a las secciones del diccionario. 

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{section} \textsl{id}="principal" \textsl{type}="standard">
<!-- ... -->
</\textbf{section}>
<\textbf{section} \textsl{id}="patterns" \textsl{type}="inconditional">
<!-- ... -->
</\textbf{section}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{section}>}}
\label{fig:section}
\end{figure}

\paragraph{Elementos de las entradas \texttt{<e>}}

La entrada es la unidad básica del diccionario o de la definición de
paradigma.  Las entradas consisten en una concatenación en cualquier
orden de parejas de cadenas \texttt{<\textbf{p}>}, transducciones
identidad \texttt{<\textbf{i}>}, referencias a paradigmas
\texttt{<\textbf{par}>} o expresiones regulares
\texttt{<\textbf{re}>}.  La estructura y el significado de estos
elementos se explica más adelante (en las páginas~\pageref{ss:p}, \pageref{ss:i},
\pageref{ss:par} y \pageref{ss:re} respectivamente).

\label{restric}Se usan dos atributos opcionales con esta entrada.  Uno es \texttt{\textsl{r}}
(de \textit{restriction}) que define si esa entrada se tiene que tener en
cuenta durante la lectura del diccionario sólo de izquierda a derecha
(\texttt{LR}) o sólo de derecha a izquierda (\texttt{RL}).  Si no se
especifica nada se supone que la entrada se debe tener en cuenta en ambas
direcciones. 

En los diccionarios morfológicos, la restricción de dirección
\texttt{LR} se utiliza para que una FL sea analizada pero no generada
(por ejemplo, por tratarse de una FL en una variante dialectal que se
desea reconocer pero no generar) y la restricción \texttt{RL} para que
una palabra sólo se genere pero no se analice (necesario, por ejemplo,
para las formas con marca de activación del postgenerador, véase la página \pageref{ss:a}).

En los diccionarios bilingües, las restricciones \texttt{LR} y
\texttt{RL} sirven para que la traducción se haga sólo en un sentido:
por ejemplo, en un diccionario bilingüe \texttt{es}--\texttt{ca},
\texttt{LR} indicaría que la FL sólo se traduce de español a catalán,
y \texttt{RL} sólo de catalán a español. Lo ilustraremos con un
ejemplo: los adverbios españoles \emph{aún} y \emph{todavía} los
traducimos al catalán por una misma palabra, \emph{encara}. El adverbio
catalán \emph{encara} sólo podemos traducirlo al español por uno de
las dos, y decidimos traducirlo por \emph{todavía}. En este caso,
debemos escribir dos entradas en el diccionario bilingüe: la que
empareja \emph{aún} con \emph{encara} debe tener la restricción
\texttt{LR} (traducción sólo de \texttt{es} a \texttt{ca}) y la que
empareja \emph{todavía} con \emph{encara} no debe tener ninguna
restricción (traducción en ambos sentidos).

Las restricciones de dirección en diccionarios bilingües son
necesarias también en el caso de palabras con género por determinar
("GD") o número por determinar ("ND") (véase la página~\pageref{ss:bil}).

El otro atributo opcional de las entradas es el nombre del lema
\texttt{\textsl{lm}}. Debido a la utilización de
paradigmas para representar las regularidades en la flexión de las
unidades léxicas, las entradas de los diccionarios morfológicos
contienen la parte del lema que es común a todas las formas
flexionadas, es decir, contienen el lema cortado en el punto en que
empieza la regularidad del paradigma (por ejemplo, los adjetivos
españoles \emph{distinto}, \emph{absoluto} y \emph{marino} aparecen en
las entradas como \emph{distint}, \emph{absolut} y \emph{marin},
siendo el resto de sus formas flexionadas común a todos ellos y
descrito en un paradigma).  Este hecho puede provocar dificultades en
la comprensión del diccionario.  Por ello, en las entradas se ha
añadido este atributo, que contiene el lema completo de la forma
léxica, de modo que el diccionario gane en claridad y los lingüistas
puedan solucionar problemas rápidamente.  En los diccionarios
bilingües, que no suelen tener referencias a
paradigmas,\footnote{Podrían tener referencias a paradigmas, pero no
  lo hemos considerado necesario para las lenguas
  involucradas\nota{atenció: ex--, vice--?}.} no suele ser necesario usarlo.


\paragraph{Elemento pareja de cadenas \texttt{<p>}}
\label{ss:p}

Este elemento básico de los diccionarios se usa en cualquier tipo de
entrada para indicar la correspondencia entre dos cadenas de símbolos,
correspondencia que especifica una transformación léxica que será
realizada por un camino de estados en el transductor de estados
finitos \cite{garrido99j} resultante.

Están definidas por un par de elementos internos.  Uno es el izquierdo
(elemento \texttt{<\textbf{l}>}, \textit{left}) y el otro el derecho (elemento
\texttt{<\textbf{r}>}, \textit{right}).  La estructura de esta etiqueta
presenta el aspecto que se muestra en la figura \ref{fig:p}. 

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{p}>
  <\textbf{l}><!-- ... --></\textbf{l}>
  <\textbf{r}><!-- ... --></\textbf{r}>
</\textbf{p}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{p}>}}
\label{fig:p}
\end{figure}

Una pareja \texttt{<\textbf{p}>} debe incluir estas dos partes aunque
una de ellas puede estar vacía, lo que se corresponde con borrar (o
insertar) una cadena. Los elementos \texttt{<\textbf{l}>} y
\texttt{<\textbf{r}>} tienen la misma estructura interna y los mismos
requisitos.  Dentro de cada pareja puede haber texto y referencias a
símbolos gramaticales (que en las lenguas del presente proyecto, con
flexión sufijal, se suelen poner al final en cualquier cantidad).  En
el exterior de las etiquetas \texttt{<\textbf{l}>} y
\texttt{<\textbf{r}>} de las parejas de cadenas no hay nada.


\paragraph{Elemento referencia a símbolo (o etiqueta) \texttt{<s>}}

Las referencias a símbolos sirven para especificar la información
morfológica de una FL y se usan en cualquier punto dentro de una
pareja de cadenas, es decir, dentro de \texttt{<\textbf{l}>},
\texttt{<\textbf{r}>} o de ambos, como si se tratasen de caracteres
individuales, aunque en las lenguas del presente proyecto se suelen
poner al final de las parejas y siempre en el mismo orden para el
mismo tipo de palabra.  Este orden lo decide el lingüista según como
quiera caracterizar morfológicamente las FL de los diccionarios, y
debe ser el mismo en todos los diccionarios del sistema para que las
operaciones de transferencia léxica y estructural funcionen
correctamente. Así, por ejemplo, en los diccionarios de este proyecto,
un nombre común lleva primero el símbolo de categoría (\textit{n},
nombre), luego el de género (\textit{m}, masculino, \textit{f},
femenino, \textit{mf}, masculino--femenino), y finalmente el de número
(\textit{sg}, singular, \textit{pl}, plural, \textit{sp},
singular--plural).  En el Apéndice \ref{se:simbolosmorf} se ofrece una
lista con los símbolos gramaticales utilizados en los diccionarios de
este proyecto y el orden que se ha establecido para definir los
distintos tipos de palabra.

En los diccionarios morfológicos las referencias a símbolos se usan en
los paradigmas de flexión y en las entradas que no incluyen ninguna
referencia a paradigma. En los diccionarios bilingües suelen indicarse
únicamente los primeros símbolos gramaticales (normalmente sólo el
primero) de cada FL, ya que el resto se copia automáticamente de la FL
en lengua origen a la FL en lengua meta (si coincide en ambas
lenguas).

Para especificar el símbolo al que nos referimos se usa el atributo
(obligatorio) \texttt{\textsl{n}}.  Se requiere que el símbolo esté definido
en la sección de definición de símbolos (\texttt{<\textbf{sdefs}>}).




\paragraph{Elemento transducción identidad \texttt{<i>}}
\label{ss:i}

Debe ser visto como una forma de escribir una pareja de cadenas en la que la
parte izquierda y la parte derecha son idénticas.  Por ejemplo, a todos los
efectos las dos entradas que se muestran en la figuras \ref{fig:i} son
equivalentes. La ventaja de escribir las entradas en esta notación es que resultan más compactas
y también más legibles.
\begin{figure}
\begin{small}
\begin{alltt}
[1]

<\textbf{e} \textsl{lm}="perro">
  <\textbf{p}>
    <\textbf{l}>perr</\textbf{l}><\textbf{r}>perr</\textbf{r}>
  </\textbf{p}>
  <\textbf{par} \textsl{n}="abuel_o__n"/>
</\textbf{e}>

[2]

<\textbf{e} \textsl{lm}="perro">
  <\textbf{i}>perr</\textbf{i}>
  <\textbf{par} \textsl{n}="abuel_o__n"/>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{i}>}: las entradas [1] y [2] son equivalentes}
\label{fig:i}
\end{figure}


\paragraph{Elemento sección de definición de paradigmas \texttt{<pardefs>}}

Este elemento agrupa
todas las definiciones de paradigmas del diccionario, contenidas cada una en un 
elemento \texttt{<\textbf{pardef}>}, como se muestra en la
figura \ref{fig:pardefs}. 

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{pardefs}>
  <\textbf{pardef} \textsl{n}="abuel_o__n">
    <!-- ... -->
  </\textbf{pardef}>
  <!-- ... -->
</\textbf{pardefs}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{pardefs}>}}
\label{fig:pardefs}
\end{figure}



\paragraph{Elemento de definición de paradigmas \texttt{<pardef>}}


Define un paradigma de flexión del diccionario. 
Un paradigma se puede entender como un pequeño diccionario de transformaciones 
alternativas que se pueden concatenar a partes de las palabras (o a entradas de otro paradigma)
para especificar regularidades en el 
procesamiento léxico de las entradas del diccionario, como, por ejemplo, regularidades en 
la flexión. Para especificar estas
regularidades, cada paradigma es una lista de entradas \texttt{<\textbf{e}>} como las del diccionario,
es decir, tiene la misma estructura que una sección del diccionario
\texttt{<\textbf{section}>}; por tanto, las entradas consisten en una pareja (\texttt{<\textbf{p}>}) con
parte izquierda (\texttt{<\textbf{l}>}) y parte derecha (\texttt{<\textbf{r}>}). Dentro de estos
elementos se puede incluir texto o símbolos morfológicos \texttt{<\textbf{s}>}.


Como en el caso de las definiciones de símbolos, las definiciones de
paradigmas tienen un atributo \texttt{\textsl{n}} que especifica el
nombre del paradigma para poder utilizarlo posteriormente dentro de
las entradas del diccionario. Así, en cada entrada del diccionario
bastará con indicar el nombre del paradigma que le corresponde para
que queden especificadas todas sus posibles formas.

El ejemplo de definición de paradigma que se apunta en la figura \ref{fig:pardefs}
se desarrolla en la figura \ref{fig:pardef}.  Para ilustrar
qué información se expresa mediante el paradigma se presenta la siguiente
tabla:

\begin{center}
 \begin{tabular}{|l|c|l|}
 \hline
 Raíz (FS y FL) & Desinencia (FS) & Análisis (FL) \\
 \hline
\texttt{abuel} & \texttt{o} &\texttt{o<n><m><sg>}\\
\texttt{abuel} & \texttt{a} &\texttt{o<n><f><sg>}\\
\texttt{abuel} & \texttt{os} &\texttt{o<n><m><pl>}\\
\texttt{abuel} & \texttt{as} &\texttt{o<n><f><pl>}\\
\hline
\end{tabular}
\end{center}


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{pardef} \textsl{n}="abuel_o__n">
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}>o</\textbf{l}>
      <\textbf{r}>o<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
    </\textbf{p}>
  </\textbf{e}>
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}>a</\textbf{l}>
      <\textbf{r}>o<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
    </\textbf{p}>
  </\textbf{e}>
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}>os</\textbf{l}>
      <\textbf{r}>o<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
    </\textbf{p}>
  </\textbf{e}>
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}>as</\textbf{l}>            
      <\textbf{r}>o<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
    </\textbf{p}>
  </\textbf{e}>      
</\textbf{pardef}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{pardef}>} para definir la
  morfología flexiva de substantivos de cuatro terminaciones como \emph{abuelo, -a, -os, -as}. }
\label{fig:pardef}
\end{figure}

Este paradigma se asigna a todos los sustantivos (\texttt{n}) que se
flexionan igual que \emph{abuelo}, como \emph{alumno}, \emph{amigo} o
\emph{gato}, y está pensado para ser usado como \textit{sufijo} en las
entradas del diccionario.  En general se pueden usar paradigmas en
cualquier punto de las entradas del diccionario (siempre que tenga
sentido, claro está).  Podemos pensar en los paradigmas como
transductores que se insertan en el punto en el que se haga referencia
a ellos.  En la figura \ref{fig:pardef2} se muestra un ejemplo de un
paradigma definido para ser usado como prefijo. Es el caso del
paradigma que se usa para analizar y generar las palabras que empiezan
por \emph{ex}, \emph{ex-}, etc., como \emph{ex-presidente},
\emph{exministro}, \emph{ex director}, etc., con sus variaciones
ortográficas (\emph{ex} con guión, sin guión unido y sin guión
separado por un blanco \texttt{<\textbf{b}/>}, véase la pàgina~\ref{s3:b}); el
lema entregado simplemente añade \emph{ex} sin guión ni blanco al lema
del resto. Las restricciones de dirección (\texttt{"LR"}) que aparecen en el ejemplo
se usan para decidir qué forma es la que va a generar el traductor. La
transducción identidad vacía (\texttt{<\textbf{i}/>}) es necesaria en este caso para analizar y generar la
palabra sin el prefijo \emph{ex}.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{pardef} \textsl{n}="ex">
  <\textbf{e} \textsl{r}="LR"><\textbf{p}><\textbf{l}>ex<\textbf{b}/></\textbf{l}><\textbf{r}>ex</\textbf{r}></\textbf{p}></\textbf{e}>
  <\textbf{e}><\textbf{i}>ex</\textbf{i}></\textbf{e}>
  <\textbf{e} \textsl{r}="LR"><\textbf{p}><\textbf{l}>ex-</\textbf{l}><\textbf{r}>ex</\textbf{r}></\textbf{p}></\textbf{e}>
  <\textbf{e}><\textbf{i}/></\textbf{e}>
</\textbf{pardef}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{pardef}>} en el paradigma usado
  para el prefijo \emph{ex}.} 
\label{fig:pardef2}
\end{figure}


Las entradas de un paradigma pueden incluir referencias a otros paradigmas con
la condición  de que hayan sido definidos previamente en el fichero.  Por
otro lado, por el momento, una definición de paradigma no puede incluirse a sí
mismo ni directa ni indirectamente.

Los paradigmas se usan en los diccionarios morfológicos para el
análisis y la generación de formas léxicas. Para los
pares de lenguas de este proyecto, no es necesaria la 
definición de paradigmas en los diccionarios bilingües (página~\pageref{ss:bil}). 



\paragraph{Elemento referencia a paradigma de flexión \texttt{<par>}}
\label{ss:par}

Se utiliza dentro de las entradas para indicar qué paradigma, de los
que se han definido en \texttt{<\textbf{pardefs}>}, sigue la entrada en
cuestión. Gracias a las referencias a paradigmas no es necesario
escribir en cada entrada de un diccionario morfológico todas las formas flexionadas del
lema.  El atributo \texttt{\textsl{n}} sirve para
especificar a qué paradigma se hace referencia.

El resultado de insertar una referencia a paradigma en una entrada es
la creación de tantas parejas de cadenas como casos especifique el
paradigma. Por ejemplo, la entrada de la figura \ref{fig:par}, con la
referencia al paradigma "\texttt{abuel\_o\_\_n}" (que está definido en
la figura \ref{fig:pardef}), equivale a realizar una entrada con cada
pareja de cadenas del paradigma concatenada al lema (es decir, con
cada forma flexionada del lema), como se representa en la figura
\ref{fig:lema_par}. En ella puede verse como el paradigma ofrece
siempre como cadena derecha (\texttt{<\textbf{r}>}) el lema (\emph{perro}) junto con los
símbolos gramaticales correspondientes a la forma superficial, ya que 
es a partir del lema que se realizan las operaciones de
transferencia.


El uso adecuado de paradigmas, además de permitir la creación de diccionarios
compactos, favorece la velocidad de compilación y
rebaja la necesidad de memoria durante la misma, ya que durante el
proceso de compilación es posible crear una única estructura de datos
para cada uno de la mayor parte de paradigmas \cite{ortiz05j}.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="perro">
  <\textbf{i}>perr</\textbf{i}>
  <\textbf{par} \textsl{n}="abuel_o__n"/>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{par}>}}
\label{fig:par}
\end{figure}


\begin{figure}
\begin{small}
\begin{alltt}
 <\textbf{e}>
   <\textbf{p}>
     <\textbf{l}>perro</\textbf{l}>
     <\textbf{r}>perro<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
   </\textbf{p}>
 </\textbf{e}>
 <\textbf{e}>
   <\textbf{p}>
     <\textbf{l}>perra</\textbf{l}>
     <\textbf{r}>perro<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
   </\textbf{p}>
 </\textbf{e}>
 <\textbf{e}>
   <\textbf{p}>
     <\textbf{l}>perros</\textbf{l}>
     <\textbf{r}>perro<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
   </\textbf{p}>
 </\textbf{e}>
 <\textbf{e}>
   <\textbf{p}>
     <\textbf{l}>perras</\textbf{l}>            
     <\textbf{r}>perro<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
   </\textbf{p}>
 </\textbf{e}>      
\end{alltt}
\end{small}
\caption{Entrada equivalente a la de la figura \ref{fig:par} que muestra el resultado de insertar la referencia a
  paradigma \texttt{<\textbf{par}>} con el paradigma definido en la figura \ref{fig:pardef}.}
\label{fig:lema_par}
\end{figure}


\paragraph{Elemento expresión regular \texttt{<re>}}
\label{ss:re}

En los lenguajes naturales también hay patrones que se pueden reconocer como
expresiones regulares: por ejemplo, los signos de puntuación, los números (latinos
o romanos), las direcciones de correo electrónico o de páginas de internet o
cualquier tipo de código identificable mediante estos mecanismos. 


Para estos usos se utiliza la cadena que contiene la etiqueta
\texttt{<\textbf{re}>}.  El compilador lee la definición de la expresión
regular y la transforma en un transductor que se integra en el resto del
diccionario y que traduce todas las cadenas que concuerdan con la expresión
por cadenas idénticas. 

La sintaxis de la implementación actual de estas expresiones regulares procesa
un subconjunto de las expresiones regulares de Unix, que incluye los
operadores \texttt{*}, \texttt{?}, \texttt{|} y \texttt{+}, además de
agrupaciones mediante paréntesis y rangos de caracteres opcionales como por
ejemplo \texttt{[a-zA-zñú]} o sus versiones negadas, por ejemplo
\verb![^a-z]!. 

Por analogía, se pueden ver como si se tratase de elementos
\texttt{<\textbf{i}>}, pero con la característica de que pueden identificar cadenas
que en algún caso pueden ser infinitas (como los números).

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{re}>[0-9]+([.,][0-9]+)?(\%)?</\textbf{re}>
  <\textbf{p}><\textbf{l}/><\textbf{r}><\textbf{s} \textsl{n}="num"/></\textbf{r}></\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{re}>} en una entrada que
  sirve para la identificación de números arábigos.}
\label{fig:e}
\end{figure}

En la figura \ref{fig:e} se muestra cómo etiquetar cantidades expresadas como
números arábigos en el diccionario. 


\paragraph{Elemento de bloque de blancos \texttt{<b>}}
\label{s3:b}

Se usa para expresar la presencia de blancos entre palabras de una
unidad multipalabra (vea la explicación de las multipalabras en la
página~\pageref{ss:multipalabras}). Se puede usar dentro de los
elementos \texttt{<\textbf{i}>}, \texttt{<\textbf{l}>} y
\texttt{<\textbf{r}>}.  En la figura \ref{fig:b} se puede ver la
entrada correspondiente a la expresión \emph{hoy en día}: los espacios
existentes entre las palabras aparecen como elementos
\texttt{<\textbf{b}/>} dentro de las cadenas izquierda y derecha.
\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="hoy en día">
  <\textbf{p}>
    <\textbf{l}>hoy<\textbf{b}/>en<\textbf{b}/>día</\textbf{l}>
    <\textbf{r}>hoy<\textbf{b}/>en<\textbf{b}/>día<\textbf{s} \textsl{n}="adv"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{b}>}}
\label{fig:b}
\end{figure}

Los blancos pueden ser caracteres de espaciado normales o bloques de
información sobre el formato del documento encapsulados por el
desformatador (\textit{superblancos}, ver sección \ref{ss:formato}).


\paragraph{Elemento de activación del postgenerador \texttt{<a>}}
\label{ss:a}
El elemento de activación del postgenerador \texttt{<\textbf{a}>} se
usa para indicar que algunas palabras en la lengua meta son
susceptibles de sufrir transformaciones ortográficas por contacto con
otras palabras; por ejemplo, ser apostrofadas, contraídas, escritas
sin espacios intermedios, etc.  Estas transformaciones deben
realizarse tras la generación de las formas superficiales en la lengua
meta, ya que antes, con las palabras aisladas, no es posible saber qué
palabras entrarán en contacto. Así, es el módulo siguiente al
generador (llamado postgenerador) el que se encarga de tales
operaciones. Para indicar qué palabras debe procesar el postgenerador,
se usa este elemento en la parte de la forma superficial de las
entradas correspondientes de los diccionarios morfológicos.

El ejemplo de la figura \ref{fig:a} muestra su uso en un diccionario
morfológico de catalán para la preposición \textit{de}, la cual, si
aparece delante del artículo definido masculino singular o plural
(\textit{el, els}) forma una contracción (\textit{del, dels}).  La
etiqueta \texttt{<\textbf{a}/>} incluye información que provoca la
activación del postgenerador, el cual comprueba si la preposición
viene seguida de las palabras que provocan su contracción y, de ser
así, la realiza (véase la página~\pageref{ss:postgen} para más
detalles). La restricción \texttt{RL} indica que esta entrada es sólo
de generación, ya que no tiene ningún sentido para el análisis.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{r}="RL" \textsl{lm}="de">
   <\textbf{p}>
      <\textbf{l}><\textbf{a}/>de</\textbf{l}>
      <\textbf{r}>de<\textbf{s} \textsl{n}="pr"/></\textbf{r}>
   </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{a}>} en un diccionario morfológico}
\label{fig:a}
\end{figure}



\paragraph{Elemento de marcado de grupos \texttt{<g>}}

Este elemento se usa para definir, dentro de los elementos
\texttt{<\textbf{l}>} y \texttt{<\textbf{r}>}, grupos que requieren un
tratamiento especial más allá del tratamiento palabra por palabra. Se
utiliza en las multipalabras con flexión para señalar el principio y
el final de la forma o formas léxicas que van unidas a la palabra
flexionada y que, junto a ella, forman una unidad inseparable. En la página~\pageref{ss:multipalabras} se explican con más detalle los
distintos tipos de multipalabra, y en la figura \ref{fig:hacertilin}
del mismo puede verse un ejemplo de utilización de este elemento.



\paragraph{Elemento de unión de formas léxicas \texttt{<j>}}
\label{ss:j}

Este elemento se utiliza sólo en la parte izquierda de las entradas
(\texttt{<\textbf{r}>}) para indicar que las palabras que forman parte
de una multipalabra son tratadas como formas léxicas individuales y,
por lo tanto, tienen cada una un símbolo morfológico. Estas
multipalabras serán tratadas como una unidad por el analizador y por
el desambiguador hasta llegar al módulo auxiliar \texttt{pretransfer}
(véase el apartado \ref{se:pretransfer}), que se encarga de separar
las formas léxicas que las componen para que lleguen al módulo de
transferencia como formas independientes. Si se desea que estas formas
lleguen al generador como formas unidas, formando una multipalabra
otra vez, debe haber una regla de transferencia estructural que
realice la acción de agruparlos (véase el apartado
\ref{formatotransfer}). Si, por el contrario, estas formas deben ser
sólo de análisis, la entrada debe tener la restricción \texttt{LR}.

En la página~\pageref{ss:multipalabras} se ilustra más detalladamente el uso de este elemento. Puede
verse un ejemplo de uso en la figura \ref{fig:cont} de la mencionada sección.

\subsubsection{Modificación de los diccionarios  bilingües para el nuevo módulo de selección léxica}
\label{dic_lextor}

En 2007 se ha añadido un nuevo módulo al sistema Apertium: el módulo de
selección léxica, que se describe en el apartado \ref{se:seleccio_lex}.

Para funcionar en un sistema de selección léxica, los diccionarios
bilingües deben ser modificados ligeramente para permitir la especificación
de más de una traducción en lengua meta. El único cambio
consiste en el añadido de dos nuevos atributos al elemento \texttt{<e>}.
Estos nuevos atributos pueden utilizarse en todos los diccionarios
pero sólo tienen sentido cuando se trata de una entrada del diccionario bilingüe.


En el Apéndice~\ref{dixdtd} se muestra el fragmento de la DTD
\texttt{dix.dtd} \nota{MG: no caldria ajuntar les dues DTDs en una de
  sola?}  donde se define el elemento \texttt{e} usado para codificar
las entradas en los diccionarios.  Los nuevos atributos introducidos
son:
\begin{description}
\item[slr (\emph{sense from left to right})] se utiliza para
  especificar la \emph{marca de traducción} cuando hay más de una
  traducción de izquierda a derecha para el lema situado en la parte
  izquierda de la entrada. El atributo puede recibir cualquier valor;
  sin embargo, lo más apropiado es que reciba como valor el lema
  situado en la parte derecha \texttt{<r>} (la traducción del lema).
\item[srl (\emph{sense from right to left})] se utiliza para
  especificar la \emph{marca de traducción} cuando hay más de una
  traducción de derecha a izquierda para el lema situado en la parte
  derecha de la entrada.  Como antes, el atributo puede recibir
  cualquier valor, pero lo más apropiado es que reciba el lema situado
  en la parte izquierda \texttt{<l>} (la traducción del lema).
\end{description}

Además, en ambos casos el valor del atributo puede acabar con un
espacio en blanco y la letra ``D'' para indicar que ésta es la
traducción predeterminada, es decir, la traducción a emplear cuando no
hay suficiente información para elegir otra. Es obligatorio que las
entradas con más de un equivalente en lengua meta tengan una, y sólo
una, de estas equivalencias marcada con la letra ``D'' de
\emph{predeterminado}.

El siguiente ejemplo ilustra el funcionamiento de los nuevos
atributos.  Consideramos el caso de un diccionario bilingüe
inglés--catalán y las siguientes entradas con más de una traducción en
lengua meta:
\begin{itemize}
\item \emph{look}: que se puede traducir al catalán por \emph{mirar} (por
  defecto) o por \emph{semblar} (en español, \emph{mirar/parecer}),
\item \emph{floor}: que se puede traducir al catalán por \emph{pis} (por
  defecto) o por \emph{terra} (en español, \emph{piso/suelo})
\item \emph{pis}: que se puede traducir al inglés por \emph{flat} (por
  defecto) o por \emph{floor}.
\end{itemize}

Esta información se representa utilizando los dos atributos descritos
antes:\label{entrades_lextor}
\begin{alltt}
\begin{small}
<e srl="flat D">
   <p>
      <l>flat<s n="n"/></l>
      <r>pis<s n="n"/><s n="m"/></r>
    </p>
</e>

<e slr="pis D" srl="floor">
   <p>
      <l>floor<s n="n"/></l>
      <r>pis<s n="n"/><s n="m"/></r>
   </p>
</e>

<e slr="terra">
   <p>
      <l>floor<s n="n"/></l>
      <r>terra<s n="n"/><s n="m"/></r>
   </p>
</e>

<e slr="mirar D">
   <p>
      <l>look<s n="vblex"/></l>
      <r>mirar<s n="vblex"/></r>
   </p>
</e>

<e slr="semblar">
   <p>
      <l>look<s n="vblex"/></l>
      <r>semblar<s n="vblex"/></r>
   </p>
</e>
\end{small}
\end{alltt}


%\settocdepth{paragraph}

\subsubsection{Particularidades de los distintos tipos de diccionarios}
\label{ss:morfgen}

Las entradas de los diccionarios tienen algunas características diferenciadas
según el diccionario de que se trate. Aunque en la especificación
precedente han quedado apuntadas algunas de estas particularidades, a continuación
las presentamos de manera más exhaustiva.


\paragraph{Diccionarios morfológicos}

En estos diccionarios, que se usan para construir los analizadores y
los generadores morfológicos, se deben marcar mediante
\texttt{<\textbf{a}/>} las formas superficiales que una vez generadas
pueden necesitar ciertas transformaciones ortográficas por contacto
con otras palabras, operaciones de la que se encarga el postgenerador.
Como se trata de marcas que sólo se generan, las entradas que
contengan estas marcas deben ser sólo de generación, es decir, con la
restricción \texttt{\textsl{r}=}\verb!"RL"! (de derecha a izquierda).
En la figura \ref{fig:a}  puede verse un
ejemplo de entrada con este elemento.



\paragraph{Diccionarios bilingües}
\label{ss:bil}

Como ya hemos explicado, en nuestro sistema no se utilizan paradigmas en
los diccionarios bilingües; éstos se construyen mediante entradas
genéricas en las que casi nunca se especifica más que su categoría
gramatical y no hay información de flexión. Por ejemplo, en el
diccionario \texttt{es-ca} la entrada para la palabra española
\textit{pan}, \textit{panes}, traducida al catalán por \textit{pa},
\textit{pans}, quedaría como muestra la figura \ref{fg:pan}.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>pan<\textbf{s} \textsl{n}="n"/></\textbf{l}>
    <\textbf{r}>pa<\textbf{s} \textsl{n}="n"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Entrada en el diccionario bilingüe para la traducción \emph{pan} (\texttt{es})--\emph{pa} (\texttt{ca})}
\label{fg:pan}
\end{figure}


Como vemos, en la entrada únicamente se especifica el primero símbolo
gramatical \texttt{<\textbf{s}
  \textsl{n}="\ldots}\texttt{"}\texttt{/>} de ambas palabras, ya que
los símbolos no especificados que siguen a los especificados en el
diccionario bilingüe son copiados de la forma léxica original a la
forma léxica de la lengua meta; así, esta entrada vale tanto para
\textit{pan} (singular) como para \textit{panes} (plural), ya que el
módulo analizador entrega el lema (\emph{pan}) seguido de los símbolos
gramaticales correspondientes a la forma superficial analizada
(\emph{n m sg} o \emph{n m pl} según el caso); por lo tanto, los
símbolos no especificados en la entrada (\emph{m sg} o \emph{m pl}) se
copian a la lengua meta. Lo mismo vale para los dos sentidos de
traducción.  La idea es que se especifica la información imprescindible para
diferenciar las entradas y el resto de información se
\textit{sobreentiende} (se copia). Es importante tener en cuenta este
hecho ya que, si existen diferencias entre los símbolos gramaticales
de una forma léxica entre la LO y la LM, estas diferencias deben
quedar especificadas en el diccionario bilingüe.  Así, por ejemplo,
cuando hay un cambio de género o de número entre la forma original y
la forma traducida, hay que especificar los símbolos gramaticales por
orden (el orden en que aparecen estos símbolos en los diccionarios
morfológicos)\footnote{Para saber qué símbolos gramaticales se han
  utilizado en los diccionarios morfológicos y en qué orden,
  consúltese el Apéndice \ref{se:simbolosmorf}.} hasta que lleguemos
al símbolo divergente entre LO y LM.

Por ejemplo, para traducir la palabra española \textit{cama}, nombre
femenino, por la palabra catalana \textit{llit}, nombre masculino, la
entrada en el diccionario bilingüe debe ser como se muestra en la figura
\ref{fg:cama}. Debe especificarse el género (\emph{f}, \emph{m})
ya que, de no hacerlo, se copiarían los símbolos de
género y número de la forma léxica en LO a la forma léxica en LM. Por
lo tanto, al traducir de \texttt{es} a \texttt{ca} se obtendría la
forma léxica \emph{llit} con los símbolos \texttt{n f sg} o bien
\texttt{n f pl}. En ambos casos, el generador se encontraría con
una palabra imposible de generar, ya que los diccionarios morfológicos
del catalán no contienen ninguna entrada con lema \emph{llit} y género
femenino.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>cama<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/></\textbf{l}>
    <\textbf{r}>llit<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Entrada en el diccionario bilingüe para la traducción \emph{cama} (\texttt{es})--\emph{llit} (\texttt{ca})}
\label{fg:cama}
\end{figure}


En este ejemplo el número no se especifica y la entrada sirve tanto para la
correspondencia \textit{cama--llit} como para la correspondencia
\textit{camas--llits}.  Sin embargo, si hay que especificar un cambio de
número, no hay más remedio que especificar también el género si en
todo el diccionario el orden usado es \emph{género, número}.  



Mediante la restricción de dirección \texttt{r} podemos indicar qué
traducciones tienen lugar en un sentido y no en el otro (véase la
descripción de las restricciones \texttt{LR} y \texttt{RL} en la página
\pageref{restric}).  Esto es necesario cuando la correspondencia entre dos
formas léxicas no es simétrica, en cuyo caso deben realizarse varias entradas en el
diccionario bilingüe con alguna restricción de dirección, como en el
ejemplo de la figura~\ref{fg:postre}. En este ejemplo, cuando traducimos
de español a catalán (\texttt{LR}), necesitamos que solo se generen
formas en plural porque la palabra \textit{postres} en
catalán no tiene singular.  Pero en cambio, sólo
traduciremos al español en plural porque no hay forma de determinar si
el número sería singular o plural.

\begin{figure}[htbp]
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{r}="LR">
  <\textbf{p}>
    <\textbf{l}>postre<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{l}>
    <\textbf{r}>postres<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>

<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>postre<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{l}>
    <\textbf{r}>postres<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Entradas en el diccionario bilingüe español--catalán/valenciano para la correspondencia \emph{postre}--\emph{postres}}
\label{fg:postre}
\end{figure}


\label{pg:GD} Existe otro problema debido a las diferencias gramaticales entre dos
lenguas determinadas que se soluciona con dos símbolos especiales,
\texttt{GD} (de \textit{género por determinar}) y \texttt{ND} (de
\textit{número por determinar}), símbolos que deberán estar definidos
en la sección de símbolos del diccionario bilingüe. Este problema
surge cuando la información gramatical de una forma léxica en LO no es
suficiente para determinar el género (masculino o femenino) o el
número (singular o plural) de la forma léxica en LM.  Por poner un
ejemplo, el adjetivo \textit{común} en español es tanto masculino como
femenino (y por tanto mas\-cu\-li\-no/fe\-me\-ni\-no, \texttt{mf}),
pero en ca\-ta\-lán hay formas diferentes para el masculino,
\textit{comú}/\textit{comuns}, y para el femenino,
\textit{comuna}/\textit{comunes}.  En el diccionario bilingüe la
entrada quedaría como se ve en la figura~\ref{fg:comuna}: en la
dirección \texttt{LR} (de español a catalán), la información de género
no es \texttt{m}, \texttt{f} ni \texttt{mf} sino \texttt{GD}; este
\textit{género por determinar} lo determinará a continuación el módulo de transferencia
estructural mediante la aplicación de las reglas de transferencia
apropiadas (normalmente reglas de concordancia entre formas léxicas de
un patrón; véase el apartado \ref{ss:transfer} para obtener una descripción
detallada del funcionamiento de las reglas de este módulo). Análogamente, se puede definir un mecanismo similar,
mediante el símbolo \texttt{ND}, para el caso del número
sin\-gu\-lar--plu\-ral (por ejemplo, en español \textit{análisis} es
singular y plural, mientras que en ca\-ta\-lán el singular es
\textit{anàlisi} y el plural \textit{anàlisis}).


\begin{figure}[htbp]
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{r}="LR">
  <\textbf{p}>
    <\textbf{l}>común<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>comú<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="GD"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>

<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>común<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>comú<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>

<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>común<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>comú<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="f"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Entradas en el diccionario bilingüe español--catalán para la
  correspondencia \emph{común}--\emph{comú}, la primera para la
  traducción del español al catalán y las dos últimas para la traducción del catalán al español}
\label{fg:comuna}


\end{figure}







\paragraph{Diccionarios de postgeneración}
\label{ss:postgen}



En el diccionario morfológico, las formas léxicas que, una vez
generadas, pueden sufrir operaciones de contracción, apostrofación,
etc., según las palabras que entren en contacto con ellas en el texto
resultante, deben llevar la marca de activación del postgenerador
(\texttt{<\textbf{a}/>}, véase la página \pageref{ss:a}) en la entrada de
generación (dirección \texttt{LR}).  Es fundamental que las formas
superficiales marcadas con la marca de activación del postgenerador
coincidan en los diccionarios morfológicos y de postgeneración del
mismo traductor. En el diccionario de postgeneración, todas las
entradas comienzan por esta marca de activación.


En la figura~\ref{fg:postgen} se muestra un ejemplo de fragmento del
postgenerador para el español; en este ejemplo se puede ver cómo se
realiza la contracción de \textit{de} y \textit{el} para formar
\textit{del}.  En el ejemplo, el paradigma no definido, \texttt{puntuación}, es un
paradigma que se limita a definir los caracteres no alfabéticos que
pueden formar parte de un texto. Vemos en el ejemplo que la entrada
para la preposición \emph{de} lleva la marca \texttt{<\textbf{a}/>}. El
paradigma asignado a esta entrada, "\texttt{el}", es el que
encontramos definido arriba. De este modo, cuando el sistema se
encuentra con la cadena izquierda de la entrada (la parte entre
\texttt{<\textbf{l}>}) concatenada con la cadena izquierda del paradigma (es
decir, cuando se encuentra con las cadenas de entrada
\texttt{"}\texttt{<a/>\textbf{de}<b/>\textbf{el}<b/>"} o bien
\texttt{"}\texttt{<a/>\textbf{de}<b/>\textbf{el}[puntuación]}\texttt{"}),
el módulo ofrece como cadena de salida (la parte entre \texttt{<r>})
la cadena \texttt{"}\textbf{del}\texttt{"} seguida de los blancos representados por \texttt{<b/>} o
de los símbolos representados por \texttt{[puntu\-a\-ción]}. Nótese que a la
salida del módulo todas las marcas \texttt{<\textbf{a}/>} han sido eliminadas.




\begin{figure}[htbp]
\begin{small}
\begin{alltt}
<\textbf{dictionary}>
<\textbf{pardefs}>
  ... 
  <\textbf{pardef} \textsl{n}="el">
    <\textbf{e}>
      <\textbf{p}>
        <\textbf{l}>el<\textbf{b}/></\textbf{l}>
        <\textbf{r}>l<\textbf{b}/></\textbf{r}>
      </\textbf{p}>
    </\textbf{e}>
    <\textbf{e}>
      <\textbf{p}>
        <\textbf{l}>el</\textbf{l}>
        <\textbf{r}>l</\textbf{r}>
      </\textbf{p}>
      <\textbf{par} \textsl{n}="puntuación"/>
    </\textbf{e}>
  </\textbf{pardef}>
  ... 
</\textbf{pardefs}>
<\textbf{section} \textsl{id}="main" \textsl{type}="standard">
  ... 
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}><\textbf{a}/>de<\textbf{b}/></\textbf{l}>
      <\textbf{r}>de</\textbf{r}>
    </\textbf{p}>
    <\textbf{par} \textsl{n}="el"/>
  </\textbf{e}>
  ... 
</\textbf{section}/>
</\textbf{ditionary}>
\end{alltt}
\end{small}
\caption{Diccionario de postgeneración en el que se observa la información
  necesaria para la contracción española \emph{de} + \emph{el} = \emph{del} .}
\label{fg:postgen}
\end{figure}
\nota{en l'exemple, "el" no ha de portar
la marca d'activació oi? - l'he treta de l'exemple, treure-la dels diccionaris (Mikel?)}

%\settocdepth{subsubsection}


\subsubsection{Unidades léxicas multipalabra}
\label{ss:multipalabras}


Con el formato propuesto para los diccionarios es posible introducir
\textit{unidades léxicas multipalabra} ---simplificando,
\textit{multipalabras}--- de formas diferentes dependiendo del problema que
haya que resolver. 

En este proyecto se consideran tres tipos básicos de unidades multipalabra:
\begin{enumerate}
\item El caso más sencillo es el de las \textit{multipalabras sin
    flexión}, que están formadas por una sola forma léxica, ya que su lema consta de varias palabras
  ortográficas invariables pero se etiqueta como una unidad.  En la
  figura \ref{fig:msf} se muestra un ejemplo de unidad multipalabra
  invariable (la expresión \emph{hoy en día}). Esta multipalabra
  consta de tres palabras separadas por un blanco
  (\texttt{<\textbf{b}/>}) y, aunque estrictamente esté formada por un
  adverbio, una preposición y un nombre, se etiqueta globalmente como
  adverbio, pues cumple una función equivalente.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="hoy en día">
  <\textbf{p}>
    <\textbf{l}>hoy<\textbf{b}/>en<\textbf{b}/>día</\textbf{l}>
    <\textbf{r}>hoy<\textbf{b}/>en<\textbf{b}/>día<\textbf{s} \textsl{n}="adv"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Ejemplo de multipalabra sin flexión en el diccionario morfológico.} 
\label{fig:msf}
\end{figure}

\item Un caso algo más complejo es el de las \textit{multipalabras
    compuestas}, que están formadas por más de una forma léxica, cada
  una con sus símbolos gramaticales. Se considera que las palabras de
  las que se componen no conforman una unidad semántica como en el
  caso anterior, y que sólo aparecen juntas formando una unidad por
  razones de contacto entre sí (razones fonéticas u ortográficas). En
  esta categoría entran las \textit{contracciones} y los
  \textit{pronombres enclíticos} que acompañanan a los verbos.  Para
  marcar este fenómeno se usa la etiqueta \texttt{<\textbf{j}>}
  descrita en la página~\pageref{ss:j}. Puede verse un ejemplo en la
  figura~\ref{fig:cont}, en la que el análisis de \emph{del} entrega
  una multiforma léxica compuesta por dos formas léxicas: \emph{de},
  preposición, y \emph{el}, determinante definido masculino singular,
  enlazadas mediante el elemento \texttt{<\textbf{j}/>}. El analizador
  y el desambiguador léxico categorial tratan estas multipalabras como
  una unidad; sin embargo, antes de entrar al módulo de transferencia
  son procesadas por un módulo auxiliar llamado \texttt{pretransfer}
  (véase el apartado \ref{se:pretransfer}) que se encarga de separar las
  formas léxicas de las que se componen. De este modo llegan al módulo de
  transferencia como formas independientes; es el lingüista quien debe
  decidir si hay que volver a unirlas (tarea que debe realizarse en el
  módulo de transferencia estructural) o si deben continuar como
  formas independientes a través de los módulos posteriores.


  En nuestro sistema, los elementos que forman cada contracción prosiguen como formas
  independientes, y es tarea del postgenerador realizar la contracción
  en la lengua meta en caso de que sea necesaria. En cambio, los
  pronombres enclíticos vuelven a unirse al verbo mediante una regla
  de transferencia estructural (véase el apartado \ref{ss:transfer}),
  de modo que el verbo más los enclíticos llegan como una sola
  multiforma léxica al módulo de generación, unidos entre sí mediante
  el elemento \texttt{<\textbf{j}/>}. Por lo tanto, las entradas que contienen pronombres enclíticos
no deberán tener ninguna restricción de dirección, como puede verse en el ejemplo de la figura
\ref{fig:encl}, que muestra un fragmento del paradigma del verbo "dar", concretamente la
entrada correspondiente a la forma de infinitivo unida a un pronombre enclítico.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="del" \textsl{r}="LR">
  <\textbf{p}>
    <\textbf{l}>del</\textbf{l}>
    <\textbf{r}>de<\textbf{s} \textsl{n}="pr"/><\textbf{j}/>
     el<\textbf{s} \textsl{n}="det"/><\textbf{s} \textsl{n}="def"/>
     <\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Ejemplo de entrada para analizar una contracción (la
  contracción española \emph{del}) en el diccionario morfológico.}
\label{fig:cont}
\end{figure}

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>ar</\textbf{l}>
    <\textbf{r}>ar<\textbf{s} \textsl{n}="vblex"/><\textbf{s} \textsl{n}="inf"/><\textbf{j}/></\textbf{r}>
  </\textbf{p}>
  <\textbf{par} \textsl{n}="S__cantar"/>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Fragmento del paradigma de flexión del verbo \emph{dar}, que muestra la entrada 
correspondiente a la forma de infinitivo seguida de un pronombre enclítico. Los pronombres enclíticos están contenidos
en el paradigma \texttt{S\_\_cantar}. Obsérvese que, a diferencia de la figura \ref{fig:cont}, la entrada es tanto
de análisis como de generación.}
\label{fig:encl}
\end{figure}



\item El caso más complejo de los que se especifican en este documento
  es el de las \textit{multipalabras con flexión intercalada} en medio
  del lema (o formas de "lema partido"), que se muestra en la figura
  \ref{fig:echardemenos}. Este tipo de multipalabras se caracterizan
  por tener lemas con una parte afectada por la flexión (a la que
  llamamos \emph{cabeza del lema}) seguida de una parte
  invariable (a la que llamamos \emph{cola del lema}).  La
  parte invariable se colocará entre elementos \texttt{<\textbf{g}>},
  para poder moverla a la posición inmediatamente posterior a la
  cabeza del lema  con el objetivo de obtener el lema de
  la multipalabra. Es decir, conviene considerar que el lema de
  multipalabras como \emph{echó de menos}, \emph{echándole de menos},
  etc.  sea \emph{echar de menos}, ya que será esta forma la que se
  buscará en el diccionario bilingüe para encontrar su traducción.
  Esto supondrá un adelantamiento de la cola del lema (\emph{de
    menos}) detrás de la forma no flexionada de la cabeza del lema
  (\emph{echar}). Este adelantamiento se realizará en el módulo
  auxiliar \texttt{pretransfer} (véase el apartado
  \ref{se:pretransfer}) que se ejecuta antes del módulo de
  transferencia estructural.

  Para entender el ejemplo de la figura \ref{fig:echardemenos}, hay
  que tener en cuenta que el paradigma que define el verbo
  \emph{echar} incluye, además de la flexión del verbo, los pronombres
  enclíticos que van al final de las formas flexionadas del verbo, los
  cuales aparecen enlazados, en la multiforma léxica resultante,
  usando el elemento vacío \texttt{<\textbf{j}/>}.



\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="echar de menos">
  <\textbf{i}>ech</\textbf{i}>
  <\textbf{par} \textsl{n}="aspir/ar__vblex"/> <!-- incluye pronombres enclíticos -->
  <\textbf{p}>
    <\textbf{l}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{l}>    
    <\textbf{r}><\textbf{g}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{g}></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Ejemplo de entrada en el diccionario morfológico que contiene un
  grupo \texttt{<\textbf{g}>}.} 
\label{fig:echardemenos}
\label{fig:hacertilin}
\end{figure}



Cuando la traducción es también un \emph{lema partido} (por ejemplo,
en catalán \emph{trobar a faltar}, con formas como \emph{trobem a
  faltar}, \emph{trobar-lo a faltar}, etc.), es necesario recolocar la
cola en su sitio, tras la forma flexionada más los pronombres
enclíticos, en caso de haberlos, e indicar la correspondencia de estos
fragmentos invariables del lema (\emph{de menos}, \emph{a faltar}) a
ambos lados de la traducción. Así, en el ejemplo de la
figura~\ref{fig:echardemenos}, el elemento \texttt{<\textbf{g}>} sirve
para diferenciar el grupo `\texttt{<b/>de<b/>menos}' en el diccionario
morfológico. En el diccionario bilingüe (véase la
figura~\ref{fig:menosfaltar}), el elemento \texttt{<\textbf{g}>} sirve
para establecer una correspondencia entre los grupos
``\texttt{<b/>de<b/>menos}'' y ``\texttt{<b/>a<b/>faltar}''. \nota{I
  com serà el cas de ``dirección general'' - ``direcciones
  generales''?}

Cuando la traducción no es ningún \emph{lema partido}, no hace falta introducir ningún
elemento \texttt{<\textbf{g}>} en la cadena correspondiente a la lengua meta.

\end{enumerate}

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>echar<\textbf{g}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{g}><\textbf{s} \textsl{n}="vblex"/></\textbf{l}>    
    <\textbf{r}>trobar<\textbf{g}><\textbf{b}/>a<\textbf{b}/>faltar</\textbf{g}><\textbf{s} \textsl{n}="vblex"/></\textbf{r}>    
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}
\caption{Ejemplo de entrada en el diccionario bilingüe que contiene dos
  grupos \texttt{<\textbf{g}>} en correspondencia.} 
\label{fig:menosfaltar}
\end{figure}


\subsection[Generación automática de los módulos]{Generación automática de los módulos de procesamiento léxico}
\label{se:compiladoresdic}


Los cuatro módulos de procesamiento léxico (analizador morfológico,
transferencia léxica, generador morfológico y postgenerador) se
compilan a partir de los diccionarios mediante un único compilador
% \cite{Sergio},
basado en transductores de letras \cite{roche97}. Este
compilador es mucho más rápido que los utilizados en los sistemas
\textsf{interNOSTRUM} \cite{canals01b,garridoalenda01p,garrido99j} y
\textsf{Traductor Universia} \cite{garrido03p, gilabert03j}, gracias a
la utilización de nuevas estrategias de construcción de transductores
y a la minimización de transductores parciales durante la construcción \cite{ortiz05j}.

La división de entradas del diccionario en lema y paradigma permite
construir eficazmente transductores de letras mínimos. El compilador
aprovecha completamente la factorización que permiten los paradigmas
para acelerar la construcción. Como en la mayoría de lenguas europeas las modificaciones
de las palabras tienen lugar al final o al principio de las mismas, hemos explotado este
hecho para mejorar la velocidad de construcción del transductor mínimo.

Los paradigmas se minimizan antes de ser insertados en el transductor para
reducir el tamaño del transductor completo final antes de minimizar.  
Como antes de minimizar, los paradigmas de los diccionarios de las lenguas 
con las que hemos trabajado suelen tener unos pocos cientos de estados, 
la minimización de estos paradigmas es un proceso muy rápido.

Si suponemos que una entrada puede presentar una referencia a un
paradigma en cualquier punto de la misma, podríamos pensar en copiar
en ese punto el transductor que se calcula en la definición del
paradigma. El procedimiento utilizado en \emph{Apertium} se basa en que no
siempre es necesario copiar, sino que en determinadas ocasiones es
posible reutilizar un paradigma que ya haya sido copiado.  En
particular, dos o más entradas que comparten un paradigma como sufijo
pueden reutilizar la misma copia de ese paradigma y lo mismo sucede
cuando ocurre como prefijo. Sin embargo, en general, no es posible
reutilizar paradigmas si se encuentran en posiciones intermedias de
entradas diferentes, ya que se pueden introducir nuevos
sufijos (prefijos) a entradas existentes, lo que hace que la
información que se introduce en el transductor no sea consistente con
el diccionario, y el transductor generado sería incorrecto (añadiría pares
de cadenas que no se encuentran en el lenguaje formal que definen los
diccionarios).

La construcción de transductores de letras mínimos se realiza como se explica
a continuación. A partir de una transducción de cadenas se puede construir una
\textit{secuencia de transducciones de letras} $S(s:t)$ de longitud $N
= \max(|s|,|t|)$ que se define como sigue para cada elemento $1 \leq i
\leq N$:


\begin{equation}
\label{eq:transletras}
S_i(s:t)=\left\{
\begin{array}{ll}
(s_i:\theta) & \textrm{si } i \leq |s| \wedge i > |t|  \\
(\theta:t_i) & \textrm{si } i \leq |t| \wedge i > |s|  \\
(s_i:t_i) & \textrm{en otro caso}
\end{array}\right.
\label{e:montaje}
\end{equation}
 
Hay que destacar que, por construcción, se asegura que no puede
existir ningún $(s:t)$ que sea igual a $(\epsilon:\epsilon)$, lo
que es crucial para la consistencia del método de construcción.

El método de construcción usa dos procedimientos, el procedimiento de
\textit{montaje} que se infiere de la ecuación \ref{e:montaje} y el de
minimización, que se realiza por un algoritmo convencional de
minimización \cite{vandesnepscheut93b} de autómatas finitos que
consiste en invertir, determinizar, volver a invertir y volver a
determinizar, tomando como alfabeto del autómata que hay que minimizar
el producto cartesiano $L$ y como transición vacía la
$\left(\theta:\theta\right)$.


\begin{figure}
\begin{center}
\includegraphics[width=10cm]{fig1} 
\end{center}
\caption{Construcción del diccionario como aceptor de prefijos y
  enlace con paradigmas mediante transiciones
  $\left(\theta:\theta\right)$.}
\label{fig:construccion}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=8cm]{fig2} 
\end{center}
\caption{Paradigma «-es \textbf{n m}» minimizado que se usa en la
figura \ref{fig:construccion}.}
\label{fig:paradigmapan}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=8cm]{fig3} 
\end{center}
\caption{Paradigma «z/-ces \textbf{n m}» minimizado que se usa en la
figura \ref{fig:construccion}.}
\label{fig:paradigmavez}
\end{figure}



En la figura \ref{fig:construccion} se observa un ejemplo simplificado
de este montaje.  Se introduce transducción por transducción compuesta
como en la ecuación \ref{e:montaje} en un transductor en forma de
\textit{aceptor de prefijos} o \textit{trie}, es decir, de manera en
la que haya sólo un nodo para cada prefijo común del conjunto de
transducciones que forman el diccionario.  Con los sufijos de las
transducciones (que no se comparten) se crean estados nuevos.  En el
punto en el que se haga referencia a un paradigma, se crea una réplica
de ese paradigma y se enlaza a la entrada del diccionario que se está
insertando en el transductor mediante una transducción nula $\left(\theta:\theta\right)$.

Cada uno de los paradigmas, en tanto que pueden ser vistos como
pequeños diccionarios, se han construido por este mismo procedimiento
a su vez y se han minimizado para reducir el tamaño del problema en la
construcción del diccionario grande. En las figuras
\ref{fig:paradigmapan} y \ref{fig:paradigmavez} se muestra el estado
de los dos paradigmas utilizados en la figura \ref{fig:construccion}
después de la minimización.



\section{Desambiguador léxico categorial}
\label{ss:tagger}

\subsection{Descripción del funcionamiento}
\label{functagger}


El desambiguador léxico categorial está basado en modelos ocultos de
Markov~\cite{rabiner89} de primer orden, es decir, en información de
naturaleza estadística. Los estados del modelo de Markov representan
categorías gramaticales y los observables son clases de
ambigüedad~\cite{cutting92a}, esto es, conjuntos de categorías
gramaticales. 

A pesar de trabajar con información estadística, el
entrenamiento y el comportamiento actual del desambiguador mejoran si
se introducen restricciones que impiden determinadas secuencias de
categorías (en los modelos de primer orden, estas secuencias solo
pueden implicar a dos categorías); por ejemplo, en español o catalán
una preposición nunca puede ir seguida de un verbo conjugado en forma
personal, restricción que es de gran ayuda cuando la forma que sigue a
la preposición es ambigua y uno de sus análisis morfológicos es verbo
en forma personal (p.e., \emph{de trabajo}, \emph{en libertad}, etc.).
En el fichero de definición  del desambiguador se declaran explícitamente estas restricciones, a veces
en forma de \emph{prohibiciones} y otras en forma de
\emph{obligaciones}.

Las etiquetas gramaticales con las que trabaja el desambiguador no son
las mismas que se utilizan en el analizador morfológico. Normalmente,
la información que entrega el analizador morfológico es demasiado
detallada para la desambiguación léxica categorial (por ejemplo, para
la mayoría de los propósitos, es suficiente agrupar en una misma
categoría todos los substantivos comunes, independientemente de su
género y su número). El empleo de etiquetas más finas no mejora los
resultados, al tiempo que incrementa considerablemente el número de
parámetros a estimar y hace más acusado el problema de la escasez de
recursos lingüísticos tales como textos desambiguados a mano. Por este
motivo, en el fichero del desambiguador se especifica cómo agrupar las
etiquetas \emph{finas} (o específicas) proporcionadas por el
analizador morfológico en etiquetas \emph{gruesas} ---que llamaremos
\emph{categorías}--- más generales que se emplearán en la
desambiguación léxica categorial. Además de las categorías gruesas,
también pueden definirse etiquetas lexicalizadas. En la bibliografía
se describen básicamente dos tipos de lexicalizaciones, las que añaden
nuevos observables y las que además añaden nuevos estados al modelo de
Markov~\cite{pla04}; el desambiguador léxico categorial de Apertium
utiliza este último tipo de lexicalización.

Cabe recordar que, pese a trabajar con categorías \emph{gruesas}, el
desambiguador proporciona a su salida etiquetas finas como las del
analizador morfológico. De hecho, en ocasiones, puede suceder que el
analizador morfológico entregue, para una palabra dada, dos o más
etiquetas finas que pueden agruparse bajo una misma categoría: p. e.,
en español \emph{cante} puede ser la 1ª o la 3ª persona del presente
de subjuntivo del verbo \emph{cantar}; las dos etiquetas finas,
\texttt{\emph{<vblex><prs><p1><sg>}} y
\texttt{\emph{<vblex><prs><p1><sg>}}, se agrupan bajo la categoría\
\texttt{VLEXSUBJ} (\emph{verbo subjuntivo}). En este caso, una de las
dos etiquetas finas es descartada; en el fichero de definición del
desambiguador se puede definir qué etiqueta fina de las que componen
una etiqueta gruesa será la entregada tras la desambiguación.




\subsection{Datos para el desambiguador léxico categorial}
\label{datostagger}
\subsubsection{Introducción}
\label{ss:introtagger}
A continuación se describe el formato de los ficheros en los que se
especifica cómo agrupar las etiquetas \emph{finas} proporcionadas por
el analizador morfológico en etiquetas \emph{gruesas} más generales.
En dichos ficheros, además, se pueden especificar \emph{restricciones}
que ayuden a la estimación del modelo estadístico encargado del
proceso de desambiguación léxica, así como reglas de preferencia para
el caso de que a dos etiquetas finas les corresponda la misma
categoría.


El desambiguador asume que a su entrada las palabras se encontrarán
convenientemente delimitadas, tal como se especifica en el formato del
flujo de datos entre módulos (capítulo \ref{se:flujodatos}). El
formato de los datos entregados por el analizador morfológico, a
grandes rasgos, es como sigue:
\begin{equation}
\label{eq:formaanalizada}
  \begin{array}{rcl}
  \mbox{formaanalizada}&\to& \mbox{multiformaléxica}\;
  [\; \mbox{multiformaléxica} \; ]^* 
\\
  \mbox{multiformaléxica}&\to& \mbox{formaléxica}\; [\;\mbox{formaléxica}\; ]^*\;\mbox{cola-lema?} \\
  \mbox{formaléxica}&\to&\mbox{lema}\;\mbox{etiquetafina}\\
  \mbox{cola-lema}&\to&\mbox{lema}\\
  \mbox{etiquetafina}&\to&\mbox{símbologram}\;[\;\mbox{símbologram}\;]^* \\  
  \end{array}
\end{equation}
\label{formaanalizada}

donde:


\begin {itemize}
\item \emph{formaanalizada} es toda la información que se entrega para cada
forma superficial a la salida del analizador morfológico 
\item \emph{multiformaléxica} es una secuencia de una o más formas
  léxicas seguida, opcionalmente, por una cola invariable como en el
  caso de algunas multipalabras (\emph{cántale las cuarenta}).
\item \emph{formasléxicas}\footnote{Separadas entre ellas por
  un delimitador que se corresponde con el elemento \texttt{<j/>} (ver página
  \pageref{ss:j}).} son unidades compuestas por un lema y una o más etiquetas con la información de la salida del analizador 
\item \emph{cola-lema} está compuesta por uno o más lemas\footnote{Separados entre ellos mediante el elemento \texttt{<b/>}
    (ver página~\pageref{s3:b}).} que forman la parte invariable de una
  multipalabra. La cola 
  de una multipalabra está formada por el lema o los
  lemas sin flexión que siguen a los lemas con flexión. Por ejemplo,
  la multipalabra \emph{cantar las cuarenta} puede tomar las formas
  \emph{cántale las cuarenta}, \emph{(le) cantaré las cuarenta},
  \emph{cantándole las cuarenta}, etc. La cola sería en este caso
  \emph{las cuarenta} (véase la página~\pageref{ss:multipalabras} para más información).

\item \emph{etiquetafina} corresponde a uno o más símbolos gramaticales (\emph{símbologram}).
\end {itemize}

Por ejemplo, la entrada correspondiente a la forma superficial ambigua española
\emph{correos} tendría dos multiformas léxicas; la primera multiforma
léxica tendría una única forma léxica, con lema \emph{correo} y una
etiqueta fina compuesta de los símbolos gramaticales \emph{nombre
  común}, \emph{masculino}, \emph{plural}; la segunda multiforma
léxica sería una secuencia de dos formas léxicas, una con lema
\emph{correr} y etiqueta fina compuesta de los símbolos gramaticales
\emph{verbo léxico}, \emph{imperativo}, \emph{segunda persona},
\emph{plural} y la otra con lema \emph{vosotros}, y etiqueta fina
compuesta por los símbolos \emph{pronombre}, \emph{enclítico},
\emph{segunda persona}, \emph{masculino-femenino}, \emph{plural}.


\subsubsection{Especificación del formato}
\label{formatotagger}
El formato del fichero (codificado en XML) se especifica mediante la
DTD que se observa en el apéndice ~\ref{ss:DTD_desambiguador}.


El significado de las etiquetas es como sigue:
\begin{description}
\item[\texttt{tagger}]: es el elemento raíz; su atributo obligatorio
  \texttt{name} sirve para especificar el nombre del etiquetador
  generado a partir del fichero. 
%% \item[\texttt{preamble}] define los delimitadores que permiten al
%%   desambiguador separar la forma superficial de las distintas formas
%%   léxicas, así como las distintas formas léxicas entre sí. Por
%%   definición debe contener: \texttt{word-delimiter},
%%   \texttt{tag-delimiter}, \texttt{surface-form-separator} y
%%   \texttt{lexical-form-separator}. 
%% \item[\texttt{word-delimiter}] define los caracteres especiales dentro
%%   del flujo de datos que delimitan una palabra con todos sus posibles
%%   análisis. Mediante el atributo obligatorio \texttt{begin} se
%%   especifica el carácter de inicio de una palabra, y mediante el
%%   atributo, también obligatorio, \texttt{end} el carácter de final de
%%   palabra. 
%% \item[\texttt{tag-delimiter}] define mediante los atributos
%%   obligatorios \texttt{begin} y \texttt{end} los caracteres que
%%   delimitan una etiqueta fina proporcionada por el analizador
%%   morfológico a su salida. 
%% \item[\texttt{surface-form-separator}] mediante el atributo
%%   obligatorio \texttt{value} define el carácter especial que separa la
%%   forma superficial de las distintas formas léxicas de la palabra. 
%% \item[\texttt{lexical-form-separator}] mediante el atributo
%%   obligatorio \texttt{value} permite definir el carácter especial que
%%   separa las distintas formas léxicas de una misma palabra. 
\item[\texttt{tagset}]: define el etiquetario \emph{grueso} de las categorías
  con el que trabaja el desambiguador. Las categorías se definen
  a partir de las etiquetas finas que proporciona el analizador morfológico a
  su salida. 
\item[\texttt{def-label}]: define una categoría o etiqueta gruesa
  (cuyo nombre se indica en el atributo obligatorio \texttt{name}) en
  términos de listas de etiquetas finas definidas mediante uno o más
  elementos \texttt{tags-item}; un atributo opcional \texttt{closed}
  indica si la categoría es cerrada; de ser cerrada se entiende que
  una palabra desconocida nunca puede pertenecer a esta
  categoría.\footnote{Las categorías cerradas son aquellas que no
    crecen cuando se crea nuevo léxico: preposiciones, determinantes,
    conjunciones, etc.}
  
  Las categorías más específicas \emph{deben} definirse antes de las más
  generales.  Cuando la definición de una categoría general incluye implícitamente la de una
  categoría específica definida previamente, se entiende que se refiere a
  todos los casos \emph{excepto} los definidos por las categorías más
  específicas. 
 
\item[\texttt{tags-item}]: permite definir una etiqueta fina en
  términos de una secuencia de símbolos gramaticales. Mediante el
  atributo obligatorio \texttt{tags} se define la secuencia de
  símbolos gramaticales que conforman la etiqueta fina. En dicha
  secuencia los símbolos gramaticales se separan por puntos y el
  asterisco ``\texttt{*}'' se utiliza para indicar que en determinada
  posición puede aparecer cualquier secuencia de símbolos. También se
  pueden especificar categorías lexicalizadas indicando en el atributo
  \texttt{lemma} el lema deseado.
  
\item[\texttt{def-mult}]: define categorías especiales
  (\emph{multicategorías}) formadas por varias categorías, para tratar
  el caso de que una entrada presente multiformas léxicas como las
  definidas en la sección anterior. Cada categoría se define como un
  conjunto de secuencias (\texttt{sequence}) válidas de categorías
  definidas previamente o de etiquetas finas.  Su uso es apropiado
  para contracciones, verbos con enclíticos, etc. 

\item[\texttt{sequence}]: define una secuencia de elementos que pueden
  ser categorías (\texttt{label-item}) o etiquetas finas
  (\texttt{tags-item}). El utilizar directamente etiquetas finas es
  útil si se desea utilizar una secuencia de símbolos gramaticales que
  no forma parte de una etiqueta fina ya definida o que supone una
  especialización mayor de una etiqueta fina ya creada.
  
\item[\texttt{label-item}]: permite hacer referencia a una categoría o etiqueta gruesa ya
  definida con anterioridad y que se especifica en el atributo
  obligatorio \texttt{label}. 
  
\item[\texttt{forbid}]: esta sección (opcional) permite definir
  restricciones en forma de secuencias de categorías
  \texttt{label-sequence} que no pueden darse en el idioma en cuestión. En la versión actual,
  al estar el desambiguador basado en modelos ocultos de Markov de
  primer orden, las secuencias sólo pueden estar formadas por
  \emph{dos} \texttt{label-items}. 
  
\item[\texttt{label-sequence}]: define una secuencia de categorías
  (\texttt{label-item}). 

\item[\texttt{enforce-rules}]: esta sección (opcional) permite definir
  restricciones en forma de obligaciones. 
  
\item[\texttt{enforce-after}]: define una restricción que obliga a que
  a una determinada categoría sólo puedan seguirle categorías
  pertenecientes al conjunto (\texttt{label-set}) de categorías
  que se define. Nótese que este tipo de restricciones es equivalente
  a definir varias secuencias (\texttt{label-sequence}) prohibidas
  (\texttt{forbid}) con la categoría definida mediante el atributo
  obligatorio \texttt{label} y el resto de categorías no pertenecientes
  al conjunto definido en \texttt{label-set}. Por esta razón, este
  tipo de restricción debe usarse con mucha cautela.  
  
\item[\texttt{label-set}]: define un conjunto de categorías
  (\texttt{label-items}). 

\item[\texttt{preferences}]: permite definir prioridades en cuanto a qué etiquetas finas se deben
  producir a la salida del desambiguador cuando una o más etiquetas finas sean
  asignadas a la misma categoría. 
  
\item[\texttt{prefer}]: especifica que en caso de conflicto entre
  varias etiquetas finas asignadas a la misma categoría, el
  desambiguador debe proporcionar a la salida la etiqueta definida
  mediante el atributo obligatorio \texttt{tags}. Si la categoría
  contiene más de una de las etiquetas finas definidas en estos
  elementos \texttt{prefer}, se entregará la que esté definida antes. 
\end{description}

Las figuras~\ref{fg:exemple_desambiguador1} y~\ref{fg:exemple_desambiguador2}
muestran con un ejemplo las partes más importantes de un fichero de
especificación de desambiguador definido por la DTD que acabamos de describir. 

% DTD moguda a Apèndix


%% <!\textsl{ELEMENT} \textbf{preamble} (word-delimiter,tag-delimiter,surface-form-separator,
%%                     lexical-form-separator)>
%% <!\textsl{ELEMENT} \textbf{word-delimiter} \textsl{EMPTY}>
%% <!\textsl{ATTLIST} word-delimiter begin \textsl{CDATA} \textsl{#REQUIRED}
%%                          end   \textsl{CDATA} \textsl{#REQUIRED}>
%% <!\textsl{ELEMENT} \textbf{tag-delimiter} \textsl{EMPTY}>
%% <!\textsl{ATTLIST} tag-delimiter begin \textsl{CDATA} \textsl{#REQUIRED}
%%                         end   \textsl{CDATA} \textsl{#REQUIRED}>
%% <!\textsl{ELEMENT} \textbf{surface-form-separator} \textsl{EMPTY}>
%% <!\textsl{ATTLIST} surface-form-separator value \textsl{CDATA} \textsl{#REQUIRED}>
%% <!\textsl{ELEMENT} \textbf{lexical-form-separator} \textsl{EMPTY}>
%% <!\textsl{ATTLIST} lexical-form-separator value \textsl{CDATA} \textsl{#REQUIRED}>


%% <preamble>
%%    <word-delimiter begin="^" end="$" />
%%    <tag-delimiter begin="&lt;" end="&gt;"/>
%%    <surface-form-separator value=":"/>
%%    <lexical-form-separator value="/"/>
%% </preamble>

\begin{figure}[htbp]
  \begin{small}
    \begin{alltt}
<?\textsl{xml} \textsl{version}="1.0" \textsl{encoding}="iso-8859-1"?>
<!\textsl{DOCTYPE} \textbf{tagger} SYSTEM "tagger.dtd">
<\textbf{tagger} \emph{name}="es-ca">
<\textbf{tagset}>
   <\textbf{def-label} \textsl{name}="adv">
      <\textbf{tags-item} \textsl{tags}="adv"/>
   </\textbf{def-label}>
   <\textbf{def-label} \textsl{name}="detnt" \textsl{closed}="true">
      <\textbf{tags-item} \textsl{tags}="detnt"/>
   </\textbf{def-label}>
   <\textbf{def-label} \textsl{name}="detm" \textsl{closed}="true">
      <\textbf{tags-item} \textsl{tags}="det.*.m"/>
   </\textbf{def-label}>
   <\textbf{def-label} \textsl{name}="vlexpfci">
      <\textbf{tags-item} \textsl{tags}="vblex.pri"/>
      <\textbf{tags-item} \textsl{tags}="vblex.fti"/>
      <\textbf{tags-item} \textsl{tags}="vblex.cni"/>
   </\textbf{def-label}>   
   <\textbf{def-mult} \textsl{name}="infserprnenc" \textsl{closed}="true">
      <\textbf{sequence}>
         <\textbf{label-item} \textsl{label}="vserinf"/>
         <\textbf{label-item} \textsl{label}="prnenc"/>
      </\textbf{sequence}>
      <\textbf{sequence}>
         <\textbf{label-item} \textsl{label}="vserinf"/>
         <\textbf{label-item} \textsl{label}="prnenc"/>
         <\textbf{label-item} \textsl{label}="prnenc"/>
      </\textbf{sequence}>
   </\textbf{def-mult}>   
   <\textbf{def-mult} \textsl{name}="prepdet" \textsl{closed}="true">
      <\textbf{sequence}>
         <\textbf{label-item} \textsl{label}="prep"/>
         <\textbf{tags-item} \textsl{tags}="det.def.m.sg"/>
      </\textbf{sequence}>
   </\textbf{def-mult}>
</\textbf{tagset}>
<!-- ... -->
    \end{alltt}
  \end{small}
  \caption{Ejemplo de fichero de definición del desambiguador (continúa en la figura~\ref{fg:exemple_desambiguador2}).} 
  \label{fg:exemple_desambiguador1}
\end{figure}


\begin{figure}[htbp]
  \begin{small}
    \begin{alltt}
<!-- ... -->
<\textbf{forbid}>
   <\textbf{label-sequence}>
      <\textbf{label-item} \textsl{label}=="prep"/>
      <\textbf{label-item} \textsl{label}=="vlexpfci"/>
   </\textbf{label-sequence}>
   <!-- ... -->
</\textbf{forbid}>
<\textbf{enforce-rules}>
   <\textbf{enforce-after} \textsl{label}=="prnpro">
      <\textbf{label-set}>
         <\textbf{label-item} \textsl{label}=="prnpro"/>
         <\textbf{label-item} \textsl{label}=="vlexpfci"/>
         <!-- ... -->
      </\textbf{label-set}>
   </\textbf{enforce-after}>
   <!-- ... -->
</\textbf{enforce-rules}>
<\textbf{preferences}>
   <\textbf{prefer} \textsl{tags}="vblex.pii.3.sg"/>
   <\textbf{prefer} \textsl{tags}="vbser.pii.3.sg"/>
   <!-- ... -->
</\textbf{preferences}>
</\textbf{tagger}>
    \end{alltt}
  \end{small}
  \caption{Ejemplo de fichero de definición del desambiguador (viene de la figura~\ref{fg:exemple_desambiguador1}).} 
  \label{fg:exemple_desambiguador2}
\end{figure}
\subsection{Consideraciones sobre el entrenamiento del desambiguador léxico categorial}
El entrenamiento del desambiguador léxico categorial podrá hacerse tanto de
forma supervisada, utilizando textos desambiguados a mano, como de forma no
supervisada, con textos ambiguos. 

Cuando el entrenamiento se realice a partir de textos ambiguos (de
forma no supervisada) el formato de dicho texto se podrá obtener de
forma automática a partir de un corpus de texto llano de la lengua
deseada utilizando el analizador morfológico del sistema; en este
caso el formato de las formas del texto será como el definido en el esquema ~\ref{eq:formaanalizada2} 
(puede leerse su descripción en la página~\pageref{formaanalizada}). Como muestra el esquema, puede
haber más de un análisis para cada forma superficial analizada (una \emph{formaanalizada} puede dar
como resultado más de una \emph{multiformaléxica}).


\begin{equation}
\label{eq:formaanalizada2}
  \begin{array}{rcl}
  \mbox{formaanalizada}&\to& \mbox{multiformaléxica}\;
  [\; \mbox{multiformaléxica} \; ]^* 
\\
  \mbox{multiformaléxica}&\to& \mbox{formaléxica}\; [\;\mbox{formaléxica}\; ]^*\;\mbox{cola-lema?} \\
  \mbox{formaléxica}&\to&\mbox{lema}\;\mbox{etiquetafina}\\
  \mbox{cola-lema}&\to&\mbox{lema}\\
  \mbox{etiquetafina}&\to&\mbox{símbologram}\;[\;\mbox{símbologram}\;]^* \\  
  \end{array}
\end{equation}
\label{formaanalizada2}

Para el entrenamiento supervisado se necesita texto desambiguado a
mano. El formato de las formas de estos textos será como el
proporcionado por el analizador morfológico (véase el
capítulo~\ref{se:flujodatos}) con la salvedad de que, al tratarse de
texto ya desambiguado, nunca habrá más de una forma léxica asociada a
cada forma superficial como se muestra en ~\ref{eq:formadesambiguada}
(una \emph{formadesambiguada} consistirá siempre en una única
\emph{multiformaléxica}).
\begin{equation}
\label{eq:formadesambiguada}
  \begin{array}{rcl}
  \mbox{formadesambiguada}&\to&\mbox{multiformaléxica}\\
  \mbox{multiformaléxica}&\to&\mbox{formaléxica}\;[\;\mbox{formaléxica}\;]^*\;\mbox{cola-lema?}\\
  \mbox{formaléxica}&\to&\mbox{lema}\;\mbox{etiquetafina}\\
  \mbox{cola-lema}&\to&\mbox{lema}\\
  \mbox{etiquetafina}&\to&\mbox{símbologram}\;[\;\mbox{símbologram}\;]^* \\
  \end{array}
\end{equation}
 

Por último, para el entrenamiento también se precisa del diccionario
de la lengua implicada. Este diccionario se emplea para determinar
conjuntamente con la especificación del etiquetario a emplear las
distintas clases de ambigüedad con las que trabaja el desambiguador. 

La figura \ref{fig:dependencias} muestra el esquema de dependencias
para el entrenamiento y el uso del desambiguador.

\nota{Aquest esquema canviarà amb el nou tagger - Sergio}

\begin{figure}
\begin{center}
\includegraphics[width=15cm]{diagram} 
\end{center}
\caption{Esquema de dependencias del desambiguador léxico categorial.}
\label{fig:dependencias}
\end{figure}


\newpage

\section[Preproceso de la transferencia]{Módulo auxiliar: módulo de preproceso de la transferencia}
\label{se:pretransfer}
\subsection{Motivación}
El módulo de preproceso de la transferencia
\texttt{pretransfer}, se ocupa de fragmentar las unidades multipalabra
compuestas (ver la página~\pageref{ss:multipalabras}) y mover ciertas
partículas de lugar en las multipalabras con flexión intercalada o de \emph{lema partido}.
Este módulo procesa la salida del etiquetador y genera una entrada
apta para el módulo de transferencia.  Este procesamiento es necesario
por varias razones:

\begin{itemize}
\item Para que el módulo de transferencia pueda tratar estas unidades
  por separado para tratar, por ejemplo, fenómenos de cambio de pronombres
  enclíticos por pronombres proclíticos o viceversa.
\item Para que en el diccionario bilingüe sólo haya que almacenar
  información de los lemas que se traducen.  Si las partículas que
  componen una unidad multipalabra se presentan conjuntamente en el
  diccionario bilingüe, este diccionario tiene que tener una entrada
  para cada una de estas composiciones.  Mediante la separación se
  consigue no tener entradas para multipalabras que incluyan la
  flexión en el diccionario bilingüe.
\end{itemize}

\subsection{Comportamiento y ejemplo}

El funcionamiento del programa consiste en sustituir cada
\texttt{<j/>} en el diccionario, es decir, cada \texttt{+} en el flujo de datos,
por un carácter de fin de palabra, un espacio en blanco y un carácter
de comienzo de palabra.  Además, si se trata de una multipalabra de
lema partido, se mueve la cola a la posición que queda entre el final
de la primera palabra de la multipalabra y la primera etiqueta morfológica que
se corresponde con esta palabra.

La responsabilidad
de generar una salida de este módulo que tenga el orden original que
acepta el generador se deja a las reglas correspondientes del  módulo de transferencia, así como la de crear las multipalabras compuestas que sean necesarias en la lengua
meta.  El generador trabaja, en general, con las
mismas multipalabras que el analizador morfológico, y con los
elementos en el mismo orden, y es por eso que esta tarea hay que
realizarla en el módulo de transferencia.

A continuación se muestra el resultado de aplicar este proceso a 
la multipalabra compuesta \textit{darlo}:

\begin{small}
\begin{alltt}
\$ pretransfer
^dar<vblex><inf>+lo<prn><enc><p3><m><sg>\$     \(\longleftarrow\) \textrm{entrada}
^dar<vblex><inf>\$ ^lo<prn><enc><p3><m><sg>\$   \(\longleftarrow\) \textrm{salida}
\end{alltt}
\end{small}

Como se puede ver, sencillamente se trata de dividir las formas léxicas de una unidad
multipalabra compuesta en formas léxicas individuales.

Cuando se trata de una multipalabra con lema partido, se opera como se
ve en el siguiente ejemplo para la multipalabra \textit{echarte de
  menos}:

\begin{small}
\begin{alltt}
\$ pretransfer
^echar<vblex><inf>+te<prn><enc><p2><m><sg># de menos\$  
^echar# de menos<vblex><inf>\$ ^te<prn><enc><p2><m><sg>\$  
\end{alltt}
\end{small}

Aquí, además de dividir las formas léxicas, se produce un movimiento de la
cola invariable del lema a la posición anunciada.  Como vemos, con el
movimiento de esta cola invariable, las unidades semánticas  se
mantienen, ya que se puede considerar \textit{echar de menos} como una
unidad verbal con significado propio.




\section{Módulo de selección léxica}
\label{se:seleccio_lex}


\subsection{Introducción} 


Cuando el sistema Apertium se utiliza para traducir automáticamente entre
lenguas menos emparentades que las que ha tratado hasta ahora, toma
importancia la cuestión de la selección léxica, que debe llevarse a cabo cuando una
palabra de la lengua origen puede tener más de una traducción en lengua
meta. Por este motivo se ha creado un nuevo módulo, el módulo
de selección léxica, que se ocupa de esta cuestión.

Antes de explicar sus características, veremos como los 
problemas de \emph{equivalencia
múltiple} (la existencia de más
de una traducción posible en lengua meta para un lema o una forma 
léxica en lengua
origen) se tratan en Apertium de dos maneras diferentes.

Por un lado, nos encontramos con la situación en que entre los múltiples
equivalentes en lengua meta no hay una gran diferencia de significado,
y el hecho de escoger entre uno u otro no comportaría
ningún error de traducción. Podríamos decir que entre estos equivalentes hay
una relación de sinonímia o casi-sinonímia. En este caso, el
lingüista escoge como traducción uno de los dos lemas (generalmente el más
frecuente o más usual), y pone una restricción de dirección en los otros
(con los atributos \texttt{LR} o \texttt{RL}) para que sean traducidos en la dirección
contraria pero no en la dirección en que hay múltiples
equivalentes.


Por otro lado, tenemos el caso en que entre los múltiples equivalentes
en lengua meta hay una evidente diferencia de significado que puede
conllevar errores de traducción cuando se elige el lema inadecuado. Estos
casos son los que trata el nuevo módulo de selección léxica. El lingüista
codifica las entradas con los atributos \texttt{slr} o \texttt{srl} que
se explican en el apartado siguiente, identificando así las diferentes
posibilidades de traducción, y el módulo de selección léxica se ocupa
de escoger, mediante procedimientos estadísticos, cuál es la traducción
adecuada en un contexto determinado.



Decidir cuándo una situación de equivalencia múltiple debe solucionarse
de una manera o de la otra, a veces no es sencillo. Por ejemplo, 
cuando entre dos o más
lemas de la lengua meta existe diferencia de significado,
pero consideramos que el módulo de selección léxica no será capaz
de escoger la buena traducción a partir del contexto, seguiremos el primer
método: escoger la traducción fija que queramos (la más general, la que
consideramos adecuada en el máximo de situaciones posibles) y poner una
restricción de dirección en el resto de equivalentes.
En los demás casos, codificaremos las entradas de forma que la decisión
quede en manos del módulo de selección léxica.


Cuando se utilice un sistema Apertium sin módulo de selección léxica, la única manera
de codificar entradas con varias traducciones posibles es la primera, es decir, escogiendo
una única traducción y marcando el resto de equivalencias con una restricción de dirección.
En caso de que utilicemos diccionarios bilingües con múltiples traducciones,
codificades con los atributos \texttt{slr} o \texttt{srl},
en un sistema que no dispone de módulo de selección léxica, una hoja de estilo
se encarga de convertir estas entradas
pensadas para el módulo de selección léxica en entradas con restricciones de dirección \texttt{LR} o \texttt{RL},
de manera que uno de los múltiples equivalentes (el que el lingüista haya escogido como
entrada predeterminada) queda como traducción fija del lema en lengua origen.



Como ejemplos de equivalencias bilingües que deberían llevar una restricción
de dirección, podemos dar los pares de traducción \texttt{ca-es}
\emph{encara -- aún/todavía} y \emph{sobtat -- súbito/repentino}, el primero de los cuales
podría quedar así:
\begin{alltt}
\begin{small}

<e r="LR">
   <p>
      <l>aún<s n="adv"/></l>
      <r>encara<s n="adv"/></r>
   </p>
</e>
<e>
    <p>
      <l>todavía<s n="adv"/></l>
      <r>encara<s n="adv"/></r>
    </p>
</e>
\end{small}
\end{alltt}

Como ejemplo del segundo caso (múltiples equivalentes con gran diferencia de significado) tenemos los pares
\texttt{es-ca} \emph{hoja -- full/fulla} o \emph{muñeca -- nina/canell}, y los ejemplos \texttt{en-ca}
que se muestran en la página \pageref{entrades_lextor}, donde se explica de qué manera
se indican en el diccionario bilingüe estos múltiples equivalentes.



\begin{figure}
{\footnotesize
\setlength{\tabcolsep}{0.5mm}
\begin{center}
\begin{tabular}{ccccccccc}
\\
\parbox{0.95cm}{text en llengua origen} \\
$\downarrow$ \\
\framebox{\parbox{1.0cm}{desfor\-matador}} $\rightarrow$ &
\framebox{\parbox{0.6cm}{anal. morf.}}  $\rightarrow$ &
\framebox{\parbox{1.0cm}{desamb. categ.}} $\rightarrow$ & 
\framebox{\parbox{0.6cm}{selec. lèxic}} $\rightarrow$ & 
\framebox{\parbox{0.85cm}{transf.\ estruc.}} $\rightarrow$ &
\framebox{\parbox{0.6cm}{gen. morf.}} 
$\rightarrow$ & \framebox{\parbox{1.2cm}{post\-generador}}
$\rightarrow$ & \framebox{\parbox{1.0cm}{refor\-matador}} \\
& & & & $\updownarrow$ & & &  $\downarrow$ \\
& & & & \framebox{\parbox{0.8cm}{transf.\ lèxica}} & & &
\parbox{0.95cm}{text en llengua meta}\\
\end{tabular}
\end{center}
}
\caption{Los nuevo módulos que forman la cadena de montaje de la versión
  2 del sistema de traducción automática Apertium.}
\label{fig:moduls}
\end{figure}

La figura~\ref{fig:moduls} muestra cómo queda la cadena de montaje en
la versión 2 de Apertium.\footnote{Esta figura reemplaza la figura 1.1
  que se encuentra en la página 6 de la documentación de la versión 1
  de Apertium.} \nota{MG: caldria canviar la figura de la pàgina 6 per
  aquesta d'aquí?} El módulo encargado de la selección léxica (selector léxico)
se ejecuta después del desambiguador léxico categorial y antes del módulo
encargado de la transferencia estructural; por lo tanto, este nuevo módulo
trabaja únicamente con información de la lengua origen. 


A continuación, en la sección~\ref{se:preprocessament} se explica el
preprocesamiento a que debe someterse un diccionario bilingüe que contiene más
de una traducción por entrada, tanto si se usa un módulo de selección léxica
como si no, y en la sección~\ref{se:lextor} se explica cómo
funciona y cómo se tiene que entrenar el módulo que realiza la selección léxica.


 
\subsection{Preprocesamiento de los diccionarios bilingües}\label{se:preprocessament}

El hecho de que, con esta modificación, se creen diccionarios bilingües
que permiten la especificación de más de una traducción por entrada (véase
en la sección \ref{dic_lextor} cómo se especifican estas entradas)
hace necesario un preprocesamiento de estos diccionarios, puesto que el motor de traducción
Apertium trabaja con diccionarios compilados en los que
cada palabra tiene sólo una traducción posible.

El preprocesamiento de los diccionarios se hace automáticamente durante la compilación,
por lo que el usuario final no tiene que ejecutar ninguna acción especial.


\subsubsection{Preprocesamiento sin módulo de selección léxica}

Cuando los diccionarios bilingües con múltiples equivalentes se
utilicen en un sistema que no dispone de módulo de selección léxica,
el preprocesamiento se realiza con la aplicación de la hoja de estilo
\texttt{translate-to\--de\-fault\--e\-qui\-va\-lent.xsl}.  Esta hoja
de estilo convierte los diccionarios con más de una posible traducción
por entrada en diccionarios con una sola traducción por entrada,
escogiendo como traducción la entrada marcada como equivalente
predeterminado, y poniendo una restricción de dirección (\texttt{LR} o
\texttt{RL} según el caso) en las demás entradas, de forma que éstas
sólo se traducen en la dirección de traducción en la que no hay
multiplicidad de equivalentes.  Esta hoja de estilo se llama desde el
\texttt{Makefile}.


Como ejemplo, las tres primeras entradas que se muestran en la página
\pageref{entrades_lextor} quedan así después de la aplicación de la hoja
de estilo mencionada:

\begin{alltt}
\begin{small}
<e>
   <p>
      <l>flat<s n="n"/></l>
      <r>pis<s n="n"/><s n="m"/></r>
   </p>
</e>

<e r="LR">
   <p>
      <l>floor<s n="n"/></l>
      <r>pis<s n="n"/><s n="m"/></r>
   </p>
</e>

<e r="RL">
   <p>
      <l>floor<s n="n"/></l>
      <r>terra<s n="n"/><s n="m"/></r>
   </p>
</e>
\end{small}
\end{alltt}

\subsubsection{Preprocesamiento con módulo de selección léxica}

En el caso de que el sistema Apertium funcione con un módulo de selección léxica, el diccionario bilingüe 
se tiene que preprocessar para obtener:
\begin{itemize}
\item un diccionario monolingüe que para cada palabra en
  lengua origen (por ejemplo \emph{look}) devuelva todas las posibles
  marcas de traducción  o equivalencias (\texttt{look\_\_mirar D} y \texttt{look\_\_semblar}),
  este diccionario será utilizado por el
  módulo que hace la selección léxica; y

\item un nuevo diccionario bilingüe que dada una palabra con la
  selección léxica ya hecha (por ejemplo \texttt{look\_\_semblar})
  devuelva la traducción (\emph{parèixer}); este será el diccionario
  bilingüe a emplear en la transferencia lèxica.

\end{itemize}


Este preprocesamiento se hace automáticamente con el siguiente
software en compilar los diccionarios:
\begin{itemize}
\item \texttt{apertium-gen-lextormono}, que recibe tres parámetros: 
  \begin{itemize}
  \item el sentido de traducción para el cual se quiere obtener el
    diccionario monolingüe usado en la selección lèxica; \texttt{lr}
    (\emph{left to rigth}) para la traducción de izquierda a derecha, y
    \texttt{rl} (\emph{right to left}) para la traducción de derecha a
    izquierda;
  \item el diccionario bilingüe a preprocesar; y
  \item el fichero donde se tiene que escribir el diccionario monolingüe
    resultante.
  \end{itemize}

\item \texttt{apertium-gen-lextorbil}, que recibe tres parámetros: 
  \begin{itemize}
  \item el sentido de traducción (\texttt{lr} o \texttt{rl}) para el que
     se quiere obtener el diccionario bilingüe a usar por el módulo de transferencia
    léxica;
  \item el diccionario bilingüe a preprocesar; y
  \item el fichero donde se tiene que escribir el diccionario bilingüe resultante.
  \end{itemize}
\end{itemize}

\subsection{Funcionamiento del módulo de selección léxica}\label{se:lextor}

El módulo encargado de la selección léxica se ejecuta después del
desambiguador léxico categorial y antes de la transferencia estructural
(véase la figura~\ref{fig:moduls} de la página~\pageref{fig:moduls});
por lo tanto hace uso únicamente de información de la lengua origen de la
traducción. Sin embargo, para el entrenamiento del módulo también se hace
uso de información de la lengua meta.


\subsubsection{Entrenamiento}\label{se:entrenament}

Para el entrenamiento del módulo que realiza la selección léxica se necesitan un
corpus en lengua origen y otro en lengua meta; no es necesario que
estén relacionados. Los dos corpus tienen que ser preprocesados antes
del entrenamiento. Este preprocesamiento, que consiste en analizar
los corpus y hacer la desambiguación léxica categorial, se puede
hacer
%perquè estiguen en el mateix format que quan es fa la
%tria lèxica durant la traducció (vegeu la secció~\ref{se:us} més
%avall) 
con \texttt{apertium-prepro\-cess\--cor\-pus\--lex\-tor}.

El entrenamiento del módulo encargado de la selección léxica consiste en hacer
las siguientes tareas:\footnote{El entrenamiento de los modelos usados para
  la selección léxica se ha automatizado en aquellos paquetes lingüísticos que
  lo usan. Además todo el software mencionado tiene su página de manual UNIX}



\begin{enumerate}
\item obtener la lista de palabras que no tendrán que ser tenidas en
  cuenta a la hora de hacer la selección lèxica (\emph{stopwords}). Esta
  lista puede hacerse a mano o mediante
  \texttt{apertium-gen-stopwords-lextor};
\item obtener la lista de palabras (en lengua origen) que tienen más
  de una traducción en lengua meta con
  \texttt{apertium-gen-wlist-lextor};
\item traducir a la lengua meta cada una de las palabras obtenidas en
  el paso anterior con \texttt{apertium-gen-wlist-lextor-translation};
\item entrenar con \texttt{apertium-lextor --trainwrd}  y usando el
  corpus preprocesado de la lengua meta un modelo de coaparición de palabras
  para las obtenidas en el paso anterior;
\item entrenar con \texttt{apertium-lextor --trainlch} 
y usando el
  corpus preprocesado de la lengua origen, los diccionarios generados
  con los programas mencionados en la sección~\ref{se:preprocessament} y los
  modelos de coaparición de palabras estimados en el paso anterior, un
  modelo de coaparición para cada una de las marcas de traducción
  de aquellas palabras que pueden tener más de una traducción en lengua
  meta.
\end{enumerate}

\subsubsection{Utilización}\label{se:us}
Los modelos de coaparición de palabras estimados en la sección anterior para
cada una de las marcas de traducción proporcionan la información
necesaria para llevar a cabo la selección léxica con información del
contexto.

La selección léxica se hace con \texttt{apertium-lextor --lextor}; los formatos
usados para la comunicación con el resto de módulos del motor de traducción
son:

\begin{description}
\item [Entrada:] texto en el mismo formato que el de entrada al módulo de transferencia
  estructural, es decir, texto analizado y desambiguado
  con las colas invariantes de las multipalabras desplazadas antes de cualquier
  etiqueta.
\item [Salida:] texto en el mismo formato pero con la marca de traducción
  a emplear cuando se haga la transferencia léxica.
\end{description}


El siguiente ejemplo ilustra los formatos de entrada/salida usados por el
selector léxico (suponemos que únicamente el verbo inglés \emph{get} tiene más
de un equivalente de traducción en los diccionarios):
\begin{itemize}
\item Texto en lengua origen (inglés): \emph{To get to the city
    centre}
\item Entrada al selector léxico: \verb!^To<pr>$!
  \verb!^get<vblex><inf>$! \verb!^to<pr>$! \verb!^the<det><def><sp>$!
  \verb!^city<n><sg>$! \verb!^centre<n><sg>$!
\item Marcas de traducción en el diccionario bilingüe para el verbo \emph{get}:
  \texttt{rebre}, \texttt{agafar}, \texttt{arribar},
  \texttt{aconseguir D}
\item Salida del selector léxico: \verb!^To<pr>$!
  \verb!^get__arribar<vblex><inf>$! \verb!^to<pr>$!
  \verb!^the<det><def><sp>$!  \verb!^city<n><sg>$!
  \verb!^centre<n><sg>$!
\end{itemize}


\newpage
\section{Módulo de transferencia estructural}
\label{ss:transfer}


\nota{Faena per fer (mlf):
  \begin{itemize}
  \item El document no diu encara res de metaparadigmes. En cal una descripció.
  \item Caldria demanar comentaris a Marta Villegas com a usuària del document perquè ens indique parts fosques, possibles suggeriments, etc.
  \item Hi ha bastants vacil·lacions en la terminologia usada per a referir-se a conceptes i en els noms usats per als programes.
\item He intentat substituir en cada cas l'expressió \emph{per defecte} per una altra més adequada; però caldrà distingir en quin cas ens trobem en cada cas.
  \end{itemize}
}


\subsection{Introducción}

A partir de 2007, Apertium dispone de un sistema
de transferencia estructural más avanzado que el que existía
hasta el momento, cuya necesidad aparece con el
requerimiento de la implementación de traductores para pares de
lenguas menos emparentados que los que se habían tratado hasta el
momento, como por ejemplo el par \emph{inglés}--\emph{catalán}.

Este sistema de transferencia se compone de tres módulos, el primero
de los cuales puede utilitzarse aisladamente cuando se desee ejecutar
un sistema de \textbf{transferencia sintática superficial}, como es
el caso para los pares de lenguas emparentadas
\emph{español}--\emph{catalán} o \emph{español}--\emph{gallego}.
Cuando el sistema se utiliza para pares de lenguas más alejados y se
desee, por lo tanto, realizar una \textbf{transferencia sintáctica
  avanzada}, se ejecutarán los tres módulos de transferencia en lo que
denominamos sistema Apertium 2.

El sistema de transferencia inicial o superficial realiza las
transformaciones estructurales en una única pasada de las reglas, las
cuales detectan secuencias o \emph{patrones} de formas léxicas y
realizan sobre ellas las comprobacions y cambios pertinentes.

El sistema de transferencia avanzado o Apertium 2 funciona con una
nueva arquitectura de transferencia que permite detectar
\emph{patrones de patrones} de formas léxicas mediante tres pasadas,
que realizan sus tres módulos.

A continuación se describen sus características.  En el apartado
\ref{functransfer} se describe el sistema de transferencia
superficial, que funciona con un sólo módulo de transferencia, y en el
apartado \ref{apertium2}, el sistema de transferencia avanzada, que
funciona con tres módulos de transferencia, con lo que la
descripción del primer apartado es válida también para el sistema de
transferencia avanzada, con las diferencias que se exponen en el
apartado correspondiente. Finalmente, en el apartado
\ref{formatotransfer} se describe el formato utilizado para crear
reglas en ambos sistemas.


\subsection{Transferencia sintáctica superficial}
\label{functransfer}


Este sistema utiliza únicamente el primero de los tres módulos de los
que se compone el sistema de transferencia avanzada. Este módulo lo
hemos denominado \textrm{transfer} o \emph{chunker}.

El diseño del lenguaje y del compilador que se usan para generar el módulo encargado de
la transferencia estructural está fuertemente inspirado en el lenguaje
MorphTrans descrito en \cite{garridoalenda01p} y usado por los
sistemas de TA español--catalán \textsf{interNOSTRUM}
\cite{canals01b,garridoalenda01p,garrido99j} y español--portugués
\textsf{Traductor Universia} \cite{garrido03p, gilabert03j},
desarrollados por el grupo Transducens de la Universitat d'Alacant.


La tarea de transferencia se realiza a partir de patrones que
representan secuencias de longitud fija de formas léxicas (véase página~\pageref{pg:FSFL}) de la lengua
origen (FLLO);
una secuencia sigue un cierto patrón cuando contiene la secuencia de
categorías léxicas correspondiente.  Los patrones no tienen por qué
ser constituyentes o sintagmas en un sentido sintáctico estricto, sino que son
meras concatenaciones de formas léxicas que pueden necesitar un
procesamiento conjunto adicional a la simple traducción palabra por
palabra, debido a las divergencias gramaticales existentes entre la LO y la LM
(cambios de género y número, reordenamientos, cambios preposicionales,
etc). Los patrones que forman el conjunto definido para una lengua
determinada se escogen de manera que definan las transformaciones estructurales más comunes.
Cuando las lenguas origen y meta son sintácticamente similares, como
es el caso del español, el catalán y el gallego, reglas simples
basadas en secuencias de categorías léxicas permiten obtener una
calidad razonable en la traducción.

El módulo de transferencia detecta en la LO secuencias de formas léxicas que concuerden
con algun patrón de los previamente definidos en un catálogo de
patrones y los procesa aplicando unas reglas de transferencia
estructural al mismo tiempo que realiza la transferencia léxica
consultando el diccionario bilingüe.

La \emph{detección de patrones} funciona como sigue: si el módulo de 
transferencia empieza a procesar la $i$ésima FLLO del texto, $l_i$, éste
intenta comparar la secuencia de FLLO $l_i, l_{i+1}, \ldots$ con todos los
patrones que hay en su catálogo: escoge el patrón más largo que 
coincida, procesa la secuencia detectada (mirar más abajo), 
y el proceso continúa en la FLLO $l_{i+k}$, donde $k$ es la longitud del 
patrón que se acaba de procesar. Si ningún patrón coincide con la 
secuencia que empieza con la FLLO $l_i$, ésta se traduce como una palabra 
aislada y el proceso comienza de nuevo con la FLLO $l_{i+1}$ (es
decir, cuando ningún 
patrón es aplicable, el sistema recurre a la traducción palabra por 
palabra). Nótese que cada FLLO es procesada una sola vez: 
los patrones no se solapan; por tanto, el procesamiento se realiza de 
izquierda a derecha y en fragmentos bien definidos.


Para el \emph{procesamiento de patrones}, el sistema toma la secuencia de FLLO
detectada y construye (utilizando un programa para la consulta del
diccionario bilingüe) una secuencia de formas léxicas en la lengua
meta (FLLM) obtenidas por aplicación de las operaciones descritas en la regla que afecta
al patrón (reordenación, adición, sustitución o eliminación de
palabras, cambios en la flexión, etc.). La información que no cambia
se copia automáticamente de la lengua origen a la lengua meta. Los
datos resultantes, es decir, los lemas más todas las etiquetas
morfológicas correspondientes, se envían al generador, el cual se
encarga de crear las formas flexionadas.



Como ejemplo, la secuencia en español \emph{una señal inequívoca}, que
llegaría desde el desambiguador al módulo de transferencia en el
siguiente formato~\footnote{El ejemplo se ha elegido de manera que no tenga superblancos con información de formato, para que quede más clara la parte lingüística de la transformación. Véase el capítulo \ref{se:flujodatos}}:\\

\begin{alltt}
\begin{small}
\textasciicircum\textbf{uno}<det><ind><f><sg>\$
\textasciicircum\textbf{señal}<n><f><sg>\$ 
\textasciicircum\textbf{inequívoco}<adj><f><sg>\$
\end{small}
\end{alltt}


\noindent{sería detectado como patrón por una regla para determinante--nombre--adjetivo.} El módulo de transferencia consultaría el diccionario bilingüe para establecer las correspondencias en catalán y, como detectaría un cambio de género en la palabra \emph{señal} (su equivalente catalán \emph{señal} es masculino), propagaría este cambio al determinante y al adjetivo para ofrecer la secuencia de salida:\\

\begin{alltt}
\begin{small}
\textasciicircum\textbf{un}<det><ind><m><sg>\$
\textasciicircum\textbf{senyal}<n><m><sg>\$ 
\textasciicircum\textbf{inequívoc}<adj><m><sg>\$
\end{small}
\end{alltt}

\noindent{que el módulo de generación convertiría en la forma catalana flexionada: \emph{un senyal inequívoc}.}

La mayoría de reglas se encargan de garantizar la concordancia de género y número en
varios sintagmas nominales (SN) sencillos (determi\-nan\-te--nombre, determinante--nombre--adjetivo, 
determinante--adjeti\-vo\---\\nom\-bre, determinante--adjetivo, etc.), siempre que haya concordancia
entre las FLLO del patrón detectado. Estas reglas son necesarias bien porque el nombre cambia de 
género o número entre la LO y la LM (como en el ejemplo que acabamos de describir) o bien porque 
hay que determinar el género o el número en la LM debido a que en la LO era ambiguo para 
alguna de las palabras (por ejemplo, el determinante \emph{cap} en catalán se puede traducir al español por 
\emph{ningún} (masc.) o \emph{ninguna} (fem.) según el nombre al que acompañe: \emph{cap cotxe} 
(\texttt{ca}) $\rightarrow$ \emph{ningún coche} (\texttt{es}) y \emph{cap casa} (\texttt{ca}) 
$\rightarrow$ \emph{ninguna casa} (\texttt{es}). Además, hay definidas otras reglas para solucionar problemas
frecuentes de transferencia entre el español, el catalán y el gallego, como, entre otras:

\begin{itemize}
  

\item reglas para cambiar preposiciones en determinadas
  construcciones: \emph{en Barcelona} (\texttt{es}) $\rightarrow$
  \emph{a Barcelona} (\texttt{ca}); \emph{consiste en hacer}
  (\texttt{es}) $\rightarrow$ \emph{consisteix a fer} (\texttt{ca});

\item reglas para añadir/quitar la preposición \emph{a} en determinadas construcciones modales del gallego con \emph{ir}
y \emph{vir}: \emph{vai comprar} (\texttt{gl}) $\rightarrow$ \emph{va a comprar} (\texttt{es});

\item reglas para los artículos delante de nombres propios: \emph{ve
    la Marta} (\texttt{ca}) $\rightarrow$ \emph{viene Marta}
  (\texttt{es});

\item reglas léxicas, por ejemplo, para decidir la traducción correcta del adverbio \emph{molt} 
(\texttt{ca}) al español (\emph{muy, mucho}) o la del adjetivo \emph{primeiro} (\texttt{gl}) 
o \emph{primer} (\texttt{ca}) al español (\emph{primer, primero});

\item reglas para reposicionar los pronombres átonos o clíticos, cuya distribución en gallego es diferente
que en español (proclítico en gallego y enclítico en español o viceversa): \emph{envioume} (\texttt{gl})
$\rightarrow$ \emph{me envió} (\texttt{es}); \emph{para nos dicir} (\texttt{gl}) $\rightarrow$ 
\emph{para decirnos} (\texttt{es}).

\end{itemize}



Las \emph{multipalabras} (sus diferentes tipos están explicados
en la página~\pageref{ss:multipalabras}) son procesadas de una manera especial en
este módulo:

\begin{itemize}
\item Las \emph{multipalabras sin flexión}, formadas por una sola forma
léxica, no necesitan ningún procesamiento específico, ya que son tratadas como las
demás FL.
\item Cuando se trata de \emph{multipalabras compuestas}, es decir,
  multipalabras formadas por varias \emph{formas léxicas}, cada una
  con un símbolo gramatical propio y unidas mediante el elemento
  \texttt{<j>} en la entrada del diccionario (que se corresponde con
  el símbolo '+' en el flujo de datos), el módulo auxiliar
  \texttt{pretransfer} (véase \ref{se:pretransfer}), situado antes del
  presente módulo, separa las distintas formas léxicas para que
  lleguen aquí como FL independientes. Si se desea volver a unirlas
  para que lleguen al generador como multipalabras (como es el caso de
  los pronombres enclíticos en nuestro sistema), hay que hacerlo
  mediante una regla de transferencia, utilizando el elemento
  \texttt{<\textbf{mlu}>} (descrito más adelante, en el apartado
  \ref{ss:mlu}). En la página~\pageref{regla_verbo2} puede verse un
  ejemplo de regla para la unión de los pronombres enclíticos al
  verbo.
\item En el caso de las \emph{multipalabras con flexión intercalada},
  el módulo \texttt{pre\-trans\-fer} adelanta la cola del lema (la parte
  invariable) y la coloca detrás de la cabeza del lema (la forma que se flexiona),
  para que sea posible buscar la multipalabra en el diccionario
  bilingüe. Este tipo de multipalabras deben procesarse mediante una
  regla de transferencia estructural, que recoloque la cola del lema
  en la posición adecuada. Esto se realiza utilizando los atributos
  \texttt{lemh} (\emph{lemma head} o ``cabeza del lema'' y \texttt{lemq}
  (\emph{lemma queue} o ``cola del lema'') del elemento
  \texttt{<\textbf{clip}>} a la salida de la regla. Véase la página~\pageref{ss:lu} para obtener
  una explicación más detallada del uso de este elemento, y la página 
\pageref{regla_verbo1} para ver dos reglas en que se utilizan estos atributos.
\end{itemize}


\subsection{Transferencia sintáctica avanzada (Apertium 2)}
\label{apertium2}

La arquitectura de transferencia superficial descrita en el apartado
anterior se basa, como hemos visto, en la manipulación automática de
determinados patrones de aparición de palabras mediante reglas
definidas por el usuario. Este modelo considera dos niveles desde
el punto de vista de la naturaleza de los datos: un nivel básico que
denominamos \textit{nivel léxico}, que se ocupa de las palabras y de
las operaciones de consulta y modificación de sus características
(lema y etiquetas), además de la traducción de lemas individuales
mediante consultas al diccionario bilingüe; y otro nivel que
denominamos \textit{nivel de patrones de palabras}, que se encarga de
realizar, cuando conviene, reordenamientos con las palabras que constituyen
estos patrones, así como cambios en las características de las
palabras que dependan de cada patrón concreto que haya sido
detectado. Todo este procesamiento de detección y manipulación léxica
y de patrones se lleva a cabo en una única pasada.  

Como contraste, la
nueva arquitectura de transferencia avanzada de Apertium 2 se
define como un sistema de transferencia en tres
niveles y tres pasadas. Los dos primeros niveles, el nivel léxico y el
de patrones, son homólogos a los del sistema de transferencia superficial. El nuevo
nivel que aparece es un nivel de \emph{patrones de patrones} de
palabras. El objetivo de la existencia de este nuevo nivel de
procesamiento es permitir la manipulación y la relación de patrones de
patrones de palabras de manera similar a cómo se tratan las palabras
en los patrones de palabras del sistema superficial. Con esta nueva estructura de
niveles se pretende que haya un tratamiento más adecuado de todas las
transformaciones que se requieren para traducir de una lengua a
otra. Por esto se tiene que poner de manifiesto que la identificación
de patrones de palabras en el sistema de transferencia superficial no tiene que coincidir con la
identificación de patrones de palabras en el sistema avanzado: se pretende que los patrones
en este último tengan un \textit{espíritu} de sintagmas que no tienen en el 
sistema anterior. Por esta razón utilizaremos el término \textit{segmento}
(en inglés \textit{chunk}), para referirnos a las secuencias de
palabras del sistema de transferencia avanzada. 

La arquitectura de transferencia avanzada de Apertium 2
se organiza en tres pasadas. Siguiendo el modelo de procesamiento de
Apertium, estas tres pasadas son realizadas por tres módulos
(programas) diferentes:

\begin{itemize} 
\item \texttt{chunker} (\texttt{transfer}): identifica los segmentos,
  realiza la traducción palabra por palabra, así como ciertas
  operaciones de reordenamiento y propagación de información
  morfosintáctica dentro del segmento (por ejemplo, para establecer la
  concordancia). Además, crea los segmentos para que sean tratados por
  el módulo siguiente. Este módulo tiene la opción de funcionar como
  módulo independiente en un sistema de transferencia sintáctica
  superficial; ello se controla mediante un atributo del elemento
  \texttt{<transfer>}.
\item \texttt{interchunk}: este módulo recibe los segmentos
  construidos por el \texttt{chunker} y permite reordenarlos,
  modificar la ``información sintáctica'' asociada a cada segmento y,
  finalmente, imprimir los segmentos en el orden nuevo y con las
  características nuevas en la salida, creando segmentos nuevos si es
  necesario.
\item \texttt{postchunk}: este módulo recibe los segmentos modificados
  por el interchunk y realiza tareas finales de modificación de las
  palabras contenidas en cada segmento y de impresión del texto
  contenido en los segmentos en el formato que acepta el
  generador. 
\end{itemize}


A continuación se especifica el formato de los segmentos que circulan entre los tres
módulos del sistema de transferencia (sección \ref{sec:format}, el tratamiento de 
mayúsculas y minúsculas en los segmentos (sección \ref{ss:majuscules}), que difiere del 
que se da para las formas léxicas individuales en el caso de un sistema de transferencia superficial, 
y finalmente se describe el funcionamiento de cada uno de los tres módulos (secciones 
\ref{ss:chunker}, \ref{ss:interchunk} y  \ref{ss:postchunk} respectivamente).

) 
En la sección \ref{formatotransfer} se describe el formato de las reglas de
transferencia, que es común para los tres módulos con algunas diferencias, y finalmente
en la sección \ref{noutransfer} se recalcan algunas de las características diferenciadas de los
tres módulos en cuanto al formato y el funcionamiento de las reglas.


\subsubsection{Formato de los segmentos}
\label{sec:format}


La comunicación entre los módulos \texttt{chunker} e
\texttt{interchunk}, al igual que la comunicación entre
\texttt{interchunk} y \texttt{postchunk}, se lleva a cabo
mediante secuencias de segmentos. Definimos $C$ como una
\emph{secuenca de segmentos}, que tiene la forma:
$$
C=b_{0}c_{1}b_{1}c_{2}b_{2} \ldots b_{k-1}c_{k}b_{k}
$$

Donde cada $b_i$ es un \textit{superblanco}, y cada $c$ es un \emph{segmento}. Un
segmento $c$ se define como a una cadena
\verb!^!$F$\verb!{!$W$\verb!}$! que contiene la siguiente
información:

\begin{itemize} 
\item $F$ es el \emph{pseudolema del segmento}, y es una cadena que
  tiene la forma $fE$, donde $f$ es el \textit{pseudolema} del
  segmento, y  $E=e_{1}e_{2} \ldots$ es una secuencia de etiquetas
  morfológicas denominadas \emph{etiquetas del segmento}. La
  modificación de estas etiquetas provocará la modificación de la
  información morfológica de las palabras del segmento que esté
  enlazada a estos parámetros.
\item $W=b_{0}w_{1}b_{1}w_{2}b_{2} \ldots w_{k}b_{k}$ es la secuencia
  de palabras $w_i$ enviada por el chunker
  con los \textit{superblancos}  $b_i$ intercalados. Estas palabras se
  encuentran en el mismo formato an ambos sistemas de transferencia, es decir, una palabra
  individual 
$w_i=$\verb!^!$l_{i}E_{i}$\verb!$!  contiene lema $l_i$ y
  etiquetas $E_i$, algunas de las cuales pueden ser \emph{referencias
    o enlaces a las etiquetas} del segmento y se designan con números
  naturales \texttt{<1>}, \texttt{<2>}, \texttt{<3>}, etc. Estas
  referencias a etiquetas se corresponden, en el orden especificado, con
  las etiquetas de $E$.
\end{itemize} 

Un ejemplo de uso de este formato es el siguiente:

\begin{small}
\begin{alltt}
\verb!^!det_nom<SN><m><pl>\verb!{^!el<det><def><2><3>$[ 
<a href="http://www.ua.es">]^gat<n><2><3>$\verb!}$![</a>]
\end{alltt}
\end{small}

Los caracteres \verb!{! y \verb!}!, cuando estén presentes en el texto
original, deberán protegerse colocando una barra invertida \verb!\!
delante.

\subsubsection{Tratamiento de mayúsculas y minúsculas}
\label{ss:majuscules}

Para cada segmento, la información de mayúsculas y minúsculas de las
palabras viene determinada por la información de mayúsculas y
minúsculas del pseudolema del segmento, teniendo en cuenta estas
condiciones:

\begin{itemize}

\item Si todas las letras del pseudolema están en minúsculas: el estado de mayúsculas y minúsculas no se modifica. 
\item Si la primera letra del pseudolema está en mayúsculas y el resto
  en minúsculas: en la generación en el módulo
  \texttt{postchunk}, se hará que la primera letra que
  resulto de todos los posibles cambios de orden de las palabras del
  segmento esté en mayúsculas.
 \item Si
  todas las letras del pseudolema están en mayúsculas: todas las
  palabras permanecerán en mayúsculas.
\end{itemize}


Un requisito es que las palabras del interior del segmento no
empiecen por mayúsculas si no se trata de nombres propios, con tal de
evitar que el último módulo busque cuál es la palabra que tiene que
perder la mayúscula, si la hay. Esta tarea corresponde al módulo
\texttt{chunker} y se hace mediante una macro o
algún mecanismo similar.

\subsubsection{Programa \texttt{chunker} (\texttt{transfer})}
\label{ss:chunker}


Este programa es el heredero más directo del módulo de transferencia
sintáctica superficial de Apertium. De hecho, este módulo puede
utilizarse individualmente como sistema de transferencia sintáctica
superficial, o en combinación con los otros dos módulos de transferencia
para construir un sistema de transferencia sintáctica
avanzada.

\paragraph{Entrada/salida}

\begin{itemize}
\item Entrada: datos con el formato de salida del \texttt{pretransfer}, es decir,
  con las colas invariantes de las multipalabras desplazadas a una posición
  anterior a cualquier etiqueta.

\item Salida:
\begin{itemize}
\item[-] si se utiliza en un sistema de transferencia avanzada: segmentos (chunks),
  para que el módulo siguiente los detecte y realice operaciones con ellos
\item[-]  si se utiliza en un sistema de transferencia superficial: formas léxicas que constituyen
la entrada del módulo de generación.
\end{itemize}

\end{itemize}


\paragraph{Ficheros de datos}

\nota{Explicar millor això de l'únic fitxer de configuració}

Este programa usa un único fichero de configuración y un fichero
precompilado de detección de patrones calculado a partir del primero, de manera
idéntica a Apertium \nota{MG: caldria canviar les
  referències a 'Apertium' com si fos una altra cosa}. El nombre del
fichero de patrones (el fichero de configuración) tendrá la extensión  \texttt{.t1x}. 
Como el 
\texttt{chunker} es quien hace la consulta del diccionario bilingüe, éste
(en forma compilada) también se tiene que aportar al programa.

\nota{Potser seria bona idea esmentar en quina secció s'explica el
compilador a què es fa referència}

La DTD de este fichero de datos se especifica en el apéndice 
\ref{ss:dtdtransfer}, y en el apartado \ref{formatotransfer} se describen
los elementos utilizados para crear las reglas del fichero.

\paragraph{Detección de patrones}

El sistema de detección de reglas de este módulo será el mismo que en
el módulo de transferencia actual de Apertium \nota{ídem sobre 'Apertium', canviar-ho}. El programa
\texttt{a\-per\-tium-pre\-trans\-fer}  
\nota{Vacil·lació terminològica \texttt{pretransfer}.}
es necesario para adaptar el formato
de salida del etiquetador a la entrada que reconoce el módulo de transferencia.
En posteriores versiones de Apertium no se descarta que se modifique el
\textit{desambiguador categorial} para que haga el trabajo del
\texttt{apertium-pretransfer}.
\nota{També hem d'unificar la terminologia d'altres mòduls:
\emph{desambiguador categorial}, \emph{etiquetador}; tal com està redactat
el paràgraf es podria pensar que són dues coses diferents.}


\paragraph{Acción implícita}

Los \textit{superblancos} aislados, que no son detectados por ningún patrón
de este módulo, se escriben en el mismo orden en el que llegan.

El elemento raíz del fichero \texttt{.t1x} de reglas del
\texttt{chunker}, \texttt{<transfer>}, tiene un
atributo opcional \texttt{default} que puede tomar los valores
\begin{itemize}
\item \texttt{chunk}: cuando el módulo funcione en Apertium 2
  (transferencia sintáctiva avanzada), para que se generen segmentos
  triviales con las palabras que no son detectadas por ninguna regla,
  para que a la salida no haya ninguna palabra no integrada en un
  segmento.  El nuevo segmento se creará mediante la traducción de la
  palabra por el diccionario bilingüe.  El lema fijo de los chunks
  creados implícitamente es \texttt{default}.
\item \texttt{lu} (valor implícito): cuando el módulo funcione como
  único módulo de transferencia en Apertium 1 (transferencia
  sintáctica superficial), para que no se creen segmentos para las
  palabras no detectadas por reglas, y simplemente se traduzcan con el
  diccionario bilingüe.

\end{itemize}

A continuación se muestra el segmento generado automáticamente con una forma léxica no
detectada por ninguna regla  del
\texttt{chunker} cuando el atributo \texttt{default} tiene el valor \texttt{chunk}:


\begin{alltt}
^default\verb!{!^that<cnjsub>$\verb!}!$
\end{alltt}

\nota{Va sense etiquetes entre \texttt{default} i \texttt{\{}? No caldria dir-ho explícitament?}


\subsubsection{Programa \texttt{interchunk}}
\label{ss:interchunk}


\nota{És \texttt{apertium-interchunk} o \texttt{interchunk} només?}

El programa \texttt{interchunk} trata los segmentos, los reordena y hace los
cambios pertinentes en la información morfosintáctica. Esto se hace
mediante la detección de patrones de segmentos (secuencias de segmentos).
Las instrucciones que se usan para controlar
su funcionamiento son, con pocas diferencias, las mismas que usa
el programa \texttt{chunker}, pero tiene que quedar claro que se utiliza un archivo
diferente. Los segmentos son tratados de forma similar a como se
tratan las palabras en el transfer o \texttt{chunker} de Apertium.
\nota{Comprovar la denominació dels programes}

\paragraph{Entrada/salida}

\begin{itemize}
\item Entrada: segmentos procedentes de \texttt{chunker}.
\item Salida: segmentos posiblemente reordenados y con la información del
  pseudolema del segmento posiblemente modificada.
\end{itemize}

\paragraph{Ficheros de datos}

Este módulo usa dos ficheros de datos. Un fichero de especificación del
comportamiento del programa \texttt{in\-ter\-chunk}, con extensión
\texttt{.t2x} por analogía con el módulo anterior, y un
fichero de patrones precalculados para acelerar el análisis de la entrada.
No se  incluye el fichero binario del diccionario bilingüe porque no
se usa.
\nota{Citar el compilador?}

La sintaxi del fichero de especificación es muy similar a la del módulo
\texttt{chunker}. Su DTD se especifica en el Apéndice
\ref{ss:dtdinterchunk}, y en el apartado \ref{formatotransfer} se describen
los elementos utilizados para crear las reglas del fichero.


\paragraph{Detección de reglas}

Las reglas detectan patrones que están definidos mediante secuencias
de pseudopalabras. Estas pseudopalabras tienen un formato basado en
el formato de la forma léxica de las palabras. Desde el punto de vista
práctico, este pseudolema es visto de manera equivalente a como se
\nota{La alternança \emph{pseudolema} i \emph{pseudoparaula} s'ha de resoldre}
ve la forma léxica de una palabra en el módulo
\texttt{chunker} para realizar la detección.
De esta forma, se usará una detección de patrones con atributos definidos
sobre las pseudopalabras y no sobre las palabras del patrón original.

\paragraph{Acción implícita}

Al igual que en el módulo anterior, se ha establecido una acción
implícita que escribe sin modificar los segmentos no reconocidos por ningún
patrón del fichero de especificación de este módulo. Esta acción implícita
escribe exactamente lo que lee, tanto si se trata de chunks como
de blancos.
\nota{Atenció a la vacil·lació \emph{regla}/\emph{acció} en la resta del document. Sempre havia cregut que era \emph{regla}=\emph{patró}+\emph{acció}.}


\subsubsection{Programa \texttt{postchunk}}
\label{ss:postchunk}

El programa \texttt{postchunk} detecta segmentos individuales, y para
cada uno de ellos, ejecuta unas acciones especificadas. La detección se
basa en los lemas del segmento,
\nota{Seria \emph{en el lema}?}
y no en patrones (no en las etiquetas);
esto hará que la detección en este módulo sea específica para cada
``nombre'' de segmento.\nota{Quan fixem bé la terminologia hem d'assegurar-nos que la redacció d'aquesta part és l'adequada.}


Por otro lado, el funcionamiento de la detección y del procesamiento de las
reglas se basa en que las referencias a parámetros se resuelven
inmediatamente después de la detección, es decir, las etiquetas
\texttt{<1>}, \texttt{<2>}, etc. son sustituidas automáticamente por el
valor de los parámetros antes de empezar el procesamiento. Las posiciones
(atributo \texttt{pos}) a las que se hace referencia con las
instrucciones \texttt{<clip>}, etc. corresponden a la posición de las
palabras en el interior del segmento.

También aplica automáticamente la política de mayúsculas (ver sección
\ref{ss:majuscules}) de los lemas de las pseudopalabras hacia las
palabras que están dentro del segmento.



\paragraph{Entrada/salida}

\begin{itemize}
\item Entrada: segmentos procedentes de\texttt{in\-ter\-chunk}.
\item Salida: entrada válida para el módulo de generación morfológica de Apertium.
\end{itemize}

\paragraph{Ficheros de datos}

Este programa tiene su propio archivo de especificación, que tendrá
extensión \texttt{.t3x}. La sintaxis está basada igualmente en el
\texttt{chunker} i en el \texttt{in\-ter\-chunk} de Apertium 2. 
\nota{Explicar que no ha de llegir cap fitxer compilat de patrons perquè usa noms i no patrons?}

\paragraph{Detección de reglas}

La detección de los segmentos se basa en el nombre de los segmentos. Los
segmentos no detectados reciben el procesamiento implícito.


\paragraph{Acción implícita}


En este módulo la acción implícita es la de escribir las palabras de dentro
del segmento, sustituyendo las referencias por los parámetros del
segmento. Será usada para la mayor parte de segmentos, ya que se prevé
que este módulo se utilice para casos muy específicos en los que
sea necesario hacer algún procesamiento concreto.

También se aplica implícitamente la política de mayúsculas (sección
\ref{ss:majuscules}).

En cualquier caso, los blancos externos a los segmentos son copiados en
el mismo orden en que son leídos, puesto que la detección de segmentos es
unitaria (este módulo no los agrupa).

%\settocdepth{subsection}
\subsection{Especificación del formato de las reglas de transferencia estructural}
\label{formatotransfer}


En esta sección se explica el formato en el que se escriben las reglas
de transferencia estructural. En el apéndice, en las secciones
~\ref{ss:dtdtransfer}, \ref{ss:dtdinterchunk} i \ref{ss:dtdpostchunk}
se ofrece la descripción formal (DTD).

Los archivos de reglas de transferencia estructural tienen dos partes
bien diferenciadas: una de declaración de los elementos que se
utilizarán en las reglas y otra de reglas propiamente dichas.\\


En la parte de \textbf{declaración} encontramos:

\begin{itemize}

\item Una serie de declaraciones de \emph{categorías léxicas} que
  especifican aquellas formas léxicas que serán tratadas como una
  categoría particular y que serán detectadas en los patrones.  Hemos
  de destacar que el lingüista puede incluir cualquier información de
  la forma léxica para definir una categoría; las ca\-te\-go\-rías
  pueden ser muy genéricas (p.e. todos los nombres) o muy específicas
  (p.e. sólo aquellos determinantes que son demostrativos femeninos
  plurales).
\item Una serie de declaraciones de los \emph{atributos} que queremos
  detectar en las formas léxicas (como el \emph{género}, el
  \emph{número}, la \emph{persona} o el \emph{tiempo}), para realizar
  con ellos las operaciones de transformación pertinentes y enviar la
  información resultante a la salida de las reglas. En la declaración
  de los atributos se incluye el nombre del atributo y los posibles
  valores que puede tomar este atributo en una forma léxica (por lo
  general se corresponden con los símbolos morfológicos que la
  caracterizan): por ejemplo, el atributo de \emph{número} puede tomar
  los valores de \emph{singular}, \emph{plural},
  \emph{singular-plural} (para formas léxicas invariables, como
  \emph{crisis} en español) y \emph{número por determinar} (para
  formas léxicas de la LM con distinción
  \emph{singular}--\emph{plural} cuyo número no se puede determinar en
  la traducción al ser la forma léxica de la LO invariable en número,
  véase la explicación de la página \pageref{pg:GD}). Si dentro de la
  regla, fuera del patrón, debe hacerse referencia a alguna de las
  categorías léxicas definidas en el punto anterior (para someterlas a
  acciones o comprobaciones), deberán definirse también atributos para
  las mismas.

\item Una serie de declaraciones de \emph{variables globales}, que se
  usan para transferir valores de atributos activos dentro de cada
  regla o de una regla a las que se apliquen posteriormente.

\item Una sección de \textit{definición de listas de cadenas},
  generalmente listas de lemas, que serán utilizados para buscar en
  ellas un valor que corresponda para realizar una transformación
  determinada.

\item Una serie de declaraciones de \emph{macroinstrucciones}; las
  macroinstrucciones contienen secuencias de instrucciones de operaciones frecuentes y 
  pueden incluirse en varias reglas (por ejemplo, una
  macroinstrucción para asegurar la concordancia de género y número
  entre dos formas léxicas de un mismo patrón).

\end{itemize}

En las \textbf{reglas de transferencia estructural} encontramos:

\begin{itemize}
\item La definición del patrón que será detectado, especificado como 
una secuencia de categorías léxicas tal como se han definido en la parte de declaración. Cabe resaltar que, 
  si la secuencia de formas léxicas concuerda con dos reglas diferentes, primero, prevalece la 
  más larga y, segundo, para reglas de la misma longitud, prevalece la regla definida en primer lugar.

\item La parte de proceso de las reglas, en la que especifican las acciones a realizar sobre las FLLO
y se construye el patrón en la LM.

\end{itemize}
\nota{Assegurem-nos que totes les sigles estan definides}

A continuación se explican detalladamente las características de cada uno de los elementos utilizados.


\subsubsection{Elemento \texttt{<transfer>}}

(\textit{Sólo en el módulo transfer/chunker})

Es el elemento raíz  del
módulo \texttt{transfer/chunker} y contiene todos los demás
elementos del archivo de reglas de transferencia estructural de este
módulo.

Su atributo \texttt{default} puede tomar dos valores: 
\begin{itemize}

\item \texttt{lu}: indica que funcionará como único módulo de
  transferencia en un sistema de transferencia sintáctica superficial
  y que, por lo tanto, las palabras implícitas deben dejarse intactas

\item \texttt{chunk}: indica que, cuando una palabra no es
reconocida por ninguna regla,  se creará de oficio un segmento que encapsule
esta palabra para que pueda ser tratada por los siguientes módulos de transferencia en Apertium 2 (transferencia
sintáctica avanzada).

\end{itemize}

El valor por defecto es \texttt{lu}.

\subsubsection{Elemento \texttt{<interchunk>}}

(\textit{Sólo en interchunk})

Es el elemento raíz del módulo \texttt{interchunk} y contiene todos los demás
elementos del archivo de reglas de transferencia
estructural de este módulo.


\subsubsection{Elemento \texttt{<postchunk>}}


(\textit{Sólo en postchunk})

Es el elemento raíz del módulo \texttt{postchunk} y contiene todos los demás
elementos del archivo de reglas de transferencia
estructural de este módulo.



\subsubsection{Elemento de sección de definición de categorías \\\texttt{<section-def-cats>}}
\nota{Atenció a l'ús polisèmic del mot \emph{categoria} en el document}

En esta sección se definen las categorías léxicas que se usarán para crear
los patrones utilizados en las reglas. Cada definición se realiza con un \texttt{<\textbf{def-cat}>}.



\subsubsection{Elemento de definición de categorías \texttt{<def-cat>}}

Cada definición de categoría tiene un nombre \texttt{n} obligatorio
como por ejemplo \texttt{det}, \texttt{adv}, \texttt{prep}, etc. y una
lista de categorías (\texttt{<\textbf{cat-item}>}) que la definen. El nombre
de la categoría no puede contener acentos.


\subsubsection{Elemento de categoría \texttt{<cat-item>}}


Este elemento tiene dos usos marcadamente diferenciados según el 
módulo en el que se utilice.

\paragraph{Uso en el módulo transfer/chunker}


Mediante este elemento se definen las categorías léxicas que se
utilizarán en los patrones, es decir, que se desea detectar en el
texto origen. Estas categorías se definen a partir de una subsecuencia
de las etiquetas finas (ver definición en la página~\pageref{ss:introtagger}) que
entregan tanto el analizador morfológico como el
desambiguador\footnote{Hay que tener en cuenta que a lo largo de los
  distintos módulos de procesamiento lingüístico se utilizan distintas
  categorizaciones léxicas: en los diccionarios morfológicos, los
  lemas se acompañan de una etiqueta fina (por ejemplo,
  \texttt{\emph{<n><m><pl>}} para los nombres masculinos en plural);
  el desambiguador categorial agrupa estas etiquetas finas en
  etiquetas más generales (por ejemplo, la categoría \texttt{NOM} para
  todos los nombres), aunque a su salida vuelve a entregar la etiqueta
  fina completa de cada FL; finalmente, en el módulo de transferencia,
  las etiquetas finas de las FL se agrupan otra vez en categorías más
  generales (aunque pueden definirse también categorías detalladas)
  según el tipo de formas léxicas que se quiera detectar en los
  patrones.}.

Cada elemento \texttt{<\textbf{cat-item}>} tiene un atributo
obligatorio \texttt{tags} cuyo valor es una secuencia de símbolos
gramaticales separados por puntos; esta secuencia es una subsecuencia
de la etiqueta fina, es decir, de la secuencia de símbolos
gramaticales que define cada posible forma léxica entregada por el
desambiguador léxico categorial.  De este modo, una categoría
representa un determinado conjunto de formas léxicas.  Tenemos que
definir tantas categorías distintas como tipos de formas léxicas
queramos detectar en los patrones. Así, si nos interesa detectar todos
los nombres para realizar operaciones con ellos, crearemos una
categoría definida a partir del símbolo gramatical \texttt{n}. Por
otro lado, si nos interesa detectar todos los nombres femeninos en
plural, deberemos definir una categoría mediante los símbolos
\texttt{n} \texttt{f} y \texttt{pl}.



Cuando un símbolo gramatical utilizado para definir una categoría
viene seguido por otros símbolos gramaticales en el grupo de lemas que
se quiere incluir, se utiliza el carácter \texttt{"*"}. Por ejemplo,
\texttt{tags}=\texttt{"n.*"} abarca todas las formas léxicas que
contengan este símbolo, como \texttt{casa<n><f><pl>} o
\texttt{coche<n><m><sg>}. En cambio, cuando detrás del símbolo
utilizado no puede venir ningún otro símbolo, no se incluye el
asterisco: por ejemplo, \texttt{tags}=\texttt{"}\texttt{adv"} abarcará
todos los adverbios, pues en nuestro sistema son caracterizados por
una única etiqueta. También puede utilizarse el asterisco para
indicar la existencia de símbolos precedentes:
\texttt{tags}=\texttt{"*.f.*"} incluye a todas las formas léxicas
femeninas, sean de la categoría que sean. Además, puede utilizarse un
atributo opcional, \texttt{lemma}, para definir formas léxicas a
partir de su lema (ver figura \ref{fig:cat-item}).



\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{def-cat} \textsl{n}="nom"/>
  <\textbf{cat-item} \textsl{tags}="n.*"/>
</\textbf{def-cat}>

<\textbf{def-cat} \textsl{n}="que"/>
  <\textbf{cat-item} \textsl{lemma}="que" \textsl{tags}="cnjsub"/>
  <\textbf{cat-item} \textsl{lemma}="que" \textsl{tags}="rel.an.mf.sp"/>
</\textbf{def-cat}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{cat-item}>} para definir
  dos categorías, una para nombres sin especificar ningún lema
  (\emph{nom}) en la que se incluyen todas las formas léxicas cuyo
  primer símbolo morfológico sea \emph{n}, y otra con lema asociado
  (\emph{que}), que tiene más de un símbolo gramatical asociado, para
  incluir el \emph{que} conjunción y el \emph{que} relativo.}
\label{fig:cat-item}
\end{figure}


\paragraph{Uso en el módulo interchunk}


Se utiliza igual que en el módulo \texttt{chunker}, pero aquí, en lugar de definirse
a partir de los símbolos gramaticales de las formas léxicas, se define a partir de los símbolos de
los segmentos entregados por el módulo \texttt{chunker}. Si, por ejemplo, queremos definir
una categoría para detectar todos los sintagmas nominales determinados, la definiremos mediante
los símbolos \texttt{SN} y \texttt{DET} si así hemos caracterizado el segmento o \emph{chunk} mediante 
las instrucciones \texttt{<tag>} contenidas en el elemento \texttt{<chunk>} (véase 
\ref{ss:chunker}). También se puede utilizar el atributo opcional
\texttt{lemma} para hacer referencia al \emph{pseudolema} del segmento. Así pues, sus características
formales son las mismas en los módulos \texttt{chunker} e \texttt{interchunk}, con la única diferencia que en el
primero se utilizan para detectar formas léxicas y en el segundo, para detectar segmentos o \emph{chunks}.


\paragraph{Uso en el módulo postchunk}

En este módulo, este elemento solo prevé el atributo obligatorio \texttt{name}, que hace referencia al nombre del
segmento o chunk,

\nota{MG: abans deia 'al nom de la regla', comentari mlf: De la
  regla o del patró?}  sin etiquetas, ya que en el módulo
\texttt{postchunk} sólo se usa el pseudolema (nombre del segmento)
para la detección.  En la detección no se distingue entre mayúsculas y
minúsculas, porque el pseudolema se usa para transmitir la información
sobre las mayúsculas y las minúsculas del segmento. (Véase la figura
\ref{fig:cat-item-postchunk}).

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{def-cat} \textsl{n}="det-nom"/>    
  <\textbf{cat-item} \textsl{name}="det-nom"/>
</\textbf{def-cat}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{cat-item}>} en el módulo
  postchunk para detectar chunks de determinante-nombre.}
\label{fig:cat-item-postchunk}
\end{figure}



\subsubsection{Elemento de sección de definición de atributos de categoría \\\texttt{<section-def-attrs>}}


En esta sección se definen los atributos que se extraerán de las
categorías detectadas por el patrón y que se utilizarán en la parte de
acción de las reglas. Cada atributo se define mediante una etiqueta
\texttt{<\textbf{def-attr}>}.

\nota{De vegades les etiquetes aprareixen en el text en
  negretes i de vegades sense negretes. Decidim-nos per una tipografia
  i usem-la en tot el document.}


\subsubsection{Elemento de definición de atributos de categoría \\\texttt{<def-attr>}}

Cada \texttt{<\textbf{def-attr}>} define un atributo con información
morfológica (tanto información flexiva --género, número, persona,
etc.--, como categorial --verbo, adjetivo, etc--) mediante una lista
de elementos de atributo de categoría (\texttt{<\textbf{attr-item}>})
y tiene un nombre único obligatorio \texttt{n}. Un atributo se define,
por lo tanto, a partir de los símbolos morfológicos que pueden
encontrarse en una forma léxica dada. Cada atributo extrae, de las formas léxicas
del patrón, los símbolos que éstas contienen de entre los posibles valores dados.

\subsubsection{Elemento de atributo de categoría \texttt{<attr-item>}}

Cada elemento de atributo de categoría representa uno de los valores
posibles que puede tomar el atributo. Por ejemplo, el atributo de
número \texttt{nbr} puede tomar los valores singular \texttt{sg},
plural \texttt{pl}, singular--plural \texttt{sp} y número por
determinar \texttt{ND}. Estos valores son una subsecuencia de las
etiquetas morfológicas que caracterizan a las formas léxicas y se
indican en el atributo \texttt{tags} del elemento, separadas por punto
si hay más de una. En la figura \ref{fig:attr-item} puede verse un
ejemplo de utilización de este elemento para el atributo de
\emph{número} y el atributo de \emph{nombre}. 
\nota{Potser s'hauria d'explicar per què s'ha triat el nom \emph{a\_nom} en la figura}

Compárese la definición del
atributo de nombre en esta figura (con todos los valores posibles y sin asteriscos) con la
definición de la categoría de nombre de la figura \ref{fig:cat-item}. 



\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{def-attr} \textsl{n}="nbr"/>
  <\textbf{attr-item} \textsl{tags}="sg"/>
  <\textbf{attr-item} \textsl{tags}="pl"/>
  <\textbf{attr-item} \textsl{tags}="sp"/>
  <\textbf{attr-item} \textsl{tags}="ND"/>
</\textbf{def-attr}>

<\textbf{def-attr} \textsl{n}="a_nom"/>
  <\textbf{attr-item} \textsl{tags}="n"/>
  <\textbf{attr-item} \textsl{tags}="n.acr"/>
</\textbf{def-attr}>


\end{alltt}
\end{small}
\caption{Definición del atributo de categoría \emph{número}
  \texttt{nbr}, que puede tomar los valores  \emph{singular}, \emph{plural}, \emph{singular-plural} o
 \emph{número por determinar}, así como del atributo de categoría \emph{nombre} \texttt{a\_nom}, que puede
tomar los valores de los símbolos \emph{n} o \emph{n acr}.}
\label{fig:attr-item}
\end{figure}


\subsubsection{Elemento de sección de definición de variables \\\texttt{<section-def-vars>}}

En esta sección se definen (mediante etiquetas \texttt{<\textbf{def-var}>}) las
variables globales de tipo cadena que se utilizarán para transferir información
dentro de una regla y de una regla a otra (por ejemplo, para poder
transmitir información de género o número entre dos patrones).


\nota{Que quede clar que aquesta transferència d'una regla a altra es fa només d'una aplicació d'una regla a l'aplicació d'altra regla en un moment posterior, o d'esquerra a dreta}

\subsubsection{Elemento de definición de variables \texttt{<def-var>}}
\label{ss:defvar}
La definición de una variable global de tipo cadena tiene un nombre único obligatorio
\texttt{n} que se utilizará para referirse a la misma dentro de las
reglas.  Las variables contienen cadenas que describen información de estado, como la
existencia de concordancia entre dos elementos, la detección de un
signo de interrogación en la LO que haya que eliminar en LM, etc.


\subsubsection{Elemento de sección de definición de listas de cadenas \\\texttt{<section-def-lists>}}
En esta sección se definen (mediante etiquetas \texttt{<\textbf{def-list}>}) las
listas que se utilizarán para realizar búsquedas de cadenas.  Estas
listas se pueden utilizar para agrupar lemas de palabras que tengan
alguna característica común (por ejemplo, verbos que expresen
movimiento, adjetivos que expresen estados de ánimo, etc.).  Esta
sección es opcional.

\subsubsection{Elemento de definición de listas de cadenas \texttt{<def-list>}}
Este elemento sirve para ponerle nombre a la lista de cadenas mediante el
atributo \texttt{n} y para encapsular la lista que se
define mediante uno o más elementos \texttt{<\textbf{list-item}>}. Puede verse un ejemplo de uso
en la figura \ref{fig:deflist}.

\subsubsection{Elemento de miembro de lista de cadenas \texttt{<list-item>}}
Este elemento define, mediante el valor del atributo \texttt{v}, la
cadena concreta que se incluye en la definición de la lista que
engloba a este elemento. Puede verse un ejemplo de uso
en la figura \ref{fig:deflist}.



\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{def-list} n="verbos_est">
  <\textbf{list-item} v="actuar"/>
  <\textbf{list-item} v="buscar"/>
  <\textbf{list-item} v="estudiar"/>
  <\textbf{list-item} v="existir"/>
  <\textbf{list-item} v="ingressar"/>
  <\textbf{list-item} v="introduir"/>
  <\textbf{list-item} v="penetrar"/>
  <\textbf{list-item} v="publicar"/>
  <\textbf{list-item} v="treballar"/>
  <\textbf{list-item} v="viure"/>
<\textbf{/def-list}>
\end{alltt}
\end{small}
\caption{Definición de una lista de lemas en catalán. Estos lemas se utilizan en una regla que puede
verse en la figura \ref{fig:in}.}
\label{fig:deflist}
\end{figure}


\subsubsection{Elemento de sección de definición de macroinstrucciones \\\texttt{<section-def-macros>}}

En esta sección se definen las macroinstrucciones que contienen fragmentos
de código utilizado con frecuencia en la parte de acción de las
reglas. 

\subsubsection{Elemento de definición de macroinstrucciones \\\texttt{<def-macro>}}

Cada definición de una macroinstrucción tiene un nombre obligatorio (el valor del
atributo \texttt{n}), el número de argumentos que se le pasan como
referencia (atributo \texttt{npar}) y un cuerpo con instrucciones.


\subsubsection{Elemento de sección de reglas \texttt{<section-rules>}}

Esta sección contiene las reglas de transferencia estructural, cada una en un elemento \texttt{<\textbf{rule}>}.

\subsubsection{Elemento de regla \texttt{<rule>}}

Cada regla tiene un patrón (\texttt{<\textbf{pattern}>}) y la acción
(\texttt{<\textbf{action}>}) asociada que se ejecuta cuando es
detectado.

La regla puede especificar en un atributo opcional \texttt{comment}
un comentario que explique cuál es la función de la regla.

\subsubsection{Elemento de patrón \texttt{<pattern>}}

Un patrón se especifica utilizando componentes de patrón (\texttt{<\textbf{pattern-\\item}>}),
cada uno de los cuales corresponde a una forma léxica en el
patrón detectado, en orden de aparición.

\subsubsection{Elemento de componente de patrón \texttt{<pattern-item>}}

En cada componente de un patrón se indica, mediante un atributo de
nombre obligatorio \texttt{n}, qué tipo de forma léxica se quiere
detectar.  Para ello se utiliza una de las categorías definidas en
\texttt{<\textbf{section-def-cats}>} (véase un ejemplo de cómo se detecta el
patrón determinante--nombre en la figura \ref{fig:regla}).


\subsubsection{Elemento de acción \texttt{<action>}}

En este elemento se incluyen las ``instrucciones'' que se tienen que
ejecutar para llevar a cabo el procesamiento que se desee para cada
detección de patrones.

La parte de procesamiento del patron detectado es un bloque de cero o
más instrucciones de tipo: \texttt{<\textbf{choose}>} (procesamiento
condicional), \texttt{<\textbf{let}>} (asignación de valores),
\texttt{<\textbf{out}>} (escritura de formas léxicas de la LM),
\texttt{<\textbf{modify-case}>} (modificación del estado de las
mayúsculas y minúsculas de una forma léxica),
\texttt{<\textbf{call-macro}>} (llamadas a macroinstrucciones) y 
\texttt{<\textbf{append}>} (concatenación de cadenas).


Durante el procesamiento, según se cumplan o no una serie de opciones
condicionales, se realizan distintas operaciones, como por ejemplo la
concordancia de los elementos de un patrón, ya que éstos están sujetos
a posibles cambios de género o número durante el proceso de
transferencia léxica. Para ello, a pesar de trabajar con FL en LM
también se tiene en cuenta la información de la LO ya que si, por
ejemplo, en LO los elementos de un patrón no concuerdan, tal vez tampoco deben
hacerlo en LM. Durante la aplicación de las distintas operaciones
realizadas dentro un patrón, se asignan valores a atributos del patrón
y, en su caso, a variables globales o de estado y se envía la
información del patrón en LM resultante al siguiente módulo (el generador morfológico en un sistema de
transferencia sintáctica superficial, o bien un módulo posterior de transferencia
en un sistema de transferencia sintáctica avanzada).


\subsubsection{Elemento de llamada a macroinstrucción \\\texttt{<call-macro>}}

Dentro de una regla puede invocarse cualquiera de las
macroinstrucciones definidas en \texttt{<\textbf{section-def-macros}>}. Para
ello, hay que especificar el nombre de la macroinstrucción en el atributo \texttt{n} y uno o
más argumentos en el elemento de parámetros \texttt{<\textbf{with-param}>} (ver
a continuación).

\subsubsection{Elemento de parámetros \texttt{<with-param>}}

Este elemento se utiliza dentro de las llamadas a macroinstrucciones
\texttt{<\textbf{call-macro}>}. El atributo \texttt{pos} de cada argumento se
utiliza para referirse a una forma léxica de la regla que invoca la macroinstrucción. Por
ejemplo, si se ha definido una macroinstrucción de 2 parámetros que
realiza operaciones de concordancia nombre--adjetivo, puede utilizarse
con los argumentos 1 y 2 en una regla de nombre--adjetivo, con los
argumentos 2 y 3 en una regla de determinante--nombre--adjetivo, con
los argumentos 1 y 3 en una regla de nombre--adverbio--adjetivo y con
los argumentos 2 y 1 en una regla de adjetivo--nombre. Véase un
ejemplo de llamada a macroinstrucción en la figura \ref{fig:macro}.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{call-macro} n="f_concord2">
  <\textbf{with-param} pos="3"/>
  <\textbf{with-param} pos="1"/>
<\textbf{/call-macro}>
\end{alltt}
\end{small}
\caption{Llamada a la macroinstrución \texttt{f-concord2} para hacer
  concordar los elementos de un patrón como por ejemplo
  determinante--adverbio--nombre. La propagación de género y número se
  hace a partir de uno de los elementos, en este caso el nombre que
  aparece como tercer elemento del patrón (3). Por eso, la posición
  del nombre se pasa como primer parámetro y después se pasan el resto
  de elementos. Como el adverbio (en posición 2) no necesita
  información de concordancia, sólo se pasa la posición del
  determinante (1).}
\label{fig:macro}
\end{figure}



\subsubsection{Elemento de selección \texttt{<choose>}}
\label{choose}

La instrucción de selección se compone de una o más opciones
condicionales (\texttt{<\textbf{when}>}) y una opción alternativa
\texttt{<\textbf{otherwise}>}, de inclusión opcional.


\subsubsection{Elemento de condición \texttt{<when>}}

Con este elemento se describe una opción condicional (véase la página
\pageref{choose}).  Se compone de la condición a verificar
\texttt{<\textbf{test}>} y de un bloque de cero o más instrucciones de
tipo \texttt{<\textbf{choose}>}, \texttt{<\textbf{let}>},
\texttt{<\textbf{out}>}, \texttt{<\textbf{modify-case}>},
\texttt{<\textbf{call-macro}>} o \texttt{<\textbf{append}>}, \nota{OK append?} que se
ejecutarán si se cumple la citada condición.

\subsubsection{Elemento de opción alternativa \texttt{<otherwise>}}

El elemento \texttt{<\textbf{otherwise}>} contiene un bloque de una o
más instrucciones (de tipo \texttt{<\textbf{choose}>},
\texttt{<\textbf{let}>}, \texttt{<\textbf{out}>}, \texttt{<\textbf{modify-case}>},
\texttt{<\textbf{call-macro}>} y \texttt{<\textbf{append}>}) que deben realizarse si no se cumple
la condición descrita en ninguno de los \texttt{<\textbf{when}>} de un
\texttt{<\textbf{choose}>}.

\subsubsection{Elemento de evaluación \texttt{<test>}}

El elemento de evaluación \texttt{<\textbf{test}>} dentro de un
elemento de condición \texttt{<\textbf{when}>} puede estar compuesto
por una conjunción (\texttt{<\textbf{and}>}), una disyunción
(\texttt{<\textbf{or}>}) o una negación (\texttt{<\textbf{not}>}) de
condiciones a evaluar, así como por una simple condición de igualdad de cadenas
(\texttt{<\textbf{equal}>}), de principio de cadena (\texttt{<\textbf{begins-with}>}), de final de cadena (\texttt{<\textbf{ends-with}>}), de subcadena (\texttt{<\textbf{contains-substring}>}) o de inclusión en conjunto (\texttt{<\textbf{in}>}).

\nota{Segur que es pot millorar la redacció de l'últim paràgraf, canviat per mlf perquè hi estiguen totes les condicions booleanes simples.}

\subsubsection{Elementos de operadores condicionales o booleanos: \texttt{<equal>}, \texttt{<and>}, \texttt{<or>}, \texttt{<not>}, \texttt{<in>}}

\nota{Cal completar-ho: falten \texttt{contains-substring}, \texttt{ends-with}, \texttt{begins-with}, etc.}

\begin{itemize}
  
\item El elemento de conjunción \texttt{<\textbf{and}>} representa una
  condición, compuesta de dos o más condiciones, que se cumple cuando
  todas las condiciones en él incluidas son ciertas. Se puede ver un
  ejemplo de su uso en la figura \ref{fig:regla}

\item El elemento de disyunción \texttt{<\textbf{or}>} representa una
  condición, compuesta de dos o más condiciones, que se cumple cuando
  al menos una de ellas es cierta. En la figura \ref{fig:ornot} hay un
  ejemplo de este tipo de condición para evaluar la concordancia de
  género de un patrón en LO.
  
\item El elemento de negación \texttt{<\textbf{not}>} representa una
  condición que se cumple cuando la condición incluida no se cumple y
  viceversa. Se puede ver un ejemplo de negación de una igualdad en la
  figura \ref{fig:ornot}.

\item El operador condicional de igualdad
  \texttt{<\textbf{equal}>} es una instrucción que comprueba si dos
  argumentos (dos cadenas) son o no idénticos. Véase un ejemplo del
  uso de este elemento en las figuras \ref{fig:clip} y
  \ref{fig:lit-tag}.  En este operador, además, se puede especificar
  el atributo \texttt{caseless}, el cual, si tiene el valor
  \texttt{yes}, hace que la comparación entre cadenas se realice sin
  tener en cuenta las diferencias de mayúsculas y minúsculas.
\nota{Totes les comprovacions condicionals de cadenes tenen l'atribut \texttt{caseless}; \texttt{in} també; més avall}

\item El operador de búsqueda en listas, \texttt{<\textbf{in}>} sirve
  para buscar cualquier valor (que corresponde al primer parámetro de
  la condición) en una lista a la que se hace referencia mediante el
  atributo \texttt{n} del elemento \texttt{<\textbf{list}>} y que debe
  estar definida en la sección correspondiente
  (\texttt{<\textbf{section-\\def-lists}}).  El resultado de la búsqueda es cierto si
  el valor se encuentra en la lista.  En esta comparación se puede
  utilizar también el atributo \texttt{caseless}: si se le asigna el
  valor \texttt{yes}, se realiza la búsqueda en la lista sin tener en
  cuenta las diferencias de mayúsculas y minúsculas. En la figura
  \ref{fig:in} puede verse un ejemplo de su uso.
  
\end{itemize}

\nota{Cal unificar tota la discussió anterior, traient factor comú.}

\nota{Cal descriure la resta d'elements condicionals que no hi són.}


\subsubsection{Elemento \texttt{<clip>}}
\label{ss:clip}


El elemento \texttt{<\textbf{clip}>} representa una subcadena de una
forma léxica de la LO o de la LM,
definida por el valor de varios atributos (véase un ejemplo de uso en
la figura \ref{fig:clip}):

\begin{itemize}
\item \texttt{pos} es un índice (1, 2, 3, etc.) utilizado para
  seleccionar una forma léxica dentro de la regla: se corresponde con
  el lugar que ocupa la forma léxica en el patrón. En el módulo
  \textit{postchunk}, també existe el índice ``0'', que hace
  referencia al pseudolema del chunk, el cual es tratado como una
  palabra más para poder acceder a su información y tomar decisiones a
  partir de ella.

\item \texttt{side} \textit{(sólo en módulo \texttt{chunker})} especifica si
  se selecciona un \emph{clip} de la lengua de origen (\texttt{sl},
  por \emph{source language}) o de la lengua de destino (\texttt{tl},
  por \emph{target language}).
  
\item \texttt{part} indica qué parte de la forma léxica se procesa;
  generalmente su valor es uno de los atributos definidos en
  \texttt{<\textbf{section-def-\\attrs}>} (\texttt{gen}, \texttt{nbr},
  etc.), aunque también puede tomar cuatro valores predefinidos que
  son: \texttt{lem} (para hacer referencia al lema de la forma
  léxica), \texttt{lemh} (para hacer referencia a la primera parte de
  un lema partido), \texttt{lemq} (la cola del lema partido), y
  \texttt{whole} (la forma léxica completa, con el lema y todos los
  símbolos gramaticales, que pueden haber sido modificados en la parte
  precedente de la regla).

\item \texttt{link-to} \textit{(sólo en \texttt{chunker} en un sistema de
transferencia sintáctica avanzada)} sustituye
  el valor que se derivaría de la consulta del resto de atributos del
  clip por el valor especificado en este atributo, que ha de ser un
  número natural ($>0$). Este número indica con qué etiqueta
  \texttt{<\textbf{tag}>} del \texttt{<\textbf{chunk}>} se enlaza el
  contenido del clip, siendo el número el orden que ocupa esta
  etiqueta dentro de \texttt{<\textbf{tags}>}. El resto de atributos
  del clip quedan únicamente como información, pues son sobrescritos
  por el valor de la etiqueta enlazada. Puede verse un ejemplo de su
  uso en la figura \ref{fig:chunkintrachunk}.
   
\end{itemize}


\begin{figure}
\begin{small}
\begin{alltt}
    <\textbf{test}>
      <\textbf{not}>
        <\textbf{equal}>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="gen"/>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="sl" \textsl{part}="gen"/>
        <\textbf{/equal}>
      <\textbf{/not}>
    <\textbf{/test}>
\end{alltt}
\end{small}
\caption{Fragmento de una regla en la que se comprueba si el género (\texttt{gen}) en
  LM (\texttt{tl}) de la segunda unidad léxica identificada en un patrón es distinto
  del género de la misma unidad léxica en LO (\texttt{sl})}
\label{fig:clip}
\end{figure}



\subsubsection{Elemento de cadena literal \texttt{<lit>}}
Este elemento sirve para especificar el valor de una cadena literal
mediante el atributo \texttt{v}. Por ejemplo, \texttt{<\textbf{lit} v=\texttt{"}andar\texttt{"}/>}
representa la cadena \emph{andar}.


\subsubsection{Elemento de valor de etiqueta \texttt{<lit-tag>}}
Es similar al elemento \texttt{<\textbf{lit}>} pero no especifica el valor de una cadena literal sino el de
una etiqueta morfológica, mediante el atributo
\texttt{v}. Véase un ejemplo de su uso
en la figura \ref{fig:lit-tag}.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{equal}>
  <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="nbr"/>
  <\textbf{lit-tag} \textsl{v}="ND"/>
<\textbf{/equal}>
\end{alltt}
\end{small}
\caption{Uso del elemento \texttt{<\textbf{lit-tag}>}: se comprueba si
  la etiqueta (o símbolo) de número (\texttt{nbr}) de la segunda
  unidad léxica de la LM (\texttt{tl}) es \texttt{ND} (número por
  determinar)}
\label{fig:lit-tag}
\end{figure}
 
\begin{figure}
\begin{small}
\begin{alltt}
  <\textbf{test}>
    <\textbf{or}>
      <\textbf{not}> 
        <\textbf{equal}>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="sl" \textsl{part}="gen"/>
          <\textbf{clip} \textsl{pos}="3" \textsl{side}="sl" \textsl{part}="gen"/>
        <\textbf{/equal}>
      <\textbf{/not}>
      <\textbf{not}>
        <\textbf{equal}>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="sl" \textsl{part}="gen"/>
          <\textbf{clip} \textsl{pos}="3" \textsl{side}="sl" \textsl{part}="gen"/>
        <\textbf{/equal}>
      <\textbf{/not}>
    <\textbf{/or}>
  <\textbf{/test}>
\end{alltt}
\end{small}
\caption{Fragmento de una regla en la que se comprueba si el género en
  LO de la primera o de la segunda unidad léxica identificada en un
  patrón (podría ser determinante--adjetivo--nombre) es distinto del
  género de la tercera unidad léxica también en LO.}
\label{fig:ornot}
\end{figure}



\subsubsection{Elemento de variable \texttt{<var>}}


Cada \texttt{<\textbf{var}>} es un identificador de variable: el
atributo obligatorio \texttt{n} indica su nombre tal como se ha
definido en \texttt{<\textbf{section-def-vars}>}. Cuando se encuentra
en un \texttt{<\textbf{out}>}, un \texttt{<\textbf{test}>}, o la parte
derecha de un \texttt{<\textbf{let}>}, representa el valor de la
variable; cuando se encuentra en la parte izquierda de un
\texttt{<\textbf{let}>}, dentro de un \texttt{<\textbf{append}>} o en
un \texttt{<\textbf{modify-case}>}, representa la referencia de la
variable y se puede cambiar su valor.

\subsubsection{Elemento de referencia a lista de cadenas \texttt{<list>}}

Este elemento sólo se usa como segundo parámetro de una búsqueda
\texttt{<\textbf{in}>}.  El atributo \texttt{n} hace referencia a la
lista concreta definida en la sección de definición de listas de
cadenas \texttt{<section-def-lists>}. Véase un ejemplo de uso
en la figura \ref{fig:in}.


\begin{figure}
\begin{small}
\begin{alltt}
    <\textbf{rule}>
      <\textbf{pattern}>
        <\textbf{pattern-item} \textsl{n}="verb"/>
        <\textbf{pattern-item} \textsl{n}="a"/>
      <\textbf{/pattern}>
      <\textbf{action}>
      <\textbf{choose}>
        <\textbf{when}>
          <\textbf{test}>
            <\textbf{in} \textsl{caseless}="yes"/>
              <\textbf{clip} \textsl{pos}="1" \textsl{side}="sl" \textsl{part}="lem"/>
              <\textbf{list} \textsl{n}="verbos_est"/>
            <\textbf{/in}>
         <\textbf{/test}>
         <\textbf{let}>
           <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="lem"/>
           <\textbf{lit} \textsl{v}="en"/>
         <\textbf{/let}>
       <\textbf{/when}>
       <!-- ... --> 
\end{alltt}
\end{small}
\caption{Fragmento de una regla que detecta un patrón formado por un
  verbo más la preposición \emph{a} y a continuación comprueba si el
  verbo (el lema indicado en \texttt{lem}) de la lengua origen
  (\texttt{sl}) es uno de los que se han incluido en la lista de
  verbos de estado (definida en la figura \ref{fig:deflist}). En caso
  afirmativo, el lema de la segunda palabra de la lengua meta
  (\texttt{tl}) se cambia por \emph{en}.}
\label{fig:in}
\end{figure}


\subsubsection{Elemento de información de mayúsculas/mi\-nús\-cu\-las\\  \texttt{<get-case-from>}}

El elemento \texttt{<\textbf{get-case-from}>} representa la cadena
resultante de aplicar el esquema de mayúsculas que presenta el lema de
una unidad léxica en LO a una cadena (\emph{clip}, \emph{lit} o
\emph{var}).  Para hacer referencia a la unidad léxica de la que se
tomará la información, se utiliza el atributo \texttt{pos} que indica
la posición de dicha unidad léxica en LO. Se utiliza cuando se
reordenan las unidades léxicas de un patrón o cuando se añade o se
suprime una unidad léxica. Puede verse un ejemplo de uso en la figura
\ref{fig:case}, que contiene una regla para transformar el pretérito
perfecto simple español (\emph{dije}) por el pretérito perfecto
perifrástico catalán (\emph{vaig dir}). En esta regla se añade una FL
con lema \emph{anar} y símbolo morfológico \emph{vaux} ("verbo
auxiliar"), el cual debe tomar la información de mayúsculas del verbo
en español (que tiene la posición "1" en el patrón), para que se
traduzca \emph{Dije} por \emph{Vaig dir}, \emph{dije} por \emph{vaig
  dir} y \emph{DIJE} por \emph{VAIG DIR}.


\subsubsection{Elemento de obtención del patrón de mayúsculas/mi\-nús\-cu\-las\\ \texttt{<case-of>}}

Sirve para obtener el patrón de mayúsculas/minúsculas, es decir, uno
de los valores "\texttt{aa}", "\texttt{Aa"} o "\texttt{AA}", de una
cadena, que se obtiene como en el caso de la etiqueta
\texttt{<\textbf{clip}>}, pues tiene los mismos atributos:
\texttt{pos}, la posición que ocupa la palabra en el patrón detectado;
\texttt{part}, el atributo concreto al que
se hace referencia (normalmente el lema), con los atributos
predefinidos que ya se mencionan en la página \pageref{ss:clip}, y, sólo en
el caso del módulo \texttt{chunker}, el atributo
\texttt{side}, el lado de la traducción, \texttt{sl} para la LO y
\texttt{tl} para la LM. En la figura
\ref{fig:case} puede verse un ejemplo de utilización de este elemento,
y en el apartado siguiente (la explicación de
\texttt{<\textbf{modify-case}>}) se encuentra una explicación más
detallada del ejemplo.


\subsubsection{Elemento de modificación de estado de \\mayúsculas/minúsculas \texttt{<modify-case>}}
Esta instrucción sirve para modificar las mayúsculas o minúsculas de
la primera expresión (el primer parámetro, típicamente un lema)
mediante un literal o una variable (el segundo parámetro). El primer
parámetro puede ser una \texttt{<\textbf{var}>}, un
\texttt{<\textbf{clip}>} o un \texttt{<\textbf{case-of}>}, mientras
que el segundo puede ser cualquier cosa que devuelva un valor, pero en
principio será \texttt{<\textbf{var}>} o \texttt{<\textbf{lit}>}.  Los
valores que puede tomar este valor suelen ser ``\texttt{Aa}'' para
expresar que la ``parte izquierda'' de esta modificación de las
mayúsculas debe tener la primera letra en mayúsculas y el resto en
minúsculas, ``\texttt{aa}'' para poner todo en minúsculas y
``\texttt{AA}'' para poner todo en mayúsculas. 

En la figura
\ref{fig:case} puede verse un ejemplo de su utilización. En esta regla
se modifica el estado de mayúsculas del lema en LM en posición "1",
que corresponde a \emph{dir}, puesto que, aunque a la salida de la
regla sea la segunda forma léxica (\emph{vaig dir}), es la traducción
de la FL que tiene la posición 1 en la LO, y por lo tanto sigue
teniendo asignada esta posición en la LM. A este lema se le asigna el
valor ``\texttt{aa}'' en caso de que el lema en LO tenga el estado
``\texttt{Aa}''. En los demás casos no hay que especificar nada, pues
el estado de mayúsculas/minúsculas en la FL con posición 1 coincidirá
en la LO y en la LM y, por lo tanto, se transfiere automáticamente
(véase la página~\pageref{mayusc} para más información sobre la
gestión de mayúsculas y minúsculas en los diccionarios).


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{rule}>
  <\textbf{pattern}>
    <\textbf{pattern-item} n="pretind"/>
  <\textbf{/pattern}>
  <\textbf{action}>
    <\textbf{out}>
      <\textbf{lu}>
         <\textbf{get-case-from} pos ="1">
           <\textbf{lit} v="anar"/>
         <\textbf{/get-case-from}>
         <\textbf{lit-tag} v="vaux"/>
         <\textbf{clip} pos="1" side="sl" part="persona"/>
         <\textbf{clip} pos="1" side="sl" part="nbr"/>
       <\textbf{/lu}>
       <\textbf{b/}>
     <\textbf{/out}>
     <\textbf{choose}>
       <\textbf{when}>
         <\textbf{test}>
           <\textbf{equal}>
              <\textbf{case-of} pos="1" side="sl" part="lemh"/>
              <\textbf{lit} v="Aa"/>
           <\textbf{/equal}>
         <\textbf{/test}>
         <\textbf{modify-case}>
             <\textbf{case-of} pos="1" side="tl" part="lemh"/>
             <\textbf{lit} v="aa"/>
         <\textbf{/modify-case}>
       <\textbf{/when}>
     <\textbf{/choose}>
     <\textbf{out}>
       <\textbf{lu}>
          <\textbf{clip} pos="1" side="tl" part="lemh"/> 
          <\textbf{clip} pos="1" side="tl" part="a_verb"/>
          <\textbf{lit-tag} v="inf"/>
          <\textbf{clip} pos="1" side="tl" part="lemq"/>
       <\textbf{/lu}>
    <\textbf{/out}>
  <\textbf{/action}>
<\textbf{/rule}>
\end{alltt}
\end{small}
\caption{Regla para traducir de español a catalán que transforma los verbos
  en pretérito perfecto simple o indefinido (\emph{dije}) en la forma
  de pretérito perfecto perifrástico usual en catalán (\emph{vaig
    dir}), al mismo tiempo que se asigna la información correcta de
  mayúsculas/minúsculas a las dos palabras resultantes.}
\label{fig:case}
\end{figure}



\subsubsection{Elemento de asignación \texttt{<let>}}

La instrucción de asignación \texttt{<\textbf{let}>} asigna el valor
de la parte derecha de la asignación (una cadena literal, un \texttt{clip}, una
variable, etc.) a la parte izquierda (un \texttt{clip}, una variable,
etc.). Véase un ejemplo de uso en la figura \ref{fig:regla}.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{rule}>
  <\textbf{pattern}>
    <\textbf{pattern-item} n="det"/>
    <\textbf{pattern-item} n="nom"/>
  <\textbf{/pattern}>
  <\textbf{action}>
      <\textbf{choose}>
        <\textbf{when}>
          <\textbf{test}>
            <\textbf{and}>
              <\textbf{not}>
                <\textbf{equal}>
                  <\textbf{clip} pos="2" side="tl" part="gen"/>
                  <\textbf{clip} pos="2" side="sl" part="gen"/>
                <\textbf{/equal}>
              <\textbf{/not}>
              <\textbf{not}>
                <\textbf{equal}>
                  <\textbf{clip} pos="2" side="tl" part="gen"/>
                  <\textbf{lit-tag} v="mf"/>
                <\textbf{/equa}l>
              <\textbf{/not}>
              <\textbf{not}>
                <\textbf{equal}>
                  <\textbf{clip} pos="2" side="tl" part="gen"/>
                  <\textbf{lit-tag} v="GD"/>
                <\textbf{/equal}>
              <\textbf{/not}>
            <\textbf{/and}>
          <\textbf{/test}>
          <\textbf{let}>
            <\textbf{clip} pos="1" side="tl" part="gen"/>
            <\textbf{clip} pos="2" side="tl" part="gen"/> 
          <\textbf{/let}>
        <\textbf{/when}>
      <\textbf{/choose}>
      <!-- Otras operaciones de concordancia de género y número --> 
\end{alltt}
\end{small}
\caption{Fragmento de una regla en la que el patrón detectado es
  determinante--nombre (continúa en la fig. \ref{fig:regla2}): en esta parte de la regla,
  se asigna el género del nombre al determinante en
  caso de que el nombre cambie de género entre la LO (\texttt{sl}) y la
  LM (\texttt{tl}) durante el proceso de transferencia léxica entre
  ambas lenguas.}
\label{fig:regla}
\end{figure}

\subsubsection{Elemento de concatenación de cadenas \texttt{<concat>}} 

Este elemento se usa para concatenar cadenas para asignarlas a una
variable. Se usa de manera combinada con \texttt{<\textbf{let}>}, y el
valor anterior de la variable que se modifica con la asignación de
\texttt{<\textbf{concat}>}, se pierde.

No tienen ningún atributo. Puede contener qualquier instrucción que devuelva una
cadena, como \texttt{<\textbf{lit}>}, \texttt{<\textbf{lit-tag}>} o
\texttt{<\textbf{clip}>}.

En la figura \ref{fig:concat} puede verse un ejemplo de uso.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{let}>    
  <\textbf{var} n="palabra"/>
    <\textbf{concat}>
       <\textbf{clip} pos="3" side="tl" part="lem"/>  
       <\textbf{lit-tag} v="adj"/>
    <\textbf{/concat}>
<\textbf{/let}>   
\end{alltt}
\end{small}
\caption{En este ejemplo se atribuye a la variable \texttt{palabra} el valor
de la concatenación de un \texttt{clip} (el lema de la posición 3) y una etiqueta \emph{adj}.}
\label{fig:concat}
\end{figure}




\subsubsection{Elemento de concatenación de cadenas \\\texttt{<append>}}

La instrucción \texttt{<\textbf{append}>} puede utilizarse para almacenar la salida
de una acción antes de imprimirla en el \texttt{<\textbf{out}>} correspondiente, por conveniencia del diseñador de las
reglas de transferencia.

El atributo obligatorio \texttt{n} especifica el nombre de variable que tiene
la expresión. Al final de la instrucción, el contenido antiguo de la
variable referenciada será prefijo del nuevo contenido, es decir, el nuevo
contenido indicado dentro de \texttt{<\textbf{append}>} se concatenará al contenido preexistente
en la variable indicada en  \texttt{n}.

El contenido de esta instrucción puede ser una o más de las siguientes
etiquetas: \texttt{<\textbf{b}>}, \texttt{<\textbf{clip}>},
\texttt{<\textbf{lit}>}, \texttt{<\textbf{lit-tag}>},
\texttt{<\textbf{var}>}, \texttt{<\textbf{get-case-from}>},
\texttt{<\textbf{case-of}>} o \texttt{<\textbf{concat}>}. Se puede ver
un ejemplo en la figura \ref{fig:append}.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{append} n="temporal">    
  <clip pos="3" part="gen" side="tl"/>    
<\textbf{/append}>
\end{alltt}
\end{small}
\caption{En este ejemplo se concatena a la variable
  \texttt{temporal} el valor de género de la parte de LM de la tercera
  palabra detectada por la regla.}
\label{fig:append}
\end{figure}




\subsubsection{Elemento de salida \texttt{<out>}}
\label{ss:out}
En la instrucción de salida se especifican las formas léxicas que se
envían a la salida del módulo tras haber sido sometidas a las
operaciones de transferencia estructural pertinentes. El uso de este
elemento varía según el módulo. Por un lado, el uso en el módulo
\texttt{chunker} cuando funciona como único módulo (transferencia sintáctica superficial)
y en el módulo \texttt{postchunk} son similares, pues la salida que hay
que imprimirse en los dos casos será la entrada del generador. 
El módulo \texttt{chunker} en Apertium 2 y el módulo \texttt{interchunk} tienen
modos de uso diferentes: el primero para crear los segmentos y el segundo
para modificar los segmentos sin modificar su parte interna.

\begin{enumerate}

\item \textbf{Uso en \texttt{chunker} como módulo único y en \texttt{postchunk}}

  La instrucción envía cada forma léxica dentro de un conjunto
  \texttt{<\textbf{lu}>}, que a su vez puede estar contenido dentro de
  un elemento \texttt{<\textbf{mlu}>} si lo que se envía es una
  multipalabra compuesta de dos o más FL. Además, se envían también
  los espacios en blanco o superblancos (\texttt{<\textbf{b}>}) que
  haya que colocar entre FL y FL. En las figuras \ref{fig:case} y
  \ref{fig:regla2} puede verse un ejemplo de uso.

\begin{figure}
\begin{small}
\begin{alltt}
    <!-- ... -->
    <\textbf{out}>
      <\textbf{lu}>
         <\textbf{clip} pos="1" side="tl" part="whole"/> 
      <\textbf{/lu}>
      <\textbf{lu}>
         <\textbf{clip} pos="2" side="tl" part="whole"/>
      <\textbf{/lu}>
    <\textbf{/out}>
  <\textbf{/process}>
 <\textbf{/action}>
<\textbf{/rule}>
\end{alltt}
\end{small}
\caption{Fragmento de una regla (viene de la fig. \ref{fig:regla}). Al
  final de la regla, y tras varias operaciones, se da salida a la
  información resultante mediante el atributo \texttt{whole}, que
  contiene el lema y los símbolos morfológicos de cada FL (posiciones
  1 y 2 del patrón).}
\label{fig:regla2}
\end{figure}


\item \textbf{Uso en \texttt{chunker} en un sistema de transferencia avanzada}

  La salida de este módulo se espera que sea una secuencia de uno o
  más chunks (enviados con el elemento \texttt{<\textbf{chunk}>})
  separados por blancos \texttt{<\textbf{b}>}. Las formas léxicas y multiformas
  léxicas, así como los blancos entre las mismas, se envían dentro de
  los chunks. En la figura \ref{fig:chunkintrachunk} se puede ver su
  uso.


\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{out}>
  <\textbf{chunk} name="pr" case="caseFirstWord">
    <\textbf{tags}>
      <\textbf{tag}><\textbf{lit-tag} v="PREP"/><\textbf{/tag}>
    <\textbf{/tags}>
    <\textbf{lu}>   
      <\textbf{clip} pos="1" side="tl" part="whole"/> 
    <\textbf{/lu}> 
  <\textbf{/chunk}>	  
  <\textbf{b} pos="1"/>
  <\textbf{chunk} name="probj" case="caseOtherWord">
    <\textbf{tags}>
      <\textbf{tag}><\textbf{lit-tag} v="SN"/><\textbf{/tag}>
      <\textbf{tag}><\textbf{lit-tag} v="tn"/><\textbf{/tag}>
      <\textbf{tag}><\textbf{clip} pos="2" side="tl" part="pers"/><\textbf{/tag}>
      <\textbf{tag}><\textbf{clip} pos="2" side="tl" part="gen"/><\textbf{/tag}>
      <\textbf{tag}><\textbf{clip} pos="2" side="tl" part="nbr"/><\textbf{/tag}>
    <\textbf{/tags}>
    <\textbf{lu}>  
      <\textbf{clip} pos="2" side="tl" part="lem"/>
      <\textbf{lit-tag} v="prn"/>
      <\textbf{lit-tag} v="2"/>
      <\textbf{clip} pos="2" side="tl" part="pers"/>
      <\textbf{clip} pos="2" side="tl" part="gen" link-to="4"/>
      <\textbf{clip} pos="2" side="tl" part="nbr" link-to="5"/>
    <\textbf{/lu}>
  <\textbf{/chunk}>
<\textbf{/out}>
\end{alltt}
\end{small}
\caption{Instrucción de salida que imprime dos segmentos separados por
  un blanco. La secuencia que se imprime es la de preposición seguida
  de sintagma nominal. Las etiquetas que se enlazan a fuera como
  referencia son la persona, el género y el número del sintagma
  nominal. Usa las etiquetas \texttt{<\textbf{tag}>} para especificar
  las etiquetas del segmento, y el valor de los atributos \texttt{name} y
  \texttt{case} para especificar la forma léxica del chunk.}
\label{fig:chunkintrachunk}
\end{figure}


\item \textbf{Uso en \texttt{interchunk}}

  En este módulo, las formas léxicas de las palabras son inaccesibles, pues
  sólo son posibles las operaciones con los chunks y, por
  lo tanto, dentro de un elemento \texttt{<\textbf{out}>} sólo puede
  haber elementos \texttt{<\textbf{chunk}>} o blancos
  \texttt{<\textbf{b}>}.  La información de lema y de etiquetas que
  hay dentro del elemento \texttt{<\textbf{chunk}>} corresponde al
  lema del chunk y a las etiquetas del chunk exclusivamente.

Se puede ver un ejemplo de uso en la figura \ref{fig:chunkinterchunk}.

\begin{figure}
\begin{small}
\begin{alltt}
<\textbf{out}>
  <\textbf{b} pos="1">
  <\textbf{chunk}>
    <\textbf{clip} pos="2" part="lem"/>
    <\textbf{clip} pos="2" part="tags"/>
    <\textbf{clip} pos="2" part="chcontent"/>
  <\textbf{/chunk}>
<\textbf{/out}>
\end{alltt}  

\end{small}
\caption{Esta salida se ha hecho para descartar el primer chunk de una
  regla (caída de pronombre). El uso de los tres elementos
  \texttt{<\textbf{clip}>} se ha hecho aquí con fines ilustrativos, puesto que se habrían
  podido sustituir por la \texttt{part="whole"} que los agruparía en un 
  único \texttt{<\textbf{clip}>} .}
\label{fig:chunkinterchunk}
\end{figure}


\end{enumerate}




\subsubsection{Elemento de unidad léxica \texttt{<lu>}}
\label{ss:lu}
Su nombre proviene de \emph{lexical unit} o ``unidad léxica'' y es el
elemento mediante el que se envía cada forma léxica del patrón en
lengua meta a la salida de la regla, dentro del elemento
\texttt{<\textbf{out}>}.  Mediante este elemento puede enviarse la forma léxica
completa, con el atributo \texttt{whole} de un \texttt{<\textbf{clip}>}, o
bien, en caso necesario, indicar explícitamente cada una de sus partes
(lema más etiquetas, especificadas mediante cadenas \texttt{<\textbf{clip}>},
cadenas literales \texttt{<\textbf{lit}>}, etiquetas \texttt{<\texttt{\textbf{lit-tag}}>},
variables \texttt{<\texttt{\textbf{var}}>}, así como información de mayúsculas y
minúsculas [\texttt{<\textbf{get-case-from}>}, \texttt{<\textbf{case-of}>}]).



Hay que tener en cuenta que, como se ha explicado antes, en el caso de
las multipalabras con \emph{lema partido} hay que resituar la cola de un lema
multipalabra detrás de los símbolos gramaticales de la palabra
flexionada (o cabeza del lema), ya que el módulo \texttt{pretransfer} ha adelantado la cola y
la ha colocado antes de los símbolos gramaticales de la cabeza.
Esta recolocación se realiza aquí, dentro del elemento
\texttt{<\textbf{lu}>}, mediante los valores \texttt{lemh} y
\texttt{lemq} del atributo \texttt{part} de un \texttt{<\textbf{clip}>}. El atributo
\texttt{lemh} corresponde a la cabeza de lema, y el atributo
\texttt{lemq}, a la cola del lema. Como se ve en el ejemplo
\ref{fig:case}, la parte \texttt{lemq} del \texttt{<\textbf{clip}>} se
coloca detrás de la cabeza del lema y de los símbolos gramaticales que
la acompañan.  Esta regla serviría, por ejemplo, para la forma en
español \emph{eché de menos}, que debe traducirse al catalán por
\emph{vaig trobar a faltar}. El atributo \texttt{a\_verb} que aparece
detrás de \texttt{lemh} contiene el símbolo gramatical que describe la categoría del verbo
(\emph{vblex}, \emph{vbser}, \emph{vbhaver} o \emph{vbmod} según el caso). Así, la
última forma léxica enviada por esta regla, para el caso de \emph{vaig trobar a faltar},
sería en el flujo de datos: 
\begin{alltt}  ^trobar<vblex><inf># a faltar\$ \end{alltt}

\noindent El símbolo almohadilla del flujo de datos se corresponde con el elemento \texttt{<\textbf{g}>}
de los diccionarios, utilizado para indicar la posición de las partes invariables de una
unidad multipalabra con lema partido.

Es importante tener en cuenta que los atributos que se incluyen dentro
de \texttt{<\textbf{lu}>} pueden estar vacíos. Así, un verbo que entre
por la regla de la figura \ref{fig:case} y que no sea una multipalabra
con lema partido, será enviado con el atributo \texttt{lemq} vacío,
puesto que no tiene cola de lema. De este modo no hay que definir
reglas diferentes para formas léxicas con cola y sin cola. Puede verse
también otro ejemplo en la página \pageref{regla_verbo1}, en que la
regla para verbo envía con \texttt{<\textbf{lu}>} los atributos
\texttt{gen} (\emph{género}) y \texttt{nbr} (\emph{número}). De este modo
se incluyen los participios (con género y número) y las demás formas verbales (que
llevarán estos atributos vacíos).

En la misma página puede verse una regla para verbo seguido de pronombre enclítico. Aquí,
la cola del lema se coloca detrás del pronombre enclítico; así, las formas 
léxicas enviadas en el caso de una multipalabra unida a un pronombre enclítico, como
\emph{echándote de menos}, serían, en el flujo de datos y traduciendo al catalán: 

\begin{alltt} ^trobar<vblex><ger>+et<prn><enc><p2><mf><sg># a faltar\$ \end{alltt}

Por supuesto, esta regla sirve también para verbos que no sigan este
patrón de multipalabra, de modo que la forma \emph{explicándote} sería
así enviada por la regla en la traducción de español a catalán:


\begin{alltt} ^explicar<vblex><ger>+et<prn><enc><p2><mf><sg>\$ \end{alltt}

En cuanto al atributo \texttt{whole} de un \texttt{<\textbf{clip}>},
es importante tener en cuenta que sólo puede utilizarse para enviar la
forma léxica completa en caso de que la palabra enviada no pueda ser
una multipalabra, es decir, no pueda contener un lema partido.
Compárense las figuras \ref{fig:case} y \ref{fig:regla2}. El atributo
\texttt{whole} puede utilizarse en el segundo ejemplo porque contiene
el lema \texttt{lem} más todas las etiquetas morfológicas de las
formas léxicas en posición 1 y 2 (determinante y nombre). En cambio,
en el primer ejemplo, la forma léxica enviada dentro de
\texttt{<\textbf{lu}>} se envía por partes, con un \texttt{lemh}
(cabeza del lema) y un \texttt{lemq} (cola del lema), puesto que puede
ser que el verbo detectado en el patrón sea una multipalabra con lema
partido. En la práctica, esto significa que, en nuestro sistema, el
atributo \texttt{whole} puede utilizarse para enviar cualquier tipo de
forma léxica excepto los verbos y los nombres, puesto que sólo hemos
definido multipalabras con flexión para formas verbales y nombres.

\subsubsection{Elemento de unidad léxica \texttt{<mlu>}}
\label{ss:mlu}

Su nombre proviene de \emph{multilexical unit} o ``multiforma léxica''
y se utiliza dentro del elemento \texttt{<\textbf{out}>} para enviar
multipalabras compuestas por más de una forma léxica. Cada forma
léxica de una \texttt{<\textbf{mlu}>} se envía dentro de un elemento
\texttt{<\textbf{lu}>}. A la salida del módulo, las formas léxicas
contenidas dentro de este elemento aparecerán unidas entre sí mediante
el símbolo '+' del flujo de datos. Esto significa que se convertirán en
una multipalabra compuesta por varias formas léxicas y que serán
tratadas como una unidad por los módulos subsiguientes; por lo tanto,
en el diccionario de generación deberá existir una entrada para esta
multipalabra para que sea posible generarla.

En nuestro sistema, este elemento se utiliza para unir los pronombres enclíticos a los verbos
conjugados.

\subsubsection{Elemento de encapsulamiento de segmento \texttt{<chunk>}}

Es el elemento con el que se envían los chunks a la salida del módulo
dentro de un elemento \texttt{<\textbf{out}>}.  Este elemento sólo
está definido en los módulos \texttt{chunker} e \texttt{interchunk}.
En el módulo \texttt{postchunk} no se usa porque no es necesario crear
ningú chunk a la salida.

\begin{enumerate}

\item \textbf{Uso en el módulo chunker}


En este modo, el elemento \texttt{<\textbf{chunk}>} debe tener un atributo
\texttt{name} que es el lema del segmento, o bien un atributo \texttt{namefrom}
que hace referencia a una variable previamente definida, el valor de la cual se usará
como lema del segmento. Además, puede incorporar un atributo \texttt{case} para
especificar de qué variable se toma la política de mayúsculas (con un valor obtenido
con la instrucción  \texttt{<\textbf{case-from}>}, por ejemplo).

Se puede ver un ejemplo de uso del elemento en la figura
\ref{fig:chunkintrachunk}.


\item \textbf{Uso en el módulo interchunk}

  En este módulo, el elemento \texttt{<\textbf{chunk}>} no especifica
  ningún atributo, sólo se usa del modo en que se usa
  \texttt{<\textbf{lu}>} en el transfer superficial o en el
  \texttt{postchunk} para deliminar la forma léxica.  Dentro de él se
  envían (generalmente con una instrucción de
  \texttt{<\textbf{clip}>})
\nota{MG: generalmente o sempre}, el lema del chunk (\texttt{lem}), las
  etiquetas (\texttt{tags}) y el contenido del chunk
  (\texttt{chcontent}, contiene las FL más los blancos), que es una
  parte invariable pues en el módulo \texttt{interchunk} no se puede
  acceder a él.  La parte invariable del segmento se envía al final.
  También puede utilizarse el atributo \texttt{whole} para enviar el
  chunk entero (lema, etiquetas y contenido invariable).

  Se puede ver un ejemplo de uso del elemento en la figura
  \ref{fig:chunkinterchunk}.

\end{enumerate}

\subsubsection{Elemento de sección de enlace de etiquetas \texttt{<tags>}}

\textit{Sólo en chunker con transferencia sintáctiva avanzada}. 

Este elemento sirve para especificar una lista de etiquetas o
elementos \texttt{<\textbf{tag}>} que serán las pseudoetiquetas del
chunk. No tiene atributos, y debe especificarse como primer elemento
dentro del elemento \texttt{<\textbf{chunk}>}. Véase la
figura \ref{fig:chunkintrachunk}.


\subsubsection{Elemento de enlace de etiquetas \texttt{<tag>}}

\textit{Sólo en chunker con transferencia sintáctiva avanzada}. 

El elemento  \texttt{<\textbf{tag}>} tiene que contener una
una etiqueta morfológica, que se puede especificar mediante una
instrucción \texttt{<\textbf{clip}>} o bien una etiqueta literal
\texttt{<\textbf{lit-tag}>}. No tiene atributos.

La etiqueta o las etiquetas especificadas de esta manera dentro de un chunk
pasarán a ser las etiquetas morfológicas del segmento, que
el módulo siguiente, \texttt{interchunk}, podrá utilizar
para realizar comprobaciones y modificaciones en las características
de los segmentos.


\subsubsection{Elemento de blanco \texttt{<b>}}

El elemento \texttt{<\textbf{b}>} hace referencia a los [super]blancos, y se indexa
mediante el atributo \texttt{pos}; por ejemplo, un \texttt{<\textbf{b}>}
con \texttt{pos="2"} se refiere a los [super]blancos (incluidos los
datos de formato encapsulados por el desformatador) entre la 2ª FLLO y
la 3ª FLLO. La gestión explícita de [super]blancos permite la
colocación correcta del formato cuando el resultado de la
transferencia estructural tiene más o menos elementos léxicos que el
original o bien ha sido sometido a algún tipo de reordenación.


\subsection{Formato de las reglas en los tres módulos del sistema de transferencia avanzada}
\label{noutransfer}

A continuación se describen las características diferenciadas del formato
de los reglas en los tres módulos de un sistema
de transferencia sintáctica avanzada. Cuando Apertium funcione con un sistema
de transferencia sintáctica superficial, sólo entra en acción el
primero módulo, llamado \texttt{chunker}, que se comunica con el
módulo de generación.


\subsubsection{Programa \texttt{chunker} (\texttt{transfer})}
\label{ss:chunker}

El funcionamiento es básicamente similar al actual módulo de transferencia de Apertium \nota{canviar referència a ``l'actual
mòdul de transferència d'Apertium''},
con las siguientes incorporaciones:

\begin{itemize}
\item Especificación de la acción implícita en el elemento raíz
  \texttt{<transfer>}. Este elemento tiene el atributo opcional
  \texttt{default} que puede tener los valores \texttt{lu} (valor por
  defecto) o \texttt{chunk} dependiendo de si se quiere que el transfer
  funcione a la manera de Apertium 1 (transferencia sintáctica
  superficial) o de Apertium 2 (transferencia sintáctiva avanzada),
  respectivamente.
\item Atributo \texttt{comment} (opcional) para los elementos
  \texttt{<rule>}. Las reglas tendrán a partir de ahora un comentario que
  permitirá incluir información que se usará para documentación.
\item Generación de segmentos (chunks): la etiqueta \texttt{<chunk>} es una etiqueta de un nivel más alto
  que \texttt{<lu>} (\textit{lexical unit}) que
  permite generar segmentos con las características que han sido
  especificadas en \ref{sec:format}; tiene los siguientes atributos:

  \begin{itemize}
  \item \texttt{name} (opcional): pseudolema del segmento. Una
    cadena que permita identificar el pseudolema del segmento.

  \item \texttt{namefrom} (opcional): pseudolema del segmento, obtenido
    de una variable. Es obligatorio especificar o \texttt{name} o 
    \texttt{namefrom}.

  \item \texttt{case} (opcional): variable que sirve para obtener
    la información de mayúsculas o minúsculas de una variable y aplicarla
    al lema especificado bien por \texttt{name}, bien por
    \texttt{namefrom}.
  \end{itemize}

\item  Cada chunk empieza por una instrucción \texttt{<tags>}, que
  no permite especificar ningún atributo, la cual, por su parte, contiene una
  o más instrucciones individuales \texttt{<tag>}.
\item  Las instrucciones \texttt{<tag>} no tienen atributos. Dentro de ellas
  se puede poner cualquier instrucción que devuelva como valor una cadena:
  \texttt{<lit>}, \texttt{<var>}.
\item Las instrucciones \texttt{<clip>} tienen un nuevo atributo opcional:
  \texttt{link-to}, que sirve para especificar una etiqueta
  \verb!<!\textit{valor de link-to}\verb!>! en lugar de 
\nota{Es ``en lugar de'' o ``adicionalmente a''?}
la información
  que contenga el \texttt{<clip>} en los demás atributos.\nota{No s'entén gaire bé}
  Esta información es prescindible pero puede servir como
  documentación del origen de la decisión lingüística.
\end{itemize}

Veamos con un ejemplo el uso del elemento \texttt{<chunk>}:

\begin{alltt}
<out>
  <chunk name="adj-nom" case="variableCase">
    <tags>
      <tag><lit-tag v="SN"/></tag>
      <tag><clip pos="2" side="tl" part="gen"/></tag>
      <tag><clip pos="2" side="tl" part="nbr"/></tag>
    </tags>
    <lu>
      <clip pos="2" side="tl" part="lemh"/> 
      <clip pos="2" side="tl" part="a_nom"/>
      <clip pos="2" side="tl" part="gen" link-to="2"/>
      <clip pos="2" side="tl" part="nbr" link-to="3"/>
    </lu>
    <b pos="1"/>
    <lu>  
      <var n="adjectiu"/> 
      <clip pos="1" side="tl" part="lem"/>  
      <clip pos="1" side="tl" part="a_adj"/>
      <clip pos="2" side="tl" part="gen" link-to="2"/>
      <clip pos="2" side="tl" part="nbr" link-to="3"/>
    </lu> 
  </chunk>
</out>
\end{alltt}



\subsubsection{Programa \texttt{interchunk}}

Las modificaciones en el juego de instrucciones de este módulo ---respecto del
juego de instrucciones utilizado en
\texttt{chunker}--- son las siguientes:

\begin{itemize}
\item El elemento raíz se llama \texttt{<interchunk>} y no especifica ningún
  atributo.
\item Desaparición del atributo \texttt{side}: este módulo no usa
  diccionarios bilingües; por lo tanto el atributo que indica si la parte
  que se consulta es la lengua origen o la meta no tiene sentido. Este
  atributo era usado fundamentalmente en las instrucciones \texttt{<out>}.
\item La etiqueta \texttt{<chunk>} ahora se usa sin atributos,
  sencillamente dentro de \texttt{<out>} para delimitar la salida de segmentos.
\item El atributo predefinido \texttt{lem} hace referencia al pseudolema
  del segmento. De la misma manera, el atributo predefinido
  \texttt{tags} hace referencia a las etiquetas del segmento. El
  contenido del segmento queda como una cola que se puede imprimir
  mediante el atributo implícito \texttt{chcontent}.\nota{Només imprimir o s'hi pot fer referència també?}
\nota{Dir de quin element són aquests atributs}
\item Todos los valores de \texttt{part}, excepto \texttt{chname},
  acceden a la información del lema y las etiquetas del
  pseudolema de cada segmento.
\item A diferencia de lo que sucede en el módulo \texttt{chunker}, no
se permite imprimir otra cosa que \texttt{<chunk>}s en las
  instrucciones \texttt{<out>} en el fichero de especificación del
  comportamiento de este módulo, y en ningún caso palabras sueltas.
\end{itemize}


\subsubsection{Programa \texttt{postchunk}}


Las diferencias en las acciones en comparación con
\texttt{in\-ter\-chunk} son las siguientes:

\begin{itemize}
\item Prohibición de la escritura de segmentos (\texttt{<chunk>}s) a
  la salida: sólo se pueden escribir unidades léxicas (\texttt{<lu>} o
  \texttt{<mlu>}) y blancos.  \nota{Comprovar aquest ítem perquè era
    incomplet i l'ha completat mlf}
\item Nuevo atributo de detección \texttt{name} de \texttt{<cat-item>},
  que se usa en la parte de \texttt{<pattern>} de las reglas de manera
  aislada, para forzar la detección de los patrones por su nombre.
\nota{Què vol dir ``de manera aïllada''? Sembla que vulga dir ``de tant en tant''}
\item Tampoco existe el atributo \texttt{side} en los elementos a los que
  es aplicable en el módulo \texttt{in\-ter\-chunk}, por
  la misma razón por que en \texttt{in\-ter\-chunk} no
  se accede al diccionario bilingüe.
\nota{MG: però llavors això no és una diferència respecte de \texttt{interchunk} no?}
\end{itemize}



\subsection{Preproceso del módulo de transferencia estructural}

Los ficheros de especificación de los módulos de transferencia
estructural, también llamados \emph{ficheros de reglas de
  transferencia}, son preprocesados por el programa
\textit{apertium-preprocess-transfer} que calcula los patrones para
casar precondiciones de las reglas y además indexa las reglas para
acelerar su procesamiento en tiempo de ejecución.  Esta información se
almacena en un archivo en formato binario que se lee junto con el
diccionario bilingüe correspondiente y el propio fichero de reglas de
transferencia para la ejecución conjunta de los módulos de
transferencia léxica y estructural.


\section{Desformateador y reformateador}
\label{se:desformat}


\subsection[Funcionamiento]{Tratamiento del formato de los
  documentos}
\label{ss:formato}

En esta sección se describe cómo tratan el formato
de los documentos los desformateadores y reformateadores de
este sistema, creados a partir de las reglas de
especificación de formato en XML que se describen más adelante, 
en la sección \ref{ss:reglasformato}.


Los requisitos del proyecto indican que el traductor debe ser capaz de
procesar documentos en formato XML, HTML, RTF y texto llano. En todos estos tipos de documento
es posible realizar una \textit{encapsulación} del
formato, tal como se describe a continuación.

El procedimiento consiste en encapsular las cadenas de texto ---en
adelante \textit{bloques de formato} o \textit{superblancos}--- que se
identifiquen como parte del formato entre delimitadores que dependerán
de la especificación del flujo de datos entre módulos (que se discute
en detalle en el capítulo~\ref{se:flujodatos}); así, en el
formato de flujo (secciones \ref{se:noxml1} y
\ref{se:noxml2}), los \emph{superblancos} van entre corchetes
'\texttt{[}' y '\texttt{]}'.  Cada una de estas cadenas encapsuladas
será tratada como si de un blanco \texttt{<\textbf{b}/>}
(página~\pageref{s3:b}) se tratara ---de ahí lo de
\textit{superblancos}--- y serán restituidas en el orden correcto a la
salida del traductor.

Como ya se ha indicado en el capítulo \ref{se:flujodatos}, cuando los
bloques de formato sean grandes (como ocurre a veces en HTML con
segmentos de código en Javascript, o en RTF con imágenes en formato de
mapa de bits), se utilizará un mecanismo de almacenamiento en ficheros
temporales de estos bloques de formato grandes para eliminarlos del
flujo de datos de la traducción.

Un requisito adicional que aparece es que muchas veces el formato de
una parte del documento marca implícitamente la división del texto en
oraciones (véase la página \pageref{finfrase} del capítulo
\ref{se:flujodatos}). Por ejemplo, los títulos de secciones o de
documentos pueden estar en frases que no acaben en punto.  Si sabemos
que una marca de formato nos está indicando esta división debemos
aprovechar esta información para poder traducir mejor estos casos.
Ejemplos de este fenómeno pueden ser: dos saltos de línea seguidos en
el formato de texto llano, una etiqueta \texttt{</h1>} en HTML,
etcétera. El módulo desformateador debe generar en estos casos una
marca de final de oración equivalente a un punto.

\subsubsection{Sistema de encapsulación del formato y ejemplo}

Los tipos de bloques de formato o \emph{superblancos} que se generan como resultado
del procesamiento del formato se presentan a continuación:

\begin{itemize}
\item \textit{Bloques de formato} o \textit{superblancos no vacíos}.
  Son los que contienen exclusivamente marcas de formato del documento
  original. En el flujo de datos descrito en el
  capítulo~\ref{se:flujodatos} se abren con un corchete izquierdo
  '\texttt{[}' y se cierran con el derecho '\texttt{]}'.
\item \textit{Bloques de formato con referencia a archivo externo} o
  \textit{superblancos extensos}.  Sirven para encapsular segmentos de
  formato largos y así mejorar el rendimiento del traductor. En el
  flujo de datos descrito en el capítulo~\ref{se:flujodatos} comienzan
  por la cadena '\texttt{[@}', siguen con el nombre del archivo en el
  que se almacena el segmento de formato extraído del documento
  original, y finalmente acaban en un corchete derecho '\texttt{]}'.
\item \textit{Bloques de formato vacíos}. Sirven para incorporar
  información artificial de segmentación del texto obtenida a partir
  del formato.  Antes del bloque de formato vacío se coloca el signo
  de puntuación artificial que se tenga que incluir.  Cuando sea
  necesario restituir el formato original al documento, la presencia
  de un bloque de formato de estas características obligará a la
  supresión del carácter inmediatamente anterior que se encuentre en
  el flujo de datos.
\end{itemize}

%% [movido al apéndice]
%% Dentro de los bloques de formato, los caracteres '\texttt{[}', '\texttt{]}',
%% '\texttt{@}' y '\verb!\!' se escapan mediante las secuencias de escape
%% '\verb!\[!', '\verb!\]!', '\verb!\@!' y '\verb!\\!', respectivamente.  Esto
%% hay que tenerlo en cuenta para encapsular y desencapsular.  En el exterior de
%% los bloques de formato es necesario también escapar los corchetes de apertura
%% y cierre. 

El criterio que se aplica para crear estos bloques de formato se basa en los
siguientes criterios generales:

\label{pg:criteri}
\begin{itemize}
\item Se debe encapsular todo lo que no se considere parte del texto que hay
  que traducir para formar bloques de formato. 
\item No debe haber dos o más bloques de formato no vacíos estrictamente
  consecutivos.  Dos bloques de formato consecutivos siempre deben unirse en un solo
  bloque. 
\item Los bloques de formato vacíos deben preceder a un bloque de formato no
  vacío o al fin de fichero.
\end{itemize}

En la figura~\ref{fg:ejemplopelado} se muestra un documento de ejemplo cuyo
formato debe ser tratado previamente a la traducción; en el ejemplo, el
encapsulamiento se corresponde con el formato de flujo no basado en XML. La figura~\ref{fg:ejemploencapsulado}  muestra el resultado de procesar el anterior documento. 


\begin{figure}[htbp]
\begin{small}
\begin{alltt}
<html>
<head>
<title>Esto es el título</title>
<script>
<!-- ... (un bloque de código extenso) -->
</script>
</head>
<body>
<p>Esto 
es un párrafo escrito en dos líneas</p>
</body>
</html>
\end{alltt}
\end{small}
\caption{Ejemplo de documento HTML}
\label{fg:ejemplopelado}
\end{figure}

\begin{figure}[htbp]
\begin{small}
\begin{alltt}
\textbf{[<html>
<head>
<title>]}Esto es el título\textbf{.[][@/tmp/temp35345]}Esto\textbf{[
]}es un párrafo escrito en dos líneas\textbf{.[][</p>
</body>
</html>]}
\end{alltt}
\end{small}
\caption{Ejemplo de documento HTML con los bloques de formato
  encapsulados por el desformateador}\nota{repeteix coses capítol format -revisar -Gema}
\label{fg:ejemploencapsulado}
\end{figure}
De este ejemplo conviene resaltar los siguientes fenómenos:
\begin{itemize}
\item No se generan bloques de formato con contenido (no vacíos) consecutivos. 
\item Las etiquetas como \texttt{</\textbf{title}>} y \texttt{</\textbf{p}>} inducen la
  introducción de signos de puntuación artificiales, y esta introducción se
  realiza de manera sistemática (incluso cuando no hace falta, porque no
  molesta y es eficiente). 
\item Los superblancos extensos salen literalmente del proceso de la
  traducción. En este caso, el fichero temporal \texttt{temp35345} contiene
  las etiquetas desde \texttt{</\textbf{title}>} hasta  \texttt{<\textbf{p}>}
\item Los blancos sencillos entre palabras no se encapsulan.  No
  ocurre lo mismo con los blancos múltiples (dos o más blancos
  consecutivos), tabuladores, etc. que son encapsulados. Los saltos de
  línea también se encapsulan.
\end{itemize}






\subsection{Datos: reglas de especificación de formato}
\label{ss:reglasformato}
En esta sección se describe el proceso de generación de formateadores
y desformateadores a partir de una especificación de formato en XML. 


Las reglas para los formatos se especifican, como los datos
lingüísticos, en XML, y dentro de ellas se declaran expresiones
regulares con sintaxis de \texttt{flex}.  La especificación se
estructura en tres partes (ver DTD de la definición formal en el
apéndice \ref{ss:dtd_formato}):

\begin{itemize}
\item \textbf{Opciones de configuración}. En este apartado se especifica el
  valor de la longitud máxima de un superblanco no extenso, las
  codificaciones de entrada y de salida, la necesidad de la distinción
  o no entre mayúsculas y minúsculas y las expresiones regulares para
  los caracteres de escape y para los caracteres de espaciado.

\item \textbf{Reglas de formato}. Se describe el conjunto de etiquetas propias
  de un formato determinado que han de ser encerradas en un bloque de
  formato por el desformateador. Dichas etiquetas de formato podrán,
  opcionalmente, indicar el fin de frase para que el desformateador
  inserte el signo de puntuación artificial (seguido de un bloque de
  formato vacío, como se especifica en la sección anterior). También
  se ha de especificar la prioridad de aplicación de las reglas
  aunque, en caso de no ser necesario, se puede dar a todas reglas la
  misma prioridad mediante la asignación del mismo valor (cualquier
  número) a todas ellas.
  
  Se entiende que todo lo que no sea especificado como formato quedará sin encapsular y será
  texto para traducir.

\item \textbf{Reglas de sustitución}. Permiten sustituir caracteres especiales
  del texto. Una expresión regular recogerá un conjunto de caracteres
  especiales, y los sustituirá por los caracteres que se especifique.
  Por ejemplo, en HTML los caracteres especificados en hexadecimal
  deben ser sustituidos por su correspondiente entidad o carácter
  ASCII. Por ejemplo, \texttt{cami\&oacute;n} se corresponde con
  \texttt{camión}.
\end{itemize}

A continuación se describen las reglas con más detalle.
\begin{itemize}
\item Raiz del documento de especificación. En el atributo \texttt{name} está el
  nombre del formato.
\begin{small}
\begin{alltt}
<?xml version="1.0" encoding="ISO-8859-1"?>
<format name="html">
  <options>
  ...
  </options>
  
  <rules>
  ...
  </rules>
</format>
\end{alltt}
\end{small}

\end{itemize}

Dentro deben estar las opciones y las reglas de las que se presenta un ejemplo a continuación:

\begin{itemize} 

\item Opciones.
\begin{small}
\begin{alltt}
  <options> 
    <largeblocks size="8192"/>
    <input encoding="ISO-8859-1"/>
    <output encoding="ISO-8859-1"/>
    <escape-chars regexp='[\verb!\![\verb!\!]^\$\verb!\!\verb!\!]'/>
    <space-chars regexp='[ \verb!\!n\verb!\!t\verb!\!r]'/>
    <case-sensitive value="no"/>
  </options>
\end{alltt}
\end{small}

\end{itemize}

El elemento \texttt{<largeblocks>} sirve para especificar la longitud
máxima de un superblanco no extenso, mediante el valor del atributo
\texttt{size}.  Los elementos \texttt{<input>} y \texttt{<output>}
sirven para especificar la codificación de entrada y de salida del
texto mediante el atributo \texttt{encoding}.  

El elemento \texttt{escape-chars} permite especificar, mediante una
expresión regular que se da en el valor del atributo \texttt{regexp},
qué caracteres deben protegerse mediante una barra invertida.  El
elemento \texttt{<space-chars>} especifica el conjunto de caracteres
que tienen que ser tomados como si fueran espacios en blanco.

Finalmente, el elemento \texttt{case-sensitive} sirve para especificar
si, en todas las especificaciones de atributos del formato en las que
intervengan expresiones regulares es relevante si se especifican
mayúsculas o minúsculas.


\begin{itemize}  
\item Reglas. Hay reglas de formato y de sustitución.
\begin{small}
\begin{alltt}
  <rules>
    <format-rule ... >
      ...
    </format-rule>
    ...
    
    <replacement-rule>
      ...
    </replacement-rule>
    ...
  </rules>
\end{alltt}
\end{small}
Se detallan en los dos puntos siguientes.

\item Reglas de formato. El desformateador encerrará en bloques de
  formato las etiquetas que estas reglas indiquen en su campo
  \texttt{regexp}. Si se trata de etiquetas de inicio y fin, y todo lo
  que encierran es formato, se especifica una \texttt{regexp} tanto
  para \texttt{begin} como para \texttt{end}:
\begin{small}
\begin{alltt}
    <format-rule eos="no" priority="1">
      <begin regexp='"\verb!\!\&lt;!--"'/>
      <end regexp='"--\verb!\!\&gt;"'/>
    </format-rule>
\end{alltt}
\end{small}
  De lo contrario se utiliza sólo un elemento \texttt{begin-end}:
\begin{small}
\begin{alltt}
    <format-rule eos="yes" priority="3">
      <begin-end regexp='"\&lt;"[/]?"li"[^\&gt;]*"\&gt;"'/>
    </format-rule>
\end{alltt}
\end{small}


Además, en \texttt{priority} se especifica una prioridad que sirve
para saber en qué orden se aplican las reglas de formato (el valor
absoluto no es relevante, sólo se utiliza el orden que se establece
entre los valores usados en las reglas). En ``\texttt{eos}'' se indica
mediante \texttt{yes} o \texttt{no} si el bloque de formato del que
forme parte el patrón detectado deberá ir precedido de un signo de
puntuación artificial o no.\footnote{En todos estos casos, se usan las
  típicas entidades \texttt{\&lt;} y \texttt{\&gt;} para representar
  los caracteres \texttt{<} y \texttt{>} respectivamente.}

\item Reglas de sustitución. Sirve para sustituir caracteres especiales
  del texto. La expresión regular del atributo \texttt{regexp}
  recogerá un conjunto de caracteres especiales y los sustituirá en
  el texto a traducir por los caracteres que se especifiquen.  La
  correspondencia entre caracteres originales y sustituidos se
  establece en los atributos \texttt{source} y \texttt{target} de los
  elementos \texttt{replace}, que pueden ser múltiples:
\begin{small}
\begin{alltt}
    <replacement-rule regexp='"\&amp;"[^;]+;'>
      <replace source="\&amp;Agrave;" target="À"/>
      <replace source="\&amp;#192;" target="À"/>
      <replace source="\&amp;#xC0;" target="À"/>
      <replace source="\&amp;#xc0;" target="À"/>
      <replace source="\&amp;Aacute;" target="Á"/>
      <replace source="\&amp;#193;" target="Á"/>
      <replace source="\&amp;#xC1;" target="Á"/>
      <replace source="\&amp;#xc1;" target="Á"/>
      ...
    </replacement-rule>  
\end{alltt}
\end{small}
\item Expresiones regulares de los atributos \texttt{regexp}. Tienen
  la sintaxis utilizada en \texttt{flex}   \cite{lesk75tr}.
    
\end{itemize}

% DTD moguda a l'Apèndix


Como ejemplo de especificación de formato vamos a utilizar el de HTML,
del que se puede seguir la explicación que ofrecemos a continuación
mirando la figura \ref{fg:formato-html}.

Encontramos, en primer lugar, la regla de formato que especifica de
forma general todas las etiquetas de HTML, es decir, considera
etiqueta HTML todo aquello que empiece por el signo
\textbf{\texttt{<}} y termine por el signo \textbf{\texttt{>}}. Esta
regla tiene la prioridad más baja (4) para permitir que las reglas más
específicas se apliquen preferentemente.  Pero antes de considerar una
etiqueta como general, es decir, antes de aplicar esta regla, se
aplicará alguna de las reglas de mayor prioridad. En el caso de HTML,
la mayor prioridad la tienen los comentarios \texttt{<!-- ... -->}.
Las marcas de inicio y fin \texttt{<script> </script>} y
\texttt{<style> </style>}, donde se considera formato todo que lo
éstas encierren, tienen prioridad 2.  Prioridad 3 tienen las etiquetas
que implican fin de frase (puntuación artificial), que son
\texttt{</br>}, \texttt{</hr>}, \texttt{</p>}, etc.

Finalmente se especifican las reglas de sustitución, para sustituir
todos los códigos que empiecen por \texttt{\&}, y así se especifica en
la expresión regular. Después se define cada una de las sustituciones:
tanto \texttt{\&Agrave}, como \texttt{\&\#192}, \texttt{\&\#xC0} y
\texttt{\&\#xc0} se sustituyen por \texttt{À}. De igual manera se
declaran los demás caracteres especiales.



\begin{figure}[htbp]
\begin{small}
\begin{alltt}
 <?xml version="1.0" encoding="ISO-8859-1"?>
 <format name="html">
   <options>
     <largeblocks size="8192"/>
     <input encoding="ISO-8859-1"/>
     <output encoding="ISO-8859-1"/>
     <escape-chars regexp='[\verb!\![\verb!\!]^\$\verb!\!\verb!\!]'/>
     <space-chars regexp='[ \verb!\! n\verb!\! t\verb!\! r]'/>
     <case-sensitive value="no"/>
   </options>
 
   <rules>
    <format-rule eos="no" priority="1">
       <begin regexp='"\&lt;!--"'/>
      <end regexp='"--\&gt;"'/>
    </format-rule>

    <format-rule eos="no" priority="2">
      <begin regexp='"\&lt;script"[^\&gt;]*"\&gt;"'/>
      <end regexp='"\&lt;/script"[^\&gt;]*"\&gt;"'/>
    </format-rule>
    <format-rule eos="no" priority="2">
      <begin regexp='"\&lt;style"[^\&gt;]*"\&gt;"'/>
      <end regexp='"\&lt;/style"[^\&gt;]*"\&gt;"'/>
    </format-rule>

    <format-rule eos="yes" priority="3">
      <begin-end regexp='"\&lt;"[/]?"br"[^\&gt;]*"\&gt;"'/>
    </format-rule>
    <!-- Aquí faltan más declaraciones format-rule eos="yes"-->
    <!-- ...                                                -->

    <format-rule eos="no" priority="4">
      <begin-end regexp='"\&lt;"[a-zA-Z][^\&gt;]*"\&gt;"'/>
    </format-rule>

    <replacement-rule regexp='"\&amp;"[^;]+;'>
      <replace source="\&amp;Agrave;" target="À"/>
      <replace source="\&amp;#192;" target="À"/>
      <replace source="\&amp;#xC0;" target="À"/>
      <replace source="\&amp;#xc0;" target="À"/>
      <!-- Aquí faltan más elementos replace                -->    
      <!-- ...                                              -->
    </replacement-rule>
  </rules>
</format>
\end{alltt}
\end{small}
\caption{Parte de la definición de reglas del formato HTML}
\label{fg:formato-html}
\end{figure}


\subsection{Generación de formateadores y desformateadores}
\label{se:gendeformat}

Para generar el formateador y el desformateador de un formato dado, se
aplica a las reglas en XML que declaran este formato (que se describen
a continuación) una hoja de estilo generadora de formateadores y
desformateadores Esta transformación XSLT da como resultado un fichero
\texttt{lex} \cite{lesk75tr} que, una vez compilado, es el ejecutable
del formateador o desformateador para el formato especificado.

Gracias a la especificación general de formatos descrita en este
capítulo, se han podido definir las especificaciones para los formatos
HTML, RTF y texto llano.  Estas especificaciones se hallan en el
paquete \texttt{apertium}, en los ficheros respectivos
\texttt{html-format.xml}, \texttt{rtf-format.xml},
\texttt{txt-format.xml}.  En particular, es relativamente sencillo
definir desformateadores y reformateadores de cualquier formato XML.

\chapter{Instalación y ejecución del sistema}
\label{se:instalacion}


\section{Requisitos del sistema}

El sistema en el que se desee instalar y ejecutar Apertium debe tener los siguientes programas instalados:

\begin{itemize}
\item \texttt{libxml2} versión 2.6.17 o superior

\item programa \texttt{xmllint} (generalmente viene incluido en \texttt{libxml2}, pero puede ser un paquete independiente en el sistema, por ejemplo en Debian GNU-Linux)

\item programa \texttt{xsltproc} (para no usuarios de PowerPC);
  también viene con \texttt{libxml2} pero puede ser igualmente un paquete
  independiente en el sistema, como en el caso de \texttt{xmllint}

\item programa \texttt{sabcmd} (usuarios de PowerPC), suministrado con el paquete \texttt{sablotron}

\item GNU \texttt{make}, \texttt{gcc} (\texttt{g++}), intérprete de comandos \texttt{bash}

\end{itemize}

\section{Instalación de los paquetes de programas}

Para instalar los programas y librerías del sistema de traducción
automática Apertium, deberá descargarse (de
\url{http://sourceforge.net/projects/apertium}), compilar e instalar la
última versión de los siguientes paquetes, en el orden especificado:

\begin{enumerate}
\item \texttt{lttoolbox}
\item \texttt{apertium}
\end{enumerate}

La manera más sencilla de compilar los paquetes es la siguiente:

\begin{enumerate}
\item Vaya al directorio que contiene el código fuente del paquete y
  escriba \texttt{./configure}; se configurará el paquete en su sistema.
  Si utiliza csh en una versión antigua de System V, probablemente
  deberá escribir \texttt{sh ./configure} para evitar que \texttt{csh} (el
  intérprete de comandos por defecto en el antiguo System V) intente
  ejecutar \texttt{configure} por sí solo. La ejecución de
  \texttt{configure} tarda un tiempo; mientras se ejecuta, muestra en
  pantalla algunos mensajes que indican qué comprobaciones está
  realizando.

\item Escriba \texttt{make} para compilar el paquete

\item Escriba \texttt{make install} (probablemente necesitará
  privilegios de administrador) para instalar los programas, los
  ficheros de datos y la documentación.

\item Si desea eliminar del directorio de código fuente los archivos
  binarios y los archivos de objetos del programa, escriba \texttt{make
    clean}. Para eliminar también los ficheros que \texttt{configure} ha
  creado (de modo que pueda compilar el paquete para un ordenador de
  diferente tipo), escriba \texttt{make distclean}. También hay una
  opcion\\
  \texttt{maintainer-clean} en el Makefile, pero está prevista
  principalmente para los desarrolladores del paquete. Si lo utiliza,
  es probable que después tenga que buscar varios programas que necesitará para volver a generar los archivos que estaban incluidos en la distribución.
\end{enumerate}

Si no dispone de privilegios de administrador para instalar los
programas en su sistema, puede utilizar la opción \texttt{-prefix} con el script de configuración para que se instalen en su cuenta de usuario. Por ejemplo:

\begin{small}
\begin{alltt}
  \verb!$! pwd
  /home/me/lttoolbox-0.9.1
  \verb!$! ./configure --prefix=/home/me/myinstall
\end{alltt}
\end{small}

Las librerías se instalarán en el directorio
\texttt{LIBDIR=\$prefix/lib}. Si no se especifica ninguna opción
\texttt{-prefix} con el script de configuración, el directorio LIBDIR será \texttt{/usr/local/lib}.


Si encuentra algún error de enlace con las librerías instaladas en el
directorio \texttt{LIBDIR}, deberá usar libtool y especificar la ruta
de acceso completa de la librería, o bien utilizar la opción
\texttt{LIBDIR} durante el enlace y realizar al menos una de las
siguientes acciones:

\begin{itemize}

\item añadir  \verb!LIBDIR! a la variable de entorno \verb!LD_LIBRARY_PATH! durante la ejecución

\item añadir  \verb!LIBDIR! a la variable de entorno \verb!LD_RUN_PATH! durante el enlace

\item utilizar \texttt{-Wl}, \texttt{--rpath -Wl}, opción de enlazado \texttt{LIBDIR}

\item pedir al administrador del sistema que añada \texttt{LIBDIR} a \texttt{/etc/ld.so.conf} y ejecute \texttt{ldconfig}

\end{itemize}

Consulte la documentación del sistema operativo relativa a las
librerías compartidas para obtener más información; por ejemplo, las páginas de manual \texttt{ld(1)} y \texttt{ld.so(8)}.

\section{Instalación de los paquetes de datos}

Para instalar los paquetes de datos lingüísticos, siga los pasos siguientes:

\begin{enumerate}

\item Descargue un paquete de datos
  (\texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{-}$\textrm{VERSION}$\texttt{.tar.gz}) de la página web de Apertium
  en Sourceforge (\url{http://apertium.sourceforge.net/}). Por ejemplo,
  para obtener la versión 0.9 de los datos lingüísticos del traductor español--catalán, deberá
  descargarse el paquete \texttt{apertium-es-ca-0.9.tar.gz}.

\item Descomprima el archivo en cualquier directorio, vaya al directorio en cuestión y escriba \texttt{make} en el terminal. Espere mientras se compilan los datos lingüísticos.


\end{enumerate}


\section{Ejecución del traductor}

Hay versiones del traductor Apertium que funcionan tanto en sistemas
operativos Linux (siempre más actualizadas) como en Windows.  La
información de este capítulo está básicamente dirigida a los usuarios
de Linux.


Para utilizar el traductor, debe ejecutarse la herramienta
\texttt{apertium-translator} haciendo referencia al directorio en el
que se encuentran los datos lingüísticos, indicando además la
dirección de traducción (\texttt{es-ca}, \texttt{ca-es},
\texttt{es-gl}, etc.), el formato del fichero (\texttt{txt},
\texttt{html}, \texttt{rtf}), el nombre del fichero a traducir y el
nombre del fichero resultante. La estructura del comando es por tanto
la siguiente:


\begin{small}
\begin{alltt}
\$ apertium-translator <directorio> <traducción> <formato> \\
                 < fichero_original > fichero_traducido
\end{alltt}
\end{small}


Por
ejemplo, si el directorio es \texttt{/home/maria/apertium-es-ca}, hay que escribir lo
siguiente para traducir un fichero en formato \texttt{txt} de español a catalán:

\begin{small}
\begin{alltt}
\$ apertium-translator /home/maria/apertium-es-ca es-ca \\txt <fichero_esp >fichero_cat
\end{alltt}
\end{small}

Es aconsejable situarse en el directorio en el que están almacenados los datos lingüísticos, porque de
este modo es suficiente con escribir un punto para hacer referencia al directorio presente:

\begin{small}
\begin{alltt}
\$ apertium-translator . es-ca txt <fichero_esp >fichero_cat
\end{alltt}
\end{small}

Si no se indica ningún formato, el formato por defecto es
\texttt{txt}. Con los formatos \texttt{txt}, \texttt{html} y \texttt{rtf}, las palabras
desconocidas se marcan con un asterisco (*) y los errores con un símbolo (@, \# o /); si se desea que no se
marquen las desconocidas ni los errores, se añade una \texttt{u} al nombre del
formato. Así, las opciones de formato son las siguientes:

\begin{itemize}
\item \texttt{txt} : Opción predeterminada, texto con marca de desconocidas y de errores

\item \texttt{txtu} : texto sin marca de desconocidas ni de errores

\item \texttt{html} : HTML con marca de desconocidas y de errores

\item \texttt{htmlu} : HTML sin marca de desconocidas ni de errores

\item \texttt{rtf} : RTF con marca de desconocidas y de errores

\item \texttt{rtfu} : RTF sin marca de desconocidas ni de errores

\end{itemize}

Si no se desea traducir un fichero sino traducir directamente una frase en pantalla, puede ejecutarse
la herramienta \texttt{apertium-translator} sin indicar ningún nombre de archivo. El comando,
si estamos situados en el directorio de datos lingüísticos, sería como sigue:

\begin{small}
\begin{alltt}
\$ apertium-translator . es-ca
\end{alltt}
\end{small}

A continuación, debe escribirse el texto que se desea traducir (pueden incluirse saltos de línea). Para 
obtener la versión traducida, debe pulsarse Ctrl + D, con lo que la traducción aparecerá en pantalla.

Una tercera manera de traducir con Apertium es utilizando el comando \texttt{echo} para pasar
texto a través del traductor:

\begin{small}
\begin{alltt}
\$ echo "texto que quiero traducir" | apertium-translator . es-ca
\end{alltt}
\end{small}



\chapter[Mantenimiento de datos lingüísticos]{Mantenimiento de los datos lingüísticos del traductor}
\label{se:datosling}
\section[Descripción de los datos lingüísticos]{Descripción de los datos lingüísticos existentes}

Actualmente, Apertium posee datos lingüísticos para dos pares de
lenguas: español--catalán y español--gallego. Los
archivos que contienen los datos lingüísticos están contenidos en un solo
directorio: \texttt{apertium-es-ca} para el par español--catalán y \texttt{apertium-es-gl}
para el par español--gallego. Los nombres de los ficheros contenidos en este directorio
siguen la siguiente estructura:

\begin{itemize}\setlength{\itemsep}{-\parsep}
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_1$\texttt{.dix} : diccionario monolingüe del idioma $L_1$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_2$\texttt{.dix} : diccionario monolingüe del idioma $L_2$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_1$\texttt{-}$L_2$\texttt{.dix} : diccionario bilingüe del par de idiomas $L_1$\texttt{-}$L_2$ (en ambas direcciones).
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.trules-}$L_1$\texttt{-}$L_2$\texttt{.dix} : reglas de transferencia estructural para la traducción de $L_1$ a $L_2$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.trules-}$L_2$\texttt{-}$L_2$\texttt{.dix} : reglas de transferencia estructural para la traducción de $L_2$ a $L_1$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_1$\texttt{.tsx} : fichero de definición del desambiguador para $L_1$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_2$\texttt{.tsx} : fichero de definición del desambiguador para $L_2$.
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.post-}$L_1$\texttt{.dix} : diccionario de postgeneración para $L_1$ (se aplica al traducir hacia la lengua $L_1$).
    \item \texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.post-}$L_2$\texttt{.dix} : diccionario de postgeneración para $L_2$ (se aplica al traducir hacia la lengua $L_2$).
    \item directorio $L_1$\texttt{-tagger-data} : contiene datos necesarios para el tagger de $L_1$ (corpus, etc.)
    \item directorio $L_2$\texttt{-tagger-data} : contiene datos necesarios para el tagger de $L_2$ (corpus, etc.)

\end{itemize}

\texttt{apertium-}$L_1$\texttt{-}$L_2$ hace referencia a la
combinación lingüística del traductor. Sus dos valores posibles
actualmente son \texttt{apertium-es-ca} y \\
\texttt{apertium-es-gl}. De
acuerdo con esta estructura, el fichero monolingüe de catalán se llama
\texttt{apertium-es-ca.ca.dix}, el fichero bilingüe español--gallego
se llama \texttt{apertium-es-gl.es-gl.dix} y el fichero de reglas de
transferencia estructural para la traducción de catalán a español se
llama \texttt{apertium-es-ca.trules-ca-es.xml}.


Los datos lingüísticos de que se dispone (datos de enero del 2006) para los
distintos pares de lenguas se resumen en el siguiente cuadro.
\begin{small}
\begin{center}
\begin{tabular}{|p{8cm}|p{5cm}|}
\hline
\multicolumn{2}{|c|}{\textbf{Traductor Apertium-es-ca}} \\
\hline
Diccionario monolingüe de español & 11.800 entradas\\
Diccionario monolingüe de catalán & 11.800 entradas \\
Diccionario bilingüe español--catalán & 12.800 entradas  (correspondencias \texttt{es-ca})\\
Reglas de transferencia estructural de español a catalán & 44 reglas \\
Reglas de transferencia estructural de catalán a español & 58 reglas \\
Diccionario de postgeneración para el español & 25 entradas y 5 paradigmas\\
Diccionario de postgeneración para el catalán & 16 entradas y 57 paradigmas\\
\hline
\multicolumn{2}{|c|}{\textbf{Traductor Apertium-es-gl}}  \\
\hline
Diccionario monolingüe de español & 9.000 entradas\\
Diccionario monolingüe de gallego & 8.600 entradas \\
Diccionario bilingüe español--gallego & 8.500 entradas (correspondencias \texttt{es-gl})\\
Reglas de transferencia estructural de español a gallego & 46 reglas \\
Reglas de transferencia estructural de gallego a español & 38 reglas \\
Diccionario de postgeneración para el español & 36 entradas y 12 paradigmas\\
Diccionario de postgeneración para el gallego & 74 entradas y 48 paradigmas\\
\hline
\end{tabular}
\end{center}
\end{small}


\section[Introducir palabras en los diccionarios]{Introducir palabras en los diccionarios monolingües y bilingües}


La adición de léxico a los diccionarios es seguramente la operación
que con más probabilidad realizarán quienes quieran ampliar o adaptar
Apertium, más que añadir reglas de transferencia o de postgeneración.

A continuación se explican los aspectos más importantes que hay que tener
en cuenta a la hora de introducir palabras. Esta información es más general
que la ofrecida en el apartado de descripción de los diccionarios (punto \ref{ss:diccionarios}), 
aunque contiene información práctica que puede ser de gran utilidad para quienes decidan
llevar a cabo esta tarea.

Para añadir una palabra a Apertium hay que realizar tres entradas en los diccionarios. Supongamos que
está trabajando con el par español--catalán.  En este caso, deberá añadir:

\begin{enumerate}
\item una entrada en el diccionario monolingüe español: para que
  el traductor pueda analizar (''entender'') la palabra cuando la
  encuentre en un texto, y la pueda generar al traducir esta palabra al
  español.

\item una entrada en el diccionario bilingüe: para que Apertium pueda traducir esta palabra de
  una lengua a la otra. 

\item una entrada en el diccionario monolingüe
  de catalán: para que el traductor pueda analizar (''entender'') la
  palabra cuando lo encuentre en un texto, y la pueda generar al traducir
  esta palabra al catalán. 
\end{enumerate}

Deberá ir al directorio que contiene los diccionarios en XML (para el
par español--catalán, por ejemplo, es \texttt{apertium-es-ca}) y abrir con un editor
de texto o un editor de XML especializado los tres diccionarios
mencionados: \texttt{apertium-es-ca.es.dix}, \texttt{apertium-es-ca.es-ca.dix} y
\texttt{apertium-es-ca.ca.dix}. Las entradas que deberá añadir en estos tres
diccionarios tienen una estructura similar.
\\

\textbf{Diccionario monolingüe (español)}


Supongamos que desea añadir el adjetivo español \emph{cósmico}, cuyo
equivalente en catalán es \emph{còsmic}. El primer paso es añadir esta
palabra al diccionario monolingüe español.

Verá que un diccionario monolingüe tiene principalmente dos tipos de
datos: \textbf{paradigmas} (en la sección "\texttt{<pardefs>}" del
diccionario, cada uno en un elemento \texttt{<pardef>}) y
\textbf{entradas léxicas} (en la sección principal del diccionario
(\texttt{<section>}), cada una dentro de un elemento \texttt{<e>}. Las
entradas léxicas se componen de un lema (es decir, la palabra que
encontraríamos como entrada en un diccionario en papel) y de
información gramatical; los paradigmas contienen los datos de flexión
de todos los lemas del diccionario. Para buscar una palabra concreta,
puede buscar la cadena \texttt{lm="palabra"} (\texttt{lm} de \emph{lema}).
Tenga en cuenta, sin embargo, que el elemento \texttt{lm} es opcional en
los diccionarios y que es posible que algunos no incluyan esta
información.

Observe cómo son las entradas léxicas del diccionario monolingüe
español, por ejemplo la entrada para el adjetivo \emph{bonito}. Puede
encontrarla buscando la cadena \texttt{lm="bonito"}:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="bonito">
    <\textbf{i}>bonit</\textbf{i}>
  <\textbf{par} \textsl{n}="absolut/o__n"/>
</\textbf{e}>
\end{alltt}
\end{small}

Para añadir una palabra, deberá crear una entrada con la misma
estructura. La parte entre \texttt{<i>} e \texttt{</i>} contiene la
parte inicial de la palabra que es común a todas las formas
flexionadas, y el elemento \texttt{<par>} indica cuál es su paradigma
de flexión. Por lo tanto, esta entrada significa que el adjetivo
\emph{bonito} se flexiona igual que el adjetivo \emph{absoluto} con el
mismo análisis morfológico: las formas \emph{bonit\textbf{o}},
\emph{bonit\textbf{a}}, \emph{bonit\textbf{os}},
\emph{bonit\textbf{as}} son equivalentes a las formas
\emph{absolut\textbf{o}}, \emph{absolut\textbf{a}},
\emph{absolut\textbf{os}}, \emph{absolut\textbf{as}} y tienen el mismo
análisis morfológico: \texttt{adj m sg}, \texttt{adj f sg}, \texttt{adj m
  pl} y \texttt{adj f pl} respectivamente.

Primero debe decidir cuál es la categoria léxica de la palabra que
desea añadir: la palabra \emph{cósmico} es un adjetivo, como
\emph{bonito}. A continuación, debe encontrar el paradigma apropiado
para este adjetivo. ¿Es el mismo que el de \emph{bonito} o \emph{absoluto}?
¿Puede decir \emph{cósmic\textbf{o}}, \emph{cósmic\textbf{a}},
\emph{cósmic\textbf{os}}, \emph{cósmic\textbf{as}}? Como la respuesta es afirmativa, ya tiene la información
necesaria para crear la entrada:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="cósmico">
    <\textbf{i}>cósmic</\textbf{i}>
  <\textbf{par} \textsl{n}="absolut/o__adj"/>
</\textbf{e}>
\end{alltt}
\end{small}


Si la palabra que desea añadir tiene un paradigma diferente, deberá
buscarlo en el diccionario y asignarlo a la entrada. Hay dos maneras
de buscar un paradigma: mirando en la sección \texttt{<pardefs>} del
diccionario, donde están definidos todos los paradigmas, cada uno
dentro de un elemento \texttt{<pardef>}, o bien buscando una palabra
que pensemos que pueda existir en el diccionario y que tenga el mismo
paradigma de inflexión que la que queremos añadir. Por ejemplo, si
desea añadir la palabra \emph{genoma}, deberá encontrar un paradigma
para un \textbf{nombre} de género masculino que forme el plural
añadiendo una \textbf{-s}. En los diccionarios actuales, se trata del
paradigma "\texttt{abismo\_\_n}". Por lo tanto, la entrada para esta nueva palabra sería:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="genoma">
    <\textbf{i}>genoma</\textbf{i}>
  <\textbf{par} \textsl{n}="abismo__n"/>
</\textbf{e}>
\end{alltt}
\end{small}

En casos excepcionales será necesario crear un nuevo paradigma para
una palabra determinada. Para ello, observe la estructura de los demás
paradigma y cree uno nuevo a partir de alguno que sea similar. Para obtener una descripción
más detallada de los paradigmas y de las entradas léxicas de los
diccionarios, consulte la sección \ref{ss:diccionarios}.
\\

\textbf{Diccionario monolingüe (catalán)}

Una vez añadida la palabra a un diccionario monolingüe, hay que
hacer lo mismo en el otro diccionario monolingüe del par de traducción
(en el ejemplo actual, el diccionario monolingüe de catalán) aplicando
la misma estructura. El resultado sería:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="còsmic">
    <\textbf{i}>còsmi</\textbf{i}>
  <\textbf{par} \textsl{n}="acadèmi/c__adj"/>
</\textbf{e}>
\end{alltt}
\end{small}

\textbf{Diccionario monolingüe (gallego)}

Si lo que quiere es mejorar los diccionarios XML para el par
español--gallego, deberá ir al directorio \texttt{apertium-es-gl} y
abrir, con un editor de texto o un editor XML especializado, los tres
ficheros de diccionarios \texttt{apertium-es-gl.es.dix},
\texttt{apertium-es-gl.es-gl.dix} y \texttt{apertium-es-gl.gl.dix}. En
este caso, una vez ha añadido la nueva palabra \emph{genoma} al
diccionario monolingüe español (\texttt{apertium-es-gl.es.dix}), deberá
añadir la palabra gallega equivalente \emph{xenoma} al diccionario
monolingüe gallego (\texttt{apertium-es-gl.gl.dix}), es decir:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="xenoma">
    <\textbf{i}>xenoma</\textbf{i}>
  <\textbf{par} \textsl{n}="Xulio__n"/>
</\textbf{e}>
\end{alltt}
\end{small}

\textbf{Diccionario bilingüe}

El último paso es añadir la traducción al diccionario bilingüe.

Generalmente, un diccionario bilingüe no tiene paradigmas, sino sólo
lemas. Una entrada contiene únicamente el lema en ambos idiomas y el
primer símbolo gramatical (la categoría léxica) de cada uno. Las
entradas tienen una parte izquierda (\texttt{<l>}) y una parte derecha
(\texttt{<r>}), y un idioma tiene que ocupar siempre la misma posición: en nuestro sistema,
se ha convenido que el español ocupe la parte izquierda, y el catalán y el gallego
la parte derecha.

Añadiendo el lema de ambas palabras, el sistema traducirá todas sus formas flexionadas (puesto que los símbolos
gramaticales se copian desde la palabra original a la palabra en lengua meta). Esto sólo dará resultado
si la palabra de origen y la palabra de destino son gramaticalmente equivalentes, es decir, si comparten
exactamente los mismos símbolos gramaticales para todas sus formas flexionadas. Como este es el caso del ejemplo
que nos ocupa, la entrada que hay que añadir al diccionario bilingüe es:


\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>cósmico<\textbf{s} \textsl{n}="adj"/></\textbf{l}>
    <\textbf{r}>còsmic<\textbf{s} \textsl{n}="adj"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

Esta entrada servirá para traducir todas las formas flexionadas, es decir, \texttt{adj m sg}, \texttt{adj f sg}, \texttt{adj m pl} y \texttt{adj f pl}. Sirve para ambas direcciones: de español a catalán y de catalán a español.

En el caso del par español--gallego, la siguiente entrada en el diccionario bilingüe español--gallego (\texttt{apertium-es-gl.es-gl.dix}) traducirá todas las formas flexionadas de las palabras equivalentes \emph{genoma}/\emph{xenoma} en ambas direcciones:

\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>genoma<\textbf{s} \textsl{n}="n"/></\textbf{l}>
    <\textbf{r}>xenoma<\textbf{s} \textsl{n}="n"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

En caso de que el par de traducción no sea gramaticalmente equivalente
(sus símbolos gramaticales no sean exactamente los mismos), es
necesario especificar todos los símbolos gramaticales (en el mismo
orden en que están especificados en los diccionarios monolingües)
hasta llegar al símbolo que cambia entre la forma léxica origen y la
forma léxica destino. Por ejemplo, el nombre español \emph{limón}, de género masculino, 
se traduce al catalán por un nombre de género femenino, \emph{llimona}. Por lo tanto, la 
entrada en el diccionario bilingüe debe ser:

\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>limón<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/></\textbf{l}>
    <\textbf{r}>llimona<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}


Un caso más complicado es el que surge cuando, teniendo dos formas
léxicas con símbolos gramaticales diferentes, la información
gramatical de la forma de la lengua origen no es suficiente para
determinar el género (masculino o femenino) o el número (singular o
plural) de la forma de la lengua destino. Así sucede, por ejemplo, con
el adjetivo español \emph{canadiense}. Su género es masculino--femenino
puesto que es de invariable en género, es decir, puede acompañar a
nombres tanto masculinos como femeninos (\emph{hombre canadiense},
\emph{mujer canadiense}. En catalán, en cambio, el adjetivo se
flexiona de manera diferente para el masculino y para el femenino
(\emph{home canadenc}, \emph{dona canadenca}). Así, al traducir de
español a catalán no es posible saber, sin mirar el nombre al que
acompaña, si el adjetivo español (\emph{mf}) tiene que traducirse como
un adjetivo femenino o masculino en catalán. En este caso se utiliza
el símbolo \texttt{GD} (de "género por determinar") en lugar del
símbolo de género. \label{GDND} Será en el módulo de transferencia estructural
donde se determinará el género de la palabra mediante una regla de
transferencia (en este caso concreto, una regla que detecte el género
del nombre precedente). El símbolo \texttt{GD} debe utilizarse sólo
para la traducción de español a catalán, y no viceversa, ya que en
español el género será siempre \texttt{mf} independientemente del
género de la palabra original.  
En el diccionario bilingüe, habrá que añadir más de una entrada con restricciones
de dirección, puesto que es necesario indicar en qué dirección de traducción
el género queda sin determinar. Las entradas para este adjetivo deben ser como sigue:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{r}="LR">
  <\textbf{p}>
    <\textbf{l}>canadiense<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>canadenc<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="GD"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>canadiense<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>canadenc<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="f"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>canadiense<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="mf"/></\textbf{l}>
    <\textbf{r}>canadenc<\textbf{s} \textsl{n}="adj"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

"\texttt{LR}" significa \emph{left to right} ("de izquierda a
derecha") y "\texttt{RL}", \emph{right to left} ("de derecha a
izquierda"). Puesto que el español está situado a la izquierda y el
catalán a la derecha, el adjetivo será \texttt{GD} sólo en la
traducción de español a catalán (\texttt{LR}). Para la traducción
\texttt{RL} hay que crear dos entradas, una para el adjetivo en
femenino y otra para el adjetivo en masculino.\footnote{También se
  podrían agrupar usando un pequeño paradigma}

Este mismo principio se aplica cuando no es posible determinar el
número de la palabra destino por los mismos motivos que se acaban de
exponer. Por ejemplo, el nombre español \emph{rascacielos} es
invariable en número, es decir, tiene la misma forma para el singular
y para el plural (\emph{un rascacielos}, \emph{dos rascacielos}). En catalán, el nombre
tiene diferente flexión para el singular y para el plurar (\emph{un gratacel}, \emph{dos gratacels}). 
En este caso, el símbolo utilizado es "\texttt{ND}" (de "número por determinar") y las entradas
para estos lemas deben ser como sigue:


\begin{small}
\begin{alltt}
<\textbf{e} \textsl{r}="LR">
  <\textbf{p}>
    <\textbf{l}>rascacielos<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sp"/></\textbf{l}>
    <\textbf{r}>gratacel<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="ND"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>rascacielos<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sp"/></\textbf{l}>
    <\textbf{r}>gratacel<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="pl"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>rascacielos<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sp"/></\textbf{l}>
    <\textbf{r}>gratacel<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/><\textbf{s} \textsl{n}="sg"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

Para obtener una descripción más detallada de este tipo de entradas, consulte lapágina~\pageref{ss:bil}.



\subsection{Añadir restricciones de dirección}

En el ejemplo anterior hemos visto el uso de restricciones de dirección en las entradas con género o número
por determinar (\texttt{GD} o \texttt{ND}). Estas restricciones también pueden utilizarse en otros casos.

Hay que tener en cuenta que la versión actual de \emph{Apertium} sólo
puede proporcionar un único equivalente para cada forma léxica de la
lengua origen, es decir, no realiza ningún tipo de desambiguación
semántica.\footnote{El sistema realiza únicamente desambiguación
  categorial para las palabras homógrafas, es decir, para formas que
  pueden tener como análisis más de una forma léxica, como ocurre con
  la forma \emph{vino} en español, la cual puede ser tanto un sustantivo
  masculino como la forma pretérita del verbo \emph{venir}. El
  desambiguador léxico categorial es el encargado de deshacer este
  tipo de ambigüedad.} Cuando una forma léxica puede traducirse a la lengua meta de dos
o más maneras diferentes, hay que escoger una (las más general, la más frecuente, etc.). 
Puede indicarse al sistema que una forma sea analizada ("entendida") pero no generada,
puesto que no es la traducción de ningún lema de la otra lengua.

Veámoslo con un ejemplo. El nombre español \emph{muñeca} puede
traducirse al catalán por dos palabras diferentes dependiendo de su
significado: \emph{canell} o \emph{nina}. El contexto es el que decide
cuál es la traducción correcta, pero el sistema \emph{Apertium}
actual no puede tomar este tipo de decisiones.\footnote{En el apartado
  \ref{multi} dedicado a la adición de multipalabras se explican
  maneras de sortear este problema.} Por lo tanto, debe decidirse qué
palabra será el equivalente para la traducción de español a catalán.
Para la traducción catalán--español, ambos lemas pueden traducirse
como \emph{muñeca} y no surge ningún problema. Todas estas
circunstancias deben quedar reflejadas en las entradas bilingües
utilizando las restricciones de dirección (\texttt{LR}, "de izquierda
a derecha", es decir, \texttt{es}--\texttt{ca}, y \texttt{RL}, "de
derecha a izquierda", es decir, \texttt{ca}--\texttt{es}). Si se decide
traducir \emph{muñeca} como \emph{canell} en todos los casos, las entradas
que deben crearse en el diccionario bilingüe son:


\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>muñeca<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/></\textbf{l}>
    <\textbf{r}>canell<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>

<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>muñeca<\textbf{s} \textsl{n}="n"/></\textbf{l}>
    <\textbf{r}>nina<\textbf{s} \textsl{n}="n"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

Con estas entradas, las direcciones de traducción serán las siguientes:
\begin{small}
\begin{alltt}
    muñeca --> canell
    muñeca <-- canell
    muñeca <-- nina 
\end{alltt}
\end{small}

(Observe también que hay un cambio de género entre \emph{muñeca} y \emph{canell}). 

Es muy importante que una forma léxica no tenga dos traducciones en la lengua meta, puesto que, de
lo contrario, se produciría un error en el proceso de traducción (véase la sección \ref{errores}
sobre cómo pueden detectarse y corregirse este y otros tipos de errores). Cuando una palabra
puede traducirse a la lengua meta de dos maneras diferentes en todos los contextos, hay que elegir
una como equivalente de traducción y dejar la otra como forma léxica analizable pero no generable, valiéndose
de restricciones de dirección como en el ejemplo anterior. Por ejemplo, como los lemas catalanes
\emph{mot} y \emph{paraula} pueden traducirse ambos al español como \emph{palabra}, las entradas del
diccionario bilingüe deberían ser como las siguientes:

\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>palabra<\textbf{s} \textsl{n}="n"/></\textbf{l}>
    <\textbf{r}>paraula<\textbf{s} \textsl{n}="n"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>

<\textbf{e} \textsl{r}="RL">
  <\textbf{p}>
    <\textbf{l}>palabra<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/></\textbf{l}>
    <\textbf{r}>mot<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\noindent de las que resultan las siguientes direcciones de traducción:
\begin{small}
\begin{alltt}
    palabra --> paraula
    palabra <-- paraula
    palabra <-- mot 
\end{alltt}
\end{small}

En algunos casos puede ser necesario especificar restricciones de
dirección también en los diccionarios monolingües. Por ejemplo, las dos formas
verbales españolas \emph{cantaran} y \emph{cantasen} deben ser
analizadas como lema \emph{cantar}, verbo, pretérito imperfecto de
subjuntivo, 3ª persona plural, pero al traducir al español, debe
decidirse e indicarse qué forma será la que se generará. Los diccionarios
monolingües se leen en dos direcciones según su finalidad: para el análisis, la
dirección de lectura es de izquierda a derecha; para la generación, de derecha a
izquierda. Por lo tanto, una palabra que debe analizarse pero no generarse debe
contener la restricción \texttt{LR}, mientras que una que deba generarse pero no
analizarse debe contener la restricción \texttt{RL}.


El caso de \emph{cantaran} o \emph{cantasen} debe haberse tratado en los paradigmas de flexión verbal y es poco probable
que constituya un problema para alguien que esté ampliando un diccionario. En algunos
otros casos puede ser necesario introducir una restricción en las entradas léxicas del diccionario monolingüe.

\subsection{Añadir multipalabras}
\label{multi}

Es posible crear entradas formadas por dos o más palabras si se
considera que éstas forman una sola "unidad de traducción".  Las
unidades multipalabra pueden ser útiles también cuando se trata de
seleccionar el equivalente correcto de una palabra dentro de una
expresión fija. Por ejemplo, la palabra española \emph{dirección}
puede traducirse al catalán de dos maneras: \emph{direcció} (el
sentido más general) y \emph{adreça} (en el sentido de ``dirección
postal''); si se añaden, por ejemplo, unidades multipalabra frecuentes
como \emph{dirección general} \(\to\) \emph{direcció general} y \emph{dirección
postal} \(\to\) \emph{adreça postal} se
pueden conseguir mejores traducciones en determinadas situaciones.

Las unidades multipalabra pueden clasificarse básicamente en dos
categorías: multipalabras con flexión intercada y multipalabras sin
flexión intercalada. 

\subsubsection{Multipalabras sin flexión intercalada}

Son iguales a las entradas léxicas de una sola palabra, con la única diferencia de que debe inserirse el
elemento \texttt{<b>} (que representa un espacio en blanco) entre las palabras que forman la unidad. Así,
si se quiere añadir, por ejemplo, la multipalabra española \emph{hoy en día}, cuyo equivalente en catalán es 
\emph{avui dia}, las entradas que habrá que crear en los diferentes diccionarios son:

\begin{itemize}

\item Diccionario monolingüe de español:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="hoy en día">
    <\textbf{i}>hoy<\textbf{b}/>en<\textbf{b}/>día</\textbf{i}>
  <\textbf{par} \textsl{n}="ahora__adv"/>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario monolingüe de catalán:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="avui dia">
    <\textbf{i}>avui<\textbf{b}/>dia</\textbf{i}>
  <\textbf{par} \textsl{n}="ahir__adv"/>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario bilingüe español--catalán:
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>hoy<\textbf{b}/>en<\textbf{b}/>día<\textbf{s} \textsl{n}="adv"/></\textbf{l}>
    <\textbf{r}>avui<\textbf{b}/>dia<\textbf{s} \textsl{n}="adv"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\end{itemize}

Para el par español--gallego, si desea añadir, por ejemplo, la multipalabra española \emph{manga por hombro}, cuyo equivalente en gallego es \emph{sen xeito nin modo}, las entradas que hay que crear son las siguientes:

\begin{itemize}

\item Diccionario monolingüe de español:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="manga por hombro">
    <\textbf{i}>manga<\textbf{b}/>por<\textbf{b}/>hombro</\textbf{i}>
  <\textbf{par} \textsl{n}="ahora__adv"/>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario monolingüe de gallego:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="sen xeito nin modo">
    <\textbf{i}>sen<\textbf{b}/>xeito<\textbf{b}/>nin<\textbf{b}/>modo</\textbf{i}>
  <\textbf{par} \textsl{n}="Deo_gratias__adv"/>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario bilingüe español--gallego:
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>manga<\textbf{b}/>por<\textbf{b}/>hombro<\textbf{s} \textsl{n}="adv"/></\textbf{l}>
    <\textbf{r}>sen<\textbf{b}/>xeito<\textbf{b}/>nin<\textbf{b}/>modo<\textbf{s} \textsl{n}="adv"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\end{itemize}

\subsubsection{Breve introducción a los paradigmas}

Los paradigmas de los ejemplos anteriores, como los adverbios, no tienen flexión, contienen sólo el símbolo gramatical
de la forma léxica, como se puede ver a continuación:

\begin{small}
\begin{alltt}
<\textbf{pardef} \textsl{n}="ahora__adv">
  <\textbf{e}>
    <\textbf{p}>
      <\textbf{l}/>
      <\textbf{r}><\textbf{s} \textsl{n}="adv"/></\textbf{r}>
    </\textbf{p}>
  </\textbf{e}>
</\textbf{pardef}>
\end{alltt}
\end{small}

Los paradigmas se construyen del mismo modo que una entrada léxica. Hasta ahora, hemos visto entradas léxicas
en que la parte invariable del lema se coloca entre \texttt{<i>} \texttt{</i>}:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="cósmico">
    <\textbf{i}>cósmic</\textbf{i}>
  <\textbf{par} \textsl{n}="absolut/o__adj"/>
</\textbf{e}>
\end{alltt}
\end{small}


Ahora bien, es posible expresar lo mismo mediante un par de cadenas: una cadena
izquierda \texttt{<l>} y una cadena derecha \texttt{<r>} dentro de un elemento \texttt{<p>}:

\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="cósmico">
  <\textbf{p}>
    <\textbf{l}>cósmic</\textbf{l}>
    <\textbf{r}>cósmic</\textbf{r}>
  </\textbf{p}>
  <\textbf{par} \textsl{n}="absolut/o__adj"/>
</\textbf{e}>
\end{alltt}
\end{small}


Las dos entradas son equivalentes. El elemento \texttt{<i>} se utiliza
porque permite obtener entradas más simples y compactas, y puede
emplearse cuando la parte izquierda y la parte derecha del par de
cadenas son idénticas. Como ya se ha indicado, los diccionarios
monolingües se leen \texttt{LR} para el análisis de un texto y
\texttt{RL} para la generación. Por ello, cuando hay alguna diferencia
entre la cadena analizada y la cadena generada (cosa que no sucede
normalmente) la entrada no puede escribirse utilizando la
\texttt{<i>}. Esto es lo que sucede con los paradigmas, en los cuales
las cadenas izquierda y derecha no son nunca idénticas, puesto que la
parte derecha debe contener los símbolos gramaticales que circularán a través
de todos los módulos del sistema.

\subsubsection{Multipalabras con flexión intercalada}


Consisten en una palabra con flexión (en general un verbo) seguida de
una o más palabras invariables. En las entradas correspondientes debe
especificarse el paradigma de flexión justo detrás de la palabra que
se flexiona, mientras que la parte invariable debe quedar incluida en un elemento \texttt{<g>} (de \emph{grupo})
en la cadena derecha. Los blancos entre palabras se indican, como en el caso anterior,
mediante la colocación del elemento \texttt{<b>}. Su estructura puede observarse en el siguiente
ejemplo, correspondiente a la multipalabra española \emph{echar de menos}, que se traduce al catalán
por \emph{trobar a faltar}:

\begin{itemize}

\item Diccionario monolingüe de español:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="echar de menos">
    <\textbf{i}>ech</\textbf{i}>
    <\textbf{par} \textsl{n}="aspir/ar__vblex"/>
    <\textbf{p}>
      <\textbf{l}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{l}>
      <\textbf{r}><\textbf{g}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{g}></\textbf{r}>
    </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario monolingüe de catalán:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="trobar a faltar">
    <\textbf{i}>trob</\textbf{i}>
    <\textbf{par} \textsl{n}="abander/ar__vblex"/>
    <\textbf{p}>
      <\textbf{l}><\textbf{b}/>a<\textbf{b}/>faltar</\textbf{l}>
      <\textbf{r}><\textbf{g}><\textbf{b}/>a<\textbf{b}/>faltar</\textbf{g}></\textbf{r}>
    </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario bilingüe español--catalán:
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>echar<\textbf{g}><\textbf{b}/>de<\textbf{b}/>menos</\textbf{g}><\textbf{s} \textsl{n}="vblex"/></\textbf{l}>
    <\textbf{r}>trobar<\textbf{g}><\textbf{b}/>a<\textbf{b}/>faltar</\textbf{g}><\textbf{s} \textsl{n}="vblex"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\end{itemize}


Obsérvese cómo el símbolo gramatical se agrega al final, tras el grupo marcado con \texttt{<g>}.

Puede suceder también que un lema sea una multipalabra de este tipo en
un idioma, mientras que en el otro idioma sea una única palabra. En
este caso, en el diccionario bilingüe, la multipalabra contendrá el
elemento \texttt{<g>} y la palabra simple no. En los diccionarios
monolingües, se creará cada entrada de acuerdo con el tipo de lema.
Esto se ilustra con el siguiente ejemplo, correspondiente a la
multipalabra española \emph{darse cuenta}, cuya equivalencia en
catalán es el verbo \emph{adonar-se}:\footnote{El verbo
  \emph{adonar-se} es considerado una palabra simple, pues la
  colocación de los pronombres enclíticos es tratada dentro del
  paradigma de flexión de los verbos (para todos los idiomas de \emph{Apertium});
  así, no es necesario especificarlos en las entradas léxicas. La
  correcta colocación de los pronombres clíticos es una de las
  principales razones de la utilización de las etiquetas
  \texttt{<g>}... \texttt{</g>} alrededor de la parte invariable de
  los verbos multipalabra.}

\begin{itemize}

\item Diccionario monolingüe de español:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="darse cuenta">
    <\textbf{i}>d</\textbf{i}>
    <\textbf{par} \textsl{n}="d/ar__vblex"/>
    <\textbf{p}>
      <\textbf{l}><\textbf{b}/>cuenta</\textbf{l}>
      <\textbf{r}><\textbf{g}><\textbf{b}/>cuenta</\textbf{g}></\textbf{r}>
    </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario monolingüe de catalán:
\begin{small}
\begin{alltt}
<\textbf{e} \textsl{lm}="adonar-se">
    <\textbf{i}>adon</\textbf{i}>
    <\textbf{par} \textsl{n}="abander/ar__vblex"/>
</\textbf{e}>
\end{alltt}
\end{small}

\item Diccionario bilingüe español--catalán:
\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>dar<\textbf{g}><\textbf{b}/>cuenta</\textbf{g}><\textbf{s} \textsl{n}="vblex"/></\textbf{l}>
    <\textbf{r}>adonar<\textbf{s} \textsl{n}="vblex"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\end{itemize}

Los mismos principios y acciones descritos para las entradas básicas (cambio de género y número, restricciones
de dirección, etc.) se aplican también a todos los tipos de multipalabras. Para obtener una descripción más detallada
de las unidades multipalabra, consulte la página~\pageref{ss:multipalabras}.

\subsection{Colaborar en la mejora de datos léxicos}

Si ha añadido satisfactoriamente datos léxicos de propósito
general para cualquiera de los pares lingüísticos de \emph{Apertium},
considere la opción de facilitarlos a los desarrolladores del
proyecto para que podamos ofrecer una mejor herramienta a los usuarios.
Puede enviar los datos léxicos por correo electrónico (en tres ficheros XML, uno
para cada diccionario monolingüe y uno para el diccionario bilingüe) a las
direcciones siguientes:
\\

\begin{tabular}{ll}
Datos español--catalán & Mireia Ginestí: \texttt{mginesti@dlsi.ua.es}\\
Datos español--portugués & Carme Armentano: \texttt{carmentano@dlsi.ua.es}\footnote{El grupo de la Universitat d'Alacant ha desarrollado también datos para este par de lenguas al margen del presente proyecto.}\\ 
Datos español--gallego & Xavier Gómez-Guinovart: \texttt{xgg@uvigo.es}\\\\

\end{tabular}


Si cree que va a contribuir de manera más decisiva al proyecto, puede
unirse al grupo de desarrollo a través de www.sourceforge.net. Si no
dispone de cuenta en Sourceforge, primero deberá crearse una; a
continuación, escriba a Mikel L. Forcada (\texttt{mlf@ua.es}) o a Sergio
Ortiz (\texttt{sortiz@dlsi.ua.es}), o bien a Xavier Gómez Guinovart si está
interesado en el par español--gallego, explicando brevemente sus
motivaciones y experiencia para unirse al proyecto.  La forma usual de
aportar datos es mediante CVS; como miembro del proyecto, podrá 
hacer \texttt{commit} para subir
los cambios a los diccionarios directamente.

La adición de contribuciones léxicas se ha simplificado recientemente a través de formularios web en \url{http://xixona.dlsi.ua.es/prototype/webform/}, de manera que los colaboradores ocasionales no tienen que manejar ficheros XML.


Tenga en cuenta que los datos que aporte al proyecto serán
distribuidos gratuitamente bajo la licencia que corresponda al producto (licencia
GNU GPL o Creative Commons 2.5
Atribución-NoComercial-LicenciarIgual, según se indique). Asegúrese de que los datos
que entregue no estén afectados por ningún tipo de licencia que pueda ser 
incompatible con las licencias utilizadas en este proyecto. No se creará ningún tipo
de acuerdo o contrato entre usted y los desarrolladores. Si tiene alguna duda, o si
tiene previsto hacer una contribución de gran envergadura, póngase en contacto con Mikel L. Forcada.


\section[Introducir reglas de transferencia]{Introducir reglas de transferencia estructural}

El contenido de este capítulo repite parcialmente información ya expuesta
en el apartado de descripción del módulo de transferencia estructural (punto \ref{ss:transfer}),
aunque aquí se describen las reglas de una manera más general y práctica, orientada
a quienes deseen una primera aproximación a su funcionamiento.

Las reglas de transferencia estructural llevan a cabo transformaciones
en el texto analizado y desambiguado, que son necesarias debido a divergencias
gramaticales, sintácticas y léxicas entre los dos idiomas implicados
(cambios de género y de número para garantizar la concordancia en la
lengua meta, reordenamientos de palabras, cambios de preposiciones,
etc.). Las reglas detectan patrones (secuencias) de formas léxicas de
la lengua origen y les aplican las transformaciones correspondientes.
El módulo detecta los patrones de izquerda a derecha y recortando el
segmento concordante más largo (\emph{left-to-right, longest-match}):
Por ejemplo, el sintagma \emph{el gato verde} será detectado y procesado
por la regla para \emph{determinante}--\emph{nombre}--\emph{adjetivo} y no por
la regla para \emph{determinante}--\emph{nombre}, puesto que el primer patrón
es más largo. Si dos patrones tienen la misma longitud, la regla que se aplica
es la definida en primer lugar.

El módulo de transferencia estructural (generado a partir del fichero de reglas de
transferencia estructural) llama, durante el procesamiento, al módulo de transferencia léxica (generado a partir
del diccionario bilingüe) para determinar los equivalentes en lengua de meta de las formas
léxicas en lengua origen.

Las reglas de transferencia estructural están guardadas en un fichero XML, uno para cada
dirección de traducción (por ejemplo, para la traducción de español a catalán, el fichero
se llama \texttt{apertium-es-ca.trules-es-ca.xml}). Deberá editar este fichero para añadir
o modificar las reglas de transferencia.

Las reglas tienen un \textbf{patrón} y una \textbf{acción}. El patrón indica qué secuencias de formas léxicas
tienen que ser detectadas y procesadas. La acción describe las verificaciones y transformaciones que deben
realizarse en ellas. Algunas operaciones de transformación usuales (como las operaciones de concordancia
de género y número) están definidas dentro de una macroinstrucción que se llama dentro de la regla.
Al final de la parte de acción de cada regla, se envían las formas léxicas resultantes en la lengua meta
para que puedan ser procesadas por los módulos posteriores del sistema de traducción.

Un fichero de reglas de transferencia contiene cuatro secciones con definiciones de elementos utilizados en las
reglas, y una quinta sección en la que se definen las reglas propiamente dichas. Las secciones son las
siguientes:

\begin{itemize}

\item \texttt{<section-def-cats>}: Esta sección contiene la definición
  de las categorías que se utilizarán en los patrones de las reglas
  (es decir, los tipos de formas léxicas que serán detectados por una
  regla determinada). Para la regla que se presenta más abajo, es
  necesario haber definido aquí las categorías \texttt{det} y
  \texttt{nom} (determinante y nombre). Las categorías se definen
  especificando los símbolos gramaticales que tienen las formas
  léxicas que se quiere incluir. Un asterisco indica que los símbolos
  gramaticales especificados van seguidos de uno o más símbolos en las
  formas léxicas correspondientes. A continuación se presenta la
  definición de la categoría \texttt{det}, que agrupa determinantes y
  predeterminantes\footnote{como el español \emph{todo}, \emph{toda},
    \emph{todos}, \emph{todas}} en una misma categoría pues para el
  módulo de transferencia desempeñan un papel similar:

\begin{small}
\begin{alltt}
<\textbf{def-cat} \textsl{n}="det">
    <\textbf{cat-item} \textsl{tags}="det.*"/>
    <\textbf{cat-item} \textsl{tags}="predet.*"/>
</\textbf{def-cat}>
\end{alltt}
\end{small}

También es posible definir definir una categoría para un lema
determinado, como la siguiente para la preposición \texttt{en}:

\begin{small}
\begin{alltt}
<\textbf{def-cat} \textsl{n}="en">
    <\textbf{cat-item} \textsl{lemma}="en" \textsl{tags}="pr"/>
</\textbf{def-cat}>
\end{alltt}
\end{small}


\item \texttt{<section-def-attrs>}: Esta sección contiene la definición de los atributos que se utilizarán
dentro de las reglas, en la parte de acción. Se necesitan atributos para las categorías
definidas en la sección anterior si van a  utilizarse en la parte de acción de una regla 
(para realizar verificaciones en ellas o para enviarlas al final de la regla), así como para otros
atributos necesarios en la regla (como el género o el número). Los atributos se definen especificando
los símbolos gramaticales correspondientes y no pueden llevar asteriscos; su nombre tiene que ser
unívoco. A continuación se muestran las definiciones para los atributos \texttt{a\_det} (para
determinantes) y \texttt{gen} (para el género):

\begin{small}
\begin{alltt}
<\textbf{def-attr} \textsl{n}="a_det">
    <\textbf{attr-item} \textsl{tags}="det.def"/>
    <\textbf{attr-item} \textsl{tags}="det.ind"/>
    <\textbf{attr-item} \textsl{tags}="det.dem"/>
    <\textbf{attr-item} \textsl{tags}="det.pos"/>
    <\textbf{attr-item} \textsl{tags}="predet"/>
</\textbf{def-attr}>

<\textbf{def-attr} \textsl{n}="gen">
    <\textbf{attr-item} \textsl{tags}="m"/>
    <\textbf{attr-item} \textsl{tags}="f"/>
    <\textbf{attr-item} \textsl{tags}="mf"/>
    <\textbf{attr-item} \textsl{tags}="nt"/>
    <\textbf{attr-item} \textsl{tags}="GD"/>
</\textbf{def-attr}>

\end{alltt}
\end{small}

\item \texttt{<section-def-vars>}: Esta sección contiene la definición
  de las variables utilizadas en las reglas.  

\begin{small}
\begin{alltt}
  <\textbf{def-var} \textsl{n}="interrogativa"/>
\end{alltt}
\end{small}

\item \texttt{<section-def-macros>}: Aquí se definen las macroinstrucciones, que contienen secuencias
de código utilizado con frecuencia dentro de las reglas; esto evita tener que escribir
repetidamente las mismas acciones al crear las reglas. Hay macroinstrucciones, por ejemplo, para
operaciones de concordancia de género y número.

\item \texttt{<section-def-rules>}: Esta es la sección en la que se escriben las reglas de transferencia
estructural.

\end{itemize}

A continuación se presenta como ejemplo una regla que detecta la secuencia \emph{determinante--nombre}:

\begin{small}
\begin{alltt}
<\textbf{rule}>
  <\textbf{pattern}>
    <\textbf{pattern-item} \textsl{n}="det"/>
    <\textbf{pattern-item} \textsl{n}="nom"/>
  <\textbf{/pattern}>
  <\textbf{action}>
    <\textbf{call-macro} \textsl{n}="f_concord2">
      <\textbf{with-param} \textsl{pos}="2"/>
      <\textbf{with-param} \textsl{pos}="1"/>
    </\textbf{call-macro}>
    <\textbf{out}>
      <\textbf{lu}>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="whole"/>
      </\textbf{lu}>
      <\textbf{b} \textsl{pos}="1"/>
      <\textbf{lu}>
        <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="whole"/>
      </\textbf{lu}>
    </\textbf{out}>
  </\textbf{action}>
</\textbf{rule}>
\end{alltt}
\end{small}

Una parte de la acción ejecutada en este patrón está especificada
dentro de la macroinstrucción \texttt{f\_concord2}, que
está definida en la sección \texttt{<section-def-macros>}. Esta
macroinstrucción realiza operaciones de concordancia de género y de
número: si se produce un cambio de género o número entre la lengua
origen y la lengua meta (en el nombre), se cambia el género o el
número del determinante de acuerdo con ello; además, si el género o el
número son indeterminados (\texttt{GD} o
\texttt{ND}\footnote{Véanse las páginas \pageref{pg:GD}
o \pageref{GDND}}), el nombre recibe el valor correcto de género o número 
aportado por el determinante que le precede. En Apertium es--ca, es--gl
y es--pt, se han definido macroinstrucciones de concordancia para una, dos, tres
o cuatro formas léxicas (\texttt{f\_concord1}, \texttt{f\_concord2}, 
\texttt{f\_concord3}, \texttt{f\_concord4}). Cuando se llama
una macroinstrucción en una regla, debe indicarse cuál es la forma léxica principal (la que
tiene más peso en la determinación de género o número de las demás formas léxicas) y qué
otras formas léxicas del patrón tienen que incluirse en las operaciones de concordancia,
en  orden de importancia. Esto se realiza con el elemento \texttt{<with-param pos=""/>}. En la
regla precedente, la forma léxica principal es el nombre (posición "2" en el patrón) y la segunda
es el determinante (posición "1" en el patrón).

Tras las acciones pertinentes, se envían las formas léxicas resultantes, dentro del elemento \texttt{<out>}. Cada
forma léxica se define mediante un \texttt{<clip>}, cuyos atributos significan lo siguiente:

\begin{itemize}

\item [-]\texttt{pos}: hace referencia a la posición de la forma léxica en el
  patrón; \texttt{1} representa la primera forma léxica (el
  determinante) y \texttt{2} la seguna (el nombre).

\item [-]\texttt{side}: indica si la forma léxica está en lengua origen
  (\texttt{sl}) o en lengua meta (\texttt{tl}).
  Naturalmente, al final de la regla las palabras se envían siempre en
  la lengua meta; las formas léxicas en lengua origen pueden
  necesitarse dentro de una regla para evaluar sus atributos o
  características.

\item [-]\texttt{part}: indica qué parte de la forma léxica incluye el \texttt{clip}. Pueden utilizarse
algunos valores predefinidos:

\begin{itemize}

\item [-]\texttt{whole}: la forma léxica completa (lema más símbolos
  gramaticales). Se utiliza sólo al enviar la forma léxica (dentro de
  un elemento \texttt{<out>}).

\item [-]\texttt{lem}: el lema de la forma léxica

\item [-]\texttt{lemh}: la cabeza del lema de una multipalabra con flexión
  intercalada (véase el apartado \ref{multi} de este capítulo, o bien
  la página~\pageref{ss:multipalabras} si desea una explicación más
  detallada)

\item [-]\texttt{lemq}: la cola del lema de una multipalabra con flexión
  intercalada


\end{itemize}

A parte de estos valores predefinidos, puede utilizarse cualquiera de
los atributos definidos en la sección \texttt{<section-def-attrs>}
(como \texttt{gen} o \texttt{a\_det}).

Los valores \texttt{lemh} y \texttt{lemq} se utilizan al enviar multipalabras con
flexión intercalada para poder colocar la cabeza y la cola del lema en
la posición correcta, puesto que el módulo previo desplazó la cola
justo después de la cabeza del lema por varios motivos. En la
práctica, en nuestro sistema, esto significa que para enviar verbos
hay que utilizar estos valores en lugar de \texttt{whole}. Esto se debe a
que, en nuestros diccionarios, las multipalabras con flexión
intercalada son siempre verbos y, si se utiliza el valor \texttt{whole} al
enviarlos al final de una regla, la multipalabra quedaría mal formada
(la cabeza y la cola del lema no tendrían la posición correcta y la
multipalabra no podría generarse en el generador).

\end{itemize}


Según lo dicho, pues, una regla que contenga un verbo en el patrón debe enviar las 
formas léxicas como en estos dos ejemplos:

\label{regla_verbo1}
\begin{small}
\begin{alltt}
<\textbf{rule}>
  <\textbf{pattern}>
    <\textbf{pattern-item} \textsl{n}="verb"/>
  <\textbf{/pattern}>
  <\textbf{action}>
    <\textbf{out}>
      <\textbf{lu}>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="lemh"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="a_verb"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="temps"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="persona"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="gen"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="nbr"/>
        <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="lemq"/>
      </\textbf{lu}>
    </\textbf{out}>
  </\textbf{action}>
</\textbf{rule}>
\end{alltt}
\end{small}


\label{regla_verbo2}
\begin{small}
\begin{alltt}
<\textbf{rule}>
  <\textbf{pattern}>
    <\textbf{pattern-item} \textsl{n}="verb"/>
    <\textbf{pattern-item} \textsl{n}="prnenc"/>
  <\textbf{/pattern}>
  <\textbf{action}>
    <\textbf{out}>
      <\textbf{mlu}>
        <\textbf{lu}>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="lemh"/>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="a_verb"/>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="temps"/>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="persona"/>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="nbr"/>
        </\textbf{lu}>
        <\textbf{lu}>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="lem"/>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="a_prnenc"/>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="persona"/>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="gen"/>
          <\textbf{clip} \textsl{pos}="2" \textsl{side}="tl" \textsl{part}="nbr"/>
          <\textbf{clip} \textsl{pos}="1" \textsl{side}="tl" \textsl{part}="lemq"/>
        </\textbf{lu}>
      </\textbf{mlu}>
    </\textbf{out}>
  </\textbf{action}>
</\textbf{rule}>
\end{alltt}
\end{small}


La primera regla detecta un verbo y coloca la cola en la posición correcta, después de todos los símbolos
gramaticales. La unidad léxica se envía especificando sus atributos por separado: cabeza del lema, categoría
léxica (verbo), tiempo, persona, género (para los participios), número y cola del lema.

La segunda regla detecta un verbo seguido de un pronombre enclítico y envía dos formas léxicas especificando
también sus atributos por separado; la primera unidad léxica se compone de: cabeza del lema, categoría léxica
(verbo), tiempo, persona y número; la segunda unidad léxica se compone de: lema, categoría léxica (pronombre
enclítico) , persona, género, número y cola del lema (de la primera unidad léxica). De este modo, la cola
se coloca después del pronombre enclítico. Las dos unidades léxicas (verbo y pronombre enclítico) se envían
dentro de un elemento \texttt{<mlu>}, puesto que tienen que llegar al generador morfológico como unidad
multiléxica.


Teniendo en cuenta todo lo que se ha explicado, para \textbf{añadir una regla de transferencia} 
deben seguirse los pasos siguientes:

\begin{enumerate}

\item Especificar el patrón que se quiere detectar. Téngase presente que las palabras sólo son procesadas una vez
por las reglas, y que las reglas se aplican de izquierda a derecha y escogiendo el segmento concordante más largo.
Por ejemplo, supongamos que tenemos un fichero de reglas de transferencia con sólo dos reglas, una para el patrón
\emph{determinante--nombre} y otra para el patrón \emph{nombre--adjetivo}.
El sintagma español \emph{el valle verde} sería detectado y procesado por la primera regla, no por
la segunda. Si queremos que las tres palabras sean procesadas por una misma regla, deberemos
añadir una regla para el patrón \emph{determinante - nombre - adjetivo}

\item Describir las operaciones que deben realizarse sobre el patrón. En los sistemas Apertium \texttt{es-ca},
\texttt{es-gl} y \texttt{es-pt}, las operaciones normales de concordancia (de género y número) son fáciles de especificar
utilizando una macroinstrucción. Para realizar otras operaciones hay que utilizar elementos del lenguaje
más complicados, que están explicados con detalle en la sección \ref{formatotransfer}.

\item Enviar las unidades léxicas del patrón en la lengua meta dentro de un elemento \texttt{<out>}. Cada unidad
léxica debe estar dentro de un elemento \texttt{<lu>}. Si dos o más unidades léxicas deben ser generadas como
una unidad multiléxica (sólo para pronombres enclíticos en los pares de lenguas actuales), deben estar
agrupadas dentro de un elemento \texttt{<mlu>}.

Todas las palabras que sean detectadas por la regla (que son parte del patrón) deben enviarse al final de la
regla para que el módulo siguiente (el generador) las reciba. Si una unidad léxica es detectada por un patrón
y no se incluye dentro del elemento \texttt{<out>}, no se generará.


\end{enumerate}


\section[Añadir datos al desambiguador léxico]{Añadir datos para el desambiguador léxico categorial}

La información lingüística que necesita el desambiguador léxico
categorial para desambiguar un texto proviene básicamente de dos
fuentes: del fichero de definición del desambiguador y de corpus. Los
ficheros de definición del desambiguador se encuentran en el directorio de datos
lingüísticos y su nombre tiene la estructura
\texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_1$\texttt{.tsx} y
\texttt{apertium-}$L_1$\texttt{-}$L_2$\texttt{.}$L_2$\texttt{.tsx},
mientras que los corpus se encuentran en los directorios
$L_1$\texttt{-tagger-data} y $L_2$\texttt{-tagger-data} que están
contenidos en el directorio anterior. 

Los  \emph{ficheros de definición del desambiguador} contienen la definición de las etiquetas gruesas (o
categorías) que utiliza el desambiguador durante su entrenamiento y al
desambiguar un texto, así como restricciones de ocurrencia de
etiquetas que ayudan a obtener mejores probabilidades para la
desambiguación. En el apartado \ref{ss:tagger} se describen en detalle sus características.

Los \emph{corpus} que deben encontrarse en el directorio
$LANG$\texttt{-tagger-data} son diferentes según si el
entrenamiento del desambiguador se realiza de forma supervisada (con texto
desambiguado a mano) o no supervisada (sin texto desambiguado a mano):

\begin{itemize}

\item para el entrenamiento de forma supervisada se necesitan los
  ficheros (para español): \texttt{es.tagged.txt},
  \texttt{es.untagged}, \texttt{es.tagged}, \texttt{es.dic}.

\item para el entrenamiento de forma no supervisada se necesitan los
  ficheros (para español): \texttt{es.crp.txt}, \texttt{es.crp},
  \texttt{es.dic}

\end{itemize}

Las características de estos ficheros son las siguientes:

\begin{itemize}

\item \texttt{es.tagged.txt}: Un corpus español en formato de texto llano.
\item \texttt{es.untagged}: El corpus \texttt{es.tagged.txt} analizado morfológicamente, es decir,
 procesado por el desformateador de texto y el analizador morfológico (corpus creado automáticamente).
\item \texttt{es.tagged}: El corpus anterior desambiguado manualmente.
\item \texttt{es.crp.txt}: Un corpus grande (cientos de miles de
  palabras) utilizado cuando se entrena el desambiguador de forma no
  supervisada mediante el algoritmo de maximización de la esperanza
  matemática.
\item \texttt{es.crp}: El corpus anterior procesado consecutivamente
  por el desformateador de texto y el analizador morfológico (corpus creado automáticamente).
\item \texttt{es.dic}: Fichero creado a partir del diccionario
  monolingüe de español \texttt{*.es.dix}, mediante las herramientas
  \texttt{lt-expand} y \texttt{aper\-tium\--fil\-ter\--am\-biguity}, que
  expanden el diccionario y filtran las clases de ambigüedad,
  de modo que el fichero contenga todas las formas
  distintas que el etiquetador definido mediante el archivo
  \texttt{*.es.tsx} identifica como clases de ambigüedad diferentes,
  es decir, qué categorías léxicas pueden ser homógrafas (fichero creado automáticamente).
\end{itemize}

Al bajarse el traductor Apertium de Sourceforge
(\url{http://apertium.sourceforge.net/}), si el desambiguador ha sido
entrenado de forma supervisada es probable que se bajen los ficheros
necesarios para este tipo de entrenamiento, \texttt{es.tagged} y
\texttt{es.tagged.txt} (para español). Los demás ficheros requeridos
son generados automáticamente al ejecutarse el entrenamiento.
Si el desambiguador ha sido entrenado de forma no supervisada, no se bajará ningún
corpus pues los ficheros necesarios para entrenar de esta forma son de enorme tamaño. En
caso de que el usuario desee reentrenar el traductor de este modo, deberá recolectar
un corpus de gran tamaño para ello y ponerle el nombre \texttt{es.crp.txt}. Los demás
ficheros requeridos son generados automáticamente al ejecutarse el entrenamiento.

De todos modos, el traductor Apertium vienen con todos los datos necesarios
para que el desambiguador funcione correctamente. No es necesario entrenar
el desambiguador para utilizar Apertium. Puede ser necesario realizar
un reentrenamiento en caso de que se hayan realizado grandes cambios
en los diccionarios o se haya modificado el fichero de definición del
desambiguador.

Así pues, los datos del desambiguador se pueden modificar de dos maneras:

\begin{enumerate}

\item Modificar el fichero de definición del desambiguador. Se pueden
  añadir, modificar o suprimir etiquetas gruesas si se considera que
  una nueva categoría sería útil para la desambiguación o que la
  modificación de una categoría comportaría mejoras. También pueden
  añadirse restricciones (por ejemplo, se puede prohibir la secuencia
  determinante--determinante en un idioma si se trata de una combinación
  imposible o poco probable y con ello puede mejorarse la
  desambiguación de ciertas palabras homógrafas).

\item Modificar los corpus utilizados para entrenar el desambiguador.
  Puede modificarse el texto desambiguado a mano (\texttt{es.tagged}
  para español) para corregir algunas etiquetas mal elegidas. También
  pueden añadirse frases a este texto (así como el corpus
  \texttt{es.tagged.txt}, usado para generar automáticamente el corpus
  \texttt{es.untagged}) para dar más información al desambiguador,
  puesto que es posible que la mala desambiguación de ciertas categorias de palabras
  se deba a poca presencia o inexistencia en los corpus de entrenamiento.


\end{enumerate}

Para llevar a cabo el reentrenamiento, existen dos comandos:

\begin{itemize}

\item para entrenar de forma supervisada, debe escribirse, en el directorio
en el que se encuentren los datos lingüísticos (ejemplo para \emph{es}--\emph{ca}):
  \texttt{make -f es-ca-supervised.make} 


\item para entrenar de forma no supervisada, debe escribirse, en el directorio
en el que se encuentren los datos lingüísticos (ejemplo para \emph{es}--\emph{ca}):
  \texttt{make -f es-ca-unsupervised.make} 


\end{itemize}

En ambos casos se generarán automáticamente los ficheros previstos.


\section{Detección de errores}
\label{errores}


Es fácil cometer errores al añadir nuevas
palabras o reglas de transferencia al sistema Apertium.

Por un lado, es posible que, al compilar los ficheros nuevos, el
sistema muestre un mensaje de error. En este caso se tratará muy
probablemente de un error formal (una etiqueta XML que falta, una
etiqueta no permitida en un determinado contexto, etc.).  Sólo hay que
ir al número de línea indicado en el mensaje de error, corregirlo y
compilar de nuevo. Por otro lado, hay otros tipos de errores que no se
detectan al compilar pero que pueden provocar una mala traducción o la
traducción de una palabra por una cadena de texto incomprensible.
Éstos son errores lingüísticos, que pueden detectarse y corregirse con
la ayuda de la información ofrecida en este capítulo. La siguiente
información está dirigida a los usuarios de Linux, puesto que por el
momento Apertium funciona únicamente con este sistema
operativo.\footnote{Existen en \url{http://apertium.org} paquetes
  experimentales para Windows con los datos lingüísticos fijos
  (binarios no modificables).}

\subsection{Control de las marcas de error}
\label{subsec:marcaserror}

Cuando el sistema tiene algún problema para traducir una o más
palabras del texto en lengua origen, en el modo de funcionamiento por
defecto se muestra la palabra problemática acompañada de un símbolo
que indica que se ha producido algun error.
El significado de los diferentes símbolos es el siguiente:



\begin{itemize}


\item '\verb!@!': El problema se ha producido en el módulo de transferencia
  léxica, que no puede traducir la forma léxica (el diccionario
  bilingüe no la contiene)

\item '\verb!#!': El problema se ha producido en el generador, que no puede
  generar una forma superficial a partir de 
  la forma léxica (el diccionario morfológico no la contiene
  en la dirección de generación)

\item '\verb!/!': Este símbolo separa dos o más formas superficiales
  ofrecidas por el generador. El problema, por lo tanto, está en el
  diccionario monolingüe de la lengua meta, que contiene, en la
dirección de generación, dos formas superficiales para una forma
  léxica, cuando debería contener sólo una.


\end{itemize}


El módulo de generación tiene tres modos de funcionamiento, con los
cuales podemos elegir la forma en que se mostrarán los errores en el resultado final.
Los tres parámetros que pueden utilizarse son los siguientes:

\begin{itemize}

\item -n : no se visualizan ni los símbolos de error ni el símbolo de
palabra desconocida, así como ninguna etiqueta morfológica

\item -g : se visualizan los símbolos de error y el símbolo de palabra desconocida
 (funcionamiento por defecto)

\item -d : se visualizan los símbolos de error y el de palabra desconocida, además de
 las etiquetas morfológicas de las formas léxicas en las que se ha producido el error.


\end{itemize}


Según el tipo de usuario y la finalidad de la traducción, es más
conveniente utilizar una u otra opción. La primera opción es la más
adecuada cuando no se desea que signos ajenos al texto interfieran en
la lectura de la traducción. La segunda opción es útil cuando el usuario
quiere que el sistema le muestre cuándo ha habido algún problema en la traducción (errores
o palabras desconocidas) para poder posteditarla con más facilidad. La tercera
opción es ideal para los desarrolladores lingüísticos de Apertium, 
puesto que muestra toda la información
lingüística de las formas que han sufrido errores.

Utilizando los símbolos de error visualizados por el sistema, se puede
hacer una comprobación exhaustiva de los diccionarios de un par
de lenguas determinado, para detectar y corregir todos los errores que 
contienen; la forma de hacerlo se explica en el apartado \ref{integridad}.

\subsection{Salida de los diferentes módulos de Apertium}

A veces es difícil
localizar el origen de un error determinado. En este caso es útil
poder ver la salida de cada uno de los módulos.  Como todos los datos
procesados por el sistema, desde el texto original al texto traducido,
circulan entre los  módulos del sistema en formato de texto, es
posible detener el flujo de texto en cualquier punto y examinar la
entrada o la salida de un módulo determinado.  

Utilizando
una estructura de tubería y los comandos \texttt{echo} o \texttt{cat},
se puede enviar texto a través de uno o varios módulos para 
detectar el motivo del error. A continuación se explica
cómo hacerlo. El usuario debe situarse en el directorio en que se
guardan los datos lingüísticos y escribir los comandos mostrados.



\subsubsection{La salida del analizador morfológico}

Para saber cómo el traductor analiza una palabra, escriba lo siguiente en el terminal (ejemplo para la palabra catalana
\emph{sabates}):


\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin
\end{alltt}
\end{small}

Puede sustituirse \texttt{ca-es} por la dirección de traducción que se desea comprobar.

La salida de Apertium debería ser:
\begin{small}
\begin{alltt}
^sabates/sabata<n><f><pl>\$^./.<sent>\$[][]
\end{alltt}
\end{small}

La estructura de la cadena es
\verb!^!\texttt{palabra/lema<}\textsl{análisis
  morfológico}\texttt{>}\verb!$!. La etiqueta \texttt{<sent>}
corresponde al análisis del punto, ya que el sistema representa cada
fin de frase como un punto, tanto si aparece explícitamente en el
texto como si no.

El análisis de una palabra desconocida es (prescindiendo de la información del final de frase):

\begin{small}
\begin{alltt}
^genoma/*genoma\$
\end{alltt}
\end{small}

\noindent y el análisis de una palabra ambigua:

\begin{small}
\begin{alltt}
^casa/casa<n><f><sg>/casar<vblex><pri><p3><sg>/casar<vblex><imp><p2><sg>\$
\end{alltt}
\end{small}

Cada forma léxica (lema más análisis morfológico) es presentada como análisis posible de la palabra \emph{casa}.

\subsubsection{La salida del desambiguador}


Para saber cuál es la salida que da el desambiguador de un texto, escriba lo siguiente en el terminal (ejemplo
para la dirección catalán -- español):

\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob
\end{alltt}
\end{small}

La salida será:
\begin{small}
\begin{alltt}
^sabata<n><f><pl>\$^./.<sent>\$[][]
\end{alltt}
\end{small}

La salida de una palabra ambigua será igual que esta, puesto que el desambiguador elige una forma léxica de entre todas las posibles. Por lo tanto, la salida para la palabra \emph{casa} en catalán será, por ejemplo (según el contexto):

\begin{small}
\begin{alltt}
^casa<n><f><sg>\$^.<sent>\$[][]
\end{alltt}
\end{small}

\subsubsection{La salida del módulo \texttt{pretransfer}}

Este módulo aplica algunos cambios a las multipalabras (desplaza la cola del lema de una multipalabra con flexión
intercalada justo detrás de la cabeza del lema). Para conocer su salida, escriba:

\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob | apertium-pretransfer
\end{alltt}
\end{small}

Como \emph{sabates} no es una multipalabra este módulo no altera la entrada.

\subsubsection{La salida del módulo de transferencia estructural}

Para saber cómo se traduce a la lengua meta una palabra o un grupo de palabras y cómo lo procesan las reglas
de transferencia estructural, escriba lo siguiente en el terminal:
\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob | apertium-pretransfer \\| ./ca-es.transfer ca-es.autobil.bin
\end{alltt}
\end{small}

La salida para esta palabra sería:

\begin{small}
\begin{alltt}
^zapato<n><m><pl>\$^.<sent>\$[][]
\end{alltt}
\end{small}


Analizar cómo una palabra o frase sale de este módulo puede ayudar a
detectar errores en el diccionario bilingüe o en las reglas de
transferencia estructural. Los errores más comunes debidos al
diccionario bilingüe son: la existencia de dos equivalentes para una misma forma léxica de la lengua origen, o una 
asignación incorrecta de símbolos morfológicos. Los errores debidos a las reglas de transferencia estructural
pueden ser muy variados ya que dependen de las acciones realizadas por las reglas.


\subsubsection{La salida del generador morfológico}

Para saber cómo el sistema genera una palabra, escriba lo siguiente en el terminal:

\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob | apertium-pretransfer \\| ./ca-es.transfer ca-es.autobil.bin | ltproc -g ca-es.autogen.bin
\end{alltt}
\end{small}

Con este comando se pueden detectar errores de generación causados por una entrada incorrecta en el diccionario
monolingüe de la lengua meta o por divergencias entre la salida del diccionario bilingüe (la salida del módulo
anterior) y la entrada en el diccionario monolingüe.

La salida correcta para la entrada \emph{sabates} sería:

\begin{small}
\begin{alltt}
zapatos.[][]
\end{alltt}
\end{small}

Aquí ya no aparecen los símbolos morfológicos y la palabra aparece flexionada.

\subsubsection{La salida del postgenerador}

No es muy usual que se produzcan errores debido al postgenerador, ya que generalmente el diccionario de postgeneración
es de pequeño tamaño y raras veces se modifica una vez añadidas las combinaciones más usuales, pero también puede
comprobar cómo un texto en lengua origen sale de este módulo, escribiendo:

\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob | apertium-pretransfer \\| ./ca-es.transfer ca-es.autobil.bin | ltproc -g ca-es.autogen.bin \\| ltproc -p es-ca.autopgen.bin
\end{alltt}
\end{small}

\subsubsection{La salida de Apertium}

Se pueden poner todos los módulos del sistema en la estructura de tubería para ver cómo un texto en lengua origen
pasa a través de los módulos y es traducido a la lengua meta. Sólo hace falta añadir el reformateador al 
comando anterior:

\begin{small}
\begin{alltt}
echo "sabates" | apertium-destxt | lt-proc ca-es.automorf.bin \\|apertium-tagger -g ca-es.prob | apertium-pretransfer \\| ./ca-es.transfer ca-es.autobil.bin | ltproc -g ca-es.autogen.bin \\| ltproc -p es-ca.autopgen.bin | apertium-retxt
\end{alltt}
\end{small}

Esto es lo mismo que utilizar el \emph{script} (guión del intérprete
de comandos de Linux) \texttt{apertium-translator} proporcionado por
el paquete Apertium:

\begin{small}
\begin{alltt}
echo "sabates" | apertium-translator . ca-es
\end{alltt}
\end{small}

\noindent (El punto indica el directorio en el que se guardan los datos lingüísticos, en este caso el directorio actual).

Naturalmente, en lugar de escribir todos los comandos presentados cada vez que necesite probar una traducción, 
puede crear \emph{scripts} para cada acción y utilizarlos para probar la salida de cada módulo.




\subsection{Ejemplos de errores}


1) Podemos encontrarnos con el siguiente resultado en la traducción:

\begin{small}
\begin{alltt}
\$ echo "nord" | apertium-translator . ca-es
\$ #norte<n><m><sg>
\end{alltt}
\end{small}

Esto significa que la palabra ha sido traducida correctamente por el diccionario bilingüe pero que el sistema
no la ha encontrado en el diccionario morfológico de español para generarla. El problema puede encontrarse en el
diccionario morfológico, pero puede deberse también a una entrada bilingüe incorrecta, en la que los símbolos
morfológicos que recibe la palabra traducida no se corresponden con los símbolos morfológicos que esta palabra
tiene en el diccionario morfológico.

2) La siguiente entrada bilingüe \texttt{es-ca} no tiene en cuenta el
cambio de género entre \emph{adhesiu} (masculino) y \emph{pegatina}
(femenino), con lo cual provoca un error del traductor:

\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>pegatina<\textbf{s} \textsl{n}="n"/></\textbf{l}>
    <\textbf{r}>adhesiu<\textbf{s} \textsl{n}="n"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

\begin{small}
\begin{alltt}
\$ echo "adhesiu" | apertium-translator . ca-es
\$ #pegatina<n><m><sg>
\end{alltt}
\end{small}

La entrada correcta es:

\begin{small}
\begin{alltt}
<\textbf{e}>
  <\textbf{p}>
    <\textbf{l}>pegatina<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="f"/></\textbf{l}>
    <\textbf{r}>adhesiu<\textbf{s} \textsl{n}="n"/><\textbf{s} \textsl{n}="m"/></\textbf{r}>
  </\textbf{p}>
</\textbf{e}>
\end{alltt}
\end{small}

3) El siguiente error se produce cuando la forma léxica de la lengua origen no se ha podido encontrar en el 
diccionario bilingüe, ya sea porque no hay ninguna entrada para este lema o porque la entrada
no se corresponde con los símbolos morfológicos recibidos del analizador:


\begin{small}
\begin{alltt}
\$ echo "illot" | apertium-translator . ca-es
\$ @illot<n><m><sg>
\end{alltt}
\end{small}

4) Cuando una forma léxica de la lengua origen tiene dos equivalentes en el diccionario bilingüe, la salida
del traductor será como la que sigue:

\begin{small}
\begin{alltt}
\$ echo "llavor" | apertium-translator . ca-es
\$ #pepita<n>/semilla<n><m><sg>
\end{alltt}
\end{small}

La solución es poner una restricción de dirección en una de las entradas bilingües.


Algunos errores pueden ser debidos a reglas de transferencia
estructural. La manera de solucionar un error cuya causa no conocemos
es comprobar la salida de cada uno de los módulos para detectar en qué
punto surge el problema.

\subsection{Comprobación de la integridad de los diccionarios}\label{integridad}

Es muy recomendable comprobar la integridad de los diccionarios de vez
en cuando, especialmente si se ha hecho cambios significativos en
ellos (o bien si se ha modificado las reglas de transferencia, ya que
algunos errores pueden deberse a su aplicación).

La comprobación se realiza en una dirección de traducción, por lo que, para un par de lenguas determinado, 
hay que realizar dos comprobaciones, una en cada dirección.

Para ello, los pasos a seguir son los siguientes:

\begin{itemize}

\item expandir el diccionario monolingüe de la lengua origen, mediante
  la herramienta \texttt{lt-expand}, para obtener todas las formas
  léxicas (que son las formas que aparecen a la derecha de los dos
  puntos en el fichero resultante);

\item pasar estas formas léxicas (exceptuando las que sean sólo de
  generación, que \texttt{lt-expand} habrá marcado con el signo '\texttt{<}' )
  por todos los módulos del sistema desde el pretransfer hasta el generador;

\item Buscar en el resultado las formas léxicas marcadas con los signos '\texttt{\#}' ,
  '\texttt{@}' o '\texttt{/}', que serán las
formas con error (véase el apartado~\ref{subsec:marcaserror}).


\end{itemize}




\section{Generar un nuevo sistema con los  nuevos datos}

Si se realiza algún cambio a cualquiera de los ficheros de datos de Apertium (diccionarios, reglas de transferencia o
fichero de definición del desambiguador), es necesario volver a compilar
los módulos para que el sistema incorpore estos cambios. Para ello, hay que escribir \texttt{make} en el directorio en el
que se guardan los datos lingüísticos, y el sistema genererará los nuevos ficheros binarios.

Si se ha hecho algún cambio en el fichero de definición del
desambiguador o en el corpus utilizado para entrenar el mismo, será
necesario además reentrenar el desambiguador: en el mismo directorio
de datos lingüísticos, debe escribirse (ejemplo para el desambiguador de español en el
traductor es-ca) \texttt{make -f es-ca-unsupervised.make}
para el entrenamiento no supervisado o \texttt{make -f es-ca-supervised.make} 
para el entrenamiento supervisado.

Tras las operaciones de compilación, \texttt{apertium-translator} ya
utilizará los nuevos datos.

\newpage


\chapter{Formularis web d'inserció de dades}

\notavisible{*** ATENCIÓN ***
\newline TEXTO EN CATALÁN, PENDIENTE DE TRADUCCIÓN}


Aquest capítol presenta el sistema de manteniment de diccionaris
d'Apertium 2.  Està estructurat en dues seccions.  En la secció
\ref{ss:formadmin} es dóna l'informació necessària per a instal·lar la
ferramenta i realitzar adaptacions.  En la secció \ref{ss:formus} s'exposa el
mode d'ús de l'aplicació web per a dur a terme la millora de les dades
lingüístiques.


\section{Introducció}

El formularis per a la introducció de nous termes als diccionaris de
les diferents llengües sorgeixen com a resposta a la necessitat de
proveir una ferramenta amb la qual introduir còmodament noves paraules
als diferents diccionaris i amb la possibilitat de fer-ho de forma
remota des de qualsevol ordinador que tinga accés a Internet.

Així és plantegen com uns formularis que estan escrits en \texttt{php}
i són utilitzables amb qualsevol navegador d'Internet, bé de forma
local en el mateix ordinador on s'emmagatzemen els diccionaris o bé
remotament.

\section{Instal·lació i administració}
\label{ss:formadmin}

\subsection{Instal·lació de la ferramenta}

La instal·lació s'ha de realitzar en un màquina Unix, que tinga
instal·lat un servidor web Apache amb \texttt{php}. Així s'ha de
procedir primerament a fer la instal·lació del servidor \texttt{php}
si no estigués ja fet. Una vegada estiga resolt el punt anterior es
procedeix a fer la instal·lació pròpiament dita.

S'obté el paquet \textit{`apertium-lexical-webform-0.9'} i
es descomprimeix dins del directori on vaja a deixar-se la ferramenta
de formularis d'inserció.

\begin{alltt}
   # cd /ruta/dels/formularis
   # tar -xvzf /ruta/apertium-lexical-webform-0.9.tar.gz
\end{alltt}

S'ha de tenir en compte que l'Apache sols serveix les pàgines que
estan dintre del directori arrel amb què l'hem configurat. Per tant el
directori on deixem els formularis ha de ser un subdirectori que
estiga dintre de l'arrel del servidor Apache.

Seguidament s'edita el fitxer de configuració que està en
\textit{private/config.php} i es dóna valors adequats a les variables
de configuració:

\begin{itemize}
\item \texttt{\$anmor}: ruta sencera on es troba l'analitzador
  morfològic \texttt{lt-proc}.
\item \texttt{\$dicos\_path}: ruta on es troben els diccionaris finals
  i el binaris compilats de cada diccionari. Aquest directori ha de
  contenir un sub-directori per a cada diccionari amb el que pot
  treballar el formulari. El nom del subdirectori ha de seguir la
  següent sintaxi: \texttt{paradigmes-ll-rr} , on \textit{ll} i
  \textit{rr} són les inicials del parell de llengües del traductor en
  concret. En cada directori es deixen els diccionaris finals amb què
  treballa el traductor i els corresponents binaris compilats.
  Aquests directoris es poden substituir per enllaços simbòlics en
  cas que es troben en diferents llocs.
\item \texttt{\$usuaris\_professionals}: un llistat amb els usuaris
  professionals del sistema que tenen permís per a inserir als
  diccionaris del formulari i validar entrades (equivalències) pendents de
  confirmació.
\item \texttt{\$mail}: Adreça electrònica de l'administrador
  encarregat dels formularis. Quan algú sol.licite donar-se d'alta com
  a usuari s'enviarà un correu electrònic a aquesta adreça.
\end{itemize}

Una vegada s'han configurat els paràmetres d'aquest fitxer el servidor
de formularis ja es troba en funcionament.


\subsection{Estructura de directoris}

Tots els fitxers necessaris per al correcte funcionament s'estructuren
de la següent forma:

\begin{itemize}
\item \texttt{/index.php:} presenta el formulari inicial d'inserció.
  Té un apartat per a cada parell de llengües on s'introdueix el lema
  en llengua origen i en llengua meta i permet triar el tipus de
  categoria gramatical que es tracta. En prémer el botó \textit{'Go
    on'} avancem a la pàgina següent on seleccionarem els paradigmes
  de flexió corresponent a cadascun dels lemes en llengua origen i
  llengua meta.
\item \texttt{/dics:} directori amb els diccionaris de les entrades
  que van inserint-se des dels formularis. Estan els fitxers amb les
  entrades dels usuaris no professionals (pendents de ser validades) i
  els diccionaris amb les entrades en format \texttt{XML} dels usuaris
  professionals
\item \texttt{/private:} aquí està la major part dels mòduls
  utilitzats en els formularis. També conté els directoris amb la
  definició de paradigmes per a totes les llengües amb les que podem
  treballar, aquests directoris tenen la forma
  \texttt{paradigmes-ll-rr} sent \textit{ll} i \textit{rr} les
  inicials del parell de llengües del traductor en concret. L'ordre
  escollit per a les dues llengües, primer \textit{ll} i després
  \textit{rr} depèn de l'ordre en que s'hagen construït les entrades
  per al diccionari bilingüe. També estan en aquest directori els
  fitxers encarregats de fer tot el processament de les paraules a
  inserir. Aquests son:
\begin{itemize}
\item \texttt{resultado.php: } Aquest \textit{php} és cridat quan
  s'insereixen dues paraules de qualsevol parell de llengües des del
  mòdul \textit{index.php}. Bàsicament el que fa és establir el parell
  de llengües amb què es treballarà (\textit{\$LR} i \textit{\$RL}) i
  la categoria gramatical de la paraula que s'inserirà
  (\textit{\$tipus}). S'inclou al mòdul \textit{selec.php} que serà el
  següent que es crida en el procés d'inserció. En el cas que el
  \textit{tipus} de la paraula a inserir fos una unitat multi-paraula
  (\textit{Multi Word Verb}) aleshores és el mòdul \textit{multip.php}
  el que s'inclou i es crida en comptes de \textit{selec.php}. Els
  elements \textit{Multi Word Verb} o unitats multi-paraula estan
  formats per un verb que pot flexionar seguit d'una cua invariable
  d'una o més paraules.
\item \texttt{selecc.php: } És el mòdul encarregat de proporcionar la
  selecció del paradigma escollit per a cada una de les dues paraules,
  la paraula en llengua origen i en llengua meta. Proporciona una
  llista de paradigmes per a escollir que depenen del tipus gramatical
  de l'entrada que estem creant. Quan es selecciona un nou paradigma
  per a un dels dos lemes, proporciona uns exemples de la flexió del
  lema a inserir segons el paradigma que hem escollit. Si acceptem els
  paradigmes escollits, el mòdul crida a \textit{insertarPro.php} o
  \textit{insertar.php} depenen de si l'usuari que està fent la nova
  inserció està considerat com a professional o no professional
  respectivament.
\item \texttt{multip.php: } Té la mateixa funció que el mòdul
  \textit{selecc.php} però per a les unitats multi-paraula. Utilitza
  les mateixes variables i realitza les mateixes operacions, però quan
  mostra els exemples ho fa flexionant el verb i afegint totes les
  paraules que formen la cua. La manera de funcionar del mòdul és
  anàloga a la del mòdul \textit{selecc.php} i la seua descripció
  detallada la trobarem a l'apartat \ref{ss:fitxersphp}.
\item \texttt{valida.php: } Aquest mòdul es crida quan un usuari
  professional decideix validar paraules que estan en la cua
  d'entrades pendents de validació. Llegeix el fitxer amb la cua de
  paraules per validar i el recorre un a un, agafa les dades de
  l'entrada corresponent (\textit{LRlem, RLlem, paradigmaLR,
    paradigmaRL, LR, RL}, etc...) i crida a \textit{selecc.php} per a
  continuar amb el procés d'inserció d'eixa entrada particular.
\item \texttt{insertarPro.php: } Aquest mòdul es crida quan ja hem
  seleccionat el paradigma adequat per a la paraula en llengua origen
  i en llengua meta (operació realitzada en \textit{selecc.php}) i
  volem visualitzar com quedarà l'entrada en el format \texttt{XML}
  dels tres diccionaris, monolingüe origen, bilingüe i monolingüe
  meta. Des d'aquesta pantalla es podrà modificar directament el codi
  i finalment acceptar la nova entrada o cancelar l'operació.
\item \texttt{ins\_multip.php: } Té la mateixa funció que
  \textit{insertarPro.php} però està pensat per a les unitats
  multi-paraula, de manera que té un tractament especial amb l'entrada
  per a que el codi \texttt{XML} que s'insereix als diccionaris siga
  correcte.
\item \texttt{insertar.php: } És el mòdul equivalent a
  \textit{insertarPro.php} però quan l'operació està realitzant-la un
  usuari no professional. Les accions que es realitzen en este cas són
  molt més senzilles ja que l'única cosa que es fa és inserir en el
  fitxer de termes pendents de validar els lemes i els paradigmes
  escollits per l'usuari no professional, i queden allí fins que un
  usuari professional els valida.
\item \texttt{verSemi.php: } Este mòdul té la funció de mostrar el
  fitxer amb les entrades inserides per usuaris no professionals i que
  estan pendents de ser validades. Pot servir com ajuda per als
  usuaris professionals que abans de començar a validar paraules poden
  comprovar quines estan en la cua per a validar. Per a cridar-lo
  apareix un enllaç en el formulari generat per \textit{selec.php} des
  d'on es pot cridar aquesta funcionalitat.
\item \texttt{paradigmas.xsl:} Full d'estils que s'utilitza per a
  generar els fitxers de paradigmes amb que treballen els mòduls del
  formulari. S'utilitza amb l'especificació dels paradigmes de cada
  llengua escrit en format \texttt{XML}. Aquest punt es tractarà més
  extensament en l'apartat \textit{Fitxers de Paradigmes}.
\item \texttt{creaparadigma.awk:} Fitxer \texttt{awk} que també
  s'utilitza per a generar els fitxers de paradigmes de treball.
\item \texttt{gen\_paradig.sh:} Script que es pot fer servir si volem
  que automàticament es generen els fitxers de paradigmes de tots els
  parells de llengües que tenim instal·lats.
\end{itemize}
\end{itemize}

L'especificació detallada de les tasques de cada mòdul es troba en les
seccions corresponents.

\subsection{Fitxers php}

\subsubsection{resultado.php}

Depenent del valor de la variable \texttt{\$nomtrad} actualitzada per
\textit{index.php} el mòdul assigna els valor adequats a \texttt{\$LR}
i \texttt{\$RL} (el tipus de llengua origen i llengua meta
respectivament). Seguidament, depenent de la categoria gramatical de
la paraula que s'inserirà, assignem el valor adequat a la variable
\$tipus i cridem a \textit{selec.php} o \textit{multip.php} depenent
de si es tracta d'una paraula simple o d'una unitat multi-paraula.

\subsubsection{selecc.php}
\label{ss:fitxersphp}

Aquest mòdul té la funció de triar el paradigma corresponent a les
paraules que volem introduir. Es tria el paradigma de la paraula en
llengua origen i en llengua meta.

Depenent de la categoria gramatical de la paraula que estem
introduint, s'assignen uns determinats valors a unes variables que
darrerament s'utilitzaran, aquestes són
\begin{itemize}
\item \texttt{cadFich:} categoria gramatical del lema.
\item \texttt{show:} cadena que es mostra al formulari indicant la
  categoria gramatical de la paraula que està inserint-se.
\item \texttt{tag:} cadena amb l'etiqueta \texttt{XML} d'eixida de
  l'analitzador morfològic per a aquesta categoria gramatical.
\item \texttt{tagout:} cadena amb el codi \texttt{XML} que indica la
  categoria gramatical de la paraula. Esta cadena s'utilitzarà quan es
  compose l'entrada final \texttt{XML} que s'inserirà al diccionari.
\item \texttt{nota:} cadena amb possibles comentaris a inserir en el
  codi \texttt{XML} de l'entrada.
\end{itemize}
Els formularis treballen amb 4 tipus de diccionaris:
\begin{itemize}
\item \textit{Semiprofessionals}: Aquests contenen les paraules
  inserides des del formulari per usuaris no professionals i que estan
  pendents de validació. Acaben amb l'extensió "\textit{semi.dic}"
\item \textit{Diccionaris del formulari}: Contenen les paraules que
  han sigut inserides des del formulari per usuaris professionals i
  també les que han estat validades des dels diccionaris
  semiprofessionals. Acaben amb l'extensió "\textit{webform}".
\item \textit{Finals}: Són els fitxers amb totes les entrades escrites
  en codi \texttt{XML} . Aquests fitxers són els que utilitza
  definitivament el traductor després de rebre un tractament adequat
  de compilació. Acaben amb l'extensió "\textit{dix}".
\item \textit{Finals compilats}: Després d'haver compilat els
  diccionaris finals ja poden ser utilitzats pels binaris del
  traductor. Acaben amb l'extensió "\textit{bin}"
\end{itemize}

Aquests diccionaris són utilitzats pels formularis i hi ha variables
que contenen les rutes on es poden trobar. També es donen valors a les
variables que mantenen les rutes on s'han de buscar els fitxers
auxiliars i de configuració:
\begin{itemize}
\item \texttt{path:} ruta per als diccionaris temporals.
\item \texttt{fich\_LR:} diccionari de la llengua origen de les
  paraules inserides mitjançant el formulari i que encara no són al
  diccionari final ni al diccionari compilat.
\item \texttt{fich\_RL:} diccionari de la llengua meta de les paraules
  inserides mitjançant el formulari i que encara no són al diccionari
  final ni al diccionari compilat.
\item \texttt{fich\_LRRL:} diccionari bilingüe de les paraules
  inserides mitjançant el formulari i que encara no són al diccionari
  final ni al diccionari compilat.
\item \texttt{fich-semi:} entrades inserides mitjançant el formulari
  per usuaris no professionals i que estan pendents de validació.
\item \texttt{path\_paradigmasLR:} ruta dels fitxers amb els
  paradigmes de flexió per a llengua origen.
\item \texttt{path\_paradigmasRL:} ruta dels fitxers amb els
  paradigmes de flexió per a llengua meta.
\item \texttt{anmor:} ruta de l'analitzador morfològic.
\item \texttt{aut\_LRRL:} ruta del binari morfològic de llengua origen
  a llengua meta.
\item \texttt{aut\_RLLR:} ruta del binari morfològic de llengua meta a
  llengua origen.
\end{itemize}

Seguidament s'insereix el codi html del que ha de fer depenent de
l'acció seleccionada. Les accions que es produeixen per ordre
seqüencial són les següents:

\begin{itemize}
\item Comprova que el lema en llengua origen a inserir no hi siga ja
  en els diccionaris de paraules inserides pel formulari. Si s'hagués
  cridat a \texttt{selecc.php} des de la pantalla de validació de
  paraules (\texttt{valida.php}) aleshores comprova que el lema no hi
  siga ja en el fitxer de paraules inserides per usuaris no
  professionals. També ho comprova en el diccionari complet final.
\item Fa la mateixa comprovació corresponent per a la llengua meta.
\item Seguidament s'escriu codi per a seleccionar restriccions del
  sentit de la traducció.
\item Es defineixen una sèrie de funcions que s'utilitzaran en la
  generació d'exemples per als lemes quan triem el corresponent
  paradigma. Aquestes son:
  \begin{itemize}
  \item \texttt{esVocalFuerte}
  \item \texttt{esVocalDebil}
  \item \texttt{esVocal}
  \item \texttt{PosicioVocalTall}
  \end{itemize}
  Aquestes funcions es descriuen més endavant en l'apartat
  corresponent a \textit{insertarPro.php}.
\item S'obri el fitxer de paradigmes per a mostrar una finestra de
  selecció desplegable amb els paradigmes que podem triar per al lema
  en llengua origen que estem tractant. Per a fer això s'ha de
  comprovar seqüencialment els paradigmes corresponents a la categoria
  gramatical del lema i comprovar que el paradigma es pot aplicar al
  lema corresponent.
\item Seguidament es fa el mateix però per als paradigmes del lema en
  llengua meta.
\item Amb els lemes i amb els paradigmes corresponents seleccionats,
  s'han de generar els exemples de com quedaria la flexió d'eixos
  lemes segons els paradigmes escollits. Per aconseguir això
  necessitem per una banda l'arrel del lema (\texttt{raiz\_LR i
    raiz\_RL}) i per altra les terminacions d'exemple per al paradigma
  escollit (\texttt{paradigma\_LR i paradigma\_RL}), terminacions que
  s'obtenen del fitxer de paradigmes. Finalment compon una cadena amb
  els exemples generats (\texttt{ejemplos\_LR i ejemplos\_RL}) i els
  mostra
\item Si estem en aquesta pantalla perquè venim de validar paraules
  (\texttt{valida=1}) aleshores afegeix al formulari un botó per a
  eliminar l'entrada actual en cas que no volguérem validar-la i
  inserir-la.
\item Si l'usuari que ha entrat en aquesta pantalla és un usuari
  reconegut com a professional, aleshores afegeix al formulari un botó
  per a que eixe usuari puga triar l'opció de validar paraules
  inserides per usuaris no professionals
\item Finalment tenim el tractament de l'acció corresponent activada
  al polsar un dels botons de confirmació que es mostren a la part
  inferior del formulari. Si l'acció és \textit{"Delete"} , cosa que
  sols pot ocórrer quan s'estan validant entrades, elimina l'entrada
  corresponent del fitxer amb les entrades d'usuaris no professionals.
  Sinó, l'acció és la de confirmar (botó \textit{"Go on"}), i cridem
  al mòdul \texttt{insertarPro.php} o \texttt{insertar.php} depenent
  de si l'usuari es professional o no professional respectivament.
  Aquests mòduls s'encarreguen de fer l'inserció als diccionaris.
\end{itemize}
Quan s'ha inserit la paraula, es torna a mostrar la pàgina de
\texttt{validar.php} o de \texttt{selecc.php} depenent de si havíem
entrat des d'un procediment de validació (i aleshores
\textit{valida=1}) o des d'una inserció normal.

\subsubsection{multip.php}
El codi i el comportament d'aquest mòdul és el mateix que el de
\textit{selecc.php}. L'única diferència és que aquest està pensat per
a tractar les unitats multiparaula, mentre que \textit{selec.php}
tracta la resta de unitats. Així, la diferència més evident es que
tenim les variables \texttt{\$LRcua} i \texttt{\$RLcua} que contenen
la cua invariable que va després de la part variable de la
multi-paraula. Quan es mostren els exemples, a banda de mostrar la
part variable flexionada segons el paradigma escollit, també es mostra
un quadre de text modificable amb la cua invariable.

Quan es premi el botó de seguir amb l'inserció de l'entrada als
diccionaris, es crida al mòdul \textit{ins\_multip.php} en comptes de
\textit{insertarPro.php}.

\subsubsection{valida.php}
Aquest mòdul és cridat quan un usuari professional polsa el botó
"\textit{validate pairs}". El control passa a aquest mòdul que llegeix
el diccionari d'entrades pendents de ser validades (\$fichSemi) del
parell de llengües corresponent. Aleshores s'entra en un bucle que
recorre aquest fitxer i va llegint les entrades una a una. Amb la
informació de l'entrada particular dóna valor a una sèrie de variables
que seran utilitzades en els mòduls que faran el tractament posterior,
com ara:
\begin{center}
% use packages: array
\begin{tabular}{ll}
\$LRlem & \$RLlem \\ 
\$paradigmaLR & \$paradigmaRL \\ 
\$direccions & \$tipo \\ 
\$comentarios & \$user \\ 
\$geneLR & \$geneRL \\ 
\$numLR & \$numRL \\ 
\$LR & \$RL
\end{tabular}
\end{center}

Una vegada establerts els valors adequats per a aquestes variables es
cedeix el control a \textit{selec.php} que tracta l'entrada com si
d'una inserció d'usuari professional es tractara. Després d'inserir
les entrades als diccionaris mitjançant \textit{insertarPro.php}, el
flux torna a \textit{valida.php} que continua amb la següent entrada
per validar.

\subsubsection{insertarPro.php}
Una vegada introduïts els lemes i seleccionats els paradigmes
corresponents en \textit{selec.php}, aquest mòdul és l'encarregat de
generar les corresponents entrades en codi \texttt{XML} i inserir-les
als diccionaris monolingües i al bilingüe.

Realitza moltes operacions semblants a les realitzades en
\textit{selec.php}, com ara generar els exemples de la paraula
flexionada. Així primerament dóna valor a \texttt{cadFich, show, tag,
  tagout, nota} depenent de la categoria gramatical (\texttt{\$tipus})
de la paraula a inserir.  Assigna rutes a les variables de ubicació de
fitxers i defineix unes funcions necessàries de igual manera a com
ocorria en \textit{selec.php}.
\begin{itemize}
\item \texttt{esVocalFuerte}: Retorna \textit{true} si la vocal és
  forta, és a dir \textit{a, e, o}.
\item \texttt{esVocalDebil}: Retorna \textit{true} si la vocal és
  feble, és a dir \textit{a, e, o}.
\item \texttt{esVocal}: Retorna \textit{true} si el caràcter que li
  passem com argument és una vocal.
\item \texttt{diptongo}: Retorna \textit{true} si les dues lletres que
  se li passen com arguments formen diftong. Això ocorrerà sempre que
  les dues vocals no siguin fortes.
\item \texttt{acentuar}: Se li passa una cadena de text i l'accentua
  seguint les regles del castellà en funció del parametre
  \textit{\$siguienteletra}.
\item \texttt{esMayuscula}: Retorna \textit{true} si el caràcter està
  en majúscula.
\item \texttt{TieneAcento}: Retorna \textit{true} si la cadena té
  accent.
\item \texttt{acentua}: Accentua l'última vocal accentuable d'una
  paraula amb un accent tancat o obert depenent del sentit indicat en
  el paràmetre \$sentit.
\item \texttt{PonQuitaAcento}: Posa o lleva l'accent de la primera
  cadena passada com argument en funció de si la segona cadena
  argument té o no té accent.
\item \texttt{PosicioVocalTall}: Torna la posició dins del lema
  (\$lema) on es troba la vocal (\$vocal) que separa l'arrel de la
  desinència. Busquem la vocal del final cap al principi i tornem la
  primera ocurrència de \$vocal.
\end{itemize}

Ara es realitzen les mateixes operacions que en \textit{selec.php},
comprova que l'entrada no hi siga ja als diccionaris i genera els
exemples de la paraula flexionada amb el paradigma prèviament
escollit.  Seguidament el que fem és construir la cadena amb el codi
\texttt{XML} que va a inserirem al diccionari monolingüe de llengua
origen. Amb la informació que disposem dels lemes provinent de
\textit{selec.php}, es genera una cadena de text (\texttt{\$cad\_LR})
que conté el codi \texttt{XML} per al diccionari monolingüe. Aquesta
cadena es mostra en una finestra de text que pot ser modificada
manualment. El mateix procés es repeteix per a generar la cadena
corresponent al diccionari monolingüe de llengua meta
(\texttt{\$cad\_RL}) i per al diccionari bilingüe
(\texttt{\$cad\_bil}).  Seguidament, es concatena a aquestes variables
de cadena els comentaris i el nom d'usuari que insereix l'entrada, si
s'escau.  Finalment s'acaba de compondre la pantalla de formulari, amb
botons d'acceptar, eliminar i tornar cap enrere.  El codi que fa el
tractament de cadascuna de les possibles accions es troba al final del
fitxer:
\begin{itemize}
\item \texttt{Inserir: } En aquest cas, fa unes substitucions de
  caràcters perquè l'entrada tinga el format adequat per als
  diccionaris, i insereix les cadenes \texttt{\$cad\_LR, \$cad\_bil,
    \$cad\_RL} als diccionaris monolingüe origen, bilingüe i
  monolingüe meta respectivament (\texttt{\$fich\_LR, \$fich\_LRRL,
    \$fich\_RL}). Si es produeix algun tipus d'error en inserir
  l'entrada informa d'aquest fet amb una notificació per pantalla. Si
  \textit{insertarPro.php} havia estat cridat des d'un procediment de
  validació de paraules (\textit{\$valida=1}), aleshores insereix un
  botó "\textit{Continue}" per a seguir validant paraules. En cas
  contrari insereix un botó de tancar la finestra que ens permetrà
  acabar.
\item  \texttt{Eliminar: } En aquest cas, elimina l'entrada del fitxer d'entrades pendents de validar.
\end{itemize}

\subsubsection{ins\_multip.php}

Realitza les mateixes operacions que \textit{insertarPro.php} però
quan l'entrada a inserir és una unitat multi-paraula. La diferencia
principal és que ara disposem de dues variables addicionals
\texttt{\$LRcua} i \texttt{\$RLcua} que contenen la part invariable de
la multi-paraula. Quan s'insereix l'entrada als diccionaris s'ha
d'afegir aquesta cua al lloc convenient i convertir els espais en blanc
per l'etiqueta de blanc \texttt{<b/>}.

\subsubsection{insertar.php}

La funció d'aquest mòdul és molt senzilla. Compon una cadena de text
amb la informació provinent de \textit{selec.php} separada per
tabuladors. Aquesta cadena conté tota la informació necessària per a
generar una entrada al diccionari:

\texttt{\$LRlem.\$RLlem.\$paradigmaLR.\$direccion.\$paradigmaRL.}


\texttt{\$tipo.\$comentarios.\$user.\$geneLR.\$geneRL.}

 

Aquesta entrada es guarda en un fitxer (\$fichSemi) que conté la cua
amb les entrades pendents de validar inserides per usuaris no
professionals. Quan un usuari considerat professional vulga validar
entrades pendents, el mòdul \textit{valida.php} llegirà aquest mateix
fitxer.


\subsubsection{verSemi.php}
S'encarrega de mostrar per pantalla el fitxer d'entrades pendents de
validació, i ho fa així: llegeix el fitxer amb les entrades
(\textit{\$fichSemi}) i entra en un bucle que recorre totes les
entrades que es troben al fitxer. Per a cadascuna d'elles mostra un
línia amb la següent informació:

\texttt{\$LRlem
\$paradigmaLR
\$direccion
\$RLlem}

\texttt{\$paradigmaRL
\$tipo
\$comentarios}

\subsection{Fitxers de diccionari}

Els fitxers amb les entrades inserides des de el formulari es troben
en \texttt{/dics}. Ací es troben dos tipus de fitxers:

\begin{itemize}
\item \texttt{apertium-ll-rr.xx.webform}: El fitxer que conté entrades
  en codi \texttt{XML} preparades per a ser copiades en els
  diccionaris finals. El fitxer te el format mostrat, sent
  \texttt{ll-rr} les inicials corresponents al traductor al que fa
  referència eixe fitxer i \texttt{xx} les inicials a la llengua del
  monolingüe al que fa referència o les inicials del bilingüe. Per
  exemple, les inicials del traductor espanyol-català són
  \texttt{es-ca}. Per aquest traductor tenim el monolingüe de espanyol
  (\texttt{es}), el de català (\texttt{ca}) i el bilingüe
  (\texttt{es-ca}) Així, en aquest directori tindrem els següents
  fitxers per al traductor espanyol-català:
\begin{center}
\texttt{apertium-es-ca.es.webform	apertium-es-ca.ca.webform	apertium-es-ca.es-ca.webform}
\end{center}


\item \texttt{oo-mm.semi.dic}: El fitxer que conté les entrades
  pendents de ser validades d'un determinat traductor. \texttt{oo-mm}
  són les inicials corresponents al traductor concret. Per exemple, el
  traductor espanyol-català tindrà aquest fitxer per al
  semi-professional: \texttt{es-ca.semi.dic}


\end{itemize}

\subsection{Fitxers de paradigmes}

Els paradigmes utilitzats per a cada parell de llengües s'especifiquen
en dos arxius de format \texttt{XML} anomenats
\texttt{paradig.ll-rr.xx.xml} on \texttt{xx} són les inicials
corresponents a una llengua i \texttt{ll-rr} les inicials
corresponents a un parell de llengües. Aquests arxius estan formats per un
conjunt d'entrades corresponents a paradigmes o models de flexió de les paraules 
d'una llengüa en concret. El fitxer \texttt{XML} es composa de les següents parts:
\begin{itemize}
\item Capçalera/Arrel del document d'especificació.\\
\begin{alltt}
<?xml version="1.0" encoding="ISO-8859-1"?>
<?xml-stylesheet type="text/xsl" href="paradigmas.xsl"?>
<!DOCTYPE form SYSTEM "form.dtd">
<form lang="oc" langpair="oc-ca">
\end{alltt}
  A l'atribut \textit{lang} estan les inicials de la llengua per a la
  qual estan especificant-se paradigmes i a l'atribut
  \textit{langpair} estan les inicials corresponents al parell de
  llengües del traductor a què correspon el fitxer. Cal que
  al mateix directori on estan els fitxers de paradigmes estiga
  \texttt{form.dtd} on s'especifica la DTD que segueixen aquests
  fitxers. Aquesta DTD està detallada a l'anexe \ref{ss:dtdparadigmes}. 
\item Un conjunt d'elements que defineixen els paradigmes. Per a
  explicar el format dels elements s'utilitzarà el següent exemple:
  \\
\begin{alltt}
<entry PoS="adj" nbr="sg_pl" gen="mf">
        <endings>
                <stem>amable</stem> 
                <ending/>
                <ending>s</ending>  
        </endings>
        <paradigms howmany="1">
                <par n="amable\_\_adj"/>
        </paradigms>
</entry>
\end{alltt}
  Cada paradigma està especificat en un element \texttt{<entry>}.
  Aquest element pot tenir tres atributs:
  \begin{itemize}
  \item \textit{PoS}: la categoria gramatical del paradigma. Pot
    prendre els valors: acr, adj, adv, noun, pname, pr, verb. Aquest
    és obligatori per a qualsevol categoria gramatical.
  \item \textit{nbr}: els nombres admesos pel paradigma. Pot tenir
    els valors: sg, pl, sg\_pl, sp.
  \item \textit{gen}: els gèneres admesos pel paradigma. Pot tenir
    els valors: m, f, m f, mf.
  \end {itemize}
  A més, està format per dos elements:
  \begin{itemize}
  \item \texttt{endings}: l'arrel i les terminacions utilitzades per a
    seleccionar el paradigma al formulari i mostrar els exemples de
    flexió.
  \item \texttt{paradigms}: especificació del paradigma o
    paradigmes que defineixen la flexió seguida per una entrada en concret.
    Necessita de l'atribut \textit{howmany} que indica el nombre de
    paradigmes que utilitza l'entrada. Per a cadascun dels
    paradigmes utilitzats hi ha una línia que especifica el nom del
    paradigma del diccionari, i que té el següent format:
    \begin{center}
\begin{alltt}
<par n="long\_\_adj"/>
\end{alltt}           
    \end{center}
  \end {itemize}
\end {itemize}

A partir del fitxer de paradigmes escrit en \texttt{XML}, s'han de
generar els fitxers amb els que directament treballen els mòduls dels
formularis. Si s'executa el script \texttt{/private/gen\_paradig.sh}
el procés es realitza automàticament per a tots els parells de
llengües de què disposem:
\begin{alltt}
   #  cd private
   #  ./gen\_paradig.sh
\end{alltt}
Per a inserir un nou paradigma als formularis, cal
preparar l'entrada corresponent al fitxer de paradigmes en format
\texttt{XML} i després actualitzar els arxius de treball amb l'ordre
anterior.

El procés automatitzat també es pot realitzar de forma manual si no
volem actualitzar els fitxers de tots els parells de llengües que
tenim instal·lats. La generació manual dels arxius de
treball, es fa amb un full d'estil \texttt{XSL} mitjançant
aquesta ordre:
\begin{alltt}
   #  xsltproc paradigmas.xsl fitxer\_de\_paradigmes.xml 
                                     | ./creaparadig.awk
\end{alltt}

Aquesta acció genera un fitxer de treball per a cada categoria
gramatical. Els fitxers generats es troben en els directoris \texttt{/private/paradigmas.ll-rr}.
Cada directori conté fitxers amb els paradigmes que es poden utilitzar
per a cada parell de llengües \texttt{ll-rr} i per a cada component gramatical.
Cadascun d'aquests directori conté els fitxers següents:
\begin{itemize}
\item \texttt{paradigacr\_xx}: paradigmes per acrònims de la llengua
  \texttt{xx}.
\item \texttt{paradigadj\_xx}: paradigmes per adjectius de la llengua
  \texttt{xx}.
\item \texttt{paradigadv\_xx}: paradigmes per adverbis de la llengua
  \texttt{xx}.
\item \texttt{paradigcnjadv\_xx}: paradigmes per a conjuncions
  adverbials de la llengua \texttt{xx}.
\item \texttt{paradigcnjcoo\_xx}: paradigmes per a conjuncions
  copulatives de la llengua \texttt{xx}.
\item \texttt{paradigcnjsub\_xx}: paradigmes per a conjuncions
  subordinades de la llengua \texttt{xx}.
\item \texttt{paradignoun\_xx}: paradigmes per a noms de la llengua
  \texttt{xx}.
\item \texttt{paradigpname\_xx}: paradigmes per a noms propis de la
  llengua \texttt{xx}.
\item \texttt{paradigpr\_xx}: paradigmes per a preposicions de la
  llengua \texttt{xx}.
\item \texttt{paradigverb\_xx}: paradigmes per a verbs de la llengua
  \texttt{xx}.
\end{itemize}

Els fitxers estan composts per una entrada per línia. Cada entrada
conté la informació següent:

\begin{center}
% use packages: array
\begin{tabular}{lllll}
\textit{exemples} & \textit{nombre de paradigmes} & \textit{paradigmes\_model} & \textit{(nombres)} & \textit{(gèneres)}
\end{tabular}
\end{center}


El separador utilitzat per a les diferents parts de l'entrada es el
tabulador.
\begin{itemize}
\item \textit{Exemples}: són les terminacions que s'utilitzaran per a
  generar els exemples quan escollim aquest paradigma com a prototip
  per a una determinada paraula a inserir.
\item \textit{Nombre de paradigmes}: és el nombre de paradigmes del
  diccionari que s'utilitzaran per a flexionar adequadament aquest
  model de flexió en particular.
\item \textit{Paradigmes model}: és el nom del paradigma o paradigmes
  que estan al diccionari i que són els que s'utilitzaran per a
  flexionar la nova entrada.
\item \textit{(Nombres)}: Només es posa en el cas de noms, adjectius i
  acrònims. Fa referència al nombre del paradigma.
\item \textit{(Gèneres)}: Només es posa en el cas de noms, adjectius i
  acrònims. Fa referència al gènere del paradigma.
\end{itemize}

Així per exemple, al traductor espanyol-català tindríem el directori  \texttt{/private\-/paradigmas.es-ca} 
on trobaríem dos fitxers \texttt{XML}: \texttt{paradig.es-ca.es.xml}
i \texttt{paradig.es-ca.ca.xml} amb l'especificació dels paradigmes
utilitzats en cada llengua. A partir d'aquests fitxers es poden generar tots 
els fitxers de paradigmes per un parell de llengües concret amb l'ordre:
\begin{alltt}
   #  cd private/paradigmas.es-ca
   #  xsltproc ../paradigmas.xsl paradig.es-ca.es.xml 
                                    | ../creaparadig.awk
   #  xsltproc ../paradigmas.xsl paradig.es-ca.ca.xml 
                                    | ../creaparadig.awk
\end{alltt}

O bé, es poden generar automàticament per a tots els parells de llengües amb:
\begin{alltt}
   #  ./private/gen\_paradig.sh
\end{alltt}

Entre els fitxers de treball generats hi hauria un anomenat \texttt{paradigverb\_ca} que conté
els possibles paradigmes de verbs per al català, on una possible línia seria la següent:

\begin{center}
\texttt{abra/çar /ço /ci        1       abalan/çar\_\_vblex}
\end{center}

que deriva de l'entrada en \texttt{XML}:

\begin{alltt}
<entry PoS="verb">
        <endings>
                <stem>abra</stem> 
                <ending>çar</ending>  
                <ending>ço</ending> 
                <ending>ci</ending>
        </endings>
        <paradigms howmany="1">
                <par n="abalan/çar\_\_vblex"/>
        </paradigms>
</entry>
\end{alltt}

\section{Utilització dels formularis}
\label{ss:formus}
\subsection{Introducció}

\notavisible{Intentar evitar el llenguatge sexista en tot el document:
\emph{usuari}, etc.}
Quan la persona usuària vulga inserir noves entrades a un diccionari ha de connectar-se mitjançant un client navegador a l'adreça on s'haja instal·lat el servidor de
 formularis, per exemple:
\begin{center}
\texttt{http://xixona.dlsi.ua.es/forms}
\end{center}
S'obrirà una pàgina web amb el portal d'entrada a \texttt{Opentrad\- Apertium\- Insertion\- Form}. En el marc de l'esquerra hi ha enllaços per a obtenir més \textit{informació} , \textit{descarregar} els programes i \textit{contacte} per a sol·licitar
incriure's com a usuari del sistema. Per a inscriure's com a usuari cal enviar un correu electrònic al
\emph{webmaster} encarregat dels formularis.

\notavisible{Canviar a tot arreu \emph{registrar} per \emph{inscriure}.}
Per a inserir noves paraules, s'omplirà el formulari amb les dades corresponents i
es polsarà el botó \textit{'Go On'}; en aquest moment caldrà identificar-s'hi com a usuari
inscrit o no es podrà continuar amb el procediment d'inserir paraules. Quan
una persona s'inscriu es pot escriure de dues maneres: com a
\emph{professional} o com a \emph{no professional}. Cada modalitat té unes habilitacions
diferents, que s'explicaran en apartats següents.

\subsection{Inserció d'entrades}

\subsubsection{Perfil professional}

Quan es vol inserir una nova entrada als diccionaris cal dirigir-se a
l'apartat corresponent al parell de llengües que es vulga ampliar. Aleshores
s'especifica el lema en llengua origen i en llengua meta i es tria la
categoria gramatical de les entrades que s'inseriran. Seguidament, es polsa el
botó \textit{Go on} per a seguir amb el procés d'inserció.

En aquest punt apareix una nova finestra on mostra els lemes i uns
paràmetres que caracteritzen la nova entrada al diccionari. Si l'entrada ja
hi és en algun dels diccionaris, s'avisarà a la persona usuària i el sistema
automàticament escollirà sentit unidireccional (d'esquerra a dreta o a
l'inrevés). Si no és en cap, triarà doble sentit de traducció. 

En aquesta
nova finestra es poden fer estes tres accions, si s'escau:


\notavisible{Cal repassar la primera oració del paràgraf següent; sembla que
hi ha algun material que hauria de ser esborrat; Una altra cosa, els
formularis en l'actualitat no tenen suport per a traduccions múltiples,
segons sembla. Caldria fer constar aquesta circumstància en algun lloc.}
\begin{itemize}
\item Escollir el paradigma corresponent per al lema en llengua origen
   i també en llengua meta (aquesta acció és obligatòria, la resta
  no).\footnote{Escollir el paradigma és un procés amb el que s'ha
    d'anar amb molta cura. Cal triar el paradigma exacte que descriu
    el comportament del lema que estem inserint. En el cas
    d'adjectius, noms i acrònims, cal escollir el paradigma que
    s'ajusti a la flexió desitjada i també als gèneres admesos. En el
    cas d'acrònims cal fixar-se en el gènere i nombre que admeteix
    cada paradigma dels que podem escollir; per exemple BBC serveix
    per a acrònims femenins singulars i SA per a acrònims femenins que
    admeteixen plural). En el cas de noms propis cal escollir el
    paradigma corresponent depenent de si es tracta d'un nom propi de
    cosa (un diari), de persona o de lloc.}
\item Escollir la direcció de traducció de l'entrada si és diferent de
  la proposada automàticament.
\item Afegir comentaris en l'entrada que quedaran al diccionari final.
\end{itemize}

Una vegada hem fet les operacions corresponents, polsem el botó
\textit{'Go on'} si volem confirmar l'entrada o \textit{'Close'} si
senzillament volem cancelar l'operació d'inserció.

La següent i última pantalla que se'ns mostra conté les tres entrades
en format \texttt{XML} generades per als diccionaris monolingüe
llengua origen, bilingüe i monolingüe llengua meta. Aquestes entrades
es mostren en tres finestres de text i es poden editar per si cal fer
alguna modificació. Una vegada revisades les entrades, polsarem el
botó \textit{'Insert'} per a inserir-les definitivament als
diccionaris corresponents. També tenim la possibilitat de polsar el
botó \textit{'Go back'} en cas que volguérem tornar al pas anterior.

\subsubsection{Usuari no professional}

Quan un usuari entra al sistema d'inserció com a usuari no
professional, el procediment d'inserció de paraules és el mateix que
per a l'usuari professional, però les entrades inserides no es guarden
als diccionaris generats pels formularis sinó que queden en una cua
d'entrades pendents de validació. Per inserir les paraules d'aquesta
cua als diccionaris cal que un usuari professional les valide.

\subsection{Validació d'entrades pendents d'aprovació}

Els usuaris professionals, en la pantalla on s'escull el paradigma
dels lemes inserits, tenen dos enllaços addicionals:
\begin{itemize}
\item \textit{See pairs to be validated}: Ací obrirem una finestra on
  podrem veure el contingut del fitxer amb les paraules que estan
  pendents de validació; paraules que hauran estat inserides per
  usuaris no professionals. Aquesta finestra és merament informativa i
  es tanca polsant el botó \textit{'Close'}.
\item \textit{Validate pairs}: Aquesta opció permet a un usuari
  professional validar una a una les entrades pendents. Quan polsem
  este botó, s'obri la finestra de selecció de paradigmes que s'ha
  vist en l'apartat d'inserció de noves paraules. Esta finestra es
  mostra amb les dades que havia escollit l'usuari que havia afegit
  eixa entrada. Ara, l'usuari professional podrà modificar els lemes,
  esborrar l'entrada (botó \textit{'Delete'}) o seguir amb el procés
  d'inserció. Si segueix amb l'inserció de l'entrada, el procés és el
  mateix que en una inserció normal, sols que quan l'entrada queda
  definitivament afegida als diccionaris de formulari el control torna
  a mostrar la següent entrada a validar de la cua

Aquest procés és repeteix fins que es validen totes les paraules de la cua o finalitzem el procés en polsar el botó \textit{'Close'}.

\end {itemize}


\notavisible{FIN DEL TEXTO EN CATALÁN, PENDIENTE DE TRADUCCIÓN}

\newpage
\appendix

\chapter[DTDs en XML]{Definiciones de tipos de documento (DTD) en XML}
\label{DTDs}

\section{DTD para el formato de los diccionarios}
\label{ss:dtd_dics}


Definición de tipo de documento para el formato de los diccionarios
morfológicos, bilingües y de postgeneración en XML; esta definición
viene con el paquete \texttt{apertium} (última versión) que se puede
descargar de \url{http://www.sourceforge.net}.

La explicación de los distintos elementos se encuentra en la página
\pageref{formatodics} y siguientes.


\begin{small}
\begin{alltt}
<!\textsl{ELEMENT} \textbf{dictionary} (alphabet?, sdefs?,
		      pardefs?, section+)>

<!\textsl{ELEMENT} \textbf{alphabet} (\textsl{#PCDATA})>
	
<!\textsl{ELEMENT} \textbf{sdefs} (sdef+)>
	
<!\textsl{ELEMENT} \textbf{sdef} \textsl{EMPTY}>
<!\textsl{ATTLIST} sdef n ID \textsl{#REQUIRED}>
	
<!\textsl{ELEMENT} \textbf{pardefs} (pardef+)>
	
<!\textsl{ELEMENT} \textbf{pardef} (e+)>
<!\textsl{ATTLIST} pardef n CDATA \textsl{#REQUIRED}>
	
<!\textsl{ELEMENT} \textbf{section} (e+)>

<!\textsl{ATTLIST} section id ID \textsl{#REQUIRED}
                  type (standard|inconditional|postblank) \textsl{#REQUIRED}>
	
<!\textsl{ELEMENT} \textbf{e} (i | p | par | re)+>
<!\textsl{ATTLIST} e r (LR|RL) \textsl{#IMPLIED}
            lm CDATA \textsl{#IMPLIED}
            a CDATA \textsl{#IMPLIED}
            c CDATA \textsl{#IMPLIED}
	
<!\textsl{ELEMENT} \textbf{par} \textsl{EMPTY}>
<!\textsl{ATTLIST} par n CDATA \textsl{#REQUIRED}>
	
<!\textsl{ELEMENT} \textbf{i} (\textsl{#PCDATA} | b | s | g | j | a)*>
	
<!\textsl{ELEMENT} \textbf{re} (\textsl{#PCDATA})>
	
<!\textsl{ELEMENT} \textbf{p} (l, r)>
	
<!\textsl{ELEMENT} \textbf{l} (\textsl{#PCDATA} | a | b | g | j | s)*>
	
<!\textsl{ELEMENT} \textbf{r} (\textsl{#PCDATA} | a | b | g | j | s)*>
	
<!\textsl{ELEMENT} \textbf{a} \textsl{EMPTY}>
	
<!\textsl{ELEMENT} \textbf{b} \textsl{EMPTY}>
	
<!\textsl{ELEMENT} \textbf{g} (\textsl{#PCDATA} | a | b | j | s)*>
<!\textsl{ATTLIST} g i CDATA \textsl{#IMPLIED}>
	
<!\textsl{ELEMENT} \textbf{j} \textsl{EMPTY}>
	
<!\textsl{ELEMENT} \textbf{s} \textsl{EMPTY}>

<!\textsl{ATTLIST} s n \textsl{IDREF} \textsl{#REQUIRED}>

\end{alltt}
\end{small}



\subsection{Modificación en la DTD de diccionarios para selección léxica}
\label{dixdtd}

La DTD para el formato de los diccionarios se ha modificado ligeramente para que éstos
pueden funcionar en un sistema con módulo de selección léxica. A continuación se muestra
el cambio realizado, que afecta sólo al elemento  \texttt{<e>}



\begin{small}
\begin{alltt}

...
<!\textsl{ATTLIST} e  
        r (LR|RL) \textsl{#IMPLIED}   
        lm \textsl{CDATA #IMPLIED}
        a \textsl{CDATA #IMPLIED}
        c \textsl{CDATA #IMPLIED}>
        i CDATA \textsl{#IMPLIED}
        slr CDATA \textsl{#IMPLIED}
        srl CDATA \textsl{#IMPLIED}>

  <!-- r: restriction LR: left-to-right,
                      RL: right-to-left -->
  <!-- lm: lemma -->
  <!-- a: author -->
  <!-- c: comment -->
  <!-- i: ignore ('yes') means ignore, otherwise it is not ignored) -->
  <!-- slr: translation sense when translating from left to right -->
  <!-- srl: translation sense when translating from right to left --> 
...

\end{alltt}
\end{small}


\section[DTD para el desambiguador]{DTD para el formato de los ficheros del desambiguador}
\label{ss:DTD_desambiguador}

DTD que define el formato del fichero de especificación del
desambiguador.  Esta definición viene con el paquete \texttt{apertium}
(última versión) que se puede descargar de
\url{http://www.sourceforge.net}.

La descripción de los distintos elementos se encuentra
en la página~\pageref{formatotagger}.

  \begin{small}
  \begin{alltt}
<!\textsl{ELEMENT} \textbf{tagger} (tagset,forbid?,enforce-rules?,preferences?)>
<!\textsl{ATTLIST} tagger name \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{tagset} (def-label+,def-mult*)>

<!\textsl{ELEMENT} \textbf{def-label} (tags-item+)>
<!\textsl{ATTLIST} def-label name \textsl{CDATA} \textsl{#REQUIRED}
                    closed \textsl{CDATA} \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{tags-item} \textsl{#EMPTY}>
<!\textsl{ATTLIST} tags-item tags \textsl{CDATA} \textsl{#REQUIRED}
                    lemma \textsl{CDATA} \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{def-mult} (sequence+)>
<!\textsl{ATTLIST} def-mult name \textsl{CDATA} \textsl{#REQUIRED}
                   closed \textsl{CDATA} \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{sequence} ((tags-item|label-item)+)>

<!\textsl{ELEMENT} \textbf{label-item} \textsl{#EMPTY}>
<!\textsl{ATTLIST} label-item label \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{forbid} (label-sequence+)>

<!\textsl{ELEMENT} \textbf{label-sequence} (label-item+)>

<!\textsl{ELEMENT} \textbf{enforce-rules} (enforce-after+)>

<!\textsl{ELEMENT} \textbf{enforce-after} (label-set)>
<!\textsl{ATTLIST} enforce-after label \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{label-set} (label-item+)>

<!\textsl{ELEMENT} \textbf{preferences} (prefer+)>

<!\textsl{ELEMENT} \textbf{prefer} \textsl{EMPTY}>
<!\textsl{ATTLIST} prefer tags \textsl{CDATA} \textsl{#REQUIRED}>
  \end{alltt}
\end{small}


\section[DTD del módulo chunker]{DTD del módulo de transferencia estructural (chunker)}
\label{ss:dtdtransfer}

DTD para el formato de las reglas de transferencia estructural del
módulo \texttt{chunker}.  Esta definición viene con el paquete
\texttt{apertium} (versión 2.0) que se puede descargar de
\url{http://www.sourceforge.net}.

La descripción de los distintos elementos se
encuentra en el apartado \ref{formatotransfer}.


\begin{small}
\begin{alltt}
<!\textsl{ENTITY} \% condition "(and|or|not|equal|begins-with|
                       ends-with|contains-substring|in)">
<!\textsl{ENTITY} \% container "(var|clip)">
<!\textsl{ENTITY} \% sentence "(let|out|choose|modify-case|
                      call-macro|append)">
<!\textsl{ENTITY} \% value "(b|clip|lit|lit-tag|var|get-case-from|
                   case-of|concat)">
<!\textsl{ENTITY} \% stringvalue "(clip|lit|var|get-case-from|
                         case-of)">

<!\textsl{ELEMENT} \textbf{transfer} (section-def-cats, 
                    section-def-attrs, 
                    section-def-vars, 
                    section-def-lists?, 
                    section-def-macros?, 
                    section-rules)>

<!\textsl{ATTLIST} transfer default (lu|chunk) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{section-def-cats} (def-cat+)>

<!\textsl{ELEMENT} \textbf{def-cat} (cat-item+)>
<!\textsl{ATTLIST} def-cat n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{cat-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} cat-item lemma CDATA \textsl{#IMPLIED}
                   tags CDATA \textsl{#REQUIRED} >

<!\textsl{ELEMENT} \textbf{section-def-attrs} (def-attr+)>

<!\textsl{ELEMENT} \textbf{def-attr} (attr-item+)>
<!\textsl{ATTLIST} def-attr n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{attr-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} attr-item tags CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{section-def-vars} (def-var+)>

<!\textsl{ELEMENT} \textbf{def-var} \textsl{EMPTY}>
<!\textsl{ATTLIST} def-var n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-lists} (def-list)+>

<!\textsl{ELEMENT} \textbf{def-list} (list-item+)>
<!\textsl{ATTLIST} def-list n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{list-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} list-item v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-macros} (def-macro)+>

<!\textsl{ELEMENT} \textbf{def-macro} (\%sentence;)+>
<!\textsl{ATTLIST} def-macro n ID \textsl{#REQUIRED}>
<!\textsl{ATTLIST} def-macro npar CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-rules} (rule+)>

<!\textsl{ELEMENT} \textbf{rule} (pattern, action)>
<!\textsl{ATTLIST} rule comment CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{pattern} (pattern-item+)>

<!\textsl{ELEMENT} \textbf{pattern-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} pattern-item n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{action} (\%sentence;)*>

<!\textsl{ELEMENT} \textbf{choose} (when+,otherwise?)>

<!\textsl{ELEMENT} \textbf{when} (test,(\%sentence;)*)>

<!\textsl{ELEMENT} \textbf{otherwise} (\%sentence;)+>

<!\textsl{ELEMENT} \textbf{test} (\%condition;)+>

<!\textsl{ELEMENT} \textbf{and} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{or} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{not} (\%condition;)>

<!\textsl{ELEMENT} \textbf{equal} (\%value;,\%value;)>
<!\textsl{ATTLIST} equal caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{begins-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} begins-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{ends-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} ends-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{contains-substring} (\%value;,\%value;)>
<!\textsl{ATTLIST} contains-substring caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{in} (\%value;, list)>
<!\textsl{ATTLIST} in caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{list} \textsl{EMPTY}>
<!\textsl{ATTLIST} list n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{let} (\%container;, \%value;)>

<!\textsl{ELEMENT} \textbf{append} (\%value;)+>
<!\textsl{ATTLIST} append n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{out} (mlu|lu|b|chunk)+>

<!\textsl{ELEMENT} \textbf{modify-case} (\%container;, \%stringvalue;)>

<!\textsl{ELEMENT} \textbf{call-macro} (with-param)*>
<!\textsl{ATTLIST} call-macro n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{with-param} \textsl{EMPTY}>
<!\textsl{ATTLIST} with-param pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{clip} \textsl{EMPTY}>
<!\textsl{ATTLIST} clip pos CDATA \textsl{#REQUIRED}
               side (sl|tl) \textsl{#REQUIRED}
               part CDATA \textsl{#REQUIRED}
               queue CDATA \textsl{#IMPLIED}
               link-to CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{lit} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{lit-tag} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit-tag v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{var} \textsl{EMPTY}>
<!\textsl{ATTLIST} var n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{get-case-from} (clip|lit|var)>
<!\textsl{ATTLIST} get-case-from pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{case-of} \textsl{EMPTY}>
<!\textsl{ATTLIST} case-of pos CDATA \textsl{#REQUIRED}
                  side (sl|tl) \textsl{#REQUIRED}
                  part CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{concat} (\%value;)+>

<!\textsl{ELEMENT} \textbf{mlu} (lu+)>

<!\textsl{ELEMENT} \textbf{lu} (\%value;)+>

<!\textsl{ELEMENT} \textbf{chunk} (tags,(mlu|lu|b)+)>
<!\textsl{ATTLIST} chunk name CDATA \textsl{#IMPLIED}
                namefrom CDATA \textsl{#IMPLIED}
                case CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{tags} (tag+)>
<!\textsl{ELEMENT} \textbf{tag} (\%value;)>

<!\textsl{ELEMENT} \textbf{b} \textsl{EMPTY}>
<!\textsl{ATTLIST} b pos CDATA \textsl{#IMPLIED}>

\end{alltt}
\end{small}


\newpage
\section{DTD del módulo interchunk}
\label{ss:dtdinterchunk}

DTD para el formato de las reglas de transferencia estructural del módulo
\texttt{interchunk}. Esta definición viene con el paquete
\texttt{apertium} (versión 2.0) que se puede descargar de
\url{http://www.sourceforge.net}.

La descripción de los distintos elementos se
encuentra en el apartado \ref{formatotransfer}.



\begin{small}
\begin{alltt}

<!\textsl{ENTITY} \% condition "(and|or|not|equal|begins-with|
                       ends-with|contains-substring|in)">
<!\textsl{ENTITY} \% container "(var|clip)">
<!\textsl{ENTITY} \% sentence "(let|out|choose|modify-case|
                      call-macro|append)">
<!\textsl{ENTITY} \% value "(b|clip|lit|lit-tag|var|get-case-from|
                   case-of|concat)">
<!\textsl{ENTITY} \% stringvalue "(clip|lit|var|get-case-from|
                         case-of)">

<!\textsl{ELEMENT} \textbf{interchunk} (section-def-cats, 
                      section-def-attrs, 
                      section-def-vars, 
                      section-def-lists?, 
                      section-def-macros?, 
                      section-rules)>

<!\textsl{ELEMENT} \textbf{section-def-cats} (def-cat+)>

<!\textsl{ELEMENT} \textbf{def-cat} (cat-item+)>
<!\textsl{ATTLIST} def-cat n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{cat-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} cat-item lemma CDATA \textsl{#IMPLIED}
                    tags CDATA \textsl{#REQUIRED} >

<!\textsl{ELEMENT} \textbf{section-def-attrs} (def-attr+)>

<!\textsl{ELEMENT} \textbf{def-attr} (attr-item+)>
<!\textsl{ATTLIST} def-attr n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{attr-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} attr-item tags CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{section-def-vars} (def-var+)>

<!\textsl{ELEMENT} \textbf{def-var} \textsl{EMPTY}>
<!\textsl{ATTLIST} def-var n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-lists} (def-list)+>

<!\textsl{ELEMENT} \textbf{def-list} (list-item+)>
<!\textsl{ATTLIST} def-list n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{list-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} list-item v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-macros} (def-macro)+>

<!\textsl{ELEMENT} \textbf{def-macro} (\%sentence;)+>
<!\textsl{ATTLIST} def-macro n ID \textsl{#REQUIRED}>
<!\textsl{ATTLIST} def-macro npar CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-rules} (rule+)>

<!\textsl{ELEMENT} \textbf{rule} (pattern, action)>
<!\textsl{ATTLIST} rule comment CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{pattern} (pattern-item+)>

<!\textsl{ELEMENT} \textbf{pattern-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} pattern-item n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{action} (\%sentence;)*>

<!\textsl{ELEMENT} \textbf{choose} (when+,otherwise?)>

<!\textsl{ELEMENT} \textbf{when} (test,(\%sentence;)*)>

<!\textsl{ELEMENT} \textbf{otherwise} (\%sentence;)+>

<!\textsl{ELEMENT} \textbf{test} (\%condition;)+>

<!\textsl{ELEMENT} \textbf{and} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{or} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{not} (\%condition;)>

<!\textsl{ELEMENT} \textbf{equal} (\%value;,\%value;)>
<!\textsl{ATTLIST} equal caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{begins-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} begins-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{ends-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} ends-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{contains-substring} (\%value;,\%value;)>
<!\textsl{ATTLIST} contains-substring caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{in} (\%value;, list)>
<!\textsl{ATTLIST} in caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{list} \textsl{EMPTY}>
<!\textsl{ATTLIST} list n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{let} (\%container;, \%value;)>

<!\textsl{ELEMENT} \textbf{append} (\%value;)+>
<!\textsl{ATTLIST} append n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{out} (b|chunk)+>

<!\textsl{ELEMENT} \textbf{modify-case} (\%container;, \%stringvalue;)>

<!\textsl{ELEMENT} \textbf{call-macro} (with-param)*>
<!\textsl{ATTLIST} call-macro n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{with-param} \textsl{EMPTY}>
<!\textsl{ATTLIST} with-param pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{clip} \textsl{EMPTY}>
<!\textsl{ATTLIST} clip pos CDATA \textsl{#REQUIRED}
               part CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{lit} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{lit-tag} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit-tag v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{var} \textsl{EMPTY}>
<!\textsl{ATTLIST} var n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{get-case-from} (clip|lit|var)>
<!\textsl{ATTLIST} get-case-from pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{case-of} \textsl{EMPTY}>
<!\textsl{ATTLIST} case-of pos CDATA \textsl{#REQUIRED}
                  part CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{concat} (\%value;)+>

<!\textsl{ELEMENT} \textbf{chunk} (\%value;)+>

<!\textsl{ELEMENT} \textbf{pseudolemma} (\%value;)>

<!\textsl{ELEMENT} \textbf{b} \textsl{EMPTY}>
<!\textsl{ATTLIST} b pos CDATA \textsl{#IMPLIED}>

\end{alltt}
\end{small}

\newpage

\section{DTD del módulo postchunk}
\label{ss:dtdpostchunk}

DTD para el formato de las reglas de transferencia estructural del módulo
\texttt{postchunk}. Esta definición viene con el paquete
\texttt{apertium} (versión 2.0) que se puede descargar de
\url{http://www.sourceforge.net}.

La descripción de los distintos elementos se
encuentra en el apartado \ref{formatotransfer}.



\begin{small}
\begin{alltt}
<!\textsl{ENTITY} \% condition "(and|or|not|equal|begins-with|
                       ends-with|contains-substring|in)">
<!\textsl{ENTITY} \% container "(var|clip)">
<!\textsl{ENTITY} \% sentence "(let|out|choose|modify-case|
                      call-macro|append)">
<!\textsl{ENTITY} \% value "(b|clip|lit|lit-tag|var|get-case-from|
                   case-of|concat)">
<!\textsl{ENTITY} \% stringvalue "(clip|lit|var|get-case-from|
                         case-of)">

<!\textsl{ELEMENT} \textbf{postchunk} (section-def-cats, 
                      section-def-attrs, 
                      section-def-vars, 
                      section-def-lists?, 
                      section-def-macros?, 
                      section-rules)>

<!\textsl{ELEMENT} \textbf{section-def-cats} (def-cat+)>

<!\textsl{ELEMENT} \textbf{def-cat} (cat-item+)>
<!\textsl{ATTLIST} def-cat n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{cat-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} cat-item name CDATA \textsl{#REQUIRED}>
 
<!\textsl{ELEMENT} \textbf{section-def-attrs} (def-attr+)>

<!\textsl{ELEMENT} \textbf{def-attr} (attr-item+)>
<!\textsl{ATTLIST} def-attr n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{attr-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} attr-item tags CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{section-def-vars} (def-var+)>

<!\textsl{ELEMENT} \textbf{def-var} \textsl{EMPTY}>
<!\textsl{ATTLIST} def-var n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-lists} (def-list)+>

<!\textsl{ELEMENT} \textbf{def-list} (list-item+)>
<!\textsl{ATTLIST} def-list n ID \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{list-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} list-item v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-def-macros} (def-macro)+>

<!\textsl{ELEMENT} \textbf{def-macro} (\%sentence;)+>
<!\textsl{ATTLIST} def-macro n ID \textsl{#REQUIRED}>
<!\textsl{ATTLIST} def-macro npar CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{section-rules} (rule+)>

<!\textsl{ELEMENT} \textbf{rule} (pattern, action)>
<!\textsl{ATTLIST} rule comment CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{pattern} (pattern-item+)>

<!\textsl{ELEMENT} \textbf{pattern-item} \textsl{EMPTY}>
<!\textsl{ATTLIST} pattern-item n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{action} (\%sentence;)*>

<!\textsl{ELEMENT} \textbf{choose} (when+,otherwise?)>

<!\textsl{ELEMENT} \textbf{when} (test,(\%sentence;)*)>

<!\textsl{ELEMENT} \textbf{otherwise} (\%sentence;)+>

<!\textsl{ELEMENT} \textbf{test} (\%condition;)+>

<!\textsl{ELEMENT} \textbf{and} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{or} ((\%condition;),(\%condition;)+)>

<!\textsl{ELEMENT} \textbf{not} (\%condition;)>

<!\textsl{ELEMENT} \textbf{equal} (\%value;,\%value;)>
<!\textsl{ATTLIST} equal caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{begins-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} begins-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{ends-with} (\%value;,\%value;)>
<!\textsl{ATTLIST} ends-with caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{contains-substring} (\%value;,\%value;)>
<!\textsl{ATTLIST} contains-substring caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{in} (\%value;, list)>
<!\textsl{ATTLIST} in caseless (no|yes) \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{list} \textsl{EMPTY}>
<!\textsl{ATTLIST} list n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{let} (\%container;, \%value;)>

<!\textsl{ELEMENT} \textbf{append} (\%value;)+>
<!\textsl{ATTLIST} append n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{out} (b|lu|mlu)+>

<!\textsl{ELEMENT} \textbf{modify-case} (\%container;, \%stringvalue;)>

<!\textsl{ELEMENT} \textbf{call-macro} (with-param)*>
<!\textsl{ATTLIST} call-macro n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{with-param} \textsl{EMPTY}>
<!\textsl{ATTLIST} with-param pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{clip} \textsl{EMPTY}>
<!\textsl{ATTLIST} clip pos CDATA \textsl{#REQUIRED}
               part CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{lit} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{lit-tag} \textsl{EMPTY}>
<!\textsl{ATTLIST} lit-tag v CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{var} \textsl{EMPTY}>
<!\textsl{ATTLIST} var n \textsl{IDREF} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{get-case-from} (clip|lit|var)>
<!\textsl{ATTLIST} get-case-from pos CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{case-of} \textsl{EMPTY}>
<!\textsl{ATTLIST} case-of pos CDATA \textsl{#REQUIRED}
                  part CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{concat} (\%value;)+>

<!\textsl{ELEMENT} \textbf{mlu} (lu+)>

<!\textsl{ELEMENT} \textbf{lu} (\%value;)+>

<!\textsl{ELEMENT} \textbf{b} \textsl{EMPTY}>
<!\textsl{ATTLIST} b pos CDATA \textsl{#IMPLIED}>

\end{alltt}
\end{small}

\newpage


\section[DTD para reglas de formato]{DTD para las reglas de especificación de formato}
\label{ss:dtd_formato}

DTD para las reglas de especificación de formato, que puede
descargarse de la página web  
\url{http://cvs.sourceforge.net/viewcvs.py/apertium/apertium/apertium/format.dtd}.


La descripción de los distintos
elementos se encuentra en el apartado \ref{ss:reglasformato}.

\begin{small}
\begin{alltt}
<!\textsl{ELEMENT} \textbf{format} (options,rules)>
<!\textsl{ATTLIST} format name \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{options} (largeblocks, input, output, 
                   escape-chars, space-chars, case-sensitive)>

<!\textsl{ELEMENT} \textbf{largeblocks} \textsl{EMPTY}>
<!\textsl{ATTLIST} largeblocks size \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{input} \textsl{EMPTY}>
<!\textsl{ATTLIST} input zip-path \textsl{CDATA} \textsl{#IMPLIED}
                encoding \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{output} \textsl{EMPTY}>
<!\textsl{ATTLIST} output zip-path \textsl{CDATA} \textsl{#IMPLIED}
                 encoding \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{escape-chars} \textsl{EMPTY}>
<!\textsl{ATTLIST} escape-chars regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{space-chars} \textsl{EMPTY}>
<!\textsl{ATTLIST} space-chars regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{case-sensitive} \textsl{EMPTY}>
<!\textsl{ATTLIST} case-sensitive value (yes|no) \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{rules} (format-rule|replacement-rule)+>

<!\textsl{ELEMENT} \textbf{format-rule} (begin-end|(begin,end))>
<!\textsl{ATTLIST} format-rule eos (yes|no) \textsl{#IMPLIED}
                      priority \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{begin-end} \textsl{EMPTY}>
<!\textsl{ATTLIST} begin-end regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{begin} \textsl{EMPTY}>
<!\textsl{ATTLIST} begin regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{end} \textsl{EMPTY}>
<!\textsl{ATTLIST} end regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{replacement-rule} (replace+)>
<!\textsl{ATTLIST} replacement-rule regexp \textsl{CDATA} \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{replace} \textsl{EMPTY}>
<!\textsl{ATTLIST} replace source \textsl{CDATA} \textsl{#REQUIRED}
                  target \textsl{CDATA} \textsl{#REQUIRED}
                  prefer (yes|no) \textsl{#IMPLIED}>

\end{alltt}
\end{small}

\newpage
\section{DTD de los paradigmas del formulario}
\label{ss:dtdparadigmes}

DTD para el formato de los ficheros de paradigmas que utiliza la herramienta de formularios. Esta definición
viene con el paquete
\texttt{apertium-lexical-webform}.

\begin{small}
\begin{alltt}


<!\textsl{ELEMENT} \textbf{form} (entry)+>

<!\textsl{ATTLIST} \textbf{form}
        lang CDATA \textsl{#REQUIRED}
        langpair CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{entry} (endings, paradigms)+>

<!\textsl{ATTLIST} \textbf{entry}
        PoS CDATA \textsl{#REQUIRED}
        nbr CDATA \textsl{#IMPLIED}
        gen CDATA \textsl{#IMPLIED}>

<!\textsl{ELEMENT} \textbf{endings} (stem, ending+)>

<!\textsl{ELEMENT} \textbf{stem} (\textsl{#PCDATA})>

<!\textsl{ELEMENT} \textbf{ending} (\textsl{#PCDATA})>

<!\textsl{ELEMENT} \textbf{paradigms} (par+)>

<!\textsl{ATTLIST} \textbf{paradigms} howmany CDATA \textsl{#REQUIRED}>

<!\textsl{ELEMENT} \textbf{par} \textsl{EMPTY}>

<!\textsl{ATTLIST} \textbf{par} n CDATA \textsl{#REQUIRED}>



\end{alltt}
\end{small}




\chapter[Símbolos gramaticales]{Símbolos gramaticales utilizados en los módulos}
\label{se:simbolosmorf}



\section[Símbolos de los diccionarios]{Símbolos gramaticales utilizados en los diccionarios}

\subsection{Lista de símbolos}


\begin{tabular}{ll}

\textbf{aa} & adjetivo-adjetivo (función antecedente relativo) \\
\textbf{acr}    & acrónimo \\
\textbf{al}    & otros \\
\textbf{an} & adjetivo-nombre (función antecedente relativo) \\
\textbf{ant}    & antropónimo \\
\textbf{cni}    & condicional \\
\textbf{cnjadv} & conjunción adverbial \\
\textbf{cnjcoo} & conjunción coordinativa \\
\textbf{cnjsub} & conjunción subordinativa \\ 
\textbf{def}    & definido \\
\textbf{dem}    & demostrativo \\
\textbf{det}    & determinante\\
\textbf{detnt}  & determinante neutro \\
\textbf{enc}    & enclítico\\
\textbf{f}      & femenino\\
\textbf{fti}    & futuro de indicativo\\
\textbf{fts}    & futuro de subjuntivo\\
\textbf{ger}    & gerundio\\
\textbf{ifi}    & pretérito perfecto o indefinido\\
\textbf{ij}     & interjección\\
\textbf{imp}    & imperativo\\
\textbf{ind}    & indeterminado\\
\textbf{inf}    & infinitivo\\

\end{tabular}
\newpage

\begin{tabular}{ll}
\textbf{itg}    & interrogativo\\
\textbf{loc}    & locativo\\
\textbf{lpar}   & ([\\
\textbf{lquest} & ¿\\
\textbf{m}      & masculino\\
\textbf{mf}     & masculino-femenino\\
\textbf{n}      & nombre\\
\textbf{nn}     & nombre-nombre (función antecedente relativo)\\
\textbf{np}     & nombre propio\\
\textbf{nt}     & neutro\\
\textbf{num}    & numeral\\
\textbf{p1}     & primera persona\\
\textbf{p2}     & segunda persona\\
\textbf{p3}     & tercera persona\\
\textbf{pii}    & pretérito imperfecto de indicativo\\
\textbf{pis}    & pretérito imperfecto de subjuntivo\\
\textbf{pl}     & plural \\
\textbf{pos}    & posesivo\\
\textbf{pp}     & participio\\
\textbf{pr}     & preposición\\
\textbf{preadv} & preadverbio\\
\textbf{predet} & predeterminante\\
\textbf{pri}    & presente de indicativo\\
\textbf{prn}    & pronombre\\
\textbf{pro}    & proclítico\\
\textbf{prs}    & presente de subjuntivo\\
\textbf{ref}    & reflexivo\\
\textbf{rel}    & relativo\\
\textbf{rpar}   & )]\\
\textbf{sent}   & . ? ; : ! \\
\textbf{sg}     & singular\\
\textbf{sp}     & singular-plural\\
\textbf{sup}    & superlativo\\
\textbf{tn}     & tónico\\
\textbf{vaux}   & verbo auxiliar\\
\textbf{vbhaver}& verbo \emph{haver}\\
\textbf{vblex}  & verbo léxico\\
\textbf{vbmod}  & verbo modal\\
\textbf{vbser}  & verbo \emph{ser}

\end{tabular}

\newpage
\subsection{Especificación de formas léxicas}

Orden de colocación de las etiquetas en los diccionarios morfológicos
de este sistema (orden de izquierda a derecha en la tabla):
\\
\\

\begin{footnotesize}
\begin{tabular}{|l|llllll|}

\hline
\textbf{Adjetivos generales}  & \textbf{Categoría} & \textbf{Género} & \textbf{Número} &&& \\\cline{2-7}
(difícil, rojo)    & adj & m & sg &&& \\   
                   &  & f & pl &&& \\
                   &  & mf & sp &&& \\
                  \hline
\textbf{Adjetivos interrogativos,} & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} &\textbf{Número}&& \\\cline{2-7}
\textbf{posesivos, indeterminados}    & adj & itg & m & sg &&\\                                  
 \textbf{y superlativos}              &     & pos & f & pl &&\\
  (qué, tus, otra, buenísimo)         &     & ind & mf & sp &&\\
                                      &     & sup &    &    &&\\\hline


\textbf{Adverbios}   & \textbf{Categoría} &&&&&\\\cline{2-7}
(siempre, mañana)& adv &&&&&\\\hline

\textbf{Preadverbios}  & \textbf{Categoría} &&&&&\\\cline{2-7}
(muy, tan)& preadv &&&&&\\\hline

\textbf{Adverbios interrogativos}  & \textbf{Categoría} &\textbf{Tipo}&&&&\\\cline{2-7}
(dónde) & adv & itg &&&&\\\hline

\textbf{Conjunciones adverbiales}  & \textbf{Categoría} &&&&&\\\cline{2-7}
(que, así como)     & cnjadv &&&&&\\
                    & cnjcoo &&&&&\\
                    & cnjsub &&&&&\\\hline


\textbf{Determinantes} & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} &\textbf{Número}&& \\\cline{2-7}
(el, uno, este, mi)                          & det & def & m & sg &&\\                                 
                                  &  & ind & f & pl &&\\
                                  &  & dem & mf & sp &&\\
                                  &  & pos &  &  &&\\\hline

\textbf{Determinante neutros}   & \textbf{Categoría} &&&&&\\\cline{2-7}
(lo)& detnt &&&&&\\\hline

\textbf{Predeterminantes} & \textbf{Categoría} & \textbf{Género} & \textbf{Número} &&& \\\cline{2-7}
(todos)                          & predet & m & sg &&&\\                                 
                          &  & f & pl &&&\\
                          &  & nt & sp &&&\\\hline
\textbf{Interjecciones}  & \textbf{Categoría} &&&&&\\\cline{2-7}
(hola) & ij &&&&&\\\hline




\textbf{Nombres comunes}& \textbf{Categoría} & \textbf{Género} & \textbf{Número} &&& \\\cline{2-7} 
(casa, perro)            & n & m & sg &&&\\                                 
                         & n & f & pl &&&\\
                         & n & mf & sp &&&\\\hline

\textbf{Nombres propios}& \textbf{Categoría} &\textbf{Tipo}&&&&\\\cline{2-7}
(Pedro, Londres)         & np & ant &&&&\\
                         &  & loc &&&&\\
                         &  & al &&&&\\\hline

\end{tabular}
\newpage
\begin{tabular}{|l|llllll|}
\hline

\textbf{Acrónimos}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} & \textbf{Número} && \\\cline{2-7} 
(IRPF, INEM)        & n & acr & m & sg &&\\                                 
                    &  &  & f & pl &&\\
                    &  &  & mf & sp &&\\\hline


\textbf{Numerales} & \textbf{Categoría} & \textbf{Género} & \textbf{Número} &&& \\\cline{2-7}
(tres)             & num & m & sg &&& \\                  
                   & & f & pl &&& \\
                   & & mf & sp &&& \\\hline

\textbf{Preposiciones}  & \textbf{Categoría} &&&&&\\\cline{2-7}
(de, por) & pr &&&&&\\\hline

\textbf{Pronombres interrogativos}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} &\textbf{Número}&& \\\cline{2-7}
(quién, qué)                      & prn & itg & m & sg &&\\                                 
                                  &  &  & f & pl &&\\\hline


\textbf{Pronombres enclíticos,}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Persona}& \textbf{Género} &\textbf{Número}& \\\cline{2-7}
\textbf{proclíticos y tónicos}     & prn & enc & p1 & m & sg &\\
   \textbf{de persona}             &     & pro & p2 & f & pl &\\
   (yo, vosotros, ayudar\textbf{te}, &   & tn  & p3 & mf & sp & \\
   \textbf{te} ayudo)                &  &  &  & nt && \\
                                     &     &       &  &  &  &     \\\cline{2-7}
\textbf{Pron. procl. reflexivo} (se):  & prn & pro & ref & p3 & mf & sp\\\cline{2-7}
\textbf{Pron. tón. reflexivo} (si):    & prn & tn & ref & p3 & mf & sp\\\hline



\textbf{Pron. tónicos posesivos}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Pos.}& \textbf{Género} &\textbf{Número}& \\\cline{2-7}
(mío, suyo)                         & prn & tn & pos & m & sg &\\
                                 &  &  &  & f & pl &\\\hline


\textbf{Otros pron. tónicos}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} &\textbf{Número}&& \\\cline{2-7}
(aquella, nadie, otro)           & prn & tn &  m & sg &&\\
                                 &  &  &  f & pl &&\\
                                 &  &  &  mf & sp && \\
                                 &  &   & nt &&& \\\hline


\textbf{Relativos pronominales}  & \textbf{Categoría} & \textbf{Tipo} & \textbf{Género} & \textbf{Número} && \\\cline{2-7} 
\textbf{y adjetivales}      & rel & nn & m & sg &&\\                                 
(que, cuyo)      &  & an  & f & pl &&\\
                    &  & aa  & f & pl &&\\\hline

\textbf{Relativos adverbiales}  & \textbf{Categoría} & \textbf{Tipo} &  &  && \\\cline{2-7} 
(como, donde)                   & rel & adv & &  &&\\\hline


\textbf{Verbos}  & \textbf{Tipo} & \textbf{Tiempo} & \textbf{Persona} &\textbf{Número}&& \\
 \textbf{(formas personales)} &        & \textbf{y modo} &                  &               && \\\cline{2-7}
(subo, vamos)                     & vblex & cni & p1 & sg &&\\                                 
                                  & vbser & fti  & p2 & pl &&\\
                                  & vbhaver & fts  & p3 &  &&\\
                                  & vbmod & ifi &   & &&\\
                                  & & imp  &  &  &&\\
                                  &  & pii  &  &  &&\\
                                  &  & pis  &  &  &&\\
                                  &  & pri  &  &  &&\\
                                  &  & prs  &  & &&\\\hline


\textbf{Verbos}  & \textbf{Tipo} & \textbf{Forma} &  & && \\\cline{2-7}
\textbf{(infinitivo y gerundio)}  & vblex & inf & & &&\\                                        
(cantar, buscando)               & vbser & ger & & &&\\  
                                 & vbhaver &  & & &&\\  
                                 & vbmod & & & &&\\\hline



\textbf{Verbos}  & \textbf{Tipo} & \textbf{Forma} &\textbf{Género}  &\textbf{Número} && \\\cline{2-7}
\textbf{(participio)} & vblex & pp & m & sg &&\\                                      
(dormido, cansadas)              & vbser &  & f & pl &&\\  
                                 & vbhaver &  & & &&\\  
                                 & vbmod & & & &&\\\hline
   


\end{tabular}
\end{footnotesize}


\newpage
\section{Categorías del desambiguador}
\subsection{Desambiguador de español}

Estas son las categorías o etiquetas gruesas con las que trabaja el
desambiguador léxico categorial del español. 


\begin{footnotesize}
\begin{longtable}{l|l|c|l}
\hline
\bf{Etiqueta} & \bf{Descripción} & \bf{Cerrada} & \bf{Ejemplos} \\
\hline
\hline
\endhead
\multicolumn{4}{c}{\bf{Etiquetas simples}} \\
\hline
\hline
PARAPR & Lexicalización \emph{para} como preposición & Sí & \\
\hline
PARAVBPRI & Lexicalización \emph{para} como verbo léxico & & \\ & en presente de indicativo & Sí& \\
\hline
PARAVBIMP & Lexicalización \emph{para} como verbo léxico & & \\ & en imperativo & Sí& \\
\hline
QUECNJ & Lexicalización \emph{que} como conjunción & Sí& \\
\hline
QUEREL & Lexicalización \emph{que} como relativo & Sí& \\
\hline
COMOPR\footnote{El analizador morfológico considera que \emph{como} puede ser una
preposición ya que puede sustituirse por \emph{en calidad de} en algunos contextos (Ej.- \emph{'Os hablo como
director de la película'}} 
       & Lexicalización \emph{como} como preposición & Sí& \\
%!!!!!!!!!!Explicar esto de la preposición porque no es muy estándar que digamos
\hline
COMOREL & Lexicalización \emph{como} como relativo & Sí& \\
\hline
COMOVB & Lexicalización \emph{como} como verbo léxico & & \\ & en presente de indicativo & Sí& \\
\hline
MASADV & Lexicalización \emph{más}/\emph{menos} como advervio & Sí& \\
\hline
MASADJ & Lexicalización \emph{más}/\emph{menos} como adjetivo & Sí& \\
\hline
MASNP & Lexicalización \emph{Más} como nombre propio & Sí& \\
\hline
ALGO & Lexicalización \emph{algo} como nombre propio & Sí& \\ 
\hline
ACRONIMOM & Acrónimo & No& BCH\\
\hline
ACRONIMOF & Acrónimo & No& ONUH\\
\hline
ACRONIMOMF & Acrónimo & No& ATS\\
\hline
INTNOM & Pronombre interrogativo & Sí& quién, cuál\\
\hline
ADJINT & Adjetivo interrogativo & Sí& cuánto, qué\\
\hline
INTADV & Adverbio interrogativo & Sí& cuándo, dónde\\
\hline
PREADV & Advervio que puede preceder a otro & &\\& adverbio o adjetivo & Sí& muy, bien, mal\\
\hline
ADV & Adverbio & No& nunca, ahí\\
\hline
CNJSUBS & Conjunción subordinante & Sí& que\\
%!!!!!!! No hay más conjunciones subordinadas a parte de que?????
\hline
CNJCOORD & Conjunción coordinante & Sí& y, pero\\
\hline
CNJADV & Conjunción subordinante adverbial & No& si\\
\hline
DETNT & Determinante neutro & Sí& lo\\
\hline
DETM & Determinante & Sí& el, un\\
\hline
DETF & Determinante & Sí& la, una\\
\hline
DETMF & Determinante & Sí& cada\\
\hline
INTERJ & Interjección & No& ojalá, hola\\
\hline
NOM & Nombre & No& casa, coche\\
\hline
ANTROPONIM & Nombre propio de persona & No& Fernando\\
\hline
TOPONIM & Nombre propio de lugar & No& Alicante\\
\hline
NPALTRES & Otros nombre propios & No& Linux, Seat\\
\hline
NUM & Numeral & Sí& tres, cuatro\\
\hline
PREDETNT & Predetermiante neutro & Sí& todo\\
\hline
PREDET & Predeterminante Ej. todo & Sí& toda\\
\hline
PREP & Preposición & Sí& ante, desde\\
\hline
PRNTNNT & Pronombre tónico neutro & Sí& algo, esto\\
\hline
PRNTN & Pronombre tónico & Sí& ambos, nadie\\
\hline
PRNENCREF & Pronombre enclítico reflexivo & Sí& se \\
\hline
PRNPROREF & Pronombre proclítico reflexivo & Sí& se\\
\hline
PRNENC & Pronombre enclítico & Sí& me, nos\\
\hline
PRNPRO & Pronombre proclítico & Sí& le, te\\
\hline
VLEXINF & Verbo léxico en infinitivo & No& cantar, reír\\
\hline
VLEXGER & Verbo léxico en gerundio  & No& hablando\\
\hline
VLEXPARTPI & Verbo léxico en participio  & No& dicho, cantado\\
\hline
VLEXPFCI & Verbo léxico en presente, futuro o & & \\ & condicional de indicativo & No& digo, diré, diría\\
\hline
VLEXIPI & Verbo léxico en pretérito imperfecto o & & \\ & perfecto simple de indicativo & No& cantaba, dijo\\
\hline
VLEXSUBJ & Verbo léxico subjuntivo & No& hablase, dijeramos\\
\hline
VLEXIMP & Verbo léxico imperativo & No& canta, comed\\
\hline
VSERINF & Verbo ser en infinitivo & Sí& ser\\
\hline
VSERGER & Verbo ser en gerundio  & Sí& siendo\\
\hline
VSERPARTPI & Verbo ser en participio  & Sí& sido\\
\hline
VSERPFCI & Verbo ser en presente, futuro o & & \\ & condicional de indicativo & Sí& soy, seré, sería\\
\hline
VSERIPI & Verbo ser en pretérito imperfecto o & & \\ & perfecto simple de indicativo & Sí& era, fui\\
\hline
VSERSUBJ & Verbo ser subjuntivo & Sí& fueras\\
\hline
VSERIMP & Verbo ser imperativo & Sí& sé\\
\hline
VHABERINF & Verbo haber en infinitivo & Sí& haber\\
\hline
VHABERGER & Verbo haber en gerundio  & Sí& habiendo\\
\hline
VHABERPARTPI & Verbo haber en participio  & Sí& habido\\
\hline
VHABERPFCI & Verbo haber en presente, futuro o & & \\ & condicional de indicativo & Sí& hay, habrán, habría\\
\hline
VHABERIPI & Verbo haber en pretérito imperfecto o & & \\ & perfecto simple de indicativo & Sí& había, hubo\\
\hline
VHABERSUBJ & Verbo haber subjuntivo & Sí& hubieran\\
\hline
VMODALINF & Verbo modal en infinitivo & Sí& deber, poder\\
\hline
VMODALGER & Verbo modal en gerundio  & Sí& debiendo\\
\hline
VMODALPARTPI & Verbo modal en participio  & Sí& podido\\
\hline
VMODALPFCI & Verbo modal en presente, futuro o & & \\ & condicional de indicativo & Sí& puede, deberá, podría\\
\hline
VMODALIPI & Verbo modal en pretérito imperfecto o & & \\ & perfecto simple de indicativo & Sí& podía, debió\\
\hline
VMODALSUBJ & Verbo modal subjuntivo & Sí& pudiese, debiéramos\\
\hline
VMODALIMP & Verbo modal imperativo & Sí& poded, debed\\
\hline
ADJM & Adjetivo & No& gracioso\\
\hline
ADJF & Adjetivo & No& graciosa\\
\hline
ADJMF & Adjetivo & No& inteligente\\
\hline
ADJPOS & Adjetivo posesivo & Sí& mío\\
\hline
REL & Relativo & Sí& quien, cuya\\
\hline
RELADV & Relativo adverbial & Sí& cuando, donde\\
\hline
\hline
\multicolumn{4}{c}{\bf{Etiquetas compuestas}} \\
\hline
\hline
PREPDET & Contracción de preposición y determinante & Sí& del, al\\
\hline
PRCNJ & Multipalabra formado por preposición y & & \\ &conjunción & Sí& a que\\
\hline
PRREL & Multipalabra formado por preposición y & & \\ &relativo & Sí& en que\\
\hline
INFLEXPRNENC & Verbo léxico en infinitivo con enclíticos & No& dármelo, cantarlo\\
\hline
GERLEXPRNENC & Verbo léxico en gerundio con enclíticos & No&  cantándosela\\
\hline
IMPLEXPRNENC & Verbo léxico en imperativo con enclíticos & No& dímelo\\
\hline
INFSERPRNENC & Verbo ser en infinitivo con enclíticos & Sí& serlo\\
\hline
GERSERPRNENC & Verbo ser en gerundio con enclíticos & Sí& siéndolo\\
\hline
IMPSERPRNENC & Verbo ser en imperativo con enclíticos & Sí& sedlo\\
\hline
INFHABPRNENC & Verbo haber en infinitivo con enclíticos & Sí& habérsela\\
\hline
GERHABPRNENC & Verbo haber en gerundio con enclíticos & Sí& habiéndole\\
\hline
INFMODPRNENC & Verbo modal en infinitivo con enclíticos & Sí& poderla, deberlo\\
\hline
GERMODPRNENC & Verbo modal en gerundio con enclíticos & Sí& debiéndosela\\
\hline
IMPMODPRNENC & Verbo modal en imperativo con enclíticos & Sí& debédmela\\
\hline
\hline
\multicolumn{4}{c}{\bf{Otras etiquetas}} \\
\hline
\hline
LQUEST & Apertura de frase interrogativa & & ? \\
\hline
LPAR & Apertura paréntesis o corchete & & (, [ \\
\hline
RPAR & Cierre paréntesis o corchete & & ), ] \\
\hline
CM & Coma & & , \\
\hline
SENT & Finalizador de oraciones & & ., :, ;, ?, !\\
\hline
\hline
\multicolumn{4}{l}{}\\
%p{0.50\textwidth}

\end{longtable}
\end{footnotesize}

\subsection{Desambiguador de catalán}

Dada la similitud con las categorías del desambiguador de español,
sólo se describen en la siguiente aquellas etiquetas que son nuevas o
diferentes para el desambiguador de catalán.

\begin{footnotesize}
\begin{longtable}{l|l|c|l}
\hline
\bf{Etiqueta} & \bf{Descripción} & \bf{Cerrada} & \bf{Ejemplos} \\
\hline
\hline
\endhead
\multicolumn{4}{c}{\bf{Etiquetas simples}} \\
\hline
\hline
MOLTADV & Lexicalización \emph{molt}/\emph{gaire} como adverbio & Sí & \\
\hline
MOTLPREADV & Lexicalización \emph{molt}/\emph{gaire} como adverbio & Sí& \\
\hline
VOLERMOD & Lexicalización \emph{voler} como verbo modal & Sí& \\
\hline
VOLERLEX & Lexicalización \emph{voler} como verbo léxico & Sí& \\
\hline
VA & Lexicalización \emph{va} como forma del verbo \emph{anar} & Sí& \\ 
\hline
\multicolumn{4}{l}{}\\
%p{0.50\textwidth}
\end{longtable}
\end{footnotesize}

\subsection{Desambiguador de gallego}


Dada la similitud con las categorías del desambiguador de español,
sólo se describen en la siguiente aquellas etiquetas que son nuevas o
diferentes para el desambiguador de gallego.

\begin{footnotesize}
\begin{longtable}{l|l|c|l}
\hline
\bf{Etiqueta} & \bf{Descripción} & \bf{Cerrada} & \bf{Ejemplos} \\
\hline
\hline
\endhead
\multicolumn{4}{c}{\bf{Etiquetas simples}} \\
\hline
\hline
VBIRNPS & Lexicalización \emph{ir} como infinitivo  & & \\ & y gerundio & Sí & \\
\hline
VBIRPARTPI & Lexicalización \emph{ir} como participio & Sí& \\
\hline
VBIRPS & Lexicalización \emph{ir} como formas personales  & & \\ & de indicativo & & \\ & y subjuntivo & Sí& \\
\hline
VBIRIMP & Lexicalización \emph{ir} como imperativo & Sí& \\
\hline
VHABERNPS & Lexicalización \emph{haber} como infinitivo & & \\ &  y gerundio & Sí & \\
\hline
VHABERPARTPI & Lexicalización \emph{haber} como participio & Sí& \\
\hline
VHABERPS & Lexicalización \emph{haber} como formas personales & & \\ &  de indicativo & & \\ & y subjuntivo & Sí& \\
\hline
VHABERIMP & Lexicalización \emph{haber} como imperativo & Sí& \\
\hline
APREP & Lexicalización \emph{a} como preposición \emph{anar} & Sí& \\ 
\hline
VLEXNPS & Verbo léxico: infinitivo y gerundio & No& achegar, achegándomos\\
\hline
VLEXPS & Verbo léxico: formas personales & & \\ & de indicativo & No& achegue, achegaré\\
\hline
VSERNPS & Verbo ser: infinitivo y gerundio & Sí& ser, seres\\
\hline
VSERPS & Verbo ser: formas personales & & \\ & de indicativo & Sí& fosen, es\\
\hline

VHABERNPS & Verbo haber: infinitivo y gerundio & Sí& haber\\
\hline
VHABERPS & Verbo haber: formas personales & & \\ & de indicativo & Sí& achegue, achegaré\\
\hline
\hline
\multicolumn{4}{c}{\bf{Etiquetas compuestas}} \\
PREPDETM & Contracción de preposición y  & & \\ & determinante masculino & Sí& do, ao\\
\hline
PREPDETF & Contracción de preposición y & & \\ &  determinante femenino & Sí& da, ás\\
\hline
PREPDETN & Contracción de preposición y & & \\ &  determinante neutro & Sí& do\\
\hline
PREPDETDET & Contracción de preposición y  & & \\ & dos determinantes & Sí& destoutro\\
\hline
PREPPRTNNT & Contracción de preposición y & & \\ &pronombre tónico neutro & Sí& daquilo\\
\hline
PREPPRNTN & Contracción de preposición y & & \\ &pronombre tónico & Sí& daqueloutra\\
\hline
PREPTNTN & Contracción de preposición y & & \\ & dos pronombres tónicos & Sí& nestoutra\\
\hline
PREPNUM & Contracción de preposición y  & & \\ & numeral & Sí& dunha\\
\hline
PREDETDET & Contracción de predeterminante y & & \\ determinante & Sí& tódalas\\
\hline
INTADVDET & Contracción de interrogativo adverbial y & & \\ determinante & Sí& u-la\\
\hline
DETDETM & Contracción de dos determinantes masculinos & Sí& ámbolos\\
\hline
DETDETF & Contracción de dos determinantes femeninos & Sí& ámbalas\\
\hline
PRNPRN & Contracción de dos pronombres tónicos & Sí& esoutra\\
\hline
PRNPRN & Contracción de dos pronombres proclíticos & Sí& chas\\
\hline
CNJCDET & Contracción de conjunción coordinada y & & \\ &  determinante & Sí& maila\\
\hline
CNJSUB & Contracción de conjunción subordinada y  & & \\determinante & Sí& cás\\
\hline
INFSERPRNENC & Verbo ser en infinitivo con enclíticos & Sí& serlo\\
\hline
GERSERPRNENC & Verbo ser en gerundio con enclíticos & Sí& siéndolo\\
\hline
IMPSERPRNENC & Verbo ser en imperativo con enclíticos & Sí& sedlo\\
\hline
INFHABPRNENC & Verbo haber en infinitivo con enclíticos & Sí& habérsela\\
\hline
GERHABPRNENC & Verbo haber en gerundio con enclíticos & Sí& habiéndole\\
\hline
INFMODPRNENC & Verbo modal en infinitivo con enclíticos & Sí& poderla, deberlo\\
\hline
GERMODPRNENC & Verbo modal en gerundio con enclíticos & Sí& debiéndosela\\
\hline
IMPMODPRNENC & Verbo modal en imperativo con enclíticos & Sí& debédmela\\
\hline
\hline
\multicolumn{4}{l}{}\\
%p{0.50\textwidth}
\end{longtable}
\end{footnotesize}


\newpage
\chapter{Abreviaturas usadas en el texto}
\label{se:apendiceabrev}
\begin{description}
\item[ANSI] \emph{American National Standards Institute}, instituto nacional
  norteamericano de estándares; cuando se usa informalmente en la expresión
  \emph{texto ANSI}, se refiere a un texto codificado en alguna de las
  codificaciones de un byte por carácter definidas en el estándar ISO-8859 \cite{Unicode}.
\item[ca] Código ISO 639 de dos letras\footnote{Véase
    \texttt{\url{http://www.w3.org/WAI/ER/IG/ert/iso639.htm}}} del
  catalán
\item[DTD] Definición del tipo de documento en XML
\item[es] Código ISO 639 de dos letras del español
\item[eu] Código ISO 639 de dos letras del euskera
\item[FL] Forma léxica (véase la página~\pageref{pg:FSFL})
\item[FLLM] Forma léxica de la lengua meta
\item[FLLO] Forma léxica de la lengua origen
\item[FS] Forma superficial (véase la página~\pageref{pg:FSFL})
\item[gl] Código ISO 639 de dos letras del gallego
\item[HTML] \emph{Hypertext markup language}, lenguaje de marcas para
  hipertextos. 
\item[LM] Lengua meta (lengua de llegada)
\item[LO] Lengua origen (lengua de partida)
\item[RTF] \emph{Rich text format}, formato de texto enriquecido. 
\item[TA] Traducción automática
\item[XML] \emph{Extensible markup language}, lenguaje de marcas extensible. 
\end{description}

\newpage
\nota{Afegir article de l'EAMT 2005 i citar-lo}
\bibliography{documentacio}
\bibliographystyle{plain}
\addcontentsline{toc}{chapter}{Bibliografía}
\end{document}

