<?xml version="1.0" encoding="UTF-8"?> <!-- -*- nxml -*- -->
<interchunk>
  <section-def-cats>

    <def-cat n="SN">
      <cat-item tags="SN.*"/>
      <cat-item lemma="relnom" tags="REL.*"/>
    </def-cat>

     <def-cat n="SNnorel">
      <cat-item tags="SN.*"/>
    </def-cat>
    
    <def-cat n="SNnopro"><!-- BCN-->
      <cat-item tags="SN.DET.*"/>
      <cat-item tags="SN.UNDET.*"/>
    </def-cat>
    
    <def-cat n="negacio"><!-- BCN-->
      <cat-item tags="SN.DET.*.*.negacio"/>
    </def-cat>
    
    <def-cat n="pr"><!-- BCN-->
      <cat-item tags="PREP"/>
    </def-cat>
    
    <def-cat n="and"><!-- BCN-->
      <cat-item lemma="cnj" tags="cnjcoo"/>
    </def-cat>
    

    <def-cat n="SN_nopron">
      <cat-item tags="SN.DET.*"/>
      <cat-item tags="SN.UNDET.*"/>
      <cat-item tags="SN.NUM.*"/>
    </def-cat>

    <def-cat n="SV"><!--Verb conjugat, i tb infinitiu per quan el tagger s'equivoca. -->
      <cat-item lemma="verbcj" tags="SV.*"/>
      <cat-item tags="Vcop.*"/>
      <cat-item lemma="mod" tags="SV.*"/><!--MG: I have to <sent> : no deixar-ho penjat (haig de 'fer-ho'). En canvi : 'I have to <desconeguda>: sí que és 'haig de'. -->
      <cat-item lemma="auxmod_inf" tags="SV.*"/>
      <cat-item lemma="auxmod_inf_inf" tags="SV.*"/><!--BCN-->
      <cat-item lemma="be_inf_inf" tags="SV.*"/> <!--BCN-->
      <cat-item lemma="verbcj_inf" tags="SV.*"/>
      <cat-item lemma="verbcj_inf_perif" tags="SV.*"/>
      <cat-item lemma="auxmod_mod_inf" tags="SV.*"/>
      <cat-item lemma="do_inf" tags="SV.*"/>
      <cat-item lemma="mod_inf" tags="SV.*"/>
      <cat-item lemma="mod_perif" tags="SV.*"/>
      <cat-item lemma="mod_inf_perif" tags="SV.*"/>
      <cat-item lemma="aux_mod" tags="SV.*"/><!--Aquests van davant desconegudes o sent (I will have to.) -->
      <cat-item lemma="have_pp" tags="SV.*"/>
      <cat-item lemma="have_pp_inf" tags="SV.*"/><!-- BCN-->
      <cat-item lemma="be_ger" tags="SV.*"/>
      <cat-item lemma="be_ger_enc" tags="SV.*"/>
      <cat-item tags="SV.vblex.inf.*"/>
      <cat-item tags="SV.vbmod.inf.*"/>
      <cat-item lemma="verbcj_perif" tags="SV.*"/>
      <cat-item lemma="pro_verbcj" tags="SV.*"/>
      <cat-item lemma="pro_verbcj_perif" tags="SV.*"/>
      <cat-item lemma="pro_auxmod_inf" tags="SV.*"/>
      <cat-item lemma="pro_mod_inf" tags="SV.*"/>
      <cat-item lemma="pro_mod_inf_perif" tags="SV.*"/>
      <cat-item lemma="pro_auxmod_mod_inf" tags="SV.*"/>
      <cat-item lemma="pro_have_pp" tags="SV.*"/>
      <cat-item lemma="pro_be_ger" tags="SV.*"/>
      <cat-item lemma="pro_do_inf" tags="SV.*"/>
      <cat-item tags="SV.reporting.inf.*"/><!-- BCN tot menys el gerundi-->
      <cat-item tags="SV.reporting.pri.*"/>
      <cat-item tags="SV.reporting.cni.*"/>
      <cat-item tags="SV.reporting.ifip.*"/>
      <cat-item tags="SV.reporting.fti*"/>
      <cat-item tags="SV.reporting.pii*"/>
      
    </def-cat>
    
    <def-cat n="SVGER"><!-- BCN. Per ara no entren els compostos amb have (having won)-->
      <cat-item lemma="ger" tags="SV.*"/>
      <cat-item lemma="ger_enc" tags="SV.*"/>
    </def-cat>
    
    <def-cat n="vbcop">
      <cat-item tags="Vcop.*"/>
      <cat-item tags="SV.vbser.*"/>
    </def-cat>
    
    <def-cat n="vblike">
      <cat-item tags="SV.like.*"/>
    </def-cat>
    
    <def-cat n="vbreporting"><!-- BCN-->
      <cat-item tags="SV.reporting.*"/>
    </def-cat>
    
    <def-cat n="there">
      <cat-item lemma="there" tags="adv"/>
    </def-cat>

    <def-cat n="thereis">
      <cat-item tags="Vcop.*"/>
      <cat-item lemma="verbcj" tags="SV.vbser.*"/>
      <cat-item lemma="auxmod_inf" tags="SV.vbser.*"/>
      <cat-item lemma="auxmod_mod_inf" tags="SV.vbser.*"/>
      <cat-item lemma="mod_inf" tags="SV.vbser.*"/>
      <cat-item lemma="mod_inf_perif" tags="SV.vbser.*"/>
      <cat-item lemma="have_pp" tags="SV.vbser.*"/>
      <cat-item lemma="verbcj_perif" tags="SV.vbser.*"/> 
    </def-cat>


    <def-cat n="pro_vblike">
      <cat-item lemma="pro_verbcj" tags="SV.like.*"/>
      <cat-item lemma="pro_verbcj_perif" tags="SV.like.*"/>
      <cat-item lemma="pro_auxmod_inf" tags="SV.like.*"/>
      <cat-item lemma="pro_mod_inf" tags="SV.like.*"/>
      <cat-item lemma="pro_mod_inf_perif" tags="SV.like.*"/>
      <cat-item lemma="pro_auxmod_mod_inf" tags="SV.like.*"/>
      <cat-item lemma="pro_have_pp" tags="SV.like.*"/>
      <cat-item lemma="pro_be_ger" tags="SV.like.*"/>
      <cat-item lemma="pro_do_inf" tags="SV.like.*"/>
    </def-cat>

    <def-cat n="ADV">
      <cat-item lemma="adv" tags="adv"/>
      <cat-item lemma="adv" tags="adv.*"/>
    </def-cat>

    <def-cat n="PRNS">
      <cat-item tags="PRN.subj.*"/>
    </def-cat>

    <def-cat n="SA">
      <cat-item tags="SA.*"/>
    </def-cat>

    <def-cat n="pp">
      <cat-item lemma="pp"  tags="SA.*"/>
      <cat-item lemma="adj"  tags="SA.*"/><!-- BCN per que agafi bé resolutions adopted -->
    </def-cat>

    <def-cat n="DET">
      <cat-item tags="DET.*"/>
    </def-cat>

   
    <def-cat n="RELAN">
      <cat-item tags="REL.an.*"/>
      <!--<cat-item tags="SN.an.*"/>-->
    </def-cat>
    
    <def-cat n="NUM">
      <cat-item tags="NUM.*"/>
    </def-cat>

    <def-cat n="punt">
      <cat-item tags="sent"/>
    </def-cat>

    <def-cat n="cnjcoo"> <!-- BCN-->
      <cat-item tags="cnjcoo"/>
    </def-cat>


  </section-def-cats>

  <section-def-attrs>

    <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
      <attr-item tags="PD"/>
    </def-attr>

    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="pres"/>
      <attr-item tags="past"/>
      <attr-item tags="pri"/>
      <attr-item tags="ifip"/>
      <attr-item tags="cni"/>
      <attr-item tags="fti"/>
      <attr-item tags="pp"/>
      <attr-item tags="ger"/>
      <attr-item tags="pprs"/>
      <attr-item tags="subs"/>
      <attr-item tags="imp"/>
      <attr-item tags="ifi"/>
      <attr-item tags="pii"/>
      <attr-item tags="pis"/>
      <attr-item tags="prs"/>
      
    </def-attr>

    <def-attr n="a_verb">
      <attr-item tags="vblex"/>	  
      <attr-item tags="vblex.pron"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="HAVER"/>
    </def-attr>
    
    <def-attr n="a_SN">
      <attr-item tags="DET"/>
      <attr-item tags="UNDET"/>
      <attr-item tags="NUM"/>
      <attr-item tags="PDET"/><!--'Per determinar', per a SN UNDET que han de passar a determinats, transformació que farà el postchunk detectant els PDET. -->
    </def-attr>

  </section-def-attrs>

  <section-def-vars>
    <def-var n="uno"/>
    <def-var n="nombre"/>
  </section-def-vars>

  <section-def-macros>

    <def-macro n="nombre_SN" npar="1">
      <choose><!--To determine value of variables of gender and
		  number and propagate to other rules.  Variables are
		  not used again in this rule -->
	<when> 
	  <test>
	    <equal>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </equal>
	  </test>
	  <let><var n="nombre"/><lit-tag v="sg"/></let>
	</when>
	<when>
	  <test>
	    <equal>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="pl"/>
	    </equal>
	  </test>
	  <let><var n="nombre"/><lit-tag v="pl"/></let>
	</when>
	<otherwise>
	  <let><var n="nombre"/><lit-tag v="sg"/></let>
	</otherwise>
      </choose> 
    </def-macro>

    <def-macro n="f_bcond" npar="1"><!--Per mirar si el blanc conté o no format. Cal posar aquesta funció en les regles en què desaparegui alguna paraula, per tal de decidir si el blanc de la paraula eliminada s'ha d'eliminar o conservar. Si conté format cal conservar-la, si no en conté cal eliminar-la perquè no apareguin dos espais seguits. -->
      <choose>
	<when>
	  <test>
	    <not>
	      <equal>
		<b pos="1"/>
		<lit v=" "/>
	      </equal>
	    </not>
	  </test>
	  <out>
	    <b pos="1"/>
	  </out>
	</when>     	    
      </choose>
    </def-macro>

  </section-def-macros>

  <section-rules>
    

    <!--REGLES LÈXIQUES: definides en primer lloc perquè si no es posen per altres regles -->



    <rule comment="REGLA: SN like SN">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="vblike"/>
	<pattern-item n="SNnorel"/>	
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis necessaris al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let>
	  <clip pos="2" part="pers"/>
	  <lit-tag v="p3"/>
	</let>
	<let>
	  <clip pos="2" part="nbr"/>
	  <clip pos="3" part="nbr"/>
	</let>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	 
	    <out>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>						
		<lit v="$}"/>
	      </chunk>
	      <b pos="1"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!--...i un altre amb un pronom feble (nois els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="2">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<!--Assigna gènere i nombre al segon SN (GD i ND) -->
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	

	<!--BCN (posa el PDET si cal)-->

	<choose>
	  <when>
	    <test>
	      <!-- <and>-->
	      <or>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom_conj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_adj_nom"/>
		</equal>
		<!--   <equal caseless="yes">
		     <clip pos="1" part="lem"/>
		     <lit v="nom_nom"/>
		     </equal> -->
		<!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_nom"/> fer aquest
		     </equal>
		     <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_conj_nom"/>
		     </equal> -->
	      </or>
	    </test>
	    <let>
	      <clip pos="3" part="a_SN"/>
	      <lit-tag v="PDET"/>
	    </let>
	  </when>
	</choose>
	<!--BCN (posa el PDET si cal)-->
	<out>
	  <chunk><!--envio el verb amb la persona i el nombre canviats (he fet els canvis dalt de tot)-->
	    <clip pos="2" part="lem"/>
	    <clip pos="2" part="tags"/>
	    <clip pos="2" part="chcontent"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk><!-- i envio també el segon SN-->
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="3"/>
	</call-macro>	
      </action>
    </rule>

    <rule comment="REGLA: SN adv like SN">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="vblike"/>
	<pattern-item n="SNnorel"/>	
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis necessaris al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let>
	  <clip pos="3" part="pers"/>
	  <lit-tag v="p3"/>
	</let>
	<let>
	  <clip pos="3" part="nbr"/>
	  <clip pos="4" part="nbr"/>
	</let>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    
	    <out>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>
		
		<lit v="$}"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!-- l'adv-->
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      
	      <chunk><!--...i un altre amb un pronom feble (als nois no els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="3">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<!--Assigna gènere i nombre al segon SN (GD i ND) -->
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="4" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="4" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<out>
	  <chunk><!--envio el verb amb la persona i el nombre canviats (he fet els canvis dalt de tot)-->
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk><!-- i envio també el segon SN-->
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="4"/>
	</call-macro>	
      </action>
    </rule>

    <rule comment="REGLA: SN pro_vblike">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="pro_vblike"/>
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis que podem al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose> <!-- canvia el nom del chunk per poder-hi treballar més facilment al t3x-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="pro_verbcj"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="lem"/>
	      <lit v="pro_vblike"/>
	    </let>
	  </when>
	  <otherwise>
	    <choose> 
	      <when>
		<test>
		  <or>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_verbcj_perif"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_auxmod_inf"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_mod_inf"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_have_pp"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_be_ger"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="2" part="lem"/>
		      <lit v="pro_do_inf"/>
		    </equal>
		  </or>
		</test>
		<let>
		  <clip pos="2" part="lem"/>
		  <lit v="pro_vblike2"/>
		</let>
	      </when>
	      <otherwise>
		<choose> 
		  <when>
		    <test>
		      <or>
			<equal caseless="yes">		
			  <clip pos="2" part="lem"/>
			  <lit v="pro_mod_inf_perif"/>
			</equal>
			<equal caseless="yes">		
			  <clip pos="2" part="lem"/>
			  <lit v="pro_auxmod_mod_inf"/>
			</equal>
		      </or>
		    </test>
		    <let>
		      <clip pos="2" part="lem"/>
		      <lit v="pro_vblike3"/>
		    </let>
		  </when>
		</choose>
	      </otherwise>
	    </choose>
	  </otherwise>
	</choose>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <out>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>
		
		<lit v="$}"/>
	      </chunk>
	      <b pos="1"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!--...i un altre amb un pronom feble (nois els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="2">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<out>
	  <chunk><!-- envio el verb al t3x amb uns canvis pendents de fer-->
	    <clip pos="2" part="lem"/>
	    <clip pos="2" part="tags"/>
	    <clip pos="2" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>

    <rule comment="REGLA: SN adv like-prn">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="pro_vblike"/>
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis possibles al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose> <!-- canvia el nom del chunk per poder-hi treballar més facilment al t3x-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="pro_verbcj"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="lem"/>
	      <lit v="pro_vblike"/>
	    </let>
	  </when>
	  <otherwise>
	    <choose> 
	      <when>
		<test>
		  <or>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_verbcj_perif"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_auxmod_inf"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_mod_inf"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_have_pp"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_be_ger"/>
		    </equal>
		    <equal caseless="yes">		
		      <clip pos="3" part="lem"/>
		      <lit v="pro_do_inf"/>
		    </equal>
		  </or>
		</test>
		<let>
		  <clip pos="3" part="lem"/>
		  <lit v="pro_vblike2"/>
		</let>
	      </when>
	      <otherwise>
		<choose> 
		  <when>
		    <test>
		      <or>
			<equal caseless="yes">		
			  <clip pos="3" part="lem"/>
			  <lit v="pro_mod_inf_perif"/>
			</equal>
			<equal caseless="yes">		
			  <clip pos="3" part="lem"/>
			  <lit v="pro_auxmod_mod_inf"/>
			</equal>
		      </or>
		    </test>
		    <let>
		      <clip pos="3" part="lem"/>
		      <lit v="pro_vblike3"/>
		    </let>
		  </when>
		</choose>
	      </otherwise>
	    </choose>
	  </otherwise>
	</choose>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <out>
	      <chunk><!-- primer envio l'adverbi-->
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>
		
		<lit v="$}"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!-- l'adv-->
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      
	      <chunk><!--...i un altre amb un pronom feble (als nois no els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="3">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<out>
	  <chunk><!--envio el verb al t3x amb canvis pendents-->
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="4"/>
	</call-macro>	
      </action>
    </rule>
    
    <rule comment="REGLA: SN vblike">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="vblike"/>
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis que podem al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let>
	  <clip pos="2" part="pers"/>
	  <lit-tag v="p3"/>
	</let>
	<let>
	  <clip pos="2" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <out>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>
		
		<lit v="$}"/>
	      </chunk>
	      <b pos="1"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!--...i un altre amb un pronom feble (nois els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="2">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<out>
	  <chunk><!-- envio el verb-->
	    <clip pos="2" part="lem"/>
	    <clip pos="2" part="tags"/>
	    <clip pos="2" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>
    
    <rule comment="REGLA: SN adv vblike">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="vblike"/>
      </pattern>
      <action>
	<choose> <!-- primer assignem els canvis que podem al verb-->
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let>
	  <clip pos="3" part="pers"/>
	  <lit-tag v="p3"/>
	</let>
	<let>
	  <clip pos="3" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>
	<choose><!-- quan el subjecte és un pronom...-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <out>
	      <chunk><!-- envio l'adv-->
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk><!--...creo un chunk que tindrà un pronom feble -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro"/>
		<clip pos="1" part="pers"/>
		<lit-tag v="mf"/>
		<clip pos="1" part="nbr"/>
		
		<lit v="$}"/>
	      </chunk>
	      <b pos="1"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN, li assigno gènere i nombre...-->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <var n="nombre"/>
		  <lit-tag v="pl"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    
	    <out> 
	      <chunk><!-- envio la preposició "a" -->
		<lit v="pr"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="a"/>
		</get-case-from>
		<lit-tag v="pr"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--envio el chunk amb el SN-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk><!-- l'adv-->
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk><!--...i un altre amb un pronom feble (nois els agraden les patates) -->
		<lit v="comp_like"/>
		<lit-tag v="prn.pro"/>
		<lit v="{^"/>
		<get-case-from pos="2">
		  <lit v="prpers"/>
		</get-case-from>
		<lit-tag v="prn.pro.p3.mf"/>
		<var n="nombre"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<out>
	  <chunk><!-- envio el verb-->
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>


    <rule comment="REGLA: there BE SN"><!--NOTA MG: la millor manera de fer el canvi de 'ser' per 'haver' hauria estat enllaçar la categoria del verb (vbser, vblex, vbhaver, vbmod) en les tags del chunk en el t1x, i aquí canviar l'etiqueta, de manera que el canvia hauria estat automàtic i no hauria fet falta fer operacions complicades en el t3x per a canviar les etiquetes segons el nom de chunk. Tanmateix, en el t1x hem posat la variable 'tipus_verb' com a etiqueta del chunk que pot contenir 'pron' i 'like' a part dels tipus de verb normals (vbser, vbhaver, vbmod, vblex), la qual cosa impossibilita fer l'enllaç correctament. Amb més temps caldria canviar la manera de passar la informació de 'pron' i 'like' en el segon transfer de manera que fos possible fer l'enllaç del tipus de verb. -->
      <pattern>
	<pattern-item n="there"/>
	<pattern-item n="thereis"/>
	<pattern-item n="SNnorel"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let><!--posa-ho com a p3 sg perquè en català 'haver-hi' sempre és en p3 i sg (hi ha cotxes) -->
	  <clip pos="2" part="pers"/>
	  <lit-tag v="p3"/>
	</let>	
	<let>
	  <clip pos="2" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>

	<let>
	  <clip pos="1" part="lem"/>
	  <lit v="hi"/>
	</let>
	<let>
	  <clip pos="2" part="a_verb"/>
	  <lit-tag v="HAVER"/>
	</let>
	<!--Quan SN és GD o ND -->
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="pri"/>
		    </equal>
		    <equal>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		  </and>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="pl"/>
		</let>
	      </when>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="temps"/>
		    <lit-tag v="pri"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="ifip"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="2" part="lem"/>
		      <lit v="be"/>
		    </equal>
		    <equal>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		  </and>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="pl"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </otherwise>
	    </choose>
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>	    
	</out>
      </action>
    </rule>

    <rule comment="REGLA: there ADV BE SN (there can not be a cat)">
      <pattern>
	<pattern-item n="there"/>
	<pattern-item n="ADV"/>
	<pattern-item n="thereis"/>
	<pattern-item n="SNnorel"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let><!--posa-ho com a p3 sg perquè en català 'haver-hi' sempre és en p3 i sg (hi ha cotxes) -->
	  <clip pos="3" part="pers"/>
	  <lit-tag v="p3"/>
	</let>	
	<let>
	  <clip pos="3" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>

	<let>
	  <clip pos="1" part="lem"/>
	  <lit v="hi"/>
	</let>
	<let>
	  <clip pos="3" part="a_verb"/>
	  <lit-tag v="HAVER"/>
	</let>
	<!--Quan SN és GD o ND -->
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="4" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="4" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="3" part="temps"/>
		      <lit-tag v="pri"/>
		    </equal>
		    <equal>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		  </and>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/>
		</let>
	      </when>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="temps"/>
		    <lit-tag v="pri"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="3" part="temps"/>
		      <lit-tag v="ifip"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="3" part="lem"/>
		      <lit v="be"/>
		    </equal>
		    <equal>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		  </and>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </otherwise>
	    </choose>
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="whole"/>
	  </chunk>	    
	</out>
      </action>
    </rule>
    
    <rule comment="REGLA: there BE (sense SN clar a continuació)">
      <pattern>
	<pattern-item n="there"/>
	<pattern-item n="thereis"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let><!--posa-ho com a p3 sg perquè en català 'haver-hi' sempre és en p3 i sg (hi ha cotxes) -->
	  <clip pos="2" part="pers"/>
	  <lit-tag v="p3"/>
	</let>	
	<let>
	  <clip pos="2" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>

	<let>
	  <clip pos="1" part="lem"/>
	  <lit v="hi"/>
	</let>
	<let>
	  <clip pos="2" part="a_verb"/>
	  <lit-tag v="HAVER"/>
	</let>
	<out>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>	    
	</out>
      </action>
    </rule>

    <rule comment="REGLA: there ADV BE (sense SN clar a continuació)">
      <pattern>
	<pattern-item n="there"/>
	<pattern-item n="ADV"/>
	<pattern-item n="thereis"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<let><!--posa-ho com a p3 sg perquè en català 'haver-hi' sempre és en p3 i sg (hi ha cotxes) -->
	  <clip pos="3" part="pers"/>
	  <lit-tag v="p3"/>
	</let>	
	<let>
	  <clip pos="3" part="nbr"/>
	  <lit-tag v="sg"/>
	</let>

	<let>
	  <clip pos="1" part="lem"/>
	  <lit v="hi"/>
	</let>
	<let>
	  <clip pos="3" part="a_verb"/>
	  <lit-tag v="HAVER"/>
	</let>
	<out>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>	    
	</out>
      </action>
    </rule>


    <!--REGLES GENERALS -->


    <rule comment="REGLA: reporting VERBS (BCN: per afegir QUE quan tenim un 'reporting' werb seguit d'una clàusula: she said they would go home -- va dir que anirien casa. Falta fer el mateix per quan tenim: SN Vcop SA; SN ADV SV; SN SV SA; a la segona part )">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="vbreporting"/>
	<pattern-item n="SNnorel"/>
	<pattern-item n="SV"/>
      </pattern>

      <action>
	<!-- Primera part amb SN SV afegint el QUE (idealment hauria d'estar en una macro)-->
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="pers"/>
		      <lit-tag v="PD"/>
		    </equal>
		    <not>
		      <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="ger"/>
		    </equal>
		    </not>
		  </and>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		    <not>
		      <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="ger"/>
		    </equal>
		    </not>
		  </and>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b/>
	      <chunk>
		<lit v="cnjsub"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="que"/>
		</get-case-from>
		<lit-tag v="cnjsub"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="2" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="2" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>

	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="pers"/>
		      <lit-tag v="PD"/>
		    </equal>
		    <not>
		      <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="ger"/>
		    </equal>
		    </not>
		  </and>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <and>
		    <equal>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		    <not>
		      <equal>
		      <clip pos="2" part="temps"/>
		      <lit-tag v="ger"/>
		    </equal>
		    </not>
		  </and>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b/>
	      <chunk>
		<lit v="cnjsub"/>
		<lit-tag v="PREP"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="que"/>
		</get-case-from>
		<lit-tag v="cnjsub"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	    </out>
	  </otherwise>
	</choose>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
	<!-- fi primera part-->      


	<!-- còpia de la regla SN SV pq faci la segona part amb els últims SN SV ok (idealment hauria d'estar en una macro)-->

	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="3" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="3" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		    <equal>
		      <clip pos="4" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <clip pos="3" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="3"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="2">
		  <clip pos="4" part="lem"/>
		</get-case-from>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	    </out>
	  </when>
	  <otherwise>
	    <choose><!--Quan SN no és prnsubj. -->
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>

	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="3" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <clip pos="3" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="3" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="3" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="3" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="3" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="3" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="3" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="3" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="3" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	      <chunk>
		<clip pos="4" part="lem"/>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	    </out>
	<call-macro n="nombre_SN">
	  <with-param pos="3"/>
	</call-macro>
	<!-- fi de la regla SN SV-->
	  </otherwise>
	</choose>
      </action>
    </rule>
    
    <rule comment="REGLA: SN SP SV SA (BCN, modificat per MG)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="pr"/>
	<pattern-item n="SNnorel"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	  </when>
	</choose>
	
<!--Quan SN 1 no és prnsubj, pot ser GD o ND.
Aquí torna a mirar si posició 4 és GD o ND, ja que en cas que  pos1 no sigui pronom subjecte, haura quedat com a GD o ND. A la vegada es fan les comprovacions que toquen el cas que SN no sigui subjecte i, per tant, pugui tenir també ell GD o ND -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->

	    <choose> <!-- quan el segon SN és GD o ND-->
	      <when>
		<test>
		    <equal>
		      <clip pos="3" part="gen"/>
		      <lit-tag v="GD"/>
		    </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<or>
			  <equal>
			    <clip pos="1" part="gen"/>
			    <lit-tag v="mf"/>
			  </equal>
			  <equal>
			    <clip pos="1" part="gen"/>
			    <lit-tag v="nt"/>
			  </equal>
			</or>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="gen"/>
		      <clip pos="1" part="gen"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="3" part="gen"/>
		      <lit-tag v="m"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		    <equal>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise><!--assigna-li el nombre del verb -->
		     <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="4" part="nbr"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>

	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	      <chunk>
		<clip pos="4" part="lem"/>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	    </out>
	<choose><!--Assigna gènere i nombre a l'adjectiu -->
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="mf"/>
		  </equal>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="nt"/>
		  </equal>
		</or>
	      </not>
	    </test>
	    <let>
	      <clip pos="5" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="5" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </otherwise>
	</choose>
	<call-macro n="nombre_SN"><!--per al nombre hi ha una macro definida -->
	  <with-param pos="1"/>
	</call-macro>
	<let>
	  <clip pos="5" part="nbr"/>
	  <var n="nombre"/>
	</let>
	<out>
	  <b pos="4"/>
	  <chunk>
	    <clip pos="5" part="whole"/>
	  </chunk>
	</out>
      </action>
    </rule>


    <rule comment="REGLA: SN SP SV (BCN, modificar per MG)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="pr"/>
	<pattern-item n="SNnorel"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	  </when>
	</choose>

<!--Aquí torna a mirar si posició 4 és GD o ND, ja que en cas que  pos1 no sigui pronom subjecte, haura quedat com a GD o ND. A la vegada es fan les comprovacions que toquen el cas que SN no sigui subjecte i, per tant, pugui tenir també ell GD o ND -->

	 
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <choose>  <!-- quan el segon SN és GD o ND-->
	      <when>
		<test>
		  <equal>
		      <clip pos="3" part="gen"/>
		      <lit-tag v="GD"/>
		    </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<or>
			  <equal>
			    <clip pos="1" part="gen"/>
			    <lit-tag v="mf"/>
			  </equal>
			  <equal>
			    <clip pos="1" part="gen"/>
			    <lit-tag v="nt"/>
			  </equal>
			</or>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="gen"/>
		      <clip pos="1" part="gen"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="3" part="gen"/>
		      <lit-tag v="m"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		    <equal>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise><!--assigna-li el nombre del verb -->
		     <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="4" part="nbr"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	      <chunk>
		<clip pos="4" part="lem"/>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	    </out>	
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>



    <rule comment="REGLA: SN SV SN.negacio (BCN I read no books -- NO llegeixo cap llibre">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
	<pattern-item n="negacio"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>
		<lit v="adv"/>
		<lit-tag v="NEG"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="no"/>
		</get-case-from>
		<lit-tag v="adv"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	    </out>
	  </when>
	  

	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="2" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="2" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<lit v="adv"/>
		<lit-tag v="NEG"/>
		<lit v="{^"/>
		<get-case-from pos="1">
		  <lit v="no"/>
		</get-case-from>
		<lit-tag v="adv"/>
		<lit v="$}"/>
	      </chunk>
	      <b/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	    </out>
	  </otherwise>
	</choose>	
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>


    <rule comment="REGLA: SN SVger(BCN the man working in the garage :: l'home que treballa ...)">
      <pattern>
	<pattern-item n="SNnopro"/>
	<pattern-item n="SVGER"/>
      </pattern>
      <action>
	<let>
	   <clip pos="2" part="temps"/>
	   <lit-tag v="pri"/>
	</let>
	<!--Aquí  SN no és mai pronom subjecte, la categoria no l'inclou -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>    
	    <!--el gerundi sempre és GD i ND, ara cal assignar-li gen i nbr del SN -->
	    <let>
	      <clip pos="2" part="pers"/>
	      <lit-tag v="p3"/>
	    </let>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sp"/>
		    </equal>
		  </not>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <clip pos="2" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </otherwise>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b/>
	      <chunk>
		<lit v="reladj"/>
		<lit-tag v="REL"/>
		<lit v="{^"/>
		<lit v="que"/>
		<lit-tag v="rel"/>
		<lit-tag v="an"/>
		<lit-tag v="mf"/>
		<lit-tag v="sp"/>
		<lit v="$}"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	    </out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>

    <rule comment="REGLA: SN SV">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="2" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="2" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	    </out>
	  </otherwise>
	</choose>	
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>



    <rule comment="REGLA: SN and SN SV (BCN)">
      <pattern>
	<pattern-item n="SNnorel"/>
	<pattern-item n="and"/>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>        <!-- SN1 = pronsubj-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/>        <!-- el nombre del verb pl-->		  
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>     <!-- enviem el SN1 pronom-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/><!--BCN-->
		</let>
	      </when>
	    </choose>
	    <choose> <!-- el primer SN-->
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>

	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </otherwise>
	</choose>	



	<choose> <!-- per al segon SN-->
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose> 
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <!-- <and>-->
	      <or>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom_conj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_adj_nom"/>
		</equal>
		<!--   <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="nom_nom"/>
		     </equal> -->
		<!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_nom"/> fer aquest
		     </equal>
		     <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_conj_nom"/>
		     </equal> -->
	      </or>
	    </test>
	    <let>
	      <clip pos="3" part="a_SN"/>
	      <lit-tag v="PDET"/>
	    </let>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	</out>

	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>


    <rule comment="REGLA: SN ADV SV">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>	      
	      <chunk><!--el pronom no l'envio, només el SV -->
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	    </out>
	  </when>

	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="3" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="3" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="3" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="3" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="3" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="3" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>


	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	    </out>
	  </otherwise>
	</choose>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>


    <rule comment="REGLA: SN and SN ADV SV (BCN)">
      <pattern>
	<pattern-item n="SNnorel"/>
	<pattern-item n="and"/>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="5" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="5" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>        <!-- SN1 = pronsubj-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="nbr"/>
		  <lit-tag v="pl"/>        <!-- el nombre del verb pl-->
		  <!--	  <clip pos="1" part="nbr"/>-->
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>     <!-- enviem el SN1 pronom-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="5" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="5" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="5" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="5" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="5" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="5" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="nbr"/>
		  <lit-tag v="pl"/><!--BCN-->
		</let>
	      </when>
	    </choose>
	    <choose> <!-- el primer SN-->
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>

	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </otherwise>
	</choose>	



	<choose> <!-- per al segon SN-->
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose> 
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <!-- <and>-->
	      <or>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom_conj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_adj_nom"/>
		</equal>
		<!--   <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="nom_nom"/>
		     </equal> -->
		<!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_nom"/> fer aquest
		     </equal>
		     <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_conj_nom"/>
		     </equal> -->
	      </or>
	    </test>
	    <let>
	      <clip pos="3" part="a_SN"/>
	      <lit-tag v="PDET"/>
	    </let>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	  <b pos="4"/>
	  <chunk>
	    <clip pos="5" part="lem"/>
	    <clip pos="5" part="tags"/>
	    <clip pos="5" part="chcontent"/>
	  </chunk>
	</out>

	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>

    <rule comment="REGLA: SN SV SA (they live/are happy - viuen feliços (BCN s'ha modificat)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="2" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="2" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	    </out>
	  </otherwise>
	</choose>
	<choose>
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="mf"/>
		  </equal>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="nt"/>
		  </equal>
		</or>
	      </not>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </otherwise>
	</choose>
	<call-macro n="nombre_SN"><!--per al nombre hi ha una macro definida -->
	  <with-param pos="1"/>
	</call-macro>
	<let>
	  <clip pos="3" part="nbr"/>
	  <var n="nombre"/>
	</let>
	<out>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	</out>
      </action>
    </rule>	 
    

    <rule comment="REGLA: SN and SN SV SA (BCN)">
      <pattern>
	<pattern-item n="SNnorel"/>
	<pattern-item n="and"/>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>        <!-- SN1 = pronsubj-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/>        <!-- el nombre del verb pl-->
		  <!--	  <clip pos="1" part="nbr"/>-->
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>     <!-- enviem el SN1 pronom-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <lit-tag v="pl"/><!--BCN-->
		</let>
	      </when>
	    </choose>
	    <choose> <!-- el primer SN-->
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>

	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </otherwise>
	</choose>	



	<choose> <!-- per al segon SN-->
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose> 
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <!-- <and>-->
	      <or>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom_conj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_adj_nom"/>
		</equal>
		<!--   <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="nom_nom"/>
		     </equal> -->
		<!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_nom"/> fer aquest
		     </equal>
		     <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_conj_nom"/>
		     </equal> -->
	      </or>
	    </test>
	    <let>
	      <clip pos="3" part="a_SN"/>
	      <lit-tag v="PDET"/>
	    </let>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	</out>

	<choose> <!-- part del SA per a genere i nombre-->
	  <when>
	    <test>
	      <or>
		<equal>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</equal>
		<equal>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="mf"/>
		</equal>
		<equal>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="m"/>
		</equal>
		<equal>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="mf"/>
		</equal>
	      </or>
	    </test>
	    <let>
	      <clip pos="5" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="5" part="gen"/>
	      <lit-tag v="f"/>
	    </let>
	  </otherwise>
	</choose>
	<let><var n="nombre"/><lit-tag v="pl"/><!--sempre serà pl-->
	</let>
	<let>
	  <clip pos="5" part="nbr"/>
	  <var n="nombre"/>
	</let>
	<out>
	  <b pos="4"/>
	  <chunk>
	    <clip pos="5" part="whole"/>
	  </chunk>
	</out>

	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>


    <!--   <rule comment="REGLA: SN Vcop SA">
	 <pattern>
	 <pattern-item n="SN"/>
	 <pattern-item n="vbcop"/>
	 <pattern-item n="SA"/>	
	 </pattern>
	 <action>
	 <choose>
	 <when>
	 <test>
	 <equal caseless="yes">		
	 <clip pos="2" part="lem"/>
	 <lit v="inf"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="temps"/>
	 <lit-tag v="pri"/>
	 </let>
	 </when>
	 </choose>
	 <choose>
	 <when>
	 <test>
	 <equal caseless="yes">
	 <clip pos="1" part="lem"/>
	 <lit v="prnsubj"/>
	 </equal>
	 </test>	    
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="pers"/>
	 <lit-tag v="PD"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="pers"/>
	 <clip pos="1" part="pers"/>
	 </let>
	 </when>
	 </choose>
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="nbr"/>
	 <clip pos="1" part="nbr"/>
	 </let>
	 </when>
	 </choose>
	 <call-macro n="f_bcond">
	 <with-param pos="1"/>
	 </call-macro>
	 <out>
	 <chunk> el pronom no l'envio, només el 2n chunk 
	 <get-case-from pos="1">
	 <clip pos="2" part="lem"/>
	 </get-case-from>
	 <clip pos="2" part="tags"/>
	 <clip pos="2" part="chcontent"/>
	 </chunk>
	 <b pos="2"/>
	 </out>
	 </when>
	 <otherwise>Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN 
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="1" part="gen"/>
	 <lit-tag v="GD"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="1" part="gen"/>
	 <lit-tag v="m"/>
	 </let>
	 </when>
	 </choose>
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="1" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </test>
	 <choose>
	 <when>
	 <test>
	 <and>
	 <equal>
	 <clip pos="2" part="temps"/>
	 <lit-tag v="pri"/>
	 </equal>
	 <equal>
	 <clip pos="2" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </and>
	 </test>
	 <let>
	 <clip pos="1" part="nbr"/>
	 <lit-tag v="pl"/>
	 </let>
	 </when>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="temps"/>
	 <lit-tag v="pri"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="1" part="nbr"/>
	 <lit-tag v="sg"/>
	 </let>
	 </when>
	 <when>
	 <test>
	 <and>
	 <equal>
	 <clip pos="2" part="temps"/>
	 <lit-tag v="ifip"/>
	 </equal>
	 <equal caseless="yes">
	 <clip pos="2" part="lem"/>
	 <lit v="be"/>
	 </equal>
	 <equal>
	 <clip pos="2" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </and>
	 </test>
	 <let>
	 <clip pos="1" part="nbr"/>
	 <lit-tag v="pl"/>
	 </let>
	 </when>
	 <otherwise>
	 <let>
	 <clip pos="1" part="nbr"/>
	 <lit-tag v="sg"/>
	 </let>
	 </otherwise>
	 </choose>
	 </when>
	 </choose>
	 
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="pers"/>
	 <lit-tag v="PD"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="pers"/>
	 <lit-tag v="p3"/>
	 </let>
	 </when>
	 </choose>
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </test>

<choose>
<when>
<test>
<not>
<equal>
<clip pos="1" part="nbr"/>
<lit-tag v="sp"/>
</equal>
</not>
</test>
<let>
<clip pos="2" part="nbr"/>
<clip pos="1" part="nbr"/>
</let>
</when>
<otherwise>
<let>
<clip pos="2" part="nbr"/>
<lit-tag v="sg"/>
</let>
</otherwise>
</choose>
</when>
</choose>

<out>
<chunk>
<clip pos="1" part="lem"/>
<clip pos="1" part="tags"/>
<clip pos="1" part="chcontent"/>
</chunk>
<b pos="1"/>
<chunk>
<clip pos="2" part="lem"/>
<clip pos="2" part="tags"/>
<clip pos="2" part="chcontent"/>
</chunk>
<b pos="2"/>
</out>
</otherwise>
</choose>
Assigna gènere i nombre a adjectiu (GD i ND) 
<choose>
<when>
<test>
<not>
<or>
<equal>
<clip pos="1" part="gen"/>
<lit-tag v="mf"/>
</equal>
<equal>  això ho he afegit jo perquè a vegades agafa "it" com a prn.obj.p3.nt i després el passa per aquesta regla (ex: pointed out it is dificult). no estic segura que sigui la millor solució. -carme
<clip pos="1" part="gen"/>
<lit-tag v="nt"/>
</equal>
</or>
</not>
</test>
<let>
<clip pos="3" part="gen"/>
<clip pos="1" part="gen"/>
</let>
</when>
<otherwise>
<let>
<clip pos="3" part="gen"/>
<lit-tag v="m"/>
</let>
</otherwise>
</choose>
<choose>
<when>
<test>
<not>
<equal>
<clip pos="1" part="nbr"/>
<lit-tag v="sp"/>
</equal>
</not>
</test>
<let>
<clip pos="3" part="nbr"/>
<clip pos="1" part="nbr"/>
</let>
</when>
<otherwise>
<let>
<clip pos="3" part="nbr"/>
<lit-tag v="sg"/>
</let>
</otherwise>
</choose>

<out>
<chunk>
<clip pos="3" part="lem"/>
<clip pos="3" part="tags"/>
<clip pos="3" part="chcontent"/>
</chunk>
</out>
<call-macro n="nombre_SN">
<with-param pos="1"/>
</call-macro>	  
</action>
</rule>-->



    <rule comment="REGLA: SN SV SA and SA (BCN)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>	
	<pattern-item n="cnjcoo"/>	
	<pattern-item n="SA"/>	
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="2" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="2" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="2" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="2" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="2" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="2" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>

		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="2" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </otherwise>
	</choose>
	<!--Assigna gènere i nombre a adjectiu (GD i ND) -->
	<choose>
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="mf"/>
		  </equal>
		  <equal> <!-- això ho he afegit jo perquè a vegades agafa "it" com a prn.obj.p3.nt i després el passa per aquesta regla (ex: pointed out it is dificult). no estic segura que sigui la millor solució. -carme-->
		    <clip pos="1" part="gen"/>
		    <lit-tag v="nt"/>
		  </equal>
		</or>
	      </not>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	    <let>
	      <clip pos="5" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	    <let>
	      <clip pos="5" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </otherwise>
	</choose>
	<choose>
	  <when>
	    <test>
	      <not>
		<equal>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sp"/>
		</equal>
	      </not>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	    <let>
	      <clip pos="5" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
	      <clip pos="5" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </otherwise>
	</choose>

	<out>
	  <chunk>
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="whole"/>
	  </chunk>
	  <b pos="4"/>
	  <chunk>
	    <clip pos="5" part="lem"/>
	    <clip pos="5" part="tags"/>
	    <clip pos="5" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>	  
      </action>
    </rule>


    <rule comment="REGLA: SN SP SV SA and SA (BCN)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="pr"/>
	<pattern-item n="SNnorel"/>	
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>	
	<pattern-item n="cnjcoo"/>	
	<pattern-item n="SA"/>	
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="4" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="4" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<get-case-from pos="1">
		  <clip pos="4" part="lem"/>
		</get-case-from>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="4" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="4" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="4" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="4" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="4" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="4" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>

		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="4" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->

	    <choose> <!-- quan tenim 'of which' en el segon SN i ens ve sense genere i nombre-->
	      <when>
		<test>
		  <or>
		    <equal>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="ND"/>
		    </equal>
		    <equal>
		      <clip pos="3" part="gen"/>
		      <lit-tag v="GD"/>
		    </equal>
		  </or>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
		<let>
		  <clip pos="3" part="gen"/>
		  <clip pos="1" part="gen"/>
		</let>
	      </when>
	    </choose>
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	      <chunk>
		<clip pos="4" part="lem"/>
		<clip pos="4" part="tags"/>
		<clip pos="4" part="chcontent"/>
	      </chunk>
	      <b pos="4"/>
	    </out>
	  </otherwise>
	</choose>
	<!--Assigna gènere i nombre a adjectiu (GD i ND) -->
	<choose>
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="mf"/>
		  </equal>
		  <equal> <!-- això ho he afegit jo perquè a vegades agafa "it" com a prn.obj.p3.nt i després el passa per aquesta regla (ex: pointed out it is dificult). no estic segura que sigui la millor solució. -carme-->
		    <clip pos="1" part="gen"/>
		    <lit-tag v="nt"/>
		  </equal>
		</or>
	      </not>
	    </test>
	    <let>
	      <clip pos="5" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	    <let>
	      <clip pos="7" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="5" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	    <let>
	      <clip pos="7" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </otherwise>
	</choose>
	<choose>
	  <when>
	    <test>
	      <not>
		<equal>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sp"/>
		</equal>
	      </not>
	    </test>
	    <let>
	      <clip pos="5" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	    <let>
	      <clip pos="7" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="5" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
	      <clip pos="7" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </otherwise>
	</choose>

	<out>
	  <chunk>
	    <clip pos="5" part="lem"/>
	    <clip pos="5" part="tags"/>
	    <clip pos="5" part="chcontent"/>
	  </chunk>
	  <b pos="5"/>
	  <chunk>
	    <clip pos="6" part="whole"/>
	  </chunk>
	  <b pos="6"/>
	  <chunk>
	    <clip pos="7" part="lem"/>
	    <clip pos="7" part="tags"/>
	    <clip pos="7" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>	  
      </action>
    </rule>



    <rule comment="REGLA: SN adv SV SA (BCN s'ha modificat vcop -> SV)">
      <pattern>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>	
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <clip pos="1" part="nbr"/>
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>
		<get-case-from pos="1">
		  <clip pos="2" part="lem"/>
		</get-case-from>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk><!--el pronom no l'envio, només el 2n chunk -->
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	    </out>
	  </when>
	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="3" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="3" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="3" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="3" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="3" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="3" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="3" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="3" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>

		<choose>
		  <when>
		    <test>
		      <not>
			<equal>
			  <clip pos="1" part="nbr"/>
			  <lit-tag v="sp"/>
			</equal>
		      </not>
		    </test>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <clip pos="1" part="nbr"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="3" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <!--BCN (posa el PDET si cal)-->

	    <choose>
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>
	    <!--BCN (posa el PDET si cal)-->
	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="lem"/>
		<clip pos="2" part="tags"/>
		<clip pos="2" part="chcontent"/>
	      </chunk>
	      <b pos="2"/>
	      <chunk>
		<clip pos="3" part="lem"/>
		<clip pos="3" part="tags"/>
		<clip pos="3" part="chcontent"/>
	      </chunk>
	      <b pos="3"/>
	    </out>
	  </otherwise>
	</choose>
	<!--Assigna gènere i nombre a adjectiu (GD i ND) -->
	<choose>
	  <when>
	    <test>
	      <not>
		<or>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="mf"/>
		  </equal>
		  <equal> <!-- això ho he afegit jo perquè a vegades agafa "it" com a prn.obj.p3.nt i després el passa per aquesta regla (ex: pointed out it is dificult). no estic segura que sigui la millor solució. -carme-->
		    <clip pos="1" part="gen"/>
		    <lit-tag v="nt"/>
		  </equal>
		</or>
	      </not>
	    </test>
	    <let>
	      <clip pos="4" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="4" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </otherwise>
	</choose>
	<choose>
	  <when>
	    <test>
	      <not>
		<equal>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sp"/>
		</equal>
	      </not>
	    </test>
	    <let>
	      <clip pos="4" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="4" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </otherwise>
	</choose>

	<out>
	  <chunk>
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>	  
      </action>
    </rule>



    <rule comment="REGLA: SN and SN ADV SV SA (BCN)">
      <pattern>
	<pattern-item n="SNnorel"/>
	<pattern-item n="and"/>
	<pattern-item n="SN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="SV"/>
	<pattern-item n="SA"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="5" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="5" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>        <!-- SN1 = pronsubj-->
	  <when>
	    <test>
	      <equal caseless="yes">
		<clip pos="1" part="lem"/>
		<lit v="prnsubj"/>
	      </equal>
	    </test>	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="pers"/>
		  <clip pos="1" part="pers"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="nbr"/>
		  <lit-tag v="pl"/>        <!-- el nombre del verb pl-->
		  <!--	  <clip pos="1" part="nbr"/>-->
		</let>
	      </when>
	    </choose>
	    <call-macro n="f_bcond">
	      <with-param pos="1"/>
	    </call-macro>
	    <out>
	      <chunk>     <!-- enviem el SN1 pronom-->
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </when>


	  <otherwise><!--Quan SN no és pronom subjecte, per tant, quan és qualsevol altre SN -->
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<choose>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="5" part="temps"/>
			  <lit-tag v="pri"/>
			</equal>
			<equal>
			  <clip pos="5" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <equal>
			<clip pos="5" part="temps"/>
			<lit-tag v="pri"/>
		      </equal>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </when>
		  <when>
		    <test>
		      <and>
			<equal>
			  <clip pos="5" part="temps"/>
			  <lit-tag v="ifip"/>
			</equal>
			<equal caseless="yes">
			  <clip pos="5" part="lem"/>
			  <lit v="be"/>
			</equal>
			<equal>
			  <clip pos="5" part="nbr"/>
			  <lit-tag v="ND"/>
			</equal>
		      </and>
		    </test>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="pl"/>
		    </let>
		  </when>
		  <otherwise>
		    <let>
		      <clip pos="1" part="nbr"/>
		      <lit-tag v="sg"/>
		    </let>
		  </otherwise>
		</choose>
	      </when>
	    </choose>
	    
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="5" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="5" part="nbr"/>
		  <lit-tag v="pl"/><!--BCN-->
		</let>
	      </when>
	    </choose>
	    <choose> <!-- el primer SN-->
	      <when>
		<test>
		  <!-- <and>-->
		  <or>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="nom_conj_nom"/>
		    </equal>
		    <equal caseless="yes">
		      <clip pos="1" part="lem"/>
		      <lit v="adj_adj_nom"/>
		    </equal>
		    <!--   <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="nom_nom"/>
			 </equal> -->
		    <!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_nom"/> fer aquest
			 </equal>
			 <equal caseless="yes">
			 <clip pos="1" part="lem"/>
			 <lit v="adj_nom_conj_nom"/>
			 </equal> -->
		  </or>
		</test>
		<let>
		  <clip pos="1" part="a_SN"/>
		  <lit-tag v="PDET"/>
		</let>
	      </when>
	    </choose>

	    <out>
	      <chunk>
		<clip pos="1" part="lem"/>
		<clip pos="1" part="tags"/>
		<clip pos="1" part="chcontent"/>
	      </chunk>
	      <b pos="1"/>
	      <chunk>
		<clip pos="2" part="whole"/>
	      </chunk>
	      <b pos="2"/>
	    </out>
	  </otherwise>
	</choose>	



	<choose> <!-- per al segon SN-->
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose> 
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <!-- <and>-->
	      <or>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="nom_conj_nom"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="3" part="lem"/>
		  <lit v="adj_adj_nom"/>
		</equal>
		<!--   <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="nom_nom"/>
		     </equal> -->
		<!--  <equal caseless="yes"> Aquests encara no estan posats en t3x
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_nom"/> fer aquest
		     </equal>
		     <equal caseless="yes">
		     <clip pos="3" part="lem"/>
		     <lit v="adj_nom_conj_nom"/>
		     </equal> -->
	      </or>
	    </test>
	    <let>
	      <clip pos="3" part="a_SN"/>
	      <lit-tag v="PDET"/>
	    </let>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	  <b pos="3"/>
	  <chunk>
	    <clip pos="4" part="lem"/>
	    <clip pos="4" part="tags"/>
	    <clip pos="4" part="chcontent"/>
	  </chunk>
	  <b pos="4"/>
	  <chunk>
	    <clip pos="5" part="lem"/>
	    <clip pos="5" part="tags"/>
	    <clip pos="5" part="chcontent"/>
	  </chunk>
	</out>
	<choose> <!-- part del SA per a genere i nombre-->
	  <when>
	    <test>
	      <or>
		<equal>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="m"/>
		</equal>
		<equal>
		  <clip pos="1" part="gen"/>
		  <lit-tag v="mf"/>
		</equal>
		<equal>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="m"/>
		</equal>
		<equal>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="mf"/>
		</equal>
	      </or>
	    </test>
	    <let>
	      <clip pos="6" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <clip pos="6" part="gen"/>
	      <lit-tag v="f"/>
	    </let>
	  </otherwise>
	</choose>
	<let><var n="nombre"/><lit-tag v="pl"/><!--sempre serà pl-->
	</let>
	<let>
	  <clip pos="6" part="nbr"/>
	  <var n="nombre"/>
	</let>
	<out>
	  <b pos="5"/>
	  <chunk>
	    <clip pos="6" part="whole"/>
	  </chunk>
	</out>

	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>

    <rule comment="REGLA: SN PP (patients treated -> pacients tractats)">
      <pattern>
	<pattern-item n="SN_nopron"/>
	<pattern-item n="pp"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <and>
		<equal>
		  <clip pos="2" part="gen"/>
		  <lit-tag v="GD"/>
		</equal>
		<not>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</not>
	      </and>
	    </test>
	    <let>
	      <clip pos="2" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <equal>
		<clip pos="2" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <and>
		<equal>
		  <clip pos="2" part="nbr"/>
		  <lit-tag v="ND"/>
		</equal>
		<not>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</not>
	      </and>
	    </test>
	    <let>
	      <clip pos="2" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <equal>
		<clip pos="2" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose> 
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="lem"/>
	    <clip pos="2" part="tags"/>
	    <clip pos="2" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>


    <rule comment="REGLA: SN ADV PP (representatives freely elected )">
      <pattern>
	<pattern-item n="SN_nopron"/>
	<pattern-item n="ADV"/>
	<pattern-item n="pp"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <and>
		<equal>
		  <clip pos="3" part="gen"/>
		  <lit-tag v="GD"/>
		</equal>
		<not>
		  <equal>
		    <clip pos="1" part="gen"/>
		    <lit-tag v="GD"/>
		  </equal>
		</not>
	      </and>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <clip pos="1" part="gen"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <and>
		<equal>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="ND"/>
		</equal>
		<not>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</not>
	      </and>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <clip pos="1" part="nbr"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose> 
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="lem"/>
	    <clip pos="3" part="tags"/>
	    <clip pos="3" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>

 
    
    
    <rule comment="REGLA: RELAN SV">
      <pattern>
	<pattern-item n="RELAN"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="2" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="2" part="pers"/>
		<lit-tag v="PD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="2" part="pers"/>
	      <lit-tag v="p3"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="2" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <var n="nombre"/>
		      <lit v=""/>
		    </equal>
		  </not>
		</test>
		<let>
		  <clip pos="2" part="nbr"/>
		  <var n="nombre"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <clip pos="2" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </otherwise>
	    </choose>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="lem"/>
	    <clip pos="2" part="tags"/>
	    <clip pos="2" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule> 
    

    <rule comment="REGLA: RELAN ADV SV">
      <pattern>
	<pattern-item n="RELAN"/>
	<pattern-item n="ADV"/>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal caseless="yes">		
		<clip pos="3" part="lem"/>
		<lit v="inf"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="temps"/>
	      <lit-tag v="pri"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="pers"/>
		<lit-tag v="PD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="3" part="pers"/>
	      <lit-tag v="p3"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="3" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <choose>
	      <when>
		<test>
		  <not>
		    <equal>
		      <var n="nombre"/>
		      <lit v=""/>
		    </equal>
		  </not>
		</test>
		<let>
		  <clip pos="3" part="nbr"/>
		  <var n="nombre"/>
		</let>
	      </when>
	      <otherwise>
		<let>
		  <clip pos="3" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </otherwise>
	    </choose>
	  </when>
	</choose>

	<out>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	  <b pos="1"/>
	  <chunk>
	    <clip pos="2" part="whole"/>
	  </chunk>
	  <b pos="2"/>
	  <chunk>
	    <clip pos="3" part="whole"/>
	  </chunk>
	</out>
      </action>
    </rule> 
    


    <!--Regles per a sintagmes sols que han pogut quedarse amb GD, ND o PD -->

    <rule comment="REGLA: SA (per assignar gènere i nombre si hi ha GD i ND que no s'han pogut determinar)">
      <pattern>
	<pattern-item n="SA"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal><!--Actualment, si és GD sempre serà també ND -->
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>	    
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>

    <rule comment="REGLA: SN (per assignar gènere i nombre si hi ha GD i ND que no s'han pogut determinar, com passa en alguns pronoms: both, etc.)">
      <pattern>
	<pattern-item n="SN"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	</out>
	<call-macro n="nombre_SN">
	  <with-param pos="1"/>
	</call-macro>
      </action>
    </rule>



    <rule comment="REGLA: DET (per assignar gènere i nombre si hi ha GD i ND que no s'han pogut determinar, com passa en alguns pronoms: both, etc.)">
      <pattern>
	<pattern-item n="DET"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="nbr"/>
		<lit-tag v="ND"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>

    <rule comment="REGLA: SV (per assignar persona i nombre si hi ha PD i ND que no s'han pogut determinar, escepte per als infinitius ">
      <pattern>
	<pattern-item n="SV"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <not>
		<equal>
		  <clip pos="1" part="temps"/>
		  <lit-tag v="inf"/>
		</equal>
	      </not>
	    </test>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="pers"/>
		    <lit-tag v="PD"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="pers"/>
		  <lit-tag v="p3"/>
		</let>
	      </when>
	    </choose>
	    <choose>
	      <when>
		<test>
		  <equal>
		    <clip pos="1" part="nbr"/>
		    <lit-tag v="ND"/>
		  </equal>
		</test>
		<let>
		  <clip pos="1" part="nbr"/>
		  <lit-tag v="sg"/>
		</let>
	      </when>
	    </choose>
	  </when>
	</choose>
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>


    <rule comment="REGLA: NUM (per assignar gènere si hi ha GD)">
      <pattern>
	<pattern-item n="NUM"/>
      </pattern>
      <action>
	<choose>
	  <when>
	    <test>
	      <equal>
		<clip pos="1" part="gen"/>
		<lit-tag v="GD"/>
	      </equal>
	    </test>
	    <let>
	      <clip pos="1" part="gen"/>
	      <lit-tag v="m"/>
	    </let>
	  </when>
	</choose>	
	<out>
	  <chunk>
	    <clip pos="1" part="lem"/>
	    <clip pos="1" part="tags"/>
	    <clip pos="1" part="chcontent"/>
	  </chunk>
	</out>
      </action>
    </rule>


    <rule> <!-- REGLA: reset variables-->
      <pattern>
	<pattern-item n="punt"/>
      </pattern>
      <action>
	<let>
	  <var n="nombre"/>
	  <lit-tag v="sg"/>
	</let>
	<out>
	  <chunk>
	    <clip pos="1" part="whole"/>
	  </chunk>
	</out>
      </action>
    </rule>


    <!-- <rule comment="REGLA: PRNS SV">
	 <pattern>
	 <pattern-item n="SN"/>
	 <pattern-item n="SV"/>
	 </pattern>
	 <action>
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="pers"/>
	 <lit-tag v="PD"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="pers"/>
	 <clip pos="1" part="pers"/>
	 </let>
	 </when>
	 </choose>
	 <choose>
	 <when>
	 <test>
	 <equal>
	 <clip pos="2" part="nbr"/>
	 <lit-tag v="ND"/>
	 </equal>
	 </test>
	 <let>
	 <clip pos="2" part="nbr"/>
	 <clip pos="1" part="nbr"/>
	 </let>
	 </when>
	 </choose>

<out>
<chunk>
<clip pos="2" part="lem"/>
<clip pos="2" part="tags"/>
<clip pos="2" part="chcontent"/>
</chunk>
</out>
</action>
</rule> -->



  </section-rules>
</interchunk>
